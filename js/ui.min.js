function bodyOnKeyPress(a){a&&a.hasOwnProperty("preventDefault")&&a.preventDefault(),_nex&&_nex.navBarListener&&_nex.navBarListener.keyPressed(null,a)}function CommandFactory(){var a=this;a.isCommandSupport=function(a){var b=!1;switch(a.name){case"ADDTOORDERRESPONSE":case"COMPLETEORDER":case"TENDERADDED":case"CANCELORDERRESPONSE":case"CARDSWIPE":case"CONSOLIDATEORDERRESPONSE":case"COUPONRESPONSE":case"CREATEORDERRESPONSE":case"CUSTOMERRESPONSE":case"DEVICELOOKUPRESPONSE":case"EMPLOYEERESPONSE":case"GENERICINQUIRYRESPONSE":case"LICENSEUPDATE":case"LOADORDERRESPONSE":case"LOYALTYRESPONSE":case"ORDERPROCESSED":case"ORDERTOTAL":case"PAYMENTRESPONSE":case"PREVIOUSORDERS":case"PROCESSLOYALTYRESPONSE":case"PROCESSTENDERRESPONSE":case"PROXIMITYTRIGGERED":case"REMOVEFROMORDERRESPONSE":case"SERVERSTATUS":case"SETSERVICEMODE":case"UPDATEQUANTITYRESPONSE":case"UPDATETENDERRESPONSE":case"EMPLOYEESECURITYCHECK":case"EMPLOYEESECURITYCHECKRESPONSE":case"SWITCHAPPLICATION":case"ITEMWEIGHT":case"ITEMLOOKUP":case"ITEMLOOKUPRESPONSE":case"ORDERLOOKUP":case"ORDERLOOKUPRESPONSE":case"UPDATEKIOSK":case"WINDOWONTOP":b=!0;break;default:console.log("command is not supported; name: "+a.name)}return b}}function Communication(a){var b=this;b.connection=a.connection||null,b.commandFactory=a.commandFactory||null,b.device=a.device||null,b.subscribers=[],b.connection.close(),b.debugEnabled=!0,b.debug=function(){b.debugEnabled&&console.debug(arguments)},b.createListener=function(a,b,c){return{cmdName:a,callback:b,autoRemove:c||!1}},b.connect=function(){null!==b.connection&&b.connection.connect()},b.close=function(){null!==b.connection&&b.connection.close()},b.send=function(a,c,d){"WRITETOLOG"!==a.name&&b.debug("communication - send message "+a.name,a);var e=a.write();e[a.name]=$.extend(!0,{pcid:b.device.computerName()},e[a.name]);var f=JSON.stringify(e[a.name]);d=d||"",d.length>0&&b.addListener(b.createListener(d,c,!0)),null!==b.connection&&b.connection.send(a.name,f)},b.receive=function(a){if(a.length>0){b.debug("communication - received message "+a.substring(0,25),{data:a});var c=JSON.parse(a);if(b.commandFactory.isCommandSupport(c)){c[c.name].responseReceived="true";for(var d=[],e=0;e<b.subscribers.length;e++)b.subscribers[e].cmdName===c.name&&(b.subscribers[e].autoRemove?(b.debug("communication - calling callback "+c.name),b.subscribers[e].callback(c[c.name]),d.push(b.subscribers[e])):(b.debug("communication - calling callback "+c.name),b.subscribers[e].callback(c.name,c[c.name])));for(var f=0;f<d.length;f++)b.removeListener(d[f]);d=null}}else b.debug("communication - received message "+a,{data:a})},b.addListener=function(a){"string"==typeof a.cmdName&&"function"==typeof a.callback&&b.subscribers.push(a)},b.removeListener=function(a){for(var c=b.subscribers.length-1;c>=0;c--)b.subscribers[c]===a&&b.subscribers.splice(c,1)}}function correctMathError(a){return a=Math.round(100*a),a/100}function copyrightNotice(){var a="Copyright 2014-2016 NEXTEP SYSTEMS, Inc. All rights reserved.";if(_nex.authToken.hasOwnProperty("copyright"))for(a=_nex.authToken.copyright;a.indexOf("%lt;")>0&&a.indexOf("%gt;")>0;)a=a.replace("%lt;","<").replace("%gt;",">");return a}function restrictCharacters(a,b,c){b||(b=window.event),b.keyCode?code=b.keyCode:b.which&&(code=b.which);var d=String.fromCharCode(code);return 27==code?(this.blur(),!1):b.ctrlKey||9===code||8===code||46===code||36===code||37===code||38===code||39===code&&(39!==code||"'"!==d)||40===code?!0:!!d.match(c)}function htmlEscape(a){return String(a).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function htmlUnescape(a){return String(a).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}function dimScreen(a){try{a=Number(a);var b=$("#dimmer");if(1!==a){var c="rgba(0,0,0,"+a.toString()+")";0===b.length?$("body").append('<div id="dimmer" style="position:fixed;top:0;left:0;right:0;bottom:0;z-index:5000;pointer-events: none;background-color:'+c+';"></div>'):b.css("background-color",c)}else b.length>0&&b.remove()}catch(d){}}function appSwitcherVerify(){if("off"!==_alternateui.toLowerCase()){_alternateui="EOS";var a=$.extend(!0,{},_nex.assets.popupManager.pinpadPopup);a.autotimeout=!0,a.buttons[0].clickEvent="validateCapability()",a.message=_nex.assets.theme.getTextAttribute("ORDER","switchapplication","Please enter your PIN to switch applications"),_nex.assets.popupManager.showPopup(a,function(){},1e4),_nex.keyboard.numpad.bindKeys()}}function validateCapability(){var a=_nex.keyboard.numpad.data;_nex.communication.send(new _nex.commands.EmployeeSecurityCheck(a,"SwitchApplication"),function(a){"true"===a.responseReceived?employeeCapabilityResponse(a):console.error("EmployeeSecurityCheck Failed!")},"EMPLOYEESECURITYCHECKRESPONSE")}function employeeCapabilityResponse(a){if(void 0===a.EMPLOYEE){var b=$.extend(!0,{},_nex.assets.popupManager.errorPopup);b.message=_nex.assets.theme.getTextAttribute("ORDER","switchapplicationnotallowed","You are not authorized to switch applications"),_nex.assets.popupManager.showPopup(b)}else _nex.communication.send(new _nex.commands.SwitchApplication(_alternateui),function(a){})}function refreshOrderTimer(){if(_nex.utility.orderTimer)_nex.utility.orderTimer.restart();else{var a=_nex.assets.theme.getTextAttribute("ORDER","needmoretime","Need more time?");_nex.utility.orderTimer=new OrderTimer(_nex.assets.popupManager,a,_nex.assets.phaseManager,"_nex.utility.orderTimer.needMoreTimeClicked();"),_nex.utility.orderTimer.restart();var b=function(){_nex.utility.orderTimer.restart(),$("#popup-message").modal("hide"),$("#popup-error").modal("hide"),console.debug("restarted order timer"),_nex.ordering&&_nex.ordering.resetNudge()},c="keypress scroll click swipe taphold tap touchmove keydown";$(document).off(c,b),$(document).on(c,b)}}function inPreviewer(){try{return window.self!==window.top}catch(a){return!0}}function Manager(a){function b(){console.debug("Popup manager has finished loading... Popups can now be shown.")}var c=this;c.communication=a.communication,c.theme=a.theme,c.phaseManager=a.phaseManager,c.pages=null,c.offlinepage="offline.html",c.initialphase="splash",c.mediaPath="",c.deviceType="",c.reason="",c.preferredStatus="",c.currentStatus="Unknown",c.connectedToTM=!1,c.statusType={IDLE:"Idle",UNKNOWN:"Unknown",OFFLINE:"Offline",ORDERING:"Ordering",SMS:"Sms",PAYMENT:"Payment",PROCESSING:"Processing",COMPLETING:"Completing",UPDATING:"Updating",COMPLETE:"Complete",PRINTER_ERROR:"PrinterError",POS_OFFLINE:"POSOffline",SURVEY:"Survey",PREVIOUS_ORDERS:"PreviousOrders",POST_ORDERING:"Completing",PAUSED:"Paused",CASH_ERROR:"CashError",EXPIRED:"Expired",SERVICE_REQUEST:"ServiceRequest",WAITING:"Waiting",PAYMENT_REQUEST:"PaymentRequest",RESERVATIONS:"Reservations"},c.init=function(a,b,d,e){if(c.deviceType=a,e.hasOwnProperty("offlinepage")&&e.offlinepage.length>0&&(c.offlinepage=e.offlinepage),b.length>0&&$("#themecss").length>0)if(c.mediaPath=d,-1===d.toLowerCase().indexOf(b.toLowerCase())&&(c.mediaPath+=b),c.mediaPath+="/media/html/",c.mediaPath=c.mediaPath.replace("//","/"),inPreviewer()){c.mediaPath="../Media.aspx?media=html/";var f="../Media.aspx?media=html/css/"+a.toLowerCase()+".css";console.debug("manager.init: loading css "+f),$("#themecss").attr("href",f)}else $("#themecss").attr("href",c.mediaPath+"css/"+a+".css")},c.commandReceived=function(a,b){"LICENSEUPDATE"===a?window.dimScreen(b.screendim):"SERVERSTATUS"===a?"true"===b.connected.toLowerCase()?(c.connectedToTM=!0,c.communication.send(new _nex.commands.Preamble)):(c.connectedToTM=!1,c.offline(!0)):"SETSERVICEMODE"===a?(c.preferredStatus=b.setstatus,c.reason=b.hasOwnProperty("reason")?b.reason:"",c.resetStatus()):"UPDATEKIOSK"===a?(c.theme.loadUpdate(b),c.update()):"WINDOWONTOP"===a&&(console.debug(_nex.device),_nex.device&&_nex.device.hasOwnProperty("stopTimer")&&_nex.device.stopTimer())},c.getStatusMessage=function(a){var b="";switch(a){case c.statusType.OFFLINE:b=c.connectedToTM?c.theme.getTextAttribute("STATUS","offline","We will reopen at {0}"):c.theme.getTextAttribute("STATUS","unknown","Connecting to TM...");break;case c.statusType.PRINTER_ERROR:b=c.theme.getTextAttribute("STATUS","printererror","Service Printer");break;case c.statusType.EXPIRED:b=c.theme.getTextAttribute("STATUS","expireerror","Subscription Expired");break;case c.statusType.UNKNOWN:b=c.theme.getTextAttribute("STATUS","unknown","Connecting to TM...");break;case c.statusType.IDLE:b="";break;default:b=c.theme.getTextAttribute("STATUS",a,c.reason)}return b},c.setCurrentStatus=function(a,b){c.currentStatus!==a&&(c.currentStatus=a,_nex.pendingKioskCssChange&&c.cssUpdated(),c.updateStatusDisplay(),b&&c.communication.send(new _nex.commands.KioskStatus(a)))},c.updateStatusDisplay=function(){c.currentStatus===this.statusType.IDLE?_nex.assets.offline.hide():_nex.assets.offline.update(c.getStatusMessage(c.currentStatus),c.reason)},c.cssUpdated=function(){return _nex.pendingKioskCssChange?c._validStatusForUpdate()?(console.log("manager.js.cssUpdated: Received kiosk.css change and in a good status... Reloading."),_nex.pendingKioskCssChange=!1,void window.location.reload(!0)):void console.log("manager.js.cssUpdated: Received kiosk.css change but not in a good state to reload kiosk.css..."):void console.log("manager.js.cssUpdated: There are no pending kiosk CSS changes.")},c._validStatusForUpdate=function(){return c.currentStatus===c.statusType.OFFLINE||c.currentStatus===c.statusType.IDLE||c.currentStatus===c.statusType.PRINTER_ERROR||c.currentStatus===c.statusType.UNKNOWN||c.currentStatus===c.statusType.POS_OFFLINE||c.currentStatus===c.statusType.CASH_ERROR||c.currentStatus===c.statusType.EXPIRED},c.update=function(){c.currentStatus!==c.statusType.OFFLINE&&c.currentStatus!==c.statusType.IDLE&&c.currentStatus!==c.statusType.PRINTER_ERROR&&c.currentStatus!==c.statusType.UNKNOWN&&c.currentStatus!==c.statusType.POS_OFFLINE&&c.currentStatus!==c.statusType.CASH_ERROR&&c.currentStatus!==c.statusType.EXPIRED||(c.setCurrentStatus(c.statusType.UPDATING,!0),c.theme.applyUpdate(b),c.phaseManager.loadTheme(c.theme.lastUpdate.THEMES.THEME.PHASE),c.start(),_nex.assets.theme.system.hasOwnProperty("USERINTERFACE")&&_nex.assets.theme.system.USERINTERFACE.hasOwnProperty("alternateui")&&"kiosk"===_nex.assets.theme.system.USERINTERFACE.alternateui.toLowerCase()?$("#appSwitcher").show():$("#appSwitcher").hide())},c.resetStatus=function(){c.currentStatus!==c.statusType.IDLE&&c.currentStatus!==c.statusType.OFFLINE&&c.currentStatus!==c.statusType.PRINTER_ERROR&&c.currentStatus!==c.statusType.UNKNOWN&&c.currentStatus!==c.statusType.UPDATING&&c.currentStatus!==c.statusType.POS_OFFLINE&&c.currentStatus!==c.statusType.CASH_ERROR&&c.currentStatus!==c.statusType.EXPIRED||c.currentStatus!==c.preferredStatus&&c.start()},c.start=function(){0===c.preferredStatus.length&&(c.preferredStatus=c.statusType.IDLE),c.preferredStatus!==c.statusType.PRINTER_ERROR&&c.currentStatus!==c.statusType.PRINTER_ERROR||null!==_nex.greenReceipt&&_nex.greenReceipt._greenReceiptEnabled()&&(c.preferredStatus=c.statusType.IDLE,c.currentStatus=c.statusType.IDLE),c.preferredStatus!=c.currentStatus&&c.setCurrentStatus(c.preferredStatus,!0),c.currentStatus===c.statusType.IDLE?inPreviewer()&&!_nex.splashPhase.redirected?(_nex.splashPhase.firstTimeToStart(),_nex.splashPhase.redirected=!0):(_nex.splashPhase.stop(),c.splash()):(_nex.splashPhase.stop(),c.offline())},c.splash=function(){var a=function(){console.debug("Splash HTML finished loading")},b=function(){console.debug("Splash JS finished loading");var a=document.getElementById("wrap");a&&(a.style.left="0",a.style.top="0",a.style.width="100%",a.style.height="100%")};_nex.assets.theme.isUpdateAvailable&&(_nex.assets.theme.applyUpdate(),c.phaseManager.loadTheme(c.theme.lastUpdate.THEMES.THEME.PHASE)),c.phaseManager.changePhase(c.phaseManager.phaseType.SPLASH,a,b)},c.offline=function(){c.phaseManager.goOffline(function(){c.currentStatus!==c.statusType.PRINTER_ERROR&&c.currentStatus!==c.statusType.UNKNOWN&&c.currentStatus!==c.statusType.POS_OFFLINE&&c.currentStatus!==c.statusType.CASH_ERROR&&c.currentStatus!==c.statusType.EXPIRED&&c.setCurrentStatus(c.statusType.OFFLINE,!0),c.updateStatusDisplay()})},c.sendStatusUpdate=function(a){c.currentStatus=a,_nex.communication.send(new _nex.commands.KioskStatus(c.currentStatus))},c.cancelCurrentPhase=function(){c.start()},c.formatError=function(a,b){return'<div class="alert alert-danger"><h2>'+a+"</h2><h3>"+b+"</h3></div>"},c.communication.addListener(c.communication.createListener("LICENSEUPDATE",c.commandReceived)),c.communication.addListener(c.communication.createListener("SERVERSTATUS",c.commandReceived)),c.communication.addListener(c.communication.createListener("SETSERVICEMODE",c.commandReceived)),c.communication.addListener(c.communication.createListener("UPDATEKIOSK",c.commandReceived)),c.communication.addListener(c.communication.createListener("LAUNCHREMOTESUPPORT",c.commandReceived)),c.communication.addListener(c.communication.createListener("WINDOWONTOP",c.commandReceived))}function BarcodeListener(a){var b=this;b._lastkeyCallback=a,b._barcodeData=new DeviceData,b._receiveBarcodeKey=function(a,c){var d=b._barcodeData.appendBarcode(a,c);d&&d.length>0&&(b._lastkeyCallback(d),b.clearData())},b._simpleListener=new SimpleListener(b._receiveBarcodeKey),b.startListening=function(){b._simpleListener.startListening()},b.stopListening=function(){b._simpleListener.stopListening()},b.getData=function(){return b._barcodeData.get()},b.clearData=function(){b._barcodeData.clear()}}function ButtonBinder(a,b,c,d){var e=this;e._setControlButtonText=a,e._setButtonText=b,e._trackClick=c,e._playButtonHit=d,e._debugEnabled=!1,e._debug=function(){console.debug("ButtonBinder",arguments)},e.bind=function(a,b,c,d,f){var g=$("#"+a);return 0===g.length?void e._debug("ButtonBinder","Could not find button "+a):(d?e._setControlButtonText(a,b):e._setButtonText(a,b),g.unbind("click"),g.click(function(){e._trackClick(g),e._playButtonHit(),c&&c()}),void(f&&g.addClass(f)))},e.unbind=function(){var a=$("#"+buttonId);a.length>0&&a.unbind("click")}}function ButtonTracking(a){var b=this;b.trackMenuButton=void 0!==a&&void 0!==a.menu?a.menu:"true",b.trackPaymentButton=void 0!==a&&void 0!==a.payment?a.payment:"true",b.trackLanguageButton=void 0!==a&&void 0!==a.language?a.language:"true",b.trackGreenReceiptButton=void 0!==a&&void 0!==a.greenreceipt?a.greenreceipt:"true",b.trackControlButton="true",b.trackedButtonList=[],b.debugButtonHits=!1,b._debugButtonHit=function(a){b.debugButtonHits&&console.debug(a)},b.reset=function(){b.trackedButtonList=[]},b._convertToAttribute=function(a){var b=0,c="";if(a){var d=parseInt(a);c=isNaN(d)?"":b>d?"":d}return c},b._cleanProperty=function(a,c){var d=64,e=128,f="";switch(a){case"id":f=b._convertToAttribute(c);break;case"text":f=c.substring(0,d);break;case"phase":f=c.substring(0,d);break;case"menuid":f=b._convertToAttribute(c);break;case"context":f=c.substring(0,e);break;case"buttontype":f=b._getType(c)}return f},b.writeButtonUsage=function(){for(var a=[],c=0;c<b.trackedButtonList.length;c++){var d,e=b.trackedButtonList[c],f={};for(var g in e)"id"!==g&&"text"!==g&&"phase"!==g&&"menuid"!==g&&"context"!==g&&"buttontype"!==g||(d=e[g],d=b._cleanProperty(g,d),f[g]=d);a.push(f)}return{BUTTON:a}},b.track=function(a,c,d,e,f){var g=b._create(a,c,d,e,f);b._addToBuffer(g)},b._create=function(a,b,c,d,e){var f={};return f.id=a,f.text=$.trim(b),f.phase=_nex.manager.phaseManager.currentPhase,f.menuid="",c&&(f.menuid=c),f.context="",d&&(f.context=d),f.buttontype="",e&&(f.buttontype=e),f},b._getType=function(a){var b=0;switch(a){case"menu":b=0;break;case"payment":case"complete":b=1;break;case"language":b=2;break;case"green":b=3;break;case"control":b=4}return b},b._addToBuffer=function(a){if(a)switch(a.buttontype){case"menu":"true"===b.trackMenuButton?(b._debugButtonHit("[Tracking menu button]"),b.trackedButtonList.push(a)):b._debugButtonHit("[NOT Tracking menu button]");break;case"payment":"true"===b.trackPaymentButton?(b._debugButtonHit("[Tracking payment button]"),b.trackedButtonList.push(a)):b._debugButtonHit("[NOT Tracking payment button]");break;case"language":"true"===b.trackLanguageButton?(b._debugButtonHit("[Tracking language button]"),b.trackedButtonList.push(a)):b._debugButtonHit("[NOT Tracking language button]");break;case"green":"true"===b.trackGreenReceiptButton?(b._debugButtonHit("[Tracking green button]"),b.trackedButtonList.push(a)):b._debugButtonHit("[NOT Tracking green button]");break;case"control":"true"===b.trackControlButton?(b._debugButtonHit("[Tracking control button]"),b.trackedButtonList.push(a)):b._debugButtonHit("[NOT Tracking control button]")}else b._debugButtonHit("[Invalid button]")}}function CardListener(a){var b=this;b._lastkeyCallback=a,b._cardData=new DeviceData,b._cardSwipeCmdListener=null,b._receiveCardKey=function(a,c){var d=b._cardData.appendCard(a,c),e=!1,f=!1,g=!1;d&&(d.track1&&d.track1.length>0?e=!0:d.track2&&d.track2.length>0?f=!0:d.track3&&d.track3.length>0&&(g=!0),(e||f||g)&&(b._lastkeyCallback(d),b.clearData()))},b._simpleListener=new SimpleListener(b._receiveCardKey),b._cardSwipeReceived=function(a,c){try{if(console.log("card swipe received"),"CARDSWIPE"===a){b._cardData._track1=c.track1,b._cardData._track2=c.track2,b._cardData._track3=c.track3;var d=b._cardData.getCard();console.log("card swipe received - execute callback"),b._lastkeyCallback(d),b.clearData()}}catch(e){console.log("error occured processing a card swipe"),console.log(e.message)}},b.startListening=function(){b._simpleListener.startListening(),b._cardSwipeCmdListener=_nex.communication.createListener("CARDSWIPE",b._cardSwipeReceived),_nex.communication.addListener(b._cardSwipeCmdListener)},b.stopListening=function(){b._simpleListener.stopListening(),_nex.communication.removeListener(b._cardSwipeCmdListener)},b.getData=function(){return b._cardData.getCard()},b.clearData=function(){b._cardData.clear()}}function CssListener(a){var b=this;b.listener=a.listener,b.init=function(){var a=0;$("link").each(function(){var c=$(this).attr("id"),d=$(this).attr("href");void 0===c&&(c="css"+a,$(this).attr("id",c)),b.watch(c,d),a++})},b.watch=function(a,c){null!==b.listener&&b.listener.watch(a,c)},b.refresh=function(a){var b=$("#"+a);if(b.length>0){var c=b.attr("href"),d=c.indexOf("?x=");d>=0&&(c=c.substring(0,d)),b.attr("href",c+"?x="+Math.random())}}}function DeviceData(){"use strict";var a=this;a._data="",a._currentTrack=0,a._track1="",a._track2="",a._track3="",a._leadingCharReceived=!1,a.clear=function(){a._data="",a._track1="",a._track2="",a._track3="",a._leadingCharReceived=!1},a.get=function(){return a._data},a.getCard=function(){var b={track1:a._track1,track2:a._track2,track3:a._track3};return b},a.appendBarcode=function(b,c){var d="";return 33===b?a._leadingCharReceived=!0:13!==b&&10!==b&&35!==b&&a._leadingCharReceived?a._data+=c:0===b||(13===b&&a._leadingCharReceived||10===b&&a._leadingCharReceived||0===b&&a._leadingCharReceived||35===b&&a._leadingCharReceived)&&(d=a.get()),d},a.appendCard=function(b,c){var d="";return 37===b?(a._currentTrack=1,a._track1="%"):59===b?(a._currentTrack=2,a._track2=";"):43===b?(a._currentTrack=3,a._track3="+"):13!==b&&0!==b?1===a._currentTrack?a._track1+=c:2===a._currentTrack?a._track2+=c:3===a._currentTrack&&(a._track3+=c):0===a._track1.toUpperCase().indexOf("%QB3")||0===a._track1.toUpperCase().indexOf("%ESC?")?(d=a.getCard(),console.info("%QB3 found in track one or %ESC")):13===b&&("B"==a._track1.substr(1,1)&&a._track2.length>0||a._track2.length>0||"B"!=a._track1.substr(1,1)&&a._track1.length>0?"%E?"!=a._track1&&";E?"!=a._track2?d=a.getCard():(console.error("Exception found in track one or track two"),d="ERROR"):console.error("Unexpected newline key found.")),d},a.appendRFID=function(b,c,d){d||(d=35);var e="";return 13!==b&&10!==b&&0!==b&&b!==d?a._data+=c:(13===b||10===b||0===b)&&a._data.length>0&&(e=a.get()),e}}function DeviceListener(a,b,c){var d=this;d.TYPE_CARD="CARD",d.TYPE_BARCODE="BARCODE",d.TYPE_RFID="RFID",d.TYPE_ALL="ALL",d.enableDebugging=!0,d._debug=function(){d.enableDebugging&&console.debug("DeviceListener",d._type,arguments)},a||(a="CARD"),d._type=a,d.getType=function(){return d._type},d._callback=null,b&&(d._callback=b),d._stopOnLastKey=!1,c&&(d._stopOnLastKey=!0),d.complete=function(a){d._callback&&d._callback(a),d._stopOnLastKey&&d.stop()},d.lastBarcodeKey=function(a){d._debug("Received last barcode key"),d.complete(a)},d.lastCardKey=function(a){d._debug("Received last card key"),d.complete(a)},d.lastRFIDKey=function(a){d._debug("Received last RFID key"),d.complete(a)},d._type===d.TYPE_BARCODE?(d._debug("Starting barcode listener"),d.barListener=new BarcodeListener(d.lastBarcodeKey)):d._type===d.TYPE_CARD?(d._debug("Starting card listener"),d.cardListener=new CardListener(d.lastCardKey)):d._type===d.TYPE_RFID?(d._debug("Starting RFID listener"),d.rfidListener=new RFIDListener(d.lastRFIDKey)):d._type===d.TYPE_ALL&&(d._debug("Starting all listeners"),d.barListener=new BarcodeListener(d.lastBarcodeKey),d.cardListener=new CardListener(d.lastCardKey),d.rfidListener=new RFIDListener(d.lastRFIDKey)),d.start=function(){var a=d._type;a===d.TYPE_BARCODE?d.barListener.startListening():a===d.TYPE_CARD?d.cardListener.startListening():a===d.TYPE_RFID?d.rfidListener.startListening():a===d.TYPE_ALL&&(d.barListener.startListening(),d.cardListener.startListening(),d.rfidListener.startListening())},d.stop=function(){var a=d._type;a===d.TYPE_BARCODE?d.barListener.stopListening():a===d.TYPE_CARD?d.cardListener.stopListening():a===d.TYPE_RFID?d.rfidListener.stopListening():a===d.TYPE_ALL&&(d.barListener.stopListening(),d.cardListener.stopListening(),d.rfidListener.stopListening())}}function ExceptionHandler(){var a=this;a.enable=function(){window.onerror=function(a,b,c,d,e){var f="";b&&(f+="URL: "+b+"\n\n"),c&&(f+="Line: "+c+"\n\n"),d&&(f+="Column: "+d+"\n\n"),a&&(f+="Message: "+a+"\n\n"),console&&console.log&&(console.log(f),e&&e.stack&&(console.log("Stack trace: "),console.log(e.stack)))}},a.disable=function(){window.onerror=function(a,b,c){}}}function GuestAccount(a,b,c,d,e,f){var g=this;g.guestAccountId=a,g.firstName=b,g.lastName=c,g.email=d,g.thumbnail64=e,g.chargeableLocalAccounts=[];var h=0;Array.isArray(f)?f.forEach(function(a){h++,g.chargeableLocalAccounts.push(new GuestAccountLocal(h,a.guestaccountlocalid,a.guestaccountlocaltypeid,a.typename,a.usagetype,a.accountnumber,a.pin))}):g.chargeableLocalAccounts.push(new GuestAccountLocal(1,f.guestaccountlocalid,f.guestaccountlocaltypeid,f.typename,f.usagetype,f.accountnumber,f.pin)),g.getGuestAccountLocalByPaymentClipTenderType=function(a){for(var b=0;b<g.chargeableLocalAccounts.length;b++)if(g.chargeableLocalAccounts[b].paymentClipTenderType===a)return g.chargeableLocalAccounts[b]}}function GuestAccountLocal(a,b,c,d,e,f,g){var h=this;h.index=a,h.paymentClipTenderType="gaincliningbalancetender"+a.toString(),h.guestAccountLocalId=b,h.guestAccountLocalTypeId=c,h.typeName=d,h.usageType=e.toLowerCase(),h.accountNumber=f,h.pin=g,h.genericTenderId=null,h.genericTenderIndex=null;var i=_nex.assets.theme.getGenericTenderByGuestAccountLocalType(c);null!==i&&void 0!==i&&(h.genericTenderId=i.type,h.genericTenderIndex=i.type.slice(-1)),h.maskedAccountNumber=function(){for(var a=h.accountNumber.length-3,b="",c=0;a>c;c++)b+="*";return h.accountNumber.replace(/\b(\d{2})\d+(\d)/,"$1"+b+"$2")}}function KVIReader(a){var b=this;b.initialized=!1,b.kioskTheme=a,b.autoAdvance=function(){var a=!1;if(_nex.assets.theme.system.hasOwnProperty("USERINTERFACE")){var b=_nex.assets.theme.system.USERINTERFACE;b.hasOwnProperty("VI")&&b.VI.hasOwnProperty("autoadvance")&&(a="true"===b.VI.autoadvance.toLowerCase())}return a},b.init=function(){b.initialized||(_nex.navBarMap=new NavBarMap(a),_nex.navBarMap.loadBumpBar(),_nex.navBar=new NavBar,_nex.navBarListener=new NavBarListener(_nex.navBarMap,_nex.navBar),_nex.domFocus=new DomFocus,b.initialized=!0)},b.ordering=function(){b._bindSpeaking()},b.payment=function(){var a=$("#selectPaymentMessage:visible");if(a.length>0)$("div.payment-button").each(function(a){$(this).attr("tabindex","2")}),$("div#selectPaymentMessage").each(function(a){$(this).attr("tabindex","2")}),b._bindSpeaking(),$("div#selectPaymentMessage").focus();else{var c=$(".paymentclip:visible");c.length>0&&(c.attr("tabindex","2"),b._bindSpeaking(),c.focus())}},b.startPaymentProcessing=function(){b.simpleTimer.restart()},b.sayWait=function(){_nex.assets.soundManager.speak(_nex.assets.theme.getTextAttribute("PAYMENT","kviwait","Waiting for payment."))},b.stopPaymentProcessing=function(){b.simpleTimer.stop()},b.paymentClip=function(){},b.complete=function(a){_nex.kviReader.rebind(),_nex.domFocus.cycleFocus()},b.rebind=function(){b._bindSpeaking()},b._bindSpeaking=function(){"UX"===_nex.context&&($("[tabindex]").off("focusin",_nex.domFocus.focusIn),$("[tabindex]").not("[tabindex='-1']").on("focusin",_nex.domFocus.focusIn))},b.speakCompleted=function(a){a?_nex.domFocus.cycleFocus():"1"===$(":focus").attr("tabindex")&&b.autoAdvance()&&_nex.domFocus.cycleFocus()},b.speak=function(a){a&&_nex.assets.soundManager.speak(a)},b.simpleTimer=new SimpleTimer(b,b.sayWait,5),b.jackedIn=function(){return _nex.navBar.jackedIn}}function Logging(a){function b(){var a=_nex.commands.WriteToLog,b=new a("");return b}function c(a){var b="[console.log] ";f.setMessage(b+a),e(f)}var d=this,e=a,f=b();window.defineNewConsoleLog(d,c)}function LookupData(a,b,c){var d=this;d.lookupType=a||_nex.types.lookup.CANCEL,d.lookupValue=b||"",d.lookupXML=c||null}function NavBar(){var a=this;a.jackedIn=!1,a.lastButtonPressed=null,a.buttonsPressed=[],a.debugEnabled=!1,a.debug=function(){a.debugEnabled&&console.log("NavBar",arguments)},a.buttons={jackin:0,back:1,help:2,up:3,down:4,circle:5,next:6,volup:7,voldown:8,jackout:9},a.invokeMethod=function(b){if(!a.hasMethod(b))throw"NavBar error: No such method "+b;var c=a.getMethod(b);c()},a.backPressed=function(){a.debug("NavBar back key pressed."),_nex.kviReader.jackedIn()&&(a.lastButtonPressed=a.buttons.back,_nex.assets.soundManager.cancelSpeak(),_nex.domFocus.cycleFocus(!0))},a.helpPressed=function(){if(a.debug("NavBar help key pressed."),_nex.kviReader.jackedIn())if(a.lastButtonPressed=a.buttons.help,_nex.assets.soundManager.cancelSpeak(),_nex.assets.phaseManager.currentPhase===_nex.assets.phaseManager.phaseType.SPLASH)a._playWelcomeMessage();else{var b=$(":focus").first(),c=b.text();_nex.assets.soundManager.speak(c)}},a._updownHelper=function(b,c,d){if(_nex.kviReader.jackedIn()){var e,f,g=a._getCurrentIndex(),h="";h=b.attr("onclick"),jQuery.globalEval(h),d?window.setTimeout(function(){a._setFocusByIndex(".order-review-item",g),_nex.kviReader&&_nex.kviReader.rebind(),e=$(":focus").first(),f=e.text(),_nex.assets.soundManager.speak(f)},500):(_nex.assets.soundManager.cancelSpeak(),_nex.assets.soundManager.speakEnabled=!1,window.setTimeout(function(){$("#messageText").focus(),e=$(":focus").first(),f=e.text(),_nex.kviReader.rebind(),_nex.assets.soundManager.speakEnabled=!0,_nex.assets.soundManager.speak(f)},500))}},a.upPressed=function(){if(_nex.kviReader.jackedIn()){a.debug("NavBar up key pressed."),a.lastButtonPressed=a.buttons.up,_nex.assets.soundManager.cancelSpeak();var b=$(":focus #quantPlus");b.length>0?(a.debug("Found quantPlus"),a._updownHelper(b,!0,!0)):(b=$(":focus #plusButton"),b.length>0&&(a.debug("Found plusButton"),b.trigger("click")))}},a.downPressed=function(){if(_nex.kviReader.jackedIn()){a.debug("NavBar down key pressed."),a.lastButtonPressed=a.buttons.down,_nex.assets.soundManager.cancelSpeak();var b=$(":focus #quantMinus"),c=parseInt($(":focus .order-review-quantity").text());b.length>0?c>1?a._updownHelper(b,!1,!0):a._updownHelper(b,!1,!1):(b=$(":focus #minusButton"),b.length>0&&(a.debug("Found minus button"),b.trigger("click")))}},a._getCurrentIndex=function(){var b=$(":focus"),c=$(".order-review-item").index(b),d=$(".order-review-item").length;return a.debug("Currently on index "+c+" of "+d),c},a._setFocusByIndex=function(a,b){var c,d=$(a),e=d.length;if(e>0){var f=e-1;b>f&&(b=f),c=parseInt(b),$(".order-review-item").eq(c).focus()}},a.circlePressed=function(){if(_nex.kviReader.jackedIn()){a.debug("NavBar circle key pressed."),a.lastButtonPressed=a.buttons.circle,_nex.assets.soundManager.cancelSpeak(!0);var b=$("#KVIToStart");if(b.length>0)_nex.splashPhase.alternateLanguageToStart("KVI");else{var c=$(":focus"),d=c.attr("id"),e=a._lessNormalMore();if(e)_nex.assets.soundManager.speak(e),c.focus();else{var f=c.find("[onclick]").first();0===f.length&&(f=c.find("a").first(),0===f.length&&(f=c)),f.trigger("click")}(c.hasClass("selectmanyof")||c.hasClass("button-down-state"))&&(c=$("#"+d),c.focus())}}},a._lessNormalMore=function(){var a="",b=$(":focus #less"),c=$(":focus #normal"),d=$(":focus #more"),e=$(":focus .sub-button-down-state").attr("id");return"less"==e?c.length>0&&(c.trigger("click"),a="Less"):"normal"==e?d.length>0&&(d.trigger("click"),a="Normal"):"more"==e?b.length>0&&(b.trigger("click"),a="More"):b.length>0&&(b.trigger("click"),a="Normal"),a},a.nextPressed=function(){_nex.kviReader.jackedIn()&&(a.debug("NavBar next key pressed."),a.lastButtonPressed=a.buttons.next,_nex.assets.soundManager.cancelSpeak(),_nex.domFocus.cycleFocus())},a._playWelcomeMessage=function(){_nex.assets.soundManager.cancelSpeak(!0);for(var a=10,b=_nex.assets.theme.getTextAttribute("SPLASH","kvitext","Welcome. Use the volume keys on the right bar to increase and decrease volume. Press the green circle button on the left navigation bar to start... ..."),c=0;a>c;c++)_nex.assets.soundManager.speak(b)},a.jackIn=function(){console.log("NavBar jack-in."),a.lastButtonPressed=a.buttons.jackin,_nex.assets.soundManager.cancelSpeak(),_nex.ordering.cancelOrder(!0),_nex.manager.cancelCurrentPhase(),_nex.splashPhase._stopListeningForDevice(),_nex.kvi.active=!0,a.jackedIn=!0,_nex.ordering.pending=!1,$("body").attr("data-language","KVI"),$("body").attr("data-jackedin","true"),refreshOrderTimer(),_nex.assets.soundManager.setSpeaker(!0),a._playWelcomeMessage()},a.jackOut=function(){console.log("NavBar jack-out."),a.lastButtonPressed=a.buttons.jackout,_nex.assets.soundManager.cancelSpeak(!0),a.jackedIn=!1,$("body").attr("data-language",""),$("body").attr("data-jackedin","false"),_nex.kvi.active=!1,_nex.ordering.cancelOrder(!0),_nex.ordering.pending=!1,_nex.manager.cancelCurrentPhase(),_nex.assets.soundManager.setSpeaker(!1)},a.volumeUp=function(){_nex.kviReader.jackedIn()&&(a.debug("NavBar volume-up."),a.lastButtonPressed=a.buttons.volup,_nex.assets.soundManager.cancelSpeak(),_nex.assets.soundManager.volumeUp(),_nex.assets.phaseManager.currentPhase!==_nex.assets.phaseManager.phaseType.SPLASH&&_nex.assets.soundManager.speak("Volume up."))},a.volumeDown=function(){_nex.kviReader.jackedIn()&&(a.debug("NavBar volume-down."),a.lastButtonPressed=a.buttons.voldown,_nex.assets.soundManager.cancelSpeak(),_nex.assets.soundManager.volumeDown(),_nex.assets.phaseManager.currentPhase!==_nex.assets.phaseManager.phaseType.SPLASH&&_nex.assets.soundManager.speak("Volume down."))},a.hasMethod=function(b){return a.hasOwnProperty(b)},a.getMethod=function(b){var c=function(){};return a.hasMethod(b)&&(c=a[b]),c}}function NavBarListener(a,b){var c=this;c._navBarMap=a,c._navBar=b,c.debugEnabled=!1,c.debug=function(){c.debugEnabled&&console.debug("NavBarListener",arguments)},c.keyPressed=function(a,b){var d="",e="",f={},g=!1;c.debug("Element",a),c.debug("Event",b),$(a).attr("data-method")&&(c.debug("Found virtual key."),g=!0,d=$(a).attr("data-method")),e="number"==typeof b?b:b.which,e&&(g=!0),c.debug("Found physical key: "+e),f=c._navBarMap.getMap(e),f&&f.hasOwnProperty("method")&&(d=f.method),g||console.log("Did not find key: ",e),d&&(c.debug("Calling navbar method "+d),c._navBar.invokeMethod(d))}}function NavBarMap(a){var b=this;b.kioskTheme=a,b._keys={},b.setMap=function(a,c){b._keys[a]=c},b.getMap=function(a){
var c=null;return b._keys.hasOwnProperty(a)&&(c=b._keys[a]),c},b.loadDefault=function(){b.setMap(132,{method:"backPressed"}),b.setMap(128,{method:"helpPressed"}),b.setMap(129,{method:"upPressed"}),b.setMap(130,{method:"downPressed"}),b.setMap(131,{method:"circlePressed"}),b.setMap(133,{method:"nextPressed"}),b.setMap(127,{method:"jackIn"}),b.setMap(126,{method:"jackOut"}),b.setMap(125,{method:"volumeUp"}),b.setMap(124,{method:"volumeDown"})},b._toArray=function(a){if(Array.isArray(a))return a;var b=[];return b.push(a),b},b._getBumpBar=function(){var a=[];if(b.kioskTheme.hasOwnProperty("BUMPBAR")){var c=_nex.assets.theme.lastUpdate.THEMES.THEME.BUMPBAR;if(c.hasOwnProperty("KEY")){var d=c.KEY;a=b._toArray(d)}}return a},b.loadBumpBar=function(){for(var a=b._getBumpBar(),c=0;c<a.length;c++){var d=a[c].key,e=a[c].event;switch(e){case"Back":b.setMap(d,{method:"backPressed"});break;case"Help":b.setMap(d,{method:"helpPressed"});break;case"Up":b.setMap(d,{method:"upPressed"});break;case"Down":b.setMap(d,{method:"downPressed"});break;case"Green":b.setMap(d,{method:"circlePressed"});break;case"Next":b.setMap(d,{method:"nextPressed"});break;case"PlugIn":b.setMap(d,{method:"jackIn"});break;case"Unplug":b.setMap(d,{method:"jackOut"});break;case"VolumeUp":b.setMap(d,{method:"volumeUp"});break;case"VolumeDown":b.setMap(d,{method:"volumeDown"});break;default:console.log("loadBumpBar: Could not find key map for event "+e)}}},b.loadTest=function(){b.setMap(97,{method:"backPressed"}),b.setMap(47,{method:"helpPressed"}),b.setMap(119,{method:"upPressed"}),b.setMap(115,{method:"downPressed"}),b.setMap(13,{method:"circlePressed"}),b.setMap(100,{method:"nextPressed"}),b.setMap(105,{method:"jackIn"}),b.setMap(111,{method:"jackOut"}),b.setMap(43,{method:"volumeUp"}),b.setMap(45,{method:"volumeDown"})},b.reset=function(){b._keys={}}}function OrderTimer(a,b,c,d){function e(){if($("#popup-need-more-time:visible").length<=0){var a=$("circle");a.length>0&&(a[0].style.WebkitAnimationDuration=n-.25+"s"),q.show()}}function f(a){$("#popup-need-more-time:visible").length>0&&q.hide(a)}function g(){f();var a=j();a?p.restart():p.stop()}function h(){var a=j();a?e():(f(),p.stop())}function i(){p.stop(),_nex.ordering.resetOrder(),f(function(){_nex.timingOut=!0,_nex.manager.cancelCurrentPhase()})}function j(){var a=!1;return o.currentPhase!==o.phaseType.ORDERING&&o.currentPhase!==o.phaseType.PREVIOUS_ORDERS&&o.currentPhase!==o.phaseType.PAYMENT&&o.currentPhase!==o.phaseType.POST_ORDERING||(a=!0),_nex.kviReader&&_nex.kviReader.jackedIn()&&(a=!1),a}var k=this,l=!1,m=24,n=4,o=c;_nex.assets.theme.system.hasOwnProperty("ordertimeout")&&_nex.assets.theme.system.ordertimeout.length>0&&(m=Number(_nex.assets.theme.system.ordertimeout),m>86280&&(m=86280)),_nex.assets.theme.system.hasOwnProperty("needmoretime")&&_nex.assets.theme.system.needmoretime.length>0&&(n=Number(_nex.assets.theme.system.needmoretime),n>120&&(n=120));var p=new DoubleTimer(k,h,m,k,i,n),q=new NeedMoreTimePopup(a,b,d);k.restart=function(a){a&&(l=!a),l||g()},k.stop=function(a){a&&(l=a),f(),p.stop()},k.needMoreTimeClicked=function(){console.log("User clicked 'yes' that they need more time."),g()}}function NeedMoreTimePopup(a,b,c){function d(a,b,c){var d=e(a.needMoreTimePopup);return d.message=b,d.buttons[0].clickEvent=c,d}function e(a){var b=!0;return $.extend(b,{},a)}function f(a,b,c){if("object"!=typeof a)throw"NeedMoreTimePopup: Must specify a valid popupManager. Got "+a;if(!a.needMoreTimePopup)throw"NeedMoreTimePopup: The popup manager given is missing the property needMoreTimePopup ";if("string"!=typeof b)throw"NeedMoreTimePopup: Must specify a string for popupMessage. Got "+b;if("string"!=typeof c)throw"NeedMoreTimePopup: Must specify a string for callbackScript. Got "+c}f(a,b,c);var g=this,h=a,i=d(a,b,c);g.show=function(){h.showPopup(i,function(){})},g.hide=function(a){h.hidePopup(i,a)}}function DoubleTimer(a,b,c,d,e,f){function g(a,b,c,d,e,f){if("object"!=typeof a)throw"DoubleTimer: Must specify a valid popupObject. Expected object and got "+a;if("function"!=typeof b)throw"DoubleTimer: Must specify a function for popupMethod. Expected function and got "+b;if("number"!=typeof c)throw"DoubleTimer: Must specify a valid popupTime. Expected number and got "+c;if("object"!=typeof d)throw"DoubleTimer: Must specify an object for callbackObject. Expected object and got "+d;if("function"!=typeof e)throw"DoubleTimer: Must specify a valid method for callbackMethod. Expected function and got "+e;if("number"!=typeof f)throw"DoubleTimer: Must specify a number for callbackTime. Expected number and got "+f}function h(a){i(k,l,a)}function i(a,b,c){if("object"!=typeof a)throw"_callFunction: Must specify a valid object to call.";if("function"!=typeof b)throw"_callFunction: Must specify a valid function to call.";b.call(a,c)}g(a,b,c,d,e,f);var j=this,k=a,l=b,m=c,n=d,o=e,p=f,q=new TimeoutTimer(j,h,m),r=new TimeoutTimer(n,o,m+p);j.start=function(){q.start(),r.start()},j.stop=function(){q.stop(),r.stop()},j.restart=function(){q.stop(),r.stop(),q.start(),r.start()}}function PositionManager(a){function b(){return window.innerHeight}function c(){return window.innerWidth}function d(){return b()*h}function e(){return c()*h}var f=this,g=!1;f.debug=function(){g&&console.debug("PositionManager",arguments)},f.setElement=function(a){var b=document.getElementById(a);if(!b)throw"No such element "+a;f.element=b,f.$element=$(b)},f.setElement(a),f.positionElement=function(a,b){f.resetTransform(),f.debug("positionElement: Moving element "+f.element.id+" to "+a+", "+b),f.element.style.position="fixed";var c={top:b,left:a};f.$element.offset(c)},f.positionToTouch=function(a,b){if(!inPreviewer()&&a>=0&&b>=0){var c=a-f.getHalfWidth(),d=b-f.getHalfHeight();f.setPositionChecked(c,d)}},f.positionTopLeft=function(){f.element.style.position="fixed",f.element.style.top="0px",f.element.style.left="0px"},f.positionTopCenter=function(){f.element.style.position="fixed",f.element.style.top="0px",f.element.style.left="50%",f.element.style.transform="translateX(-50%)"},f.positionTopRight=function(){f.element.style.position="fixed",f.element.style.top="0px",f.element.style.right="0px"},f.positionMiddleLeft=function(){f.element.style.position="fixed",f.element.style.top="50%",f.element.style.left="0px",f.element.style.transform="translate(0, -50%)"},f.positionMiddleCenter=function(){f.element.style.position="fixed",f.element.style.top="50%",f.element.style.left="50%",f.element.style.transform="translate(-50%, -50%)"},f.positionMiddleRight=function(){f.element.style.position="fixed",f.element.style.top="50%",f.element.style.right="0px",f.element.style.transform="translate(0, -50%)"},f.positionBottomLeft=function(){f.element.style.position="fixed",f.element.style.bottom="0px",f.element.style.left="0px"},f.positionBottomMiddle=function(){f.element.style.position="fixed",f.element.style.bottom="0px",f.element.style.left="50%",f.element.style.transform="translate(-50%, 0%)"},f.positionBottomRight=function(){f.element.style.position="fixed",f.element.style.bottom="0px",f.element.style.right="0px"},f.resetTransform=function(){f.element.style.transform="translate(0%, 0%)"},f.positionToSpot=function(a){switch(a){case"TOP_LEFT":f.positionTopLeft();break;case"TOP_CENTER":f.positionTopCenter();break;case"TOP_RIGHT":f.positionTopRight();break;case"MIDDLE_LEFT":f.positionMiddleLeft();break;case"MIDDLE_CENTER":f.positionMiddleCenter();break;case"MIDDLE_RIGHT":f.positionMiddleRight();break;case"BOTTOM_LEFT":f.positionBottomLeft();break;case"BOTTOM_CENTER":f.positionBottomMiddle();break;case"BOTTOM_RIGHT":f.positionBottomRight()}},f.getCurrentX=function(){var a=f.$element.offset(),b=a.left;return b},f.getCurrentY=function(){var a=f.$element.offset(),b=a.top;return b},f.getCurrentWidth=function(){var a=f.$element.width();return a},f.getCurrentHeight=function(){var a=f.$element.height();return a},f.getHalfWidth=function(){var a=f.$element.width(),b=a/2;return b},f.getHalfHeight=function(){var a=f.$element.height(),b=a/2;return b},f.setPositionChecked=function(a,d,e,g,h,i){var j=a,k=d;e||(e=f.getCurrentWidth()),g||(g=f.getCurrentHeight()),h||(h=c()),i||(i=b());var l=j+e,m=k+g;f.debug("right: "+l),f.debug("bottom: "+m),l>h&&(j=h-e,f.debug("Past right edge... moving new x to "+j)),m>i&&(k=i-g,f.debug("Past bottom edge... moving new y to "+k)),0>j&&(j=0),0>k&&(k=0),f.debug("Moving from ("+a+","+d+") to ("+j+","+k+")"),f.positionElement(j,k)},f.moveUp=function(){var a=f.getCurrentX(),e=f.getCurrentY(),g=f.getCurrentWidth(),h=f.getCurrentHeight();f.debug("moveUp: Moving from ("+a+","+e+")");var i=a,j=e-d();f.setPositionChecked(i,j,g,h,c(),b())},f.moveDown=function(){var a=f.getCurrentX(),e=f.getCurrentY(),g=f.getCurrentWidth(),h=f.getCurrentHeight();f.debug("moveDown: Moving from ("+a+","+e+")");var i=a,j=e+d();f.setPositionChecked(i,j,g,h,c(),b())},f.moveLeft=function(){var a=f.getCurrentX(),d=f.getCurrentY(),g=f.getCurrentWidth(),h=f.getCurrentHeight();f.debug("MoveLeft: Moving From ("+a+","+d+")");var i=a-e(),j=d;f.setPositionChecked(i,j,g,h,c(),b())},f.moveRight=function(){var a=f.getCurrentX(),d=f.getCurrentY(),g=f.getCurrentWidth(),h=f.getCurrentHeight();f.debug("moveRight: Moving From ("+a+","+d+")");var i=a+e(),j=d;f.setPositionChecked(i,j,g,h,c(),b())};var h=.25;f.changeWidth=function(a){f.$element.width(a)},f.changeHeight=function(a){f.$element.height(a)},f.size=function(a){f.debug("Resizing to "+a);var b=f.getResolution(a);f.changeWidth(b.width),f.changeHeight(b.height)},f.getResolution=function(a){var b={width:1280,height:720};switch(a){case 0:b.width=1024,b.height=768;break;case 1:b.width=1280,b.height=768;break;case 2:b.width=1366,b.height=768;break;case 3:b.width=1680,b.height=1050;break;case 4:b.width=1920,b.height=1080;break;case 5:b.width=768,b.height=1280;break;case 6:b.width=1024,b.height=1820;break;case 7:b.width=1080,b.height=1920;break;case 8:b.width=1280,b.height=720;break;case 9:b.width=1280,b.height=800}return b}}function RFIDListener(a){var b=this;b._lastkeyCallback=a,b._rfidData=new DeviceData,b._receiveRFIDKey=function(a,c){var d=b._rfidData.appendRFID(a,c,59);d&&d.length>0&&(b._lastkeyCallback(d),b.clearData())},b._simpleListener=new SimpleListener(b._receiveRFIDKey),b.startListening=function(){b._simpleListener.startListening()},b.stopListening=function(){b._simpleListener.stopListening()},b.getData=function(){return b._rfidData.get()},b.clearData=function(){b._rfidData.clear()}}function RotateTimer(a){var b=this,c=5,d=60;null!==_nex.assets.theme.system&&_nex.assets.theme.system.hasOwnProperty("splashmotionradius")&&$.isNumeric(_nex.assets.theme.system.splashmotionradius)&&(c=Number(_nex.assets.theme.system.splashmotionradius));var e=new ContentRotator(a,c),f=new SimpleTimer(e,e.translate,d);f.start(),b.reset=function(){f.stop(),e.reset(),f.start()}}function ContentRotator(a,b){function c(a,b,c,d){if(!a)throw"You must specify an element id.";var e=document.getElementById(a);if(!e)throw"Unable to find an element with id "+a;if(c>b||b>d)throw"A radius of "+b+" is outside the supported range for the ContentRotator."}function d(a){a.degrees+=k,a.degrees>360&&(a.degrees=0);var b=2*Math.PI*a.degrees/360,c=Math.cos(b)*a.radius,d=Math.sin(b)*a.radius;a.xOffset=Math.round(c),a.yOffset=Math.round(d)}function e(a,b,c){a.style.position="relative",a.style.left=b+"px",a.style.top=c+"px",a.style.transform="none",$("body").css("background-position",b+"px "+c+"px")}function f(a){d(a),e(a.element,a.xOffset,a.yOffset)}function g(a){a.xOffset=0,a.yOffset=0,e(a.element,0,0)}var h=this,i=1,j=300,k=40;c(a,b,i,j),h.element=document.getElementById(a),h.radius=b,h.degrees=0,h.xOffset=0,h.yOffset=0,h.translate=function(){_nex.assets.phaseManager.currentPhase!==_nex.assets.phaseManager.phaseType.SPLASH&&_nex.assets.phaseManager.currentPhase!==_nex.assets.phaseManager.phaseType.OFFLINE||f(h)},h.reset=function(){g(h)}}function ScanItems(){var a=this;_nex.scanItems=a,a.formatCurrency=function(a){return void 0===a?"":"$"+Number(a).toFixed(2)},a.currentItemDescription=ko.observable(),a.currentItemPrice=ko.observable(),a.currentItemPrompt=ko.observable("Scan an Item or Press Continue"),a.items=ko.observableArray(),a.itemTotal=ko.computed(function(){var b=0;return ko.utils.arrayForEach(a.items(),function(a){void 0!==a.itemPrice&&(b+=Number(a.itemPrice))}),b}),a.addItem=function(b,c){console.debug("scanItems: addItem"),a.currentItemDescription(b),a.currentItemPrice(c),a.currentItemPrompt("Scan Your Next Item or Press Continue"),a.items.push({itemDescription:b,itemPrice:c})}}function SimpleTimer(a,b,c){function d(a,b,c,d,e){if("object"!=typeof a)throw"You must specify an object for the timer. Type is "+a;if("function"!=typeof b)throw console.log(b),"You must specifify a method to call for the timer.";if(d>c)throw"Out of range exception for frequency. Frequency too small: "+c+". Must be greater than "+d;if(c>e)throw"Out of range exception. Frequency too large: "+c+". Must be less than "+e}function e(a,b,c){if("object"!=typeof a)throw"_callFunction: Must specify a valid object to call.";if("function"!=typeof b)throw"_callFunction: Must specify a valid function to call.";b.call(a,c)}var f=1,g=86400;d(a,b,c,f,g);var h=this;h.specifiedObject=a,h.specifiedMethod=b,h.frequencyMilliseconds=1e3*c,h.start=function(){h.intervalId=window.setInterval(function(){e(h.specifiedObject,h.specifiedMethod)},h.frequencyMilliseconds)},h.stop=function(){window.clearInterval(h.intervalId)},h.restart=function(){h.stop(),h.start()}}function TimeoutTimer(a,b,c){function d(a,b,c,d,e){if("object"!=typeof a)throw"You must specify an object for the timer. Type is "+a;if("function"!=typeof b)throw console.log(b),"You must specifify a method to call for the timer.";if(d>c)throw"Out of range exception for timeout. Timeout too small: "+c+". Must be greater than "+d;if(c>e)throw"Out of range exception. Timeout too large: "+c+". Must be less than "+e}function e(a,b,c){if("object"!=typeof a)throw"_callFunction: Must specify a valid object to call.";if("function"!=typeof b)throw"_callFunction: Must specify a valid function to call.";b.call(a,c)}var f=1,g=86400;d(a,b,c,f,g);var h=this;h.specifiedObject=a,h.specifiedMethod=b,h.timeoutMilliseconds=1e3*c,h.enableDebugging=!1,h.debug=function(){h.enableDebugging&&console.debug(arguments)},h.start=function(a){h.timeoutId=window.setTimeout(function(){e(h.specifiedObject,h.specifiedMethod,a)},h.timeoutMilliseconds),h.debug("Started timer ",h.timeoutId)},h.stop=function(){h.debug("Clearing timer ",h.timeoutId),window.clearTimeout(h.timeoutId)},h.restart=function(){h.stop(),h.start()}}function TouchListener(){var a=this;a.startX=null,a.startY=null,a.endX=null,a.endY=null,a.minDistance=25,a.debugEnabled=!0,a.debug=function(){a.debugEnabled&&console.debug("TouchListener",arguments)},a.error=function(){console.log("TouchListener",arguments)},a.listenForTouchStart=function(){a.debug("listenForTouchStart enter"),document.ontouchstart=function(b){return!b.touches||b.touches.length<=0?void console.log("Missing touches touchstart"):(a.startX=b.touches[0].pageX,a.startY=b.touches[0].pageY,a.debug("listenForTouchStart startX "+a.startX),void a.debug("listenForTouchStart startY "+a.startY))}},a.listenForTouchEnd=function(){a.debug("listenForTouchStart exit"),document.ontouchend=function(b){if(!b.changedTouches||b.changedTouches.length<=0)return void console.log("Missing touches touchend");a.endX=b.changedTouches[b.changedTouches.length-1].pageX,a.endY=b.changedTouches[b.changedTouches.length-1].pageY,a.debug("listenForTouchEnd endX "+a.endX),a.debug("listenForTouchEnd endY "+a.endY);var c=a._distanceFormula(a.startX,a.startY,a.endX,a.endY);a.debug("listenForTouchEnd distance "+c),c<=a.minDistance?(a.debug("TouchListener: Triggering a click.","Distance was "+c+" which is <= "+a.minDistance),a._triggerClick(b,a.endX,a.endY)):a.debug("TouchListener: Not triggering a click.","Distance was too great. It was "+c+" which is more than "+a.minDistance),b.preventDefault()}},a._distanceFormula=function(b,c,d,e){var f=0;return window.isNaN(b)||window.isNaN(c)||window.isNaN(d)||window.isNaN(e)?(a.error("TouchListener received an invalid parameter in the distance formula."),void a.error(b,c,d,e)):(b>=0&&c>=0&&d>=0&&e>=0&&(f=Math.pow(b-d,2)+Math.pow(e-c,2),f=Math.pow(f,.5)),f)},a._triggerClick=function(a,b,c){var d=document.createEvent("MouseEvent");d.initMouseEvent("click",!0,!0,window,0,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null),a.target.dispatchEvent(d)}}function _BaseAction(){}function SetLanguageAction(a){var b=this;b._theme=a,b._langId="",b._language=null,b._buttonText="",b.initialize=function(a,c,d){return a?c?(b._langid=a,b._language=b._getLanguage(b._theme.system.LANGUAGE),console.debug("Language elements: "),console.debug(b._language),void(null!==b._language?(b._buttonText=b._getLanguageButtonText(d),b._buttonText&&b._buttonText.length>0?c.text(b._buttonText):(console.debug("Could not find any button text for the button."),b._hideLanguageButton(c))):(console.log("The language "+b._langid+" is not enabled... Hiding the button."),b._hideLanguageButton(c)))):void console.log("Missing parameter buttonElement!"):void console.log("Missing langid!")},b._isLanguageMatch=function(a){console.debug("Checking if language matches: "+a.name);var c=!1;return a.name&&a.name.toLowerCase()===b._langid.toLowerCase()&&(console.debug("...it does."),c=!0),c},b._isLanguageActive=function(a){var b=!1;return console.debug("Checking if language is active: "+a.name),a.active&&"true"===a.active&&(console.debug("...it is."),b=!0),b},b._getLanguage=function(a){var c=null,d=null;if(a)if(a instanceof Array){for(var e=0;e<a.length;e++)if(d=a[e],b._isLanguageMatch(d)&&b._isLanguageActive(d)){c=d;break}}else d=a,b._isLanguageMatch(d)&&b._isLanguageActive(d)&&(c=d);return console.debug("Returning result: "),console.debug(c),c},b._hideLanguageButton=function(a){a.hide(),console.debug("setLanguageAction._hideLanguageButton: The language button is now hidden.")},b._getLanguageButtonText=function(a){return console.debug("Trying to get language text for language "),result=_nex.assets.theme.getTextAttribute("ORDER","language",a),console.debug("... result found is "+result),result}}function SwipeToStartAction(a){var b=this;b._theme=a,b._tenderStarted=null,b.tenderType="",b.cardData=null,b._pinData="";var c=!0;b._debug=function(a){c&&console.debug("SwipeToStartAction",a)},b.getTenderAdded=function(){return b._tenderStarted},b.getPinData=function(){return b._pinData},b.reset=function(){b.stopListening(),b._tenderStarted=null,b.cardData=null,b._pinData="",_nex.splashPhase.userSwipedToStart=!1},b.startListening=function(a){b._debug("startListening"),b.reset(),_nex.utility.deviceListener=new DeviceListener("ALL",a),_nex.utility.deviceListener.start()},b.stopListening=function(){_nex.utility.deviceListener&&_nex.utility.deviceListener.stop()},b.goodSwipe=function(a){b._debug("goodSwipe"),b.cardData=a,b._debug(b.cardData),a.isLoyalty()?(b._debug("goodSwipe","User swiped a loyalty card."),b.tenderType="loyalty",b.swipedLoyaltyCard()):(b._debug("goodSwipe","User swiped a credit card."),b.tenderType="credit",b.data=a,b.swipedCreditCard())},b.badSwipe=function(a){b._debug("badSwipe",a);var c=b._theme.getTextAttribute("PAYMENT","swipeerror","There was a problem reading your card, please swipe again"),d=b.reset;b._showBadSwipe(c,d)},b._showBadSwipe=function(a,c){b._debug("showBadSwipe");var d=$.extend(!0,{},_nex.assets.popupManager.errorPopup);d.message=a,_nex.assets.popupManager.showPopup(d,c)},b._promptForPin=function(a,c){b._debug("_promptForPin");var d=$.extend(!0,{},_nex.assets.popupManager.pinpadPopup);d.buttons[0].clickEvent="_nex.splashPhase.swipeToStartAction.pinEntered()",d.message=_nex.assets.theme.getTextAttribute("ORDER","loyaltypin","Please enter your PIN"),_nex.assets.popupManager.showPopup(d),_nex.keyboard.numpad.bindKeys()},b.pinEntered=function(){b._debug("pinEntered"),b.pinData=_nex.keyboard.numpad.data;var a=b.cardData.cardNumber,c=b.cardData.cardType,d=b.cardData.track1,e=b.cardData.track2,f=new _nex.commands.LoyaltyInquiry(a,b.pinData,c,d,e,!1);_nex.communication.send(f,function(a){b._debug("Loyalty inquiry response",a);var c=new TenderLoyalty;c.update(a),c.isValidAccount()?(b._debug("We can accept this loyalty card for swipe to start! Valid account."),b._continueWithLoyalty()):(b._debug("Can't accept this loyalty card for swipe to start! Invalid account"),b._genericError(b.reset))},"LOYALTYRESPONSE")},b._continueWithLoyalty=function(){b._debug("continueWithLoyalty"),b._gotoPreviousOrders(b.cardData)},b.swipedCreditCard=function(){var a=new TenderCredit;a.update(b.cardData.track1,b.cardData.track2),b._tenderStarted=a,b._createCreditTender()},b._createCreditTender=function(){var a=new _nex.commands.AddTender("credit");_nex.communication.send(a,function(a){a&&b._gotoPreviousOrders(b.cardData)},"TENDERADDED")},b._createLoyaltyTender=function(){var a=new _nex.commands.AddTender("loyalty");_nex.communication.send(a,function(a){a&&b._gotoPreviousOrders(b.cardData)},"TENDERADDED")},b.swipedLoyaltyCard=function(){b._debug("swipedLoyaltyCard");var a=_nex.assets.theme.getTenderByType("loyalty");a?_nex.assets.theme.isValidationRequired(a)?(b._debug("validateLoyalty","validation required; prompting for pin"),b._promptForPin()):(b._debug("validateLoyalty","validation not required; not prompting for pin"),b._createLoyaltyTender()):(b._debug("validateLoyalty","Possible Configuration Error: No tender for loyalty found"),b._genericError(b.reset))},b._gotoOrdering=function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){_nex.ordering.start()})},b._gotoPreviousOrders=function(a){console.debug("_gotoPreviousOrders","Going to previous orders"),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.PREVIOUS_ORDERS,function(){_nex.previousOrders.start(a)})},b._genericError=function(a){var b=_nex.payment.textProcessingError(),c=$.extend(!0,{},_nex.assets.popupManager.errorPopup);c.message=b,_nex.assets.popupManager.showPopup(c,a)}}function ButtonFactory(){var a=this;a.ITEM_TYPE_ITEM="Item",a.ITEM_TYPE_MOD="Modifier",a.createButton=function(a,b){var c=null;if(!a||!a.buttontype)return console.log("no button available on this menu. template: "+b),null;var d=_nex.assets.templateManager.getButtonId(b,a.buttontype);switch(a.buttontype){case"MENUBUTTON":c=new _nex.assets.buttons.MenuButton;break;case"SELECTONE":c=new _nex.assets.buttons.SelectOne;break;case"MULTIMENUBUTTON":c=new _nex.assets.buttons.MultiMenuButton;break;case"SELECTONEMODIFIER":c=new _nex.assets.buttons.SelectOneModifier;break;case"SELECTMANYITEM":c=new _nex.assets.buttons.SelectManyItem;break;case"SELECTMANYMODIFIER":c=new _nex.assets.buttons.SelectManyModifier;break;case"SELECTONEQUANTITY":c=new _nex.assets.buttons.SelectOneQuantity;break;case"SELECTOTHER":c=new _nex.assets.buttons.SelectOther;break;case"LESSMORE":c=new _nex.assets.buttons.LessMore;break;case"SELECTNE":c=new _nex.assets.buttons.SelectNE;break;default:c=new _nex.assets.buttons.Blank}return null!==c&&""!==d&&c.templateButtonName(d),c},a.hasNoItems=function(a){return null===a||"BLANK"===a.toUpperCase()||"MENUBUTTON"===a.toUpperCase()||"MULTIMENUBUTTON"===a.toUpperCase()||"ORDERREVIEWITEM"===a.toUpperCase()||"SELECTALL"===a.toUpperCase()||"SELECTOTHER"===a.toUpperCase()||"SELECTMODIFIERPOPUP"===a.toUpperCase()},a.getItemTypeForButton=function(b){return a.hasNoItems(b)?a.ITEM_TYPE_ITEM:"SELECTONE"==b.toUpperCase()?a.ITEM_TYPE_ITEM:"SELECTONEQUANTITY"==b.toUpperCase()?"":a.ITEM_TYPE_MOD}}function CardData(){var a=this;a.clear=function(){a.tenderType=paymentConstants.TENDER_CREDIT,a.tenderTypeCode="1",a.cardData=null,a.cardNumber="",a.expMonth="",a.expYear="",a.amount=0,a.cardType="",a.track1="",a.track2="",a.userData="",a.isTaxExempt=!1,a.cardId="",a.billingStreet="",a.billingZip="",a.firstName="",a.lastName="",a.cardName=""},a.clear(),a.isLoyalty=function(){return"LOYALTY"===a.cardType},a.fullName=function(){return a.firstName+" "+a.lastName}}function CardParser(a){var b=this;b._theme=a,b._creditCards=[],b._isCardTypeAccepted=!1,b.cardData={},b.lastErrorMessage="",b.parse=function(a,c,d,e){var f=null;b._initialize(b._theme),b.cardData=new CardData;var g=b._parseCard(a,c);return g===!0?(f=b.cardData,d&&d(f)):e&&e(b.lastErrorMessage),d||e?void 0:f},b._parseCard=function(a,c){var d=!1;if(a||(a=""),"%E?"===a||";E?"===c)return b.lastErrorMessage="ERROR IN TRACK 1 OR TRACK 2",d;if(0!==a.indexOf("%")&&a.indexOf("?")!==a.length-1)return b.lastErrorMessage="TRACK1: CARD READ ERROR WITH SENTINELS",d;if(0!==c.indexOf(";")&&c.indexOf("?")!==c.length-1)return b.lastErrorMessage="TRACK2: CARD READ ERROR WITH SENTINELS",d;if(0!==a.length&&a.length>79)return b.lastErrorMessage="TRACK1 OR TRACK2: length is incorrect",d;var e=!1,f=!1,g=!1,h=2,i=!1,j="";b.cardData.cardNumber="",b.cardData.lastName="",b.cardData.firstName="";var k;for(i="B"===a.substr(1,1),k=h;k<=a.length&&!e;k++)j=a.substr(k,1),"^"===j?(e=!0,h++):e||(b.cardData.cardNumber+=j);for(k=h+b.cardData.cardNumber.length;k<=a.length&&!f;k++)j=a.substr(k,1),"/"===j?(f=!0,h++):"^"===j?(f=!0,g=!0,h++):f||(b.cardData.lastName+=j);for(k=4+b.cardData.cardNumber.length+b.cardData.lastName.length;k<=a.length&&!g;k++)j=a.substr(k,1),"^"===j?(g=!0,h++):g||(b.cardData.firstName+=j);var l=h+b.cardData.cardNumber.length+b.cardData.lastName.length+b.cardData.firstName.length;if(b.cardData.lastName=b.cardData.lastName.trim(),b.cardData.firstName=b.cardData.firstName.trim(),b.cardData.expYear=a.substr(l,2),b.cardData.expMonth=a.substr(l+2,2),i&&a.length>0&&(0===b.cardData.cardNumber.length||0===b.cardData.expYear.length||0===b.cardData.expMonth.length))return b.lastErrorMessage="Card Number or expiration parsing failure",d;if(!i&&(c.length>0||a.length>0&&0===c.length)){if(b.cardData.lastName="",b.cardData.firstName="",b.cardData.expYear="",b.cardData.expMonth="",b.cardData.cardNumber=a.length>0?a.substring(1,a.length-1):c.substring(1,c.length),-1!==b.cardData.cardNumber.indexOf("?")&&(b.cardData.cardNumber=b.cardData.cardNumber.substr(0,b.cardData.cardNumber.indexOf("?"))),-1!==b.cardData.cardNumber.indexOf("=")&&(b.cardData.cardNumber=b.cardData.cardNumber.substr(0,b.cardData.cardNumber.indexOf("="))),b.cardData.cardType=b._getCardTypeByCardID(b.cardData.cardNumber),null===b.cardData.cardType&&(b.cardData.cardType="LOYALTY"),b._isCardTypeAccepted=b._isCardTypeAcceptedByCardType(b.cardData.cardType),!b._isCardTypeAccepted)return b.lastErrorMessage="Card type is not accepted",d;d=!0}else{if(b.cardData.cardType=b._getCardType(b.cardData.cardNumber),b._isCardTypeAccepted=b._isCardTypeAcceptedByCardType(b.cardData.cardType),!b._isCardTypeAccepted)return b.lastErrorMessage="Card type is not accepted",d;d=!0}return b.cardData.track1=a,b.cardData.track2=c,d},b._initialize=function(a){b._initCardArray(a)},b._getCardType=function(a){var c=Number(a.substr(0,1)),d=Number(a.substr(1,1)),e=b._getCardTypeByCardID(a);if(null!==e)return e;if(1===c)return"JCB";if(2===c){if(a.length>=6&&!isNaN(a.substring(0,6))){var f=parseInt(a.substring(0,6));if(!isNaN(f)&&f>=222100&&272099>=f)return"MASTERCARD"}return"JCB"}return 3===c?16===a.length?"JCB":6===d?"MASTERCARD":4===d||7===d?"AMEX":"DINERS":4===c?"VISA":5===c&&6===d?"":5===c&&d>=1&&5>=d?"MASTERCARD":0===a.indexOf("6011")||0===a.indexOf("622")||0===a.indexOf("64")||0===a.indexOf("65")?"DISCOVER":0===a.indexOf("564182")||0===a.indexOf("633110")||0===a.indexOf("6333")||0===a.indexOf("6759")?"MAESTRO":0===a.indexOf("5018")||0===a.indexOf("5020")||0===a.indexOf("5038")||0===a.indexOf("6304")||0===a.indexOf("6759")||0===a.indexOf("6761")||0===a.indexOf("6762")||0===a.indexOf("6763")||0===a.indexOf("0604")?"MAESTRO":6===c?"DISCOVER":5===c?"MASTERCARD":null},b._initCardArray=function(a){if(!a)return void console.log("CardParser._initCardArray: Missing required parameter theme.");if(!a.system)return void console.log("CardParser._initCardArray: Missing required parameter theme.system");if(0===b._creditCards.length&&a.system.CREDITCARD)for(var c=0;c<a.system.CREDITCARD.length;c++){var d=a.system.CREDITCARD[c];"true"===d.accept&&b._creditCards.push(d)}},b._getCardTypeByCardID=function(a){var c=null;try{for(var d=0;d<b._creditCards.length&&null===c;d++)"true"===b._creditCards[d].hascardid.toString().toLowerCase()&&0===a.indexOf(b._creditCards[d].cardid)&&(c=b._creditCards[d].code)}catch(e){}return c},b._isCardTypeAcceptedByCardType=function(a){for(var c=0;c<b._creditCards.length;c++){var d=b._creditCards[c];if("true"===d.accept&&d.code===a)return!0}return!1}}function Offline(a,b,c){var d=this,e="",f="";d.update=function(a,b){e=void 0!==a?window.htmlEscape(a):"",f=void 0!==b?window.htmlEscape(b):"",d.updateDisplay()},d.clearReason=function(){e="",f="",d.updateDisplay()},d.updateDisplay=function(){var a=$("#__offline"),b=a.find("#txtStatus0"),c=a.find("#txtStatus1"),d=a.find("#closeBg");a.css("display",""),b.empty(),c.empty(),e=e.replace("{0}",f);var g="none";f.length>0&&_nex.manager.currentStatus===_nex.manager.statusType.OFFLINE&&_nex.manager.connectedToTM?(f.toLowerCase().indexOf(" am",0)>=0||f.toLowerCase().indexOf(" pm",0)>=0)&&(g="",c.append(e)):(0===b.length&&console.log("#txtStatus0 not found"),b.append(e)),d.css("display",g)},d.hide=function(){$("#__offline").empty(),$("#__offline").css("display","none")}}function PhaseMover(a){var b=this;b._positionManager=new PositionManager(a),b._$upButton=null,b._$downButton=null,b._$leftButton=null,b._$rightButton=null;var c=!0;b.debug=function(){c&&console.debug(arguments)},b.bind=function(a,c,d,e){a&&(b._$upButton=$("#"+a)),c&&(b._$downButton=$("#"+c)),d&&(b._$leftButton=$("#"+d)),e&&(b._$rightButton=$("#"+e)),b.rebind()},b.rebind=function(){b._$upButton.length>0&&(b._$upButton.unbind("click",b.upClicked),b._$upButton.on("click",b.upClicked)),b._$downButton.length>0&&(b._$downButton.unbind("click",b.downClicked),b._$downButton.on("click",b.downClicked)),b._$leftButton.length>0&&(b._$leftButton.unbind("click",b.leftClicked),b._$leftButton.on("click",b.leftClicked)),b._$rightButton.length>0&&(b._$rightButton.unbind("click",b.rightClicked),b._$rightButton.on("click",b.rightClicked))},b.unbind=function(){b._$upButton.length>0&&b._$upButton.unbind("click",b.upClicked),b._$downButton.length>0&&b._$downButton.unbind("click",b.downClicked),b._$leftButton.length>0&&b._$leftButton.unbind("click",b.leftClicked),b._$rightButton.length>0&&b._$rightButton.unbind("click",b.rightClicked)},b.reset=function(){b._positionManager.resetTransform()},b.positionToSpot=function(a){switch(a){case"0":b._positionManager.positionToSpot("TOP_LEFT");break;case"1":b._positionManager.positionToSpot("TOP_CENTER");break;case"2":b._positionManager.positionToSpot("TOP_RIGHT");break;case"3":b._positionManager.positionToSpot("MIDDLE_LEFT");break;case"4":b._positionManager.positionToSpot("MIDDLE_CENTER");break;case"5":b._positionManager.positionToSpot("MIDDLE_RIGHT");break;case"6":b._positionManager.positionToSpot("BOTTOM_LEFT");break;case"7":b._positionManager.positionToSpot("BOTTOM_CENTER");break;case"8":b._positionManager.positionToSpot("BOTTOM_RIGHT")}},b.show=function(a,c){a&&c&&b._positionManager.positionToTouch(a,c),b._$upButton.length>0&&b._$upButton.show(),b._$downButton.length>0&&b._$downButton.show(),b._$leftButton.length>0&&b._$leftButton.show(),b._$rightButton.length>0&&b._$rightButton.show()},b.hide=function(){b._$upButton.length>0&&b._$upButton.hide(),b._$downButton.length>0&&b._$downButton.hide(),b._$leftButton.length>0&&b._$leftButton.hide(),b._$rightButton.length>0&&b._$rightButton.hide()},b.unbindAndHide=function(){b.unbind(),b.hide()},b.rebindAndShow=function(){b.rebind(),b.show()},b.upClicked=function(){b.debug("upClicked"),b._trackClick(),b._playSound(),b._moveUp()},b.downClicked=function(){b.debug("downClicked"),b._trackClick(),b._playSound(),b._moveDown()},b.leftClicked=function(){b.debug("leftClicked"),b._trackClick(),
b._playSound(),b._moveLeft()},b.rightClicked=function(){b.debug("rightClicked"),b._trackClick(),b._playSound(),b._moveRight()},b._trackClick=function(a){},b._playSound=function(){},b._moveUp=function(){b._positionManager.moveUp()},b._moveDown=function(){b._positionManager.moveDown()},b._moveLeft=function(){b._positionManager.moveLeft()},b._moveRight=function(){b._positionManager.moveRight()},b.size=function(a){var c=8,d=parseInt(a);isNaN(d)&&(console.log("Invalid screen resolution specified "+a),d=c),0>d&&(console.log("Invalid screen resolution specified "+d),d=c),d>9&&(console.log("Invalid screen resolution specified "+d),d=c),b._positionManager.size(d)}}function SoundManager(a){var b=this;b._csharpSoundManager=a,b.speakEnabled=!0,b._sounds=[{index:0,file:"dtmf0.mp3"},{index:1,file:"dtmf1.mp3"},{index:2,file:"dtmf2.mp3"},{index:3,file:"dtmf3.mp3"},{index:4,file:"dtmf4.mp3"},{index:5,file:"dtmf5.mp3"},{index:6,file:"dtmf6.mp3"},{index:7,file:"dtmf7.mp3"},{index:8,file:"dtmf8.mp3"},{index:9,file:"dtmf9.mp3"},{index:10,file:"button-hit.mp3"},{index:11,file:"Continue-Nudge.mp3"},{index:12,file:"chimeloop.mp3"}],b.initialize=function(a){b._csharpSoundManager.initialize(a)},b.playSoundByIndex=function(a){var c=b._checkSoundByIndex(a);if(c){var d=b._getSoundByIndex(a);b._playMP3(d.file)}},b.playButtonHit=function(){b._playMP3(b._sounds[10].file)},b.playChime=function(){b.playSoundByIndex(12)},b._getSoundByIndex=function(a){return b._sounds[a]},b._getSoundByName=function(a){for(var c=0;c<b._sounds.length;c++){var d=b._sounds[c];if(d.file===a)return d}return!1},b._checkSoundByIndex=function(a){var b=!0;return 0>a?(console.log("Invalid sound index "+a),b=!1):isNaN(a)&&(console.log("Invalid sound index "+a),b=!1),b},b._checkSoundByFilename=function(a){a||console.log("Missing filename."),a.length||console.log("Invalid filename "+a),a.length<=0&&console.log("Empty string for filename.")},b._playSound=function(a){var b=document.createElement("audio");b.setAttribute("src",a),b.play()},b._playMP3=function(a){b._csharpSoundManager.playSound(a)},b.cancelVoiceover=function(){try{b._csharpSoundManager.cancelVoiceover()}catch(a){}},b.playVoiceover=function(a){try{_nex.assets.theme.voiceoversEnabled&&("english"!==_nex.assets.theme.languageSelected.toLowerCase()&&(a=_nex.assets.theme.languageSelected+"\\"+a),b._csharpSoundManager.playSoundWithCancel(a))}catch(c){}},b.volumeUp=function(){b._csharpSoundManager.volUp()},b.volumeDown=function(){b._csharpSoundManager.volDown()},b.speak=function(a){b.speakEnabled&&_nex.kvi.active&&_nex.navBar.jackedIn&&b._csharpSoundManager.speak&&b._csharpSoundManager.speak(a)},b.cancelSpeak=function(a){if(b.speakEnabled&&_nex.kvi.active&&_nex.navBar.jackedIn)if(a)b._csharpSoundManager.cancelSpeak();else{if(_nex.assets.phaseManager.currentPhase===_nex.assets.phaseManager.phaseType.SPLASH)return;b._csharpSoundManager.cancelSpeak()}},b.setSpeaker=function(a){b._csharpSoundManager.setSpeaker(a)}}function ThemeUX(a,b){var c=this;Theme.call(c,a,b),c.splashid="default",c.itemClasses=null,c.lastUpdate=null,c.isUpdateAvailable=!1,c.testMode=!1,c.languageSelected="english",c.otherLanguages=null,c.debugEnabled=!1,c.debug=function(){c.debugEnabled&&console.debug("ThemeUX",arguments)},c.mediaPath=function(){if(inPreviewer())return"../Media.aspx?media=";var a=c.mediaRootUri;return-1===c.mediaRootUri.toLowerCase().indexOf(c.id.toLowerCase())&&(a+="/"+c.id),a+"/media/"},c.loadUpdate=function(a){c.lastUpdate=a,c.isUpdateAvailable=!0},c._videoUrl=function(){var a="http://127.0.0.1:8088";_nex.assets.theme.frenabled&&(c.debug("setVideoFeed","frenabled"),a="http://127.0.0.1:8089");var b="Kiosk1",d="nextep",e='"'+a+'"';return e.replace("http://","http://"+d+":"+b+"@")},c._loadVideoStream=function(){var a=$("#videostream");if(0===a.length){var b="<iframe src="+c._videoUrl()+' id="videostream" style="display:none" ></iframe>';$("#targets").append(b)}},c.setVideoFeed=function(a){if(_nex.assets.theme.hasvideo){c._loadVideoStream(),c.debug("setVideoFeed","showing video feed");var b="<img src="+c._videoUrl()+' id="cameraFrame" class="camera-frame"  alt="Video Feed Unavailable" >';a.find("#videofeedwrapper").empty(),a.find("#videofeedwrapper").append(b)}},c.clearVideoFeed=function(a){a.find("#videofeedwrapper").empty()},c.setNutrition=function(a,b,d){var e=function(a,b,d,e){var f=!1,g=c.findItemAttribute(e,a),h=null!==g?g.value:"",i=d.find("#"+b);i.length>0&&h.length>0&&(i.empty(),i.append(h),f=!0);var j=d.find("#"+b+"Label");if(j&&j.length>0){j.empty();var k=c.getTextAttribute("ORDER",(b+"Label").toLowerCase(),a);j.append(k)}return f};if(null!==a){var f=!1;f=e("Serving Size","serving",b,a),f=e("Calories Per Serving","calories",b,a)||f,f=e("Total Fat","totalFat",b,a)||f,f=e("Saturated Fat","satFat",b,a)||f,f=e("Trans Fat","transFat",b,a)||f,f=e("Cholesterol","cholesterol",b,a)||f,f=e("Sodium","sodium",b,a)||f,f=e("Total Carbohydrates","totalCarbs",b,a)||f,f=e("Sugar","sugars",b,a)||f,f=e("Protein","protein",b,a)||f,f=e("Fiber","fiber",b,a)||f,d&&!f?b.hide():b.show()}},c.getTenderByType=function(a){for(var b=null,d=null,e=c.system.TENDERS.TENDER,f=0;f<e.length;f++)if(d=e[f],d.type===a){b=d;break}return b},c.getGenericTenderByType=function(a){var b=null,d=null,e=[],f=c.system.TENDERS.GENERICTENDER,g=Array.isArray(f);g?e=f:e.push(f);for(var h=0;h<e.length;h++)if(d=e[h],d.type.toLowerCase()===a.toLowerCase()){b=d;break}return b},c.getGenericTenderByGuestAccountLocalType=function(a){var b=c.system.TENDERS.GENERICTENDER,d=null;if(Array.isArray(b)){for(var e=0;e<b.length;e++)if(void 0!==b[e].guestaccountlocaltypeid&&b[e].guestaccountlocaltypeid===a){d=b[e];break}}else void 0!==b&&null!==b&&b.guestaccountlocaltypeid===a&&(d=b);return d},c._getPropertyFromTender=function(a,b){var c=null;return a&&a.hasOwnProperty(b)&&(c=a[b]),c},c._checkBinaryProperty=function(a,b){var d=!1,e=c._getPropertyFromTender(a,b);return null!==e&&"true"===e.toLowerCase()&&(d=!0),d},c.isTenderTaxExempt=function(a){return c._checkBinaryProperty(a,"istaxexempt")},c.isPreAuthRequired=function(a){return c._checkBinaryProperty(a,"preauth")||c._checkBinaryProperty(a,"preauthandpay")},c.isPreAuthAndPay=function(a){return c._checkBinaryProperty(a,"preauthandpay")},c.isValidationRequired=function(a){return c._checkBinaryProperty(a,"validate")},c.isKioskValidationRequired=function(a){return c._checkBinaryProperty(a,"kioskvalidate")},c.isFinal=function(a){return c._checkBinaryProperty(a,"final")},c.useFullAmount=function(a){return!0},c.tendersAvailable=function(){var a=[],b=_nex.assets.theme.lastUpdate.THEMES.KIOSK.PAYMENTPROFILE;if("true"===b.TENDER.cashflag&&a.push("cash"),"true"===b.TENDER.compflag&&a.push("comp"),"true"===b.TENDER.counterflag&&a.push("counter"),"true"===b.TENDER.couponflag&&a.push("coupon"),"true"===b.TENDER.creditflag&&a.push("credit"),"true"===b.TENDER.debitflag&&a.push("debit"),"true"===b.TENDER.discountflag&&a.push("discount"),"true"===b.TENDER.driverflag&&a.push("driver"),"true"===b.TENDER.employeeflag&&a.push("employee"),"true"===b.TENDER.loyalty2flag&&a.push("loyalty2"),"true"===b.TENDER.loyaltyflag&&a.push("loyalty"),"true"===b.TENDER.roomchargeflag&&a.push("room"),b.TENDER.GENERIC){var c=[];Array.isArray(b.TENDER.GENERIC)?c=b.TENDER.GENERIC:c.push(b.TENDER.GENERIC);for(var d=0;d<c.length;d++)"true"===c[d].enabled.toString()&&a.push(c[d].paymenttype.toString())}return a},c._getOtherLanguages=function(){var a=null,b="";if(c.lastUpdate.THEMES.THEME.KIOSKTEXT.KIOSKTEXT){var d=c.lastUpdate.THEMES.THEME.KIOSKTEXT.KIOSKTEXT,e=Array.isArray(d);if(e){a={};for(var f=0;f<d.length;f++){var g=d[f];g.languageid&&(b=g.languageid.toLowerCase(),b&&b.length>0&&(a[b]=g))}}else d.languageid&&(a={},b=d.languageid.toLowerCase(),a[b]=d)}return a},c.getLanguageText=function(a,b){var d=null;return c.otherLanguages&&c.otherLanguages[a]&&c.otherLanguages[a][b]&&(d=c.otherLanguages[a][b]),d},c.getActiveLanguageText=function(a,b){var d="";if(void 0!==a)if(a.constructor===Array)for(var e=0;e<a.length;e++)"english"===a[e].languageid.toLowerCase()&&0===d.length?d=a[e][b]:a[e].languageid.toLowerCase()===c.languageSelected.toLowerCase()&&(d=a[e][b]);else a.hasOwnProperty(b)&&(d=a[b]);return d},c.applyUpdate=function(a){c.id=c.lastUpdate.THEMES.THEME.id,c.testMode="true"==c.lastUpdate.testmode.toLowerCase(),c.dayparts=c.lastUpdate.THEMES.THEME.DAYPARTS.DAYPART,c.menus=c.lastUpdate.THEMES.THEME.MENUS.MENU,c.items=c.lastUpdate.THEMES.THEME.ITEMS.ITEM,c.system=c.lastUpdate.THEMES.THEME.SYSTEM,_nex.utility.buttonTracking=new ButtonTracking(c.system.BUTTONTRACKING),_nex.utility.buttonBinder=new ButtonBinder(_nex.assets.theme.setButtonText,_nex.assets.theme.setControlButtonText,_nex.utility.buttonTracking.track,_nex.assets.soundManager.playButtonHit),c.kioskText=c.lastUpdate.THEMES.THEME.KIOSKTEXT;var b=c._getOtherLanguages();null!==b&&(c.otherLanguages=b),c.priceLevels=c.lastUpdate.THEMES.THEME.priceLevels,c.paymentProfile=c.lastUpdate.THEMES.KIOSK.PAYMENTPROFILE,c.itemClasses=c.lastUpdate.THEMES.THEME.ITEMCLASSES,_nex.assets.templateManager=new TemplateManager(c.lastUpdate.THEMES.THEME.TEMPLATES),c.system.hasOwnProperty("quantitylimit")&&(c.quantityLimit=Number(c.system.quantitylimit)),c.system.hasOwnProperty("alcohollimit")&&(c.alcoholLimit=Number(c.system.alcohollimit)),c.system.hasOwnProperty("consolidate")&&(c.consolidate="true"===c.system.consolidate.toLowerCase()),c.lastUpdate.hasOwnProperty("thememediapath")&&(c.mediaRootUri=c.lastUpdate.thememediapath),c.lastUpdate.THEMES.KIOSK.hasOwnProperty("splashid")&&(c.splashid=c.lastUpdate.THEMES.KIOSK.splashid,c.splashid||(c.splashid="default")),c.lastUpdate.THEMES.hasOwnProperty("voiceoverflag")&&(c.voiceoversEnabled="true"===c.lastUpdate.THEMES.voiceoverflag.toString().toLowerCase()),c.lastUpdate.THEMES.KIOSK.hasOwnProperty("splashvoiceover")&&(c.splashVoiceover=c.lastUpdate.THEMES.KIOSK.splashvoiceover);var d={popups:c.lastUpdate.THEMES.THEME.POPUPS,theme:this};_nex.assets.popupManager=new PopupManager(d,function(){void 0!==a&&null!==a&&a()}),c.isUpdateAvailable=!1,c.hasvideo=!1,c.frenabled=!1,c.disablesmsprompt=!1,c.lastUpdate.THEMES.KIOSK.hasOwnProperty("hasvideo")&&(c.hasvideo="true"===c.lastUpdate.THEMES.KIOSK.hasvideo.toLowerCase()),c.lastUpdate.THEMES.KIOSK.hasOwnProperty("disablesmsprompt")&&(c.disablesmsprompt="true"===c.lastUpdate.THEMES.KIOSK.disablesmsprompt.toLowerCase()),c.lastUpdate.THEMES.KIOSK.hasOwnProperty("frenabled")&&(c.frenabled="true"===c.lastUpdate.THEMES.KIOSK.frenabled.toLowerCase()),c.lastUpdate.THEMES.KIOSK.hasOwnProperty("loyaltyrequirespaymentdevice")&&(c.loyaltyrequirespaymentdevice="true"===c.lastUpdate.THEMES.KIOSK.loyaltyrequirespaymentdevice.toLowerCase()),c.kiosk=c.lastUpdate.THEMES.KIOSK,c.itemRank=c.lastUpdate.THEMES.KIOSK.ITEMRANK,_nex.assets.theme.kiosk.PAYMENTPROFILE&&!_nex.assets.theme.kiosk.PAYMENTPROFILE.REPEATORDERS&&(_nex.assets.theme.kiosk.PAYMENTPROFILE.REPEATORDERS={phone:"true",face:"false",credit:"true",cancel:"true"}),c.system.hasOwnProperty("cursor")&&"off"===c.system.cursor.toLowerCase()?$("body").addClass("ux-hide-cursor"):$("body").removeClass("ux-hide-cursor");var e=!1;_nex.assets.theme.lastUpdate.THEMES.THEME.hasOwnProperty("BUMPBAR")&&_nex.assets.theme.lastUpdate.THEMES.THEME.BUMPBAR.KEY.forEach(function(a){e||a.hasOwnProperty("event")&&"plugin"===a.event.toLowerCase()&&(e=!0,_nex.kviReader=new KVIReader(c.lastUpdate.THEMES.THEME),_nex.kviReader.init())}),c.lastUpdate.hasOwnProperty("locationid")&&$("body").addClass(c.lastUpdate.locationid)},c.getHardwareType=function(){var a="";return _nex.assets.theme.kiosk&&_nex.assets.theme.kiosk.hardwaretype&&(a=_nex.assets.theme.kiosk.hardwaretype),a},c.loadMedia=function(a,b,d,e,f){var g=c.mediaPath()+a;inPreviewer()&&(g="../Media.aspx?media="+a,console.debug("themeUX.loadMedia() - Loading uri "+g));var h=$.ajax({url:g,dataType:"html",cache:!1});h.done(function(a){void 0!==e&&e(b,a),void 0!==d&&null!==d&&""!==d&&c.loadScript(d,f)}),h.fail(function(){console.error("Failed to load media "+g),void 0!==e&&e(b,null)})},c.loadScript=function(a,b){$.getScript(uriFormatting.scriptUri(a)).done(function(a,c){b&&b()}).fail(function(b,c,d){console.error("Error loading script "+a),d&&(console.error("Exception details: "),console.error(d))})}}function Keypad(){var a=this;a.data="",a.shift=!1,a.capslock=!1,a.updateText=function(b){a._updateOutput(b),a.data=b},a.setKVI=function(){$("#keyboard li.letter").attr("tabindex","1"),$("#keyboard li span").attr("tabindex","1"),_nex.domFocus.cycleFocus()},a._updateOutput=function(b){a.write.html(b)},a._mask=function(a){var b=a,c=new RegExp("[a-zA-Z0-9]");return c.test(a)&&(b="*"),b},a.bindKeys=function(){a.write=$(".write"),a.write.html(""),a.data="",a._updateOutput("");var b=_nex.assets.theme.system.USERINTERFACE.EMAILDOMAIN.value1,c=_nex.assets.theme.system.USERINTERFACE.EMAILDOMAIN.value2,d=_nex.assets.theme.system.USERINTERFACE.EMAILDOMAIN.value3;void 0!==_nex.assets.theme.system.USERINTERFACE.EMAILDOMAIN&&""!==_nex.assets.theme.system.USERINTERFACE.EMAILDOMAIN&&(void 0!==b&&""!==b&&$("#emaildomain1").text(b),void 0!==c&&""!==c&&$("#emaildomain2").text(c),void 0!==d&&""!==d&&$("#emaildomain3").text(d)),$("#keyboard li").unbind(),$("#keyboard li").click(function(){var b=$(this),c=b.html();return b.hasClass("left-shift")||b.hasClass("right-shift")?($(".letter").toggleClass("uppercase"),$(".symbol span").toggle(),a.shift=a.shift!==!0,a.capslock=!1,_nex.utility.buttonTracking.track("","[shift]","","keyboard","control"),!1):b.hasClass("capslock")?($(".letter").toggleClass("uppercase"),a.capslock=!0,_nex.utility.buttonTracking.track("","[capslock]","","keyboard","control"),!1):b.hasClass("delete")?(a.data=a.data.substr(0,a.data.length-1),a.write.html(a.data),_nex.utility.buttonTracking.track("","[delete]","","keyboard","control"),!1):(b.hasClass("symbol")&&(c=$("span:visible",b).html()),b.hasClass("space")&&(c=" "),b.hasClass("tab")&&(c="	"),b.hasClass("return")&&(c="\n"),b.hasClass("uppercase")&&(c=c.toUpperCase()),a.shift===!0&&($(".symbol span").toggle(),a.capslock===!1&&$(".letter").toggleClass("uppercase"),a.shift=!1),_nex.utility.buttonTracking.track("",a._mask(c),"","keyboard","control"),a.data+=c,void a._updateOutput(a.data))})}}function Namepad(){var a=this;a._minLength=1,a._maxLength=50,a._popup=null,a.data="",a.shift=!1,a.capslock=!0,a.updateText=function(b){a._updateOutput(b),a.data=b},a._updateOutput=function(b){a.write.html(b)},a.setPopup=function(b){a.write=$(".write"),a._updateOutput(""),a._popup=b},a._mask=function(a){var b=a,c=new RegExp("[a-zA-Z0-9]");return c.test(a)&&(b="*"),b},a.bindKeys=function(){a.write=$(".write"),$("#pagernum").html(""),a.write.html(""),a.data="",a._updateOutput(""),a._isValid(a.data),$("#keyboard li").unbind(),$("#keyboard li").click(function(){var b=$(this),c=b.html();return b.hasClass("left-shift")||b.hasClass("right-shift")?($(".letter").toggleClass("uppercase"),$(".symbol span").toggle(),a.shift=a.shift!==!0,a.capslock=!1,_nex.utility.buttonTracking.track("","[shift]","","keyboard","control"),!1):b.hasClass("capslock")?($(".letter").toggleClass("uppercase"),a.capslock=!0,_nex.utility.buttonTracking.track("","[capslock]","","keyboard","control"),!1):b.hasClass("delete")?(a.data=a.data.substr(0,a.data.length-1),a.write.html(a.data),a._isValid(a.data),_nex.utility.buttonTracking.track("","[delete]","","keyboard","control"),!1):(b.hasClass("symbol")&&(c=$("span:visible",b).html()),b.hasClass("space")&&(c=" "),b.hasClass("tab")&&(c="	"),b.hasClass("return")&&(c="\n"),b.hasClass("uppercase")&&(c=c.toUpperCase()),a.shift===!0&&($(".symbol span").toggle(),a.capslock===!1&&$(".letter").toggleClass("uppercase"),a.shift=!1),_nex.utility.buttonTracking.track("",a._mask(c),"","keyboard","control"),a.data+=c,a._updateOutput(a.data),void a._isValid(a.data))})},a._isValid=function(b){for(var c=!0,d=a._popup.name,e=$("#"+d),f=0;f<a._popup.buttons.length;f++)"ok"===a._popup.buttons[f].id.toLowerCase()&&e.find("#"+a._popup.buttons[f].id).prop("disabled",!1);if(a._minLength>0&&a._maxLength>0&&(c=b.length>=a._minLength&&b.length<=a._maxLength,!c))for(f=0;f<a._popup.buttons.length;f++)"ok"===a._popup.buttons[f].id.toLowerCase()&&e.find("#"+a._popup.buttons[f].id).prop("disabled",!0);return c},a.setMinLength=function(b){a._minLength=b||1,0===a._minLength&&(a._minLength=1)},a.setMaxLength=function(b){a._maxLength=b||50,0===a._maxLength&&(a._maxLength=50)}}function Numpad(){var a=this;a.MAX_LENGTH=20,a._maxValue=-1,a.data="",a._popup=null,a._updateOutput=function(b){a.write.val(b)},a.setPopup=function(b){a.write=$(".numpadTextOut"),a._updateOutput(""),a._popup=b},a._mask=function(a){var b=a;switch(a){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":b="*"}return b},a.bindKeys=function(){a.write=$(".numpadTextOut"),a.write.html(""),a.data="",a._updateOutput(""),$("#numpadInput li").unbind(),$("#numpadInput li").click(function(){var b=$(this),c=b.html();if(b.hasClass("symbol")&&(c=$("span:visible",b).html()),_nex.utility.buttonTracking.track("",a._mask(c),"","numpad","control"),b.hasClass("delete")?a.data=a.data.substr(0,a.data.length-1):a.isNotMaxLength(a.data.length)&&(a.data+=c),a._updateOutput(a.data),a.data.length===a.MAX_LENGTH&&null!==a._popup){var d=a._popup.name,e=$("#"+d);e.find("#"+a._popup.buttons[0].id).trigger("click")}})},a.isNotMaxLength=function(b){var c=$("div.numpadOutput input[maxlength]").attr("maxlength");if(void 0===c)return b<=a.MAX_LENGTH;var d=$("div.numpadOutput input[maxlength]").val();return d.length<=c},a.setMaxLength=function(b){a.MAX_LENGTH=b||3,0===a.MAX_LENGTH&&(a.MAX_LENGTH=3)}}function Pagerpad(){var a=this;a.MAX_LENGTH=3,a._minValue=-1,a._maxValue=-1,a.data="",a._popup=null,a._updateOutput=function(b){a.write.val(b)},a.setPopup=function(b){a.write=$(".pagerpadTextOut"),a._updateOutput(""),a._popup=b},a._mask=function(a){var b=a;switch(a){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":b="*"}return b},a.bindKeys=function(){a.write=$(".pagerpadTextOut"),$("#pagernum").html(""),a.write.html(""),a.data="",a._updateOutput(""),a._isValid(a.data),$("#numpadInput li").unbind(),$("#numpadInput li").click(function(){var b=$(this),c=b.html();b.hasClass("symbol")&&(c=$("span:visible",b).html()),_nex.utility.buttonTracking.track("",a._mask(c),"","numpad","control"),b.hasClass("delete")?a.data=a.data.substr(0,a.data.length-1):a.data.length<a.MAX_LENGTH&&(a.data+=c),a._updateOutput(a.data);var d=a._isValid(a.data);if(d&&a.data.length===a.MAX_LENGTH&&null!==a._popup){var e=a._popup.name,f=$("#"+e);f.find("#"+a._popup.buttons[0].id).trigger("click")}})},a._isValid=function(b){b=isNaN(b)?-1:Number(b);for(var c=!0,d=a._popup.name,e=$("#"+d),f=0;f<a._popup.buttons.length;f++)"ok"===a._popup.buttons[f].id.toLowerCase()&&e.find("#"+a._popup.buttons[f].id).prop("disabled",!1);if(a._minValue>0&&a._maxValue>0&&(c=b>=a._minValue&&b<=a._maxValue,!c))for(f=0;f<a._popup.buttons.length;f++)"ok"===a._popup.buttons[f].id.toLowerCase()&&e.find("#"+a._popup.buttons[f].id).prop("disabled",!0);return c},a.setMaxLength=function(b){a.MAX_LENGTH=b||3,0===a.MAX_LENGTH&&(a.MAX_LENGTH=3)},a.setMinValue=function(b){a._minValue=b||-1},a.setMaxValue=function(b){a._maxValue=b||-1}}function Phonepad(a){var b=this;b.data="",b.MAXLENGTH=10,b._lastDigitCallback=null,b._digitEnteredCallback=null,b._soundManager=a,b._soundManager||console.log("Missing required parameter sound manager to Phonepad."),b._updatePhoneNumber=function(){for(var a="",c="",d="",e="phone1",f="phone2",g="phone3",h=0;h<b.data.length;h++){var i=b.data[h];a.length<3?a+=i:c.length<3?c+=i:d+=i}document.getElementById(e).value=a,document.getElementById(f).value=c,document.getElementById(g).value=d},b._updateOutput=function(a){b.write.val(a),b._updatePhoneNumber()},b._playSound=function(a){var c=Number(a);c>=0&&b._soundManager&&b._soundManager.playSoundByIndex&&b._soundManager.playSoundByIndex(c)},b._mask=function(a){var b=a;switch(a){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":console.debug("masking number"),b="*"}return b},b.bindKeys=function(a,c){b._lastDigitCallback=a,b._digitEnteredCallback=c,b.write=$(".numpadTextOut"),b.write.html(""),b.data="",b._updateOutput(""),$("#phonepadInput li").unbind(),$("#phonepadInput li").click(function(){var a=$(this),c=a.html();a.hasClass("symbol")&&(c=$("span",a).html()),a.hasClass("delete")?b.data=b.data.substr(0,b.data.length-1):b.data.length<b.MAXLENGTH&&(b.data+=c),window.setTimeout(function(){b._updateOutput(b.data)},0),_nex.utility.buttonTracking.track("",b._mask(c),"","keyboard","control"),b._playSound(c),b.data.length===b.MAXLENGTH?window.setTimeout(function(){"function"==typeof b._lastDigitCallback&&(console.debug("last digit found"),b._lastDigitCallback(b.data))},250):"function"==typeof b._digitEnteredCallback&&b._digitEnteredCallback(c)})}}function OnlineOrder(a){if(!(a instanceof ThemeUX))throw"OnlineOrder: Parameter is not a ThemeUX.";var b=this;b._theme=a,b.lookupByPin=!1,b.isPinOrderLookup=function(){var a=!1,c=b._theme;return c.system&&c.system.PREVIOUSORDERS&&c.system.PREVIOUSORDERS.hasOwnProperty("orderlookup")&&"true"===c.system.PREVIOUSORDERS.orderlookup.toLowerCase()&&(a=!0),a},b._popupOrderOptions=function(a,b){var c="orderOptionsPopup",d=$.extend(!0,{},_nex.assets.popupManager[c]);d.message=_nex.assets.theme.getTextAttribute("","instructions","Please Enter an option."),d.buttons[0].clickEvent="_nex.previousOrders.onlineOrder.getPinFromNumPad();",d.buttons[1].clickEvent="_nex.previousOrders._lookupPreviousSelected();",d.buttons[2].clickEvent="_nex.previousOrders._gotoOrderingWithoutOrder();",_nex.assets.popupManager.showPopup(d)},b.getPinFromNumPad=function(){var a=$.extend(!0,{},_nex.assets.popupManager.numpadPopup);a.buttons[0].clickEvent="_nex.previousOrders.onlineOrder.getPinLookup();",a.buttons[1].clickEvent="_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.SPLASH);_nex.assets.popupManager.hidePopup(popup);",a.message=_nex.assets.theme.getTextAttribute("REPEATORDERS","orderpinprompt","Please enter your Order PIN");var b=4;_nex.assets.theme.system&&_nex.assets.theme.system.USERINTERFACE&&_nex.assets.theme.system.USERINTERFACE.hasOwnProperty("orderpinlength")&&(b=Number(_nex.assets.theme.system.USERINTERFACE.orderpinlength)),_nex.keyboard.numpad.setMaxLength(b),_nex.keyboard.numpad.setPopup(a),a.onShowCallback=_nex.keyboard.numpad.bindKeys,_nex.assets.popupManager.showPopup(a)},b.getPinLookup=function(){var a=_nex.keyboard.numpad.data;a.length>0&&b.orderLookup(a)},b.showPinNotFoundPopup=function(a,b){var c=$.extend(!0,{},_nex.assets.popupManager.dismissibleMessagePopup);c.message=a?a:"Sorry! We are unable to find your order.",c.buttons[0].clickEvent="_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.PREVIOUS_ORDERS, function () { _nex.previousOrders.start();});",_nex.assets.popupManager.showPopup(c,b)},b.orderLookup=function(a){b._orderDate="",b._searchType="OrderId",b._searchTerm="*"+a;var c=new _nex.commands.OrderLookup(b._orderDate,b._searchType,b._searchTerm,!0);_nex.communication.send(c,function(a){b.orderLookupResponse(a)},"ORDERLOOKUPRESPONSE")},b.orderLookupResponse=function(a){"true"===a.success?(_nex.orderManager.currentOrder.update(a.ORDER),_nex.orderManager.currentOrder.ordertype="drivethru",_nex.ordering.order=_nex.orderManager.currentOrder,"NoPayment"===a.ORDER.paymentstatus?_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.PAYMENT,function(){_nex.payment.start()}):_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.COMPLETE,function(){_nex.complete.start()})):b.showPinNotFoundPopup()}}function Order(){var a=this;a.creditCard=null,a.ITEM=[],a.totals=new TotalsModel,a.togo=!0,a.alcoholEnabled=!0,a.ageVerified=!1,a.smsNumber="",a.lookupData=null,a.remainingBalance=0,a.roundUpCharitySelected=!1,a.customer={email:"",firstname:"",lastname:"",guestaccountid:"",name:"",pagernumber:""},a.receiptFormat=_nex.orderManager.receiptFormatType.PAPER,a.ordernumber="",a.tenderResults=[],a.origin="",a.ordertype="",a.orderid="",a.ordernumber="",a.togoSet=!1,a.currentItem=function(){var b=null;return null!==a.ITEM&&a.ITEM.length>0&&(b=a.ITEM[a.ITEM.length-1]),b},a.update=function(b,c){if(c!==!1&&(b.hasOwnProperty("ITEM")?a.ITEM=b.ITEM:a.ITEM=[]),b.hasOwnProperty("CUSTOMER")?(a.customer=b.CUSTOMER[0],console.log("Updating customer info: ",a.customer)):a.customer={},a.checkAlcoholLimit(),void 0!==b.subtotal){a.totals.subtotal(currency.formatAsDollars(Number(b.subtotal),!1)),a.totals.salestax(currency.formatAsDollars(0,!1)),a.totals.salestax2(currency.formatAsDollars(0,!1)),a.totals.deliveryfee(currency.formatAsDollars(0,!1)),a.totals.roundupcharity(currency.formatAsDollars(0,!1)),a.totals.amountdue(currency.formatAsDollars(Number(b.amountdue),!1)),a.totals.discount(currency.formatAsDollars(0,!1));var d=Number(b.remainingbalance);d||(d=Number(b.amountdue)),a.totals.remainingbalance(currency.formatAsDollars(d,!1))}b.hasOwnProperty("COMPLETEORDER")&&(a.origin=b.COMPLETEORDER.origin,a.ordertype=b.COMPLETEORDER.ordertype,a.orderid=b.COMPLETEORDER.orderid,a.ordernumber=b.COMPLETEORDER.ordernumber)},a.currentItemIndex=function(){var b=-1;return null!==a.ITEM&&a.ITEM.length>0&&(b=a.ITEM.length-1),b},a.checkAlcoholLimit=function(){var b=a.alcoholCount();a.alcoholEnabled=b<_nex.assets.theme.alcoholLimit},a.alcoholCount=function(){for(var b=0,c=0;c<a.ITEM.length;c++)"true"===a.ITEM[c].alcoholflag.toLowerCase()&&(b+=Number(a.ITEM[c].quantity));return b},a.origin=_nex.assets.theme.kiosk.origin,a.ordertype=null}function OrderManager(){var a=this;a.customData={},a.receiptFormatType={PAPER:"0",EMAIL:"1",NONE:"2",SMS:"3"},a.currentOrder=null,a.startOrder=function(b){a.currentOrder=new Order,a.currentOrder.creditCard=b||null,a._orderId=null,a._orderNumber=null,a._ordersPlaced=[],a._gratuity=0,a._gratuityPercentage=0,a._gratuityAccepted=!1,a._acceptingCash=!1,a._cashAccetped=!1,a._couponAccepted=!1,a._orderReviewMenuId=null,a._selectedReservation=null,a._specials=null},a.resetCurrentOrder=function(){a.currentOrder=new Order},a.NEXTEPOrderType={DineIn:"0",TakeOut:"1",Delivery:"2",DriveThru:"3"},a.OrderOriginType={Kiosk:"0",NextepMobile:"3",Pos:"5",DriveThru:"6",SelfCheckout:"7"}}function PaymentButtons(a){if(!a)throw"ERROR IN PAYMENTBUTTONS! You must specify a paymentManager";var b=this;b._paymentManager=a,b._$cashButtonElement=null,b._$counterButtonElement=null,b._$couponButtonElement=null,b._$creditButtonElement=null,b._$debitButtonElement=null,b._$discountButtonElement=null,b._$employeeButtonElement=null,b._$loyaltyButtonElement=null,b._$genericTender1ButtonElement=null,b._$genericTender2ButtonElement=null,b._$genericTender3ButtonElement=null,b._$genericTender4ButtonElement=null,b._$genericTender5ButtonElement=null,b._$genericTender6ButtonElement=null,b._$genericTender7ButtonElement=null,b._$genericTender8ButtonElement=null,b._$genericTender9ButtonElement=null,b._$genericTender10ButtonElement=null,b._$gaIncliningBalanceTender1ButtonElement=null,b._$gaIncliningBalanceTender2ButtonElement=null,b._$gaIncliningBalanceTender3ButtonElement=null,b._$gaIncliningBalanceTender4ButtonElement=null,b._$gaIncliningBalanceTender5ButtonElement=null,b._$gaIncliningBalanceTender6ButtonElement=null,b._$gaIncliningBalanceTender7ButtonElement=null,b._$gaIncliningBalanceTender8ButtonElement=null,b._$gaIncliningBalanceTender9ButtonElement=null,b._$gaIncliningBalanceTender10ButtonElement=null,b._numButtons=0,b.initialize=function(){var a=_nex.assets.theme.tendersAvailable();console.debug("PaymentButtons: Initializing with buttons available: "),console.debug(a);b._$cashButtonElement=$("#"+paymentConstants.CASH_BUTTON_ID),b._$counterButtonElement=$("#"+paymentConstants.COUNTER_BUTTON_ID),b._$couponButtonElement=$("#"+paymentConstants.COUPON_BUTTON_ID),b._$creditButtonElement=$("#"+paymentConstants.CREDIT_BUTTON_ID),b._$debitButtonElement=$("#"+paymentConstants.DEBIT_BUTTON_ID),b._$discountButtonElement=$("#"+paymentConstants.DISCOUNT_BUTTON_ID),b._$employeeButtonElement=$("#"+paymentConstants.EMPLOYEE_BUTTON_ID),b._$loyaltyButtonElement=$("#"+paymentConstants.LOYALTY_BUTTON_ID),b._$genericTender1ButtonElement=$("#"+paymentConstants.GENERICTENDER1_BUTTON_ID),b._$genericTender2ButtonElement=$("#"+paymentConstants.GENERICTENDER2_BUTTON_ID),b._$genericTender3ButtonElement=$("#"+paymentConstants.GENERICTENDER3_BUTTON_ID),b._$genericTender4ButtonElement=$("#"+paymentConstants.GENERICTENDER4_BUTTON_ID),b._$genericTender5ButtonElement=$("#"+paymentConstants.GENERICTENDER5_BUTTON_ID),b._$genericTender6ButtonElement=$("#"+paymentConstants.GENERICTENDER6_BUTTON_ID),b._$genericTender7ButtonElement=$("#"+paymentConstants.GENERICTENDER7_BUTTON_ID),b._$genericTender8ButtonElement=$("#"+paymentConstants.GENERICTENDER8_BUTTON_ID),b._$genericTender9ButtonElement=$("#"+paymentConstants.GENERICTENDER9_BUTTON_ID),b._$genericTender10ButtonElement=$("#"+paymentConstants.GENERICTENDER10_BUTTON_ID),b._$gaIncliningBalanceTender1ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER1_BUTTON_ID),b._$gaIncliningBalanceTender2ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER2_BUTTON_ID),b._$gaIncliningBalanceTender3ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER3_BUTTON_ID),b._$gaIncliningBalanceTender4ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER4_BUTTON_ID),b._$gaIncliningBalanceTender5ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER5_BUTTON_ID),b._$gaIncliningBalanceTender6ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER6_BUTTON_ID),b._$gaIncliningBalanceTender7ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER7_BUTTON_ID),b._$gaIncliningBalanceTender8ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER8_BUTTON_ID),b._$gaIncliningBalanceTender9ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER9_BUTTON_ID),b._$gaIncliningBalanceTender10ButtonElement=$("#"+paymentConstants.GAINCLININGBALANCETENDER10_BUTTON_ID);var c=-1;b._numButtons=0,b._$cashButtonElement&&($.inArray("cash",a)===c?(b._$cashButtonElement.hide(),b._$cashButtonElement.parent().hide()):(++b._numButtons,b._setPaymentButtonText(b._$cashButtonElement,"cashtext","CASH"),b._$cashButtonElement.unbind("click"),b._$cashButtonElement.click(function(){b._cashButtonClicked(b._$cashButtonElement)}))),b._$counterButtonElement&&($.inArray("counter",a)===c?(b._$counterButtonElement.hide(),b._$counterButtonElement.parent().hide()):(++b._numButtons,b._setPaymentButtonText(b._$counterButtonElement,"countertext","COUNTER"),b._$counterButtonElement.unbind("click"),b._$counterButtonElement.click(function(){b._counterButtonClicked(b._$counterButtonElement)}))),b._$couponButtonElement&&($.inArray("coupon",a)===c?(b._$couponButtonElement.hide(),b._$couponButtonElement.parent().hide()):(++b._numButtons,b._setPaymentButtonText(b._$couponButtonElement,"coupontext","COUPON"),b._$couponButtonElement.unbind("click"),b._$couponButtonElement.click(function(){b._couponButtonClicked(b._$couponButtonElement)}))),b._$creditButtonElement&&($.inArray("credit",a)===c?(b._$creditButtonElement.hide(),b._$creditButtonElement.parent().hide()):(++b._numButtons,b._setPaymentButtonText(b._$creditButtonElement,"credittext","CREDIT"),b._$creditButtonElement.unbind("click"),b._$creditButtonElement.click(function(){b._creditButtonClicked(b._$creditButtonElement)}))),b._$debitButtonElement&&($.inArray("debit",a)===c?(b._$debitButtonElement.hide(),b._$debitButtonElement.parent().hide()):(++b._numButtons,b._setPaymentButtonText(b._$debitButtonElement,"debittext","DEBIT"),b._$debitButtonElement.unbind("click"),b._$debitButtonElement.click(function(){b._debitButtonClicked(b._$debitButtonElement)}))),b._$discountButtonElement&&($.inArray("discount",a)===c?(b._$discountButtonElement.hide(),b._$discountButtonElement.parent().hide()):(++b._numButtons,b._setPaymentButtonText(b._$discountButtonElement,"discounttext","DISCOUNTS"),b._$discountButtonElement.unbind("click"),
b._$discountButtonElement.click(function(){b._discountButtonClicked(b._$discountButtonElement)}))),b._$employeeButtonElement&&($.inArray("employee",a)===c?(b._$employeeButtonElement.hide(),b._$employeeButtonElement.parent().hide()):(++b._numButtons,b._setPaymentButtonText(b._$employeeButtonElement,"employeetext","EMPLOYEE"),b._$employeeButtonElement.unbind("click"),b._$employeeButtonElement.click(function(){b._employeeButtonClicked(b._$employeeButtonElement)}))),b._$loyaltyButtonElement&&($.inArray("loyalty",a)===c?(b._$loyaltyButtonElement.hide(),b._$loyaltyButtonElement.parent().hide()):(++b._numButtons,b._setPaymentButtonText(b._$loyaltyButtonElement,"loyaltytext","GIFT CARD"),b._$loyaltyButtonElement.unbind("click"),b._$loyaltyButtonElement.click(function(){b._loyaltyButtonClicked(b._$loyaltyButtonElement)}))),b._validateGenericTender(a,b._$genericTender1ButtonElement,"generictender1",1),b._validateGenericTender(a,b._$genericTender2ButtonElement,"generictender2",2),b._validateGenericTender(a,b._$genericTender3ButtonElement,"generictender3",3),b._validateGenericTender(a,b._$genericTender4ButtonElement,"generictender4",4),b._validateGenericTender(a,b._$genericTender5ButtonElement,"generictender5",5),b._validateGenericTender(a,b._$genericTender6ButtonElement,"generictender6",6),b._validateGenericTender(a,b._$genericTender7ButtonElement,"generictender7",7),b._validateGenericTender(a,b._$genericTender8ButtonElement,"generictender8",8),b._validateGenericTender(a,b._$genericTender9ButtonElement,"generictender9",9),b._validateGenericTender(a,b._$genericTender10ButtonElement,"generictender10",10);for(var d=0;10>d;d++){var e=b._getGAIncliningBalanceButtonElement(d);_nex.hasGuestAccount&&d<_nex.guestAccount.chargeableLocalAccounts.length?b._validateGAIncliningBalanceTender(_nex.guestAccount.chargeableLocalAccounts[d],e,d):(e.hide(),e.parent().hide())}b._showHeaderMessage()},b._setPaymentButtonText=function(a,b,c){var d=a.find("#btext");d&&(d.empty(),d.append(_nex.assets.theme.getTextAttribute("PAYMENT",b,c)))},b._validateGenericTender=function(a,c,d,e){var f=-1;if(c)if($.inArray(d,a)===f)c.hide(),c.parent().hide();else{++b._numButtons;var g="GENERIC",h=_nex.assets.theme.getGenericTenderByType(d);h&&(g=h.name.toString()),b._setPaymentButtonText(c,d.toString()+"text",g),c.unbind("click"),c.click(function(){b._genericButtonClicked(c,d,e)})}},b._getGAIncliningBalanceButtonElement=function(a){var c;switch(a){case 0:c=b._$gaIncliningBalanceTender1ButtonElement;break;case 1:c=b._$gaIncliningBalanceTender2ButtonElement;break;case 2:c=b._$gaIncliningBalanceTender3ButtonElement;break;case 3:c=b._$gaIncliningBalanceTender4ButtonElement;break;case 4:c=b._$gaIncliningBalanceTender5ButtonElement;break;case 5:c=b._$gaIncliningBalanceTender6ButtonElement;break;case 6:c=b._$gaIncliningBalanceTender7ButtonElement;break;case 7:c=b._$gaIncliningBalanceTender8ButtonElement;break;case 8:c=b._$gaIncliningBalanceTender9ButtonElement;break;case 9:c=b._$gaIncliningBalanceTender10ButtonElement;break;default:c=null}return c},b._validateGAIncliningBalanceTender=function(a,c,d){if("incliningbalance"===a.usageType){var e=_nex.assets.theme.getGenericTenderByGuestAccountLocalType(a.guestAccountLocalTypeId);if(void 0!==e&&null!==e){++b._numButtons;var f=e.name.toString()+" Account Number: "+a.maskedAccountNumber();return b._setPaymentButtonText(c,"gaincliningbalancetender"+(d+1).toString()+"text",f),c.unbind("click"),void c.click(function(){b._gaIncliningBalanceButtonClicked(c,"gaincliningbalancetender"+(d+1).toString())})}}void 0!==c&&null!==c&&(c.hide(),c.parent().hide())},b._showHeaderMessage=function(){var a=$("#selectPaymentMessage");a.length>0&&(a.empty(),a.append(_nex.assets.theme.getTextAttribute("PAYMENT","paymenttype","Select Type of Payment")))},b._trackPaymentClick=function(a,c,d){_nex.utility.buttonTracking.track(a,c.text(),b.currentMenuId,d,"payment")},b._cashButtonClicked=function(a){console.debug("PaymentButtons: Cash button clicked."),b._trackPaymentClick(1,a,"Cash Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected("cash")},b._counterButtonClicked=function(a){console.debug("PaymentButtons: Counter button clicked."),b._trackPaymentClick(1,a,"Counter Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected("counter")},b._couponButtonClicked=function(a){console.debug("PaymentButtons: Coupon button clicked."),b._trackPaymentClick(1,a,"Coupon Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected("coupon")},b._creditButtonClicked=function(a){console.debug("PaymentButtons: Credit button clicked."),b._trackPaymentClick(1,a,"Credit Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected("credit")},b._debitButtonClicked=function(a){console.debug("PaymentButtons: Debit button clicked."),b._trackPaymentClick(1,a,"Debit Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected("debit")},b._discountButtonClicked=function(a){console.debug("PaymentButtons: Discount button clicked."),b._trackPaymentClick(1,a,"Discount Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected("discount")},b._employeeButtonClicked=function(a){console.debug("PaymentButtons: Employee button clicked."),b._trackPaymentClick(1,a,"Employee Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected("employee")},b._loyaltyButtonClicked=function(a){console.debug("PaymentButtons: Loyalty button clicked."),b._trackPaymentClick(1,a,"Loyalty Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected("loyalty")},b._genericButtonClicked=function(a,c,d){console.debug("PaymentButtons: Generic Tender button clicked...generic tenderid:"+c.toString()),b._trackPaymentClick(1,a,"Generic Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected(c)},b._gaIncliningBalanceButtonClicked=function(a,c){console.debug("PaymentButtons: Guest Account Inclining Balance Tender button clicked... id:"+c.toString()),b._trackPaymentClick(1,a,"Guest Account Inclining Balance Button"),_nex.assets.soundManager.playButtonHit(),_nex.payment.paymentSelected(c)}}function PaymentClipFactory(){var a=this;a.createPaymentClip=function(a,b){var c=paymentConstants,d=null;switch(a){case c.CASH_CLIP:break;case c.COUNTER_CLIP:d=new CounterPaymentClip(b);break;case c.COUPON_CLIP:d=new CouponPaymentClip(b);break;case c.CREDIT_CLIP:d=new CreditPaymentClip(b);break;case c.LOYALTY_CLIP:d=new LoyaltyPaymentClip(b);break;case c.PREPTIME_CLIP:break;case c.PREPTIME_CLIP:break;case c.PROCESSING_CLIP:break;case c.SELECTPAYMENT_CLIP:d=new SelectPaymentClip;break;case c.LOYALTYSELECTBUCKET_CLIP:break;case c.ROOMCHARGE_CLIP:break;case c.SUBMITORDER_CLIP:break;case c.TAKECASH_CLIP:break;case c.EMPLOYEE_CLIP:d=new EmployeePaymentClip(b);break;case c.LOYALTYPROMPT_CLIP:d=new LoyaltyPromptClip(b);break;case c.GENERICTENDER1_CLIP:d=new GenericPaymentClip(1);break;case c.GENERICTENDER2_CLIP:d=new GenericPaymentClip(2);break;case c.GENERICTENDER3_CLIP:d=new GenericPaymentClip(3);break;case c.GENERICTENDER4_CLIP:d=new GenericPaymentClip(4);break;case c.GENERICTENDER5_CLIP:d=new GenericPaymentClip(5);break;case c.GENERICTENDER6_CLIP:d=new GenericPaymentClip(6);break;case c.GENERICTENDER7_CLIP:d=new GenericPaymentClip(7);break;case c.GENERICTENDER8_CLIP:d=new GenericPaymentClip(8);break;case c.GENERICTENDER9_CLIP:d=new GenericPaymentClip(9);break;case c.GENERICTENDER10_CLIP:d=new GenericPaymentClip(10);break;case c.GAINCLININGBALANCETENDER1_CLIP:d=new GAIncliningBalancePaymentClip(1);break;case c.GAINCLININGBALANCETENDER2_CLIP:d=new GAIncliningBalancePaymentClip(2);break;case c.GAINCLININGBALANCETENDER3_CLIP:d=new GAIncliningBalancePaymentClip(3);break;case c.GAINCLININGBALANCETENDER4_CLIP:d=new GAIncliningBalancePaymentClip(4);break;case c.GAINCLININGBALANCETENDER5_CLIP:d=new GAIncliningBalancePaymentClip(5);break;case c.GAINCLININGBALANCETENDER6_CLIP:d=new GAIncliningBalancePaymentClip(6);break;case c.GAINCLININGBALANCETENDER7_CLIP:d=new GAIncliningBalancePaymentClip(7);break;case c.GAINCLININGBALANCETENDER8_CLIP:d=new GAIncliningBalancePaymentClip(8);break;case c.GAINCLININGBALANCETENDER9_CLIP:d=new GAIncliningBalancePaymentClip(9);break;case c.GAINCLININGBALANCETENDER10_CLIP:d=new GAIncliningBalancePaymentClip(10);break;default:throw"PaymentFactory: Unknown payment type "+a}return d}}function PaymentManager(){var a=this;a._enableDebugging=!0,a._debug=function(b){a._enableDebugging&&console.debug("PaymentManager: "+b)},a._previousClip=null,a._currentClip=null,a._paymentClipFactory=new PaymentClipFactory,a._paymentTenderFactory=new PaymentTenderFactory,a._paymentButtons=new PaymentButtons(a),a._callbackClip="",a._callback=function(){},a.reset=function(){a._previousClip=null,null!==a._currentClip&&a._currentClip.hide(),a._currentClip=null},a.gotoClip=function(b){a._debug("Going to clip "+b),a._currentClip&&(a._currentClip.hide(),a._previousClip=a._currentClip);var c=a._paymentClipFactory.createPaymentClip(b);c&&(a._paymentButtons.initialize(),c.show(),c.hasOwnProperty("defaultVoiceover")&&c.defaultVoiceover.length>0&&_nex.assets.soundManager.playVoiceover(c.defaultVoiceover),a._callbackClip===b&&(console.log("paymentManager.gotoClip: Calling custom callback because "+a._callbackClip+" is "+b),a._callback()),inPreviewer()&&!_nex.inAdvancedMode&&$("#wrap").click(function(){$("#wrap").unbind("click"),a._debug("In the previewer... going right to complete."),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.COMPLETE,function(){_nex.complete.start()})})),a._currentClip=c,_nex.kviReader&&_nex.kviReader.payment()},a.previousClip=function(){return a._previousClip?(a._currentClip.hide(),a._previousClip.show(),a._currentClip=a._previousClip,a._previousClip=!1,!0):!1},a.registerCallback=function(b,c){a._callbackClip=b,a._callback=c},a.updateReceipt=function(){var b=$("#receipt");if(b.length>0){if(a._debug("Found the payment receipt... Updating it..."),"UX"===_nex.context&&$("#receipt").attr("tabindex",2),void 0!==_nex.orderManager.currentOrder.totals.remainingbalance){var c=_nex.orderManager.currentOrder.totals.remainingbalance(),d=correctMathError(Number(c));if(d>0){var e=($("#receiptItemTemplate").length>0?"_nex.ordering.showPulldownReceipt()":"",Number(d));if(e>0){var f=b.find("#txtTotal");f.length>0?(a._debug("Updating txtTotal on the payment receipt"),f.empty(),f.append(currency.formatAsDollars(e,!0)),a._debug("Showing receipt"),$(".order-receipt").css("visibility","visible")):a._debug("No txtTotal on the payment receipt")}}}}else a._debug("No payment receipt")}}function PaymentTenderFactory(){}function Complete(a){var b=this;b.timer=null,b.debugEnabled=!1,b.debug=function(){b.debugEnabled&&console.debug("Complete phase",arguments)},b.orderIsDriveThruOrder=function(){return _nex.manager.theme.kiosk.PAYMENTPROFILE.ORDERTYPE.hasOwnProperty("drivethruflag")&&"true"===_nex.manager.theme.kiosk.PAYMENTPROFILE.ORDERTYPE.drivethruflag},b.startTimer=function(){b.timer&&(b.timer.stop(),b.timer=null),b.timer=new TimeoutTimer(this,this.gotoSplash,10),b.timer.start()},b.stopTimer=function(){b.timer&&(b.timer.stop(),b.timer=null)},b.start=function(){b.debug("Starting complete phase"),_nex.manager.sendStatusUpdate(_nex.manager.statusType.COMPLETE),_nex.communication.send(new _nex.commands.ProcessPrint(_nex.orderManager.currentOrder)),b.startTimer();var a=$("#complete");if(a.length>0){var c=$("#complete-hitarea");c.length>0&&(c.unbind("click"),c.click(function(){b.debug("complete hitarea clicked"),b._completeClicked(c)}));var d="COMPLETE";b.orderIsDriveThruOrder()&&(d="DTCOMPLETE");var e="Pick Up Your Order When Your Number Is Called",f=_nex.ordering.order.ordernumber,g=_nex.assets.theme.system.hasOwnProperty("ordernumberlength")&&_nex.assets.theme.system.ordernumberlength.toString().length>0?Number(_nex.assets.theme.system.ordernumberlength.toString()):2,h=_nex.ordering.order.ordernumber.length;h>g&&(f=_nex.ordering.order.ordernumber.substr(h-g,g)),$("#ordernumbermessage").empty(),$("#ordernumbermessage").append(_nex.assets.theme.getTextAttribute(d,"ordernumber","Your Order Number Is")),$("#ordernumber").empty(),$("#ordernumber").append(f||"00");var i=_nex.orderManager.currentOrder.tenderResults.length>0?_nex.orderManager.currentOrder.tenderResults[_nex.orderManager.currentOrder.tenderResults.length-1].tendertype:"",j=b._getTenderMessage(i),k=$("#ordercomplete"),l=$("#completemessage");if(l.length>0){var m=null!==j?j.dineintext:"paymentmessage";0===i.length?(m="localmessage",j="WILL BE READY IN APPROXIMATELY"):_nex.orderManager.currentOrder.togo&&null!==j&&(m=j.togotext,e="Please Take Your Receipt To The Cashier For Payment"),l.empty(),"takeout"===_nex.orderManager.currentOrder.ordertype?l.append(_nex.assets.theme.getTextAttribute(d,m,e)):b.orderIsDriveThruOrder()||l.append(_nex.assets.theme.getTextAttribute(d,m,e)),b.orderIsDriveThruOrder()&&l.append(_nex.assets.theme.getTextAttribute(d,"drivethruendtext",""))}if(null!==j){var n=j.dineinvoiceover;_nex.orderManager.currentOrder.togo&&(n=j.togovoiceover),_nex.assets.soundManager.playVoiceover(n)}_nex.kviReader&&(k.attr("tabindex","1"),_nex.kviReader.complete())}},b.stop=function(){b.stopTimer()},b._getTenderMessage=function(a){var b=null;try{for(var c=_nex.assets.phaseManager.findPhaseClips(_nex.assets.phaseManager.phaseType.COMPLETE),d=0;d<c.length&&null===b;d++)if(c[d].hasOwnProperty("TENDER"))for(var e=0;e<c[d].TENDER.length&&null===b;e++)c[d].TENDER[e].id===a&&(b=c[d].TENDER[e])}catch(f){console.log(f)}return b},b.gotoSplash=function(){b.debug("Leaving complete phase... Going to splash. Should stop the timer."),b.timer.stop(),_nex.communication.send(new _nex.commands.OrderUsage),_nex.utility.buttonTracking.reset(),_nex.kvi.active&&_nex.navBar&&_nex.navBar.jackedIn||(_nex.assets.soundManager.cancelVoiceover(),_nex.ordering.resetOrder(function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.SPLASH,function(){b.timer=null})}))},b._trackCompleteClick=function(a){var b="",c="Complete order",d="complete",e="";_nex.utility.buttonTracking.track(b,a.text(),e,c,d)},b._completeClicked=function(a){_nex.assets.soundManager.playButtonHit(),b._trackCompleteClick(a),_nex.complete.gotoSplash()}}function GreenReceipt(a){var b=this;b.timer=null;a||console.log("ERROR: GreenReceipt requires parameters"),a.theme||console.log("ERROR: GreenReceipt requires parameters theme"),b._theme=a.theme;var c=!1;b.debug=function(){c&&console.debug("GreenReceipt",arguments)},b.startTimer=function(){b.debug("!!!Starting green receipt timer");var a=b._getTimeoutSeconds();b.debug("greenReceipt - setting timeout to "+a),b.timer&&(b.timer.stop(),b.timer=null),b.timer=new TimeoutTimer(this,b.printReceipt,a),b.timer.start()},b.stopTimer=function(){b.timer&&(console.log("!!!Stopping green receipt timer"),b.timer.stop(),b.timer=null)},b.start=function(){if(console.debug("GreenReceipt: Start green receipt phase"),_nex.manager.sendStatusUpdate(_nex.manager.statusType.COMPLETING),b.startTimer(),b._greenReceiptEnabled()){if(b._bindOptions(),_nex.assets.theme.system.RECEIPT.hasOwnProperty("receiptshowsendemailoption")&&"true"!==_nex.assets.theme.system.RECEIPT.receiptshowsendemailoption.toLowerCase()&&(document.getElementById("button1").style.display="none"),_nex.assets.theme.system.RECEIPT.hasOwnProperty("receiptshowsendsmsoption")&&"true"!==_nex.assets.theme.system.RECEIPT.receiptshowsendsmsoption){var a=document.getElementById("button3");a.length>0&&(a.style.display="none")}}else b._gotoComplete()},b.stop=function(){b.stopTimer()},b.printReceipt=function(){_nex.orderManager.currentOrder.receiptFormat=_nex.orderManager.receiptFormatType.PAPER,b._gotoComplete()},b.emailReceipt=function(){b._hideReceiptChoices(),b._popupEmail()},b.noReceipt=function(){_nex.orderManager.currentOrder.receiptFormat=_nex.orderManager.receiptFormatType.NONE,b._gotoComplete()},b.smsReceipt=function(){b._hideReceiptChoices(),b._popupPhone()},b._popupEmail=function(){var a="emailPopup",b=$.extend(!0,{},_nex.assets.popupManager[a]);b.buttons[0].clickEvent="_nex.greenReceipt.saveEmail()",b.buttons[1].clickEvent="_nex.greenReceipt.cancelEmail()",_nex.assets.popupManager.showPopup(b),_nex.keyboard.keypad.bindKeys(),_nex.keyboard.keypad.updateText(_nex.orderManager.currentOrder.customer.email),_nex.keyboard.keypad.setKVI()},b.saveEmail=function(){_nex.orderManager.currentOrder.receiptFormat=_nex.orderManager.receiptFormatType.EMAIL,_nex.orderManager.currentOrder.customer.email=_nex.keyboard.keypad.data,b._gotoComplete()},b.cancelEmail=function(){b._showReceiptChoices()},b._greenReceiptEnabled=function(){var a=!1,c=b._theme,d=c.system;if(d&&d.RECEIPT&&d.RECEIPT.greenreceipt){b.debug("green receipt element is present.");var e=d.RECEIPT.greenreceipt;"true"===e.toLowerCase()?(b.debug("green receipt element is present and enabled."),a=!0):console.debug("Green receipt element is present and set to "+d.RECEIPT.greenreceipt)}return a},b._gotoComplete=function(){b.stop(),b.debug("Changing phase to complete."),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.COMPLETE,function(){_nex.complete.start()})},b._trackReceiptClick=function(a){var b="",c="",d="Receipt",e="green";_nex.utility.buttonTracking.track(b,a,c,d,e)},b._noReceiptClicked=function(a){b._trackReceiptClick("No Receipt"),b.noReceipt()},b._emailReceiptClicked=function(a){b._trackReceiptClick("Email Receipt"),b.emailReceipt()},b._printReceiptClicked=function(a){b._trackReceiptClick("Paper Receipt"),b.printReceipt()},b._smsReceiptClicked=function(a){b._trackReceiptClick("SMS Receipt"),b.smsReceipt()},b._getTimeoutSeconds=function(){var a=11;if(b._theme&&b._theme.system&&b._theme.system.RECEIPT&&b._theme.system.RECEIPT.greenreceipttimeout){var c=parseInt(b._theme.system.RECEIPT.greenreceipttimeout);isNaN(c)||(a=c)}return a},b._bindOptions=function(){b._updateReceiptText(),b.startTimer(),$("#button0").unbind("click"),$("#button0").click(function(){b.stopTimer(),b._printReceiptClicked($("#button0"))}),$("#button1").unbind("click"),$("#button1").click(function(){b.stopTimer(),b._emailReceiptClicked($("#button1"))}),$("#button2").unbind("click"),$("#button2").click(function(){b.stopTimer(),b._noReceiptClicked($("#button2"))}),$("#button3").unbind("click"),$("#button3").click(function(){b.stopTimer(),b._smsReceiptClicked($("#button3"))}),b.HasPrinterErrorByPassed?$("#button0").hide():$("#button0").show()},b._hideReceiptChoices=function(){var a=$("#clip-choices");a.hide()},b._showReceiptChoices=function(){var a=$("#clip-choices");a.show()},b._updateReceiptText=function(){var a=b._theme.kioskText;if(a){var c=a.RECEIPTTEXT;if(c){var d=c.greenreceiptheader?c.greenreceiptheader:"Consider the Environment",e=c.greenreceiptno?c.greenreceiptno:"No Receipt",f=c.greenreceiptemail?c.greenreceiptemail:"Email Receipt",g=c.greenreceiptsms?c.greenreceiptsms:"Text Receipt",h=c.greenreceiptpaper?c.greenreceiptpaper:"Paper Receipt";$("#receiptText").html(d),$("#button2").html(e),$("#button1").html(f),$("#button0").html(h),$("#button3").html(g)}}},b._popupPhone=function(){var a="phonepadPopup",c=$.extend(!0,{},_nex.assets.popupManager[a]);c.message=_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","instructions2","Please Enter Phone Number"),c.buttons[1].clickEvent="_nex.greenReceipt.cancelEmail()",c.buttons[1].text=_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","popupclear","CANCEL"),_nex.assets.popupManager.showPopup(c);var d=function(){_nex.orderManager.currentOrder.receiptFormat=_nex.orderManager.receiptFormatType.SMS,_nex.orderManager.currentOrder.smsNumber=_nex.keyboard.phonepad.data,_nex.assets.popupManager.hidePopup(c,function(){b._gotoComplete()})};_nex.keyboard.phonepad.bindKeys(d)}}function OrderingUX(a){function b(a){return!isNaN(a)}var c=this;Ordering.call(c,a),c.currentPopover=null,c.isOrderReview=!1,c._nudgeTimer=null,c.start=function(a){if(c.startMenu=1,$("#ordering #controlbuttons").hide(),_nex.manager.sendStatusUpdate(_nex.manager.statusType.ORDERING),c.addToOrderResponseListener&&_nex.communication.removeListener(c.addToOrderResponseListener),c.addToOrderResponseListener=_nex.communication.createListener("ADDTOORDERRESPONSE",c.commandReceived),_nex.communication.addListener(c.addToOrderResponseListener),c.removeFromOrderResponseListener&&_nex.communication.removeListener(c.removeFromOrderResponseListener),c.removeFromOrderResponseListener=_nex.communication.createListener("REMOVEFROMORDERRESPONSE",c.commandReceived),_nex.communication.addListener(c.removeFromOrderResponseListener),c.order=c.orderManager.currentOrder,c.menus=$.extend(!0,[],c.theme.menus),a){var b=c.findMenuByTag(a);c.loadMenu(b)}else c.loadMenu();c.updateControlButtons(),$("#ordering #controlbuttons").show()},c.stop=function(){null!==c.addToOrderResponseListener&&_nex.communication.removeListener(c.addToOrderResponseListener),null!==c.removeFromOrderResponseListener&&_nex.communication.removeListener(c.removeFromOrderResponseListener)},c.commandReceived=function(a,b){if("ADDTOORDERRESPONSE"===a||"REMOVEFROMORDERRESPONSE"===a){if(c.pending=!1,"true"===b.responseReceived){if(c.order.update(b.ORDER),"REMOVEFROMORDERRESPONSE"===a)for(var d=0;d<c.posidsRemoved.length;d++)c.menustack[c.menustack.length-1].removePosid(c.posidsRemoved[d]);c.orderUpdated&&c.orderUpdated(),c.updateReceipt()}}else console.log("ordering.commandReceived - Unexpected command: "+a)},c.trackClick=function(a,d){var e="";if(a){var f=a.split("-");f.length>=3&&(e=Number(f[2]),b(e)?e+=1:e="")}else console.debug("Unable to get info for button "+a);var g=c.currentMenuId,h=c.currentMenu.title,i="menu";_nex.utility.buttonTracking.track(e,d,g,h,i)},c.getPrice=function(){return""},c.addToOrder=function(a,b,d,e,f,g){if(!c.pending){c.pending=!0;var h=_nex.assets.templateManager.templatePricedBy(c.currentMenu.template),i=c.getButtonInfo(d),j=_nex.assets.templateManager.getPriceOverride(c.currentMenu.template,a);_nex.communication.send(new _nex.commands.AddToOrder(a,b,"1",c.currentMenuId,c.menustack.length-1,c.currentMenu.upsell,h,i,g,j),function(b){c.pending=!1,"true"===b.responseReceived&&("true"!==b.added?c.menustack[c.menustack.length-1].removePosid(a):c.menustack[c.menustack.length-1].posids.push(a),void 0!==c.orderUpdated&&c.orderUpdated(),void 0!==e&&c.loadMenu(e)),void 0!==f&&f(b)},"ADDTOORDERRESPONSE")}},c.gotoPreviousOrders=function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.PREVIOUS_ORDERS,function(){_nex.previousOrders.start()})},c.gotoPayment=function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.PAYMENT,function(){_nex.payment.start()})},c.popupPager=function(){c.hidePopupName(),c.hidePopupPager();var a=!1,b=3,d=-1,e=-1;if(null!==_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER&&void 0!==_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER&&(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("enabled")&&(a="true"===_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.enabled.toLowerCase()),_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("maxlength")&&$.isNumeric(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.maxlength)&&(b=Number(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.maxlength)),_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("minvalue")&&$.isNumeric(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.minvalue)&&(d=Number(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.minvalue)),_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("maxvalue")&&$.isNumeric(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.maxvalue)&&(e=Number(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.maxvalue)),d===e&&(d=-1,e=-1),a=c.pagerEnabledByOrderType(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER,_nex.orderManager.currentOrder.ordertype)),a){var f="PagerPopup",g=$.extend(!0,{},_nex.assets.popupManager[f]),h="Please enter your pager number";d>=0&&e>=0&&d!==e&&(h="Please enter a number between "+d.toString()+" and "+e.toString()+"."),g.message=_nex.assets.theme.getTextAttribute("POSTORDERING","pager",h),_nex.ordering.pagerYesClicked=!1,_nex.ordering.pagerNoClicked=!1,g.buttons[0].clickEvent="_nex.ordering.pagerYesClicked = true;",g.buttons[1].clickEvent="_nex.ordering.pagerNoClicked = true;",_nex.keyboard.pagerpad.setMaxLength(b),_nex.keyboard.pagerpad.setMinValue(d),_nex.keyboard.pagerpad.setMaxValue(e),_nex.keyboard.pagerpad.setPopup(g),g.onShowCallback=_nex.keyboard.pagerpad.bindKeys,c.isPagerNumberDisabled()?_nex.ordering.popupName():_nex.assets.popupManager.showPopup(g,function(){_nex.ordering.pagerYesClicked&&_nex.ordering.popupName()})}else _nex.ordering.gotoPayment()},c.pagerEnabledByOrderType=function(a,b){if(null!==_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER&&void 0!==_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER&&_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("enabled")&&"true"===_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.enabled.toLowerCase()){if("delivery"===b&&a.hasOwnProperty("enableddelivery"))return"true"===a.enableddelivery;if("dinein"===b&&a.hasOwnProperty("enableddinein"))return"true"===a.enableddinein;if("drivethru"===b&&a.hasOwnProperty("enableddrivethru"))return"true"===a.enableddrivethru;if("takeout"===b&&a.hasOwnProperty("enabledfortakeout"))return"true"===a.enabledfortakeout}return!1},c.popupName=function(){var a=c.isPagerSplit();_nex.keyboard.namepad.data="",console.debug("Pager name split "+a);var b=1,d=50;if(null!==_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER&&void 0!==_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER&&(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("minguestlength")&&$.isNumeric(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.minguestlength)&&(b=Number(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.minguestlength)),_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("maxguestlength")&&$.isNumeric(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.maxguestlength)&&(d=Number(_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.maxguestlength)),b===d&&(b=1,d=50)),console.debug("Pager name split "+a),a&&!c.isPagerNameDisabled()){var e="NamePopup",f=$.extend(!0,{},_nex.assets.popupManager[e]);f.message=_nex.assets.theme.getTextAttribute("POSTORDERING","name","Please enter your name"),_nex.ordering.nameYesClicked=!1,_nex.ordering.nameNoClicked=!1,f.buttons[0].clickEvent="_nex.ordering.nameYesClicked = true;",f.buttons[1].clickEvent="_nex.ordering.nameNoClicked = true;",_nex.keyboard.namepad.setMinLength(b),_nex.keyboard.namepad.setMaxLength(d),_nex.keyboard.namepad.setPopup(f),f.onShowCallback=_nex.keyboard.namepad.bindKeys,_nex.assets.popupManager.showPopup(f,function(){_nex.ordering.nameYesClicked?_nex.ordering.gotoPayment():_nex.ordering.nameNoClicked&&(_nex.keyboard.namepad.data="")})}else _nex.ordering.gotoPayment()},c.isPagerEnabled=function(){return null!==_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER&&void 0!==_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER&&_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("enabled")?"true"===_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.enabled.toLowerCase():!1},c.isPagerSplit=function(){return c.isPagerEnabled()&&_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("splitpager")?"true"===_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.splitpager.toLowerCase():!1},c.isPagerNameDisabled=function(){return c.isPagerEnabled()&&_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("disablenamepager")?"true"===_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.disablenamepager.toLowerCase():!1},c.isPagerNumberDisabled=function(){return c.isPagerEnabled()&&_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.hasOwnProperty("disablenumberpager")?"true"===_nex.manager.theme.kiosk.PAYMENTPROFILE.PAGER.disablenumberpager.toLowerCase():!1},c.hidePopupName=function(a){var b="NamePopup",c=$.extend(!0,{},_nex.assets.popupManager[b]);_nex.assets.popupManager.hidePopup(c,a)},c.hidePopupPager=function(){var a="PagerPopup",b=$.extend(!0,{},_nex.assets.popupManager[a]);_nex.assets.popupManager.hidePopup(b)},c._trackControlClick=function(a,b){var d="",e=a.text(),f=c.currentMenuId,g=b,h="control";_nex.utility.buttonTracking.track(d,e,f,g,h),c.resetNudge()},c._addItemClicked=function(a){c._trackControlClick(a,"Add Item"),_nex.assets.soundManager.playButtonHit(),_nex.ordering.addItem()},c._backButtonClicked=function(a){c._trackControlClick(a,"Back"),_nex.assets.soundManager.playButtonHit(),_nex.ordering.goBack()},c._cancelButtonClicked=function(a){c._trackControlClick(a,"Cancel"),_nex.assets.soundManager.playButtonHit(),_nex.ordering.cancelOrderPrompt()},c._continueButtonClicked=function(a){c._trackControlClick(a,"Continue"),_nex.assets.soundManager.playButtonHit(),c.stopNudge(),_nex.ordering.gotoNextMenu()},c._reviewButtonClicked=function(a){c._trackControlClick(a,"Review"),_nex.assets.soundManager.playButtonHit(),_nex.ordering.gotoOrderReview()},c._doneButtonClicked=function(a){c._trackControlClick(a,"Done"),_nex.assets.soundManager.playButtonHit(),_nex.keyboard.pagerpad.data="",_nex.keyboard.namepad.data="",_nex.ordering.gotoPayment()},c._setOrderType=function(a,b,c,d){a?_nex.orderManager.currentOrder.togo?_nex.orderManager.currentOrder.ordertype="takeout":_nex.orderManager.currentOrder.ordertype="dinein":(_nex.orderManager.togo=b?!0:c,b?_nex.orderManager.currentOrder.ordertype="drivethru":c?_nex.orderManager.currentOrder.ordertype="takeout":d&&(_nex.orderManager.currentOrder.ordertype="dinein")),console.log("Togo is now "+_nex.orderManager.currentOrder.togo+" and order type is "+_nex.orderManager.currentOrder.ordertype)},c._dineInOrCarryOut=function(a){_nex.orderManager.currentOrder.togoSet=!1,_nex.orderManager.currentOrder.ordertypeSet=!1,_nex.orderManager.currentOrder.togo=!1;var b=null,d=!1,e=!1,f=!1,g=null;_nex.assets.theme.kiosk.PAYMENTPROFILE.hasOwnProperty("ORDERTYPE")&&(b=_nex.assets.theme.kiosk.PAYMENTPROFILE.ORDERTYPE,b.constructor===Array&&(b=b[0])),b&&(b.hasOwnProperty("takeoutflag")&&(d="true"===b.takeoutflag.toLowerCase()),b.hasOwnProperty("dineinflag")&&(e="true"===b.dineinflag.toLowerCase()),b.hasOwnProperty("drivethruflag")&&(f="true"==b.drivethruflag.toString().toLowerCase())),d&&e||_nex.orderManager._forceDicoPrompt?(g=$.extend(!0,{},_nex.assets.popupManager.dicoPopup),g.message=_nex.assets.theme.getTextAttribute("ORDERREVIEW","dicomessage",""),g.buttons[0].clickEvent="_nex.orderManager.currentOrder.togo = false;",g.buttons[1].clickEvent="_nex.orderManager.currentOrder.togo = true;",_nex.assets.popupManager.showPopup(g,function(){_nex.orderManager.currentOrder.togoSet=!0,c._setOrderType(!0,f,d,e),a()})):(c._setOrderType(!1,f,d,e),a())},c._popoverHitTest=function(a){if(null!==c.currentPopover){var b=c.currentPopover.hitTestPoint({x:a.pageX,y:a.pageY,transparency:!0});c.currentPopover.data("keepshowing",b?"true":"false")}},c.updateControlButtons=function(){c.currentMenu.hasOwnProperty("startmenu")&&"true"===c.currentMenu.startmenu.toString().toLowerCase()&&(c.startMenu=c.currentMenuId);var a=_nex.assets.templateManager.findTemplate(c.currentMenu.template),b=!1,d=$("#ctrl-add-item");if(d.length>0)if(null!==a&&void 0!==a.additembutton&&"true"===a.additembutton.toString().toLowerCase()){b=!0,d.removeClass("control-button-hidden");var e=_nex.assets.theme.getTextAttribute("ORDERREVIEW","addanother","");0===e.length&&(e=c.theme.getTextAttribute("ORDER","addanother","ADD ITEM")),c.theme.setControlButtonText("ctrl-add-item",e),d.attr("onclick",""),d.unbind("click"),d.click(function(){c._addItemClicked(d)})}else d.addClass("control-button-hidden");var f=$("#ctrl-back");if(f.length>0){var g=c.startMenu!==c.currentMenuId||c.menuScrollIndex>0&&"moreforward"===_nex.ordering.pagination;g&&!b?(f.removeClass("control-button-hidden"),c.theme.setControlButtonText("ctrl-back",c.theme.getTextAttribute("ORDER","back","BACK")),f.attr("onclick",""),f.unbind("click"),f.click(function(){c._backButtonClicked(f)})):f.addClass("control-button-hidden")}var h=$("#ctrl-cancel");h.length>0&&(c.theme.setControlButtonText("ctrl-cancel",c.theme.getTextAttribute("ORDER","cancel","CANCEL")),
h.removeClass("control-button-hidden"),h.attr("onclick",""),h.unbind("click"),h.click(function(){c._cancelButtonClicked(h)}));var i=$("#ctrl-continue");if(i.length>0){var j=!1;if(null!==a&&void 0!==a.continuemenu&&"true"===a.continuemenu.toString().toLowerCase()){c.currentMenu.continuemenu.toString().length>0?c.currentMenu.continuemenu:c.startMenu;_nex.assets.templateManager.isContinueVisible(c.currentMenu)&&c.startMenu!==c.currentMenuId&&(j=!0)}j?(i.removeClass("control-button-hidden"),"true"===c.currentMenu.upsell.toLowerCase()&&0===c.menustack[c.menustack.length-1].posids.length?c.theme.setControlButtonText("ctrl-continue",c.theme.getTextAttribute("ORDER","nothanksbutton","NO, THANKS")):c.theme.setControlButtonText("ctrl-continue",c.theme.getTextAttribute("ORDER","continuebutton","CONTINUE")),i.attr("onclick",""),i.unbind("click"),i.click(function(){c._continueButtonClicked(i)}),c.startNudge()):(i.addClass("control-button-hidden"),c.stopNudge())}var k=$("#ctrl-orderreview");if(k.length>0){var l=c.startMenu===c.currentMenuId&&void 0!==c.order.ITEM&&c.order.ITEM.length>0;c.theme.setControlButtonText("ctrl-orderreview",c.theme.getTextAttribute("ORDER","orderreview","DONE")),l?(k.removeClass("control-button-hidden"),k.attr("onclick",""),k.unbind("click"),k.click(function(){c._reviewButtonClicked(k)})):k.addClass("control-button-hidden")}var m=$("#ctrl-done");if(m.length>0){var n=!1;null!==a&&void 0!==a.donebutton&&"true"===a.donebutton.toString().toLowerCase()&&(n=!0),n?(m.removeClass("control-button-hidden"),c.theme.setControlButtonText("ctrl-done",c.theme.getTextAttribute("ORDER","done","DONE")),m.attr("onclick",""),m.unbind("click"),m.click(function(){c._doneButtonClicked(m)})):m.addClass("control-button-hidden")}},c.removePreviousMenu=function(){if(c.menustack.length>0){for(var a=c.menustack.pop();a.skipped;)a=c.menustack.pop();var b=c.menus[a.menuId-1],d=_nex.assets.templateManager.findTemplate(b.template);if("SELECTONEMODIFIER"===d.defaultbuttontype){if(void 0!==c.order.ITEM){var e=c.order.ITEM.length-1;c.removeMods(b.id,e)}}else if("SELECTONE"===d.defaultbuttontype&&void 0!==a&&a.posids.length>0)for(var f=0;f<a.posids.length;f++)c.removeFromOrder(a.posids[f]);c.loadMenu(b.id),c.menuScrollIndex=a.scrollIndex,c._showPage()}else c.currentMenuId!==c.startMenu?c.loadMenu(c.startMenu):_nex.manager.cancelCurrentPhase()},c.removeMultipleFromOrder=function(a,b){a.length>0?(c.posidsRemoved=a,_nex.communication.send(new _nex.commands.RemoveFromOrder(a)),b&&b()):void 0!==b&&b()},c.cancelOrderPromptCallback=function(){_nex.manager.cancelCurrentPhase()},c.sendUpdateQuantity=function(a,b,d,e,f){_nex.communication.send(new _nex.commands.UpdateQuantity(a,b,d,e),function(a){"true"===a.responseReceived&&(c.order.update(a.ORDER),void 0!==c.orderUpdated&&c.orderUpdated(),c.updateReceipt()),void 0!==f&&f(a),c.pending=!1},"UPDATEQUANTITYRESPONSE")},c.resetOrder=function(a){c.pending=!0,c.stopNudge(),c.orderManager.currentOrder&&c.orderManager.currentOrder.hasOwnProperty("ordernumber")&&0===c.orderManager.currentOrder.ordernumber.length?_nex.communication.send(new _nex.commands.CancelOrder,function(b){b&&"true"===b.responseReceived,c.updateReceipt(),c.orderManager.resetCurrentOrder(),c.pending=!1,void 0!==a&&(b?a(b):a())},"CANCELORDERRESPONSE"):(c.orderManager.resetCurrentOrder(),c.pending=!1,void 0!==a&&a())},c.startNudge=function(){if(!_nex.kviReader||!_nex.kviReader.jackedIn()){null!==c._nudgeTimer&&(c._nudgeTimer.stop(),c._nudgeTimer=null);var a=7;_nex.assets.theme.system.USERINTERFACE.hasOwnProperty("nudgetimeout")&&(a=Number(_nex.assets.theme.system.USERINTERFACE.nudgetimeout.toString())),c._nudgeTimer=new SimpleTimer(c,c.onNudge,a),c._nudgeTimer.start()}},c.stopNudge=function(){$("#ctrl-continue").removeClass("nudge"),null!==c._nudgeTimer&&c._nudgeTimer.stop(),c._nudgeTimer=null},c.resetNudge=function(){null!==c._nudgeTimer&&c._nudgeTimer.restart()},c.onNudge=function(a){try{_nex.assets.soundManager.playSoundByIndex(11),$("#ctrl-continue").removeClass("nudge"),setTimeout(function(){$("#ctrl-continue").addClass("nudge")},10)}catch(b){}},c.loadAd=function(a,b){if(void 0!==a&&null!==a&&"empty.swf"!==a.toLowerCase()){$("#template").append("<div id='ad' ></div>");var c=$("#template").find("#ad");c.attr("style","background-image: url('"+_nex.assets.theme.mediaPath()+"banners/"+itemFormatting.buttonImage(a)+"');");var d="ad";void 0!==b&&(d+=" "+b.replace(/ /g,"-")+"-ad"),c.attr("class",d),$("#template").append(c)}}}function Payment(a){var b=this;b._theme=a.theme,b._theme||console.log("ERROR: theme not passed into the payment phase."),b._paymentManager=null,b.lastSelectedTender="",b.autocharge=!0,b.deviceData=null,b.promptForLoyalty=function(){return 1==_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard},b.promptForLoyalty2=function(){return 2==_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard},b._enableDebugging=!0,b._debug=function(){b._enableDebugging&&console.debug("PaymentPhase",arguments)},b.reset=function(a){void 0!==a&&null!==a||(a=!0),b.deviceData=null,b.autocharge=!0,_nex.utility.orderTimer.restart(),a&&b._route()},b.start=function(){b._debug("start"),_nex.assets.popupManager.hideAllPopups(function(){$("#targets").removeClass(),b._paymentManager||(b._paymentManager=new PaymentManager),b._paymentManager.reset(),_nex.manager.sendStatusUpdate(_nex.manager.statusType.PAYMENT),"true"===_nex.manager.theme.paymentProfile.roundupcharityenabled?(_nex.orderManager.currentOrder.roundUpCharitySelected=!0,_nex.communication.send(new _nex.commands.CalculateTotal(_nex.orderManager.currentOrder),function(a){console.log(a),a.hasOwnProperty("subtotal")&&-1!==Number(a.subtotal)?(_nex.orderManager.currentOrder.update(a,!1),_nex.orderManager.currentOrder.totals.roundupcharity(a.roundupcharity),b._popupRoundUpCharity()):b._sendCalculateTotal()},"ORDERTOTAL")):b._sendCalculateTotal()})},b.stop=function(){_nex.utility.orderTimer&&_nex.utility.orderTimer.stop()},b.showLoyaltyPrompt=function(){var a=$.extend(!0,{},_nex.assets.popupManager.yesNoPopup);a.message=_nex.assets.theme.getTextAttribute("PAYMENT","loyaltyprompt","Do you have a Loyalty Card?"),a.buttons[0].clickEvent="console.debug('yes clicked');_nex.payment._gotoLoyaltyPrompt()",a.buttons[1].clickEvent="console.debug('no clicked');_nex.payment._route(_nex.splashPhase.userSwipedToStart, true);",_nex.assets.popupManager.showPopup(a)},b._route=function(a,c){if(a)return void b.swipedToStart();var d=b._getAvailableTenders(),e=d.length,f=_nex.assets.theme.getTenderByType("loyalty"),g=""!==_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard&&void 0!==_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard,h=_nex.manager.theme.kiosk.PAYMENTPROFILE.TENDER.loyaltyflag||_nex.manager.theme.kiosk.PAYMENTPROFILE.TENDER.loyalty2flag;!c&&f&&g&&h?b.showLoyaltyPrompt():void 0!==e&&null!==e?0===e?b._zeroPaymentOptions():1===e?b._onePaymentOption(d[0]):b._multiplePaymentOptions():b._zeroPaymentOptions()},b.swipedToStart=function(){var a=_nex.splashPhase.swipeToStartAction.getTenderAdded();if(a)b._debug("swipedToStart","Automatically charging the credit card that was swiped to start"),b.autocharge&&(b._debug("Process Order with tender: ",a),b.processOrder(a));else{b._debug("swipedToStart","Automatically doing a loyalty inquiry. If preauthandpay is true, it will charge the card; otherwise, check first then charge the card if there are enough funds."),b.deviceData=_nex.splashPhase.swipeToStartAction.cardData;var c=_nex.splashPhase.swipeToStartAction.getPinData();b.autocharge&&b.loyaltyInquiry(c)}},b.usesPaymentDevice=function(){var a=!1;if(_nex.assets.theme.lastUpdate){var b=_nex.assets.theme.lastUpdate;b.usepaymentdevice&&b.usepaymentdevice.length>0&&(a="true"===_nex.assets.theme.lastUpdate.usepaymentdevice.toLowerCase())}return a},b.loyaltyRequiresPaymentDevice=function(){var a=!1;if(_nex.assets.theme.lastUpdate){var b=_nex.assets.theme.lastUpdate;b.loyaltyrequirespaymentdevice&&b.loyaltyrequirespaymentdevice.length>0&&(a="true"===_nex.assets.theme.lastUpdate.loyaltyrequirespaymentdevice.toLowerCase())}return a},b.backButton=function(){b.lastSelectedTender.length>0&&b._removeSelectedTender();var a=b._paymentManager.previousClip();a||b._gotoOrderReview()},b.orderProcessed=function(a){b._debug("enter orderProcessed with result ",a),b.hideProcessingPopup(function(){"success"===a.orderstatus.toLowerCase()?(b._debug("result is success "),_nex.ordering.order.ordernumber=a.ordernumber,_nex.ordering.order.orderid=a.orderid,void 0!==a.TENDERRESULT&&(_nex.ordering.order.tenderResults=a.TENDERRESULT),null!==_nex.orderManager.currentOrder.customer.email&&""!==_nex.orderManager.currentOrder.customer.email||null!==_nex.orderManager.currentOrder.customer.guestaccountid&&""!==_nex.orderManager.currentOrder.customer.guestaccountid||null===a.email||""===a.email||(_nex.orderManager.currentOrder.customer.email=a.email,_nex.orderManager.currentOrder.customer.guestaccountid=a.guestaccountid),b.gotoPostOrdering()):(b._debug("result is error "),_nex.communication.send(new _nex.commands.RemoveTender),_nex.payment.showErrorPopup(b.textProcessingError(),function(){b._gotoOrderReview()}))})},b.showTestPayment=function(a){a=a||!1;var b=$("#payment");if(a&&b.length>0){var c=b.find("#testpayment");0===c.length&&b.append('<div id="testpayment" class="test-payment" >test payment</div>')}},b._trackPaymentClick=function(a){var b="",c=a.text(),d="",e="Payment",f="control";_nex.utility.buttonTracking.track(b,c,d,e,f)},b._cancelButtonClicked=function(a){_nex.assets.soundManager.playButtonHit(),b._trackPaymentClick(a),_nex.ordering.cancelOrderPrompt()},b._backButtonClicked=function(a){_nex.assets.soundManager.playButtonHit(),b._trackPaymentClick(a),_nex.payment.backButton()},b._updateControlButtons=function(){var a=$("#ctrl-cancel");a.length>0&&(b._theme.setControlButtonText("ctrl-cancel",b._theme.getTextAttribute("ORDER","cancel","CANCEL")),a.removeClass("control-button-hidden"),a.attr("onclick",""),a.unbind("click"),a.click(function(){b._cancelButtonClicked(a)}),a.attr("tabindex","-1"));var c=$("#ctrl-back");c.length>0&&(b._theme.setControlButtonText("ctrl-back",b._theme.getTextAttribute("ORDER","back","BACK")),c.removeClass("control-button-hidden"),c.attr("onclick",""),c.unbind("click"),c.click(function(){b._backButtonClicked(c)}),c.attr("tabindex","3"));var d=$("#ctrl-skip");d.length>0&&d.addClass("control-button-hidden")},b._hideBackButton=function(){var a=$("#ctrl-back");a.length>0&&a.addClass("control-button-hidden")},b.gotoPostOrdering=function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.POST_ORDERING,function(){b.showTestPayment(!1),_nex.postOrdering.start()})},b._gotoSelectPayment=function(){b._paymentManager.gotoClip(paymentConstants.SELECTPAYMENT_CLIP),b._paymentManager.updateReceipt()},b._gotoLoyaltyPrompt=function(){b._paymentManager.gotoClip(paymentConstants.LOYALTYPROMPT_CLIP),b._paymentManager.updateReceipt()},b._gotoOrderReview=function(){b.reset(!1),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){b.showTestPayment(!1),_nex.ordering.gotoOrderReview(),$("#ordering #controlbuttons").show()})},b.paymentSelected=function(a){b._debug("payment selected"),inPreviewer()&&!_nex.inAdvancedMode?(b._debug("Going right to complete."),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.COMPLETE,function(){_nex.complete.start()})):(b.createSelectedTender(a),_nex.kviReader&&_nex.kviReader.payment())},b._popupRoundUpCharity=function(){var a,b=_nex.assets.theme.getTextAttribute("PAYMENT","roundupcharityprompt","Would you like to Round-Up for Charity?");null!==_nex.assets.popupManager.charityYesNoPopup?(a=$.extend(!0,{},_nex.assets.popupManager.charityYesNoPopup),a.roundUpYesAmount=currency.formatAsDollars(Number(_nex.orderManager.currentOrder.totals.amountdue()),!0),a.roundUpNoAmount=currency.formatAsDollars(Number(parseFloat(_nex.orderManager.currentOrder.totals.amountdue())-parseFloat(_nex.orderManager.currentOrder.totals.roundupcharity())),!0)):a=$.extend(!0,{},_nex.assets.popupManager.yesNoPopup),a.message=b,a.buttons[0].clickEvent="console.debug('round up charity yes clicked');_nex.payment._roundupcharity(true);",a.buttons[1].clickEvent="console.debug('round up charity no clicked');_nex.payment._roundupcharity(false);",_nex.assets.popupManager.showPopup(a)},b._roundupcharity=function(a){_nex.orderManager.currentOrder.roundUpCharitySelected=a,a||_nex.orderManager.currentOrder.totals.roundupcharity(0),b._sendCalculateTotal()},b._sendCalculateTotal=function(){b.showProcessingPopup(b.textProcessingOrder()),_nex.communication.send(new _nex.commands.CalculateTotal(_nex.orderManager.currentOrder),function(a){console.log(a),b.hideProcessingPopup(function(){if(a.hasOwnProperty("subtotal")&&-1!==Number(a.subtotal)){_nex.orderManager.currentOrder.update(a,!1),b.showTestPayment(_nex.assets.theme.testMode);var c=_nex.splashPhase.userSwipedToStart;b._route(c)}else b.showErrorPopup(b.textCalculateTotalError(),function(){_nex.payment.backButton()})})},"ORDERTOTAL")},b.showErrorPopup=function(a,c){b._debug("hiding all popups and showing error popup"),_nex.assets.popupManager.hideAllPopups(function(){var b=$.extend(!0,{},_nex.assets.popupManager.errorPopup);b.message=a,_nex.assets.popupManager.showPopup(b,c)})},b._zeroPaymentOptions=function(){b._debug("zero payment option detected - going to order review"),b._gotoOrderReview()},b._onePaymentOption=function(a){b._debug("one payment option detected - skipping payment select screen");var c=a;c?(b._debug("Creating tender for type "+a),b.createSelectedTender(c)):console.log("ERROR IN PAYMENT: Expected the single tender to be set."),b._updateControlButtons()},b._multiplePaymentOptions=function(){b._debug("multiple payment options detected - showing select payment screen"),b._gotoSelectPayment(),b._updateControlButtons()},b.showProcessingPopup=function(a,c){b._debug("showing processing popup");var d=$.extend(!0,{},_nex.assets.popupManager.processingPopup);d.message=a?a:"Processing ...",c&&(d.onShowCallback=c),_nex.assets.popupManager.showPopup(d)},b.hideProcessingPopup=function(a){b._debug("hiding processing popup"),_nex.assets.popupManager.hidePopup(_nex.assets.popupManager.processingPopup,a)},b.showSelectTenderPopup=function(a,c){b._debug("showing select tender popup");var d=$.extend(!0,{},_nex.assets.popupManager.messagePopup);d.message=a?a:"Processing ...",_nex.assets.popupManager.showPopup(d,c)},b.hideSelectTenderPopup=function(a){b._debug("hiding select tender popup"),_nex.assets.popupManager.hidePopup(_nex.assets.popupManager.messagePopup,a)},b.createSelectedTender=function(a){var c;if(a.startsWith("gaincliningbalancetender")){var d=_nex.guestAccount.getGuestAccountLocalByPaymentClipTenderType(a);c=d.genericTenderId}else c=a;b.lastSelectedTender=a,console.log("Sending request to add tender with type "+a);var e=new _nex.commands.AddTender(c);_nex.communication.send(e,b._tenderAdded,"TENDERADDED")},b.processOrder=function(a){b.stop(),b.showProcessingPopup(b.textProcessingPayment(),function(){var c=new _nex.commands.ProcessOrder(_nex.ordering.orderManager.currentOrder,a);_nex.communication.send(c,b.orderProcessed,"ORDERPROCESSED")})},b._removeSelectedTender=function(){var a=new _nex.commands.RemoveTender(b.lastSelectedTender);_nex.communication.send(a,b._tenderRemoved,"TENDERREMOVED")},b._tenderAdded=function(a){if(b._debug("Tender has been added"),b._debug(a),"true"!==a.responseReceived)throw"ERROR: MISSING CLIP FOR TENDER "+b.lastSelectedTender;b._paymentManager.gotoClip(b.lastSelectedTender)},b._tenderRemoved=function(){b._debug("Tender removed callback")},b._getAvailableTenders=function(){var a=[],c=b._theme.tendersAvailable();return c&&(a=c),b._debug("GET AVAILABLE TENDERS:"),b._debug(a),a},b.textSwipe=function(){return b._theme.getTextAttribute("PAYMENT","swipe","Please Swipe Your Credit Card")},b.textSwipeError=function(){return b._theme.getTextAttribute("PAYMENT","swipeerror","There was a problem reading your card, please swipe again")},b.textProcessingPayment=function(){return b._theme.getTextAttribute("PAYMENT","processingpayment","Your Payment Is Being Processed")},b.textProcessingError=function(){return b._theme.getTextAttribute("PAYMENT","processingerror","Sorry.  Payment could not be processed.")},b.textCash=function(){return b._theme.getTextAttribute("PAYMENT","cashtext","CASH")},b.textCredit=function(){return b._theme.getTextAttribute("PAYMENT","credittext","CREDIT")},b.textDebit=function(){return b._theme.getTextAttribute("PAYMENT","debittext","DEBIT")},b.textPaymentType=function(){return b._theme.getTextAttribute("PAYMENT","paymenttype","Select a Payment Type")},b.textProcessingOrder=function(){return b._theme.getTextAttribute("PAYMENT","processingorder","Calculating Total")},b.textCounter=function(){return b._theme.getTextAttribute("PAYMENT","countertext","COUNTER")},b.textCoupon=function(){return b._theme.getTextAttribute("PAYMENT","coupontext","COUPON")},b.textLoyalty=function(){return b._theme.getTextAttribute("PAYMENT","loyaltytext","GUEST EXPRESS")},b.textCalculateTotalError=function(){return b._theme.getTextAttribute("PAYMENT","calculatetotalerror","Error processing order")},b.textPaymentDeviceSwipe=function(){return b._theme.getTextAttribute("PAYMENT","waitforpayment","Swipe Card On The Payment Device")},b.textBalanceMessage=function(){return b._theme.getTextAttribute("PAYMENT","amountauthorized","Balance applied")},b.textCardAppliedMessage=function(){return b._theme.getTextAttribute("PAYMENT","loyaltycardapplied","Loyalty Card Applied")},b.textAuthorizing=function(){return b._theme.getTextAttribute("PAYMENT","preauthmessage","Authorizing...")},b.handlePaymentResponse=function(a){if(b._debug("handlePaymentResponse"),b._debug("Response message: "),b._debug(a),"Failure"===a.paymentstatus){var c=b._theme.getTextAttribute("PAYMENT","processingerror","Sorry, your payment could not be processed.");_nex.payment.showErrorPopup(c,function(){var a=_nex.payment._getAvailableTenders().length;1===a?(b._debug("Going back to the ordering phase ..."),b._gotoOrderReview()):a>1&&(b._debug("Going back to the start of payment, which will bring us to select payment ..."),b.start())})}else _nex.payment.processOrder()},b.handleLoyaltyResponse=function(a,c){if(b._debug("Handling response: "),b._debug(a),a.ORDER&&_nex.orderManager.currentOrder.update(a.ORDER),"ENOUGH_COLLECTED"===a.message)console.log("Payment: Enough has been collected... Going to process order."),b.processOrder();else{var d=a.amount?a.amount:0;if(d>0){var e=_nex.orderManager.currentOrder.totals.remainingbalance(),f=b.textBalanceMessage();f=f.replace("{0}",d),f=f.replace("{1}",e),b._showBalanceMessage(b._route(!1,!0),f)}else{var g=b.textCardAppliedMessage();b._showLoyaltyCardApplied(g,b._route(!1,!0))}b._hideBackButton()}},b.loyaltyInquiry=function(a,c){b._debug("processLoyalty");var d="",e="",f="LOYALTY";c&&(f="LOYALTY2");var g="",h="";if("string"==typeof b.deviceData?d=b.deviceData:"object"==typeof b.deviceData&&(d=b.deviceData.cardNumber),a&&(e=a),b.deviceData.track1&&(g=b.deviceData.track1),b.deviceData.track2&&(h=b.deviceData.track2),g||h){var i=new CardParser(_nex.assets.theme);i.parse(g,h,function(a){a&&"LOYALTY"!=f&&"LOYALTY2"!=f&&(f=a.cardType)}),i.cardData&&(d=i.cardData.cardNumber)}var j=_nex.assets.theme.getTenderByType(f.toLowerCase()),k=_nex.assets.theme.isPreAuthAndPay(j);b._sendLoyaltyInquiry(d,e,f,g,h,k)},b.showEmployeeCardError=function(a){var b=_nex.payment.textProcessingError(),c=$.extend(!0,{},_nex.assets.popupManager.errorPopup);c.message=b,_nex.assets.popupManager.showPopup(c,a)},b.authorizingEnabled=function(){var a=!0;return b.loyaltyRequiresPaymentDevice()&&(a=!1),a},b.showAuthorizingPopup=function(a){var b=_nex.payment.textAuthorizing(a),c=$.extend(!0,{},_nex.assets.popupManager.messagePopup);c.message=b,_nex.assets.popupManager.showPopup(c)},b.hideAuthorizingPopup=function(a){var b=$.extend(!0,{},_nex.assets.popupManager.messagePopup);_nex.assets.popupManager.hidePopup(b,function(){a&&a()})},b._sendLoyaltyInquiry=function(a,c,d,e,f,g){"2"===_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard&&"loyalty"===d&&(d="loyalty2"),b.showAuthorizingPopup();var h=new _nex.commands.LoyaltyInquiry(a,c,d,e,f,g);_nex.communication.send(h,function(a){b._debug("Loyalty inquiry response",a),b.hideAuthorizingPopup(function(){var c=new TenderLoyalty;if(c.update(a),c.LOYALTYRESPONSE.CardType=d.toUpperCase(),c.isValidAccount())if(c.isCharged())b._updateTender(function(){b._processLoyalty(c,c.value)});else if(c.hasMultipleValues())b._multipleOptions();else if(c._noOffersReturnedFromInquiry)if(c.hasBalance()){var e=_nex.assets.theme.getTenderByType(d),f=b._getAmountToCharge(c,e);f>0?b._processLoyalty(c,f):(b._debug("There is $0.00 to be charged. Could be from rounding if usefullamount is turned off."),b._genericError(b.reset))}else if(a.isgiftcard)b._showErrorMessage(b.reset,"No Balance remains on card");else{var g=new _nex.commands.AddTender("loyalty");_nex.communication.send(g,function(a){if(a.added){var d=new _nex.commands.ProcessLoyalty(c,0);_nex.communication.send(d,function(a){b.handleLoyaltyResponse(a,c)},"PROCESSLOYALTYRESPONSE")}},"TENDERADDED"),b._debug("No multiple values and no balance on the card")}else c._offersPopup("",c._availableOffers);else b._debug("Invalid account"),""===a.errormessage?b._genericError(b.reset):b._showErrorMessage(b.reset,a.errormessage)})},"LOYALTYRESPONSE")},b._multipleOptions=function(){_nex.assets.theme.loadMedia("customloyalty.html",null,"customloyalty.js")},b._getAmountToCharge=function(a,b){var c=a.remainingBalance(),d=_nex.assets.theme.useFullAmount(b);return d||(c=Math.floor(c)),c},b._processLoyalty=function(a,c){var d=new _nex.commands.ProcessLoyalty(a,c);_nex.communication.send(d,function(c){b.handleLoyaltyResponse(c,a)},"PROCESSLOYALTYRESPONSE")},b.processEmployeeCard=function(a){var c=a.replace(/[^0-9]/g,""),d=_nex.keyboard.numpad.data,e=new _nex.commands.EmployeeInquiry(c,d);b.showAuthorizingPopup(),_nex.communication.send(e,function(a){b.hideAuthorizingPopup(function(){if(a&&a.status&&"success"===a.status.toLowerCase()){console.debug(a);var c=Number(a.value);if(c>0){var d=new TenderEmployee;d.updateNumber(a.number),d.updatePin(a.pin),d.updateResponse(a),_nex.payment._processTender(d,c)}else b.showEmployeeCardError(_nex.payment.start)}else b.showEmployeeCardError(_nex.payment.start)})},"EMPLOYEERESPONSE")},b._genericError=function(a){var b=_nex.payment.textProcessingError(),c=$.extend(!0,{},_nex.assets.popupManager.errorPopup);c.message=b,_nex.assets.popupManager.showPopup(c,a)},b._showErrorMessage=function(a,b){var c=$.extend(!0,{},_nex.assets.popupManager.errorPopup);c.message=b,_nex.assets.popupManager.showPopup(c,a)},b._showBalanceMessage=function(a,b){var c=$.extend(!0,{},_nex.assets.popupManager.messagePopup);c.message=b,_nex.assets.popupManager.showPopup(c,a)},b._showLoyaltyCardApplied=function(a,b){var c=$.extend(!0,{},_nex.assets.popupManager.messagePopup);c.message=a,_nex.assets.popupManager.showPopup(c,b)},b._updateTender=function(a){var b=new _nex.commands.UpdateTender(!0);_nex.communication.send(b,function(b){_nex.orderManager.currentOrder.update(b.ORDER),a&&a()},"UPDATETENDERRESPONSE")},b.genericInquiry=function(a,c,d,e){b._debug("genericInquiry");var f="";if(void 0===e)if("string"==typeof b.deviceData)e=b.deviceData;else if("object"==typeof b.deviceData&&null!==b.deviceData)if(b.deviceData.cardNumber)e=b.deviceData.cardNumber;else{var g="",h="";if(b.deviceData.track1&&(g=b.deviceData.track1),b.deviceData.track2&&(h=b.deviceData.track2),g||h){var i=new CardParser(_nex.assets.theme);i.parse(g,h,function(a){a&&(cardtype=a.cardType,e=a.cardNumber)})}}a&&(f=a),b._sendGenericInquiry(e,f,d,c)},b._sendGenericInquiry=function(a,c,d,e){var f=new _nex.commands.GenericInquiry(a,c,d,e);b.showTenderProcessingMessage(),_nex.communication.send(f,function(e){b._debug("generic inquiry response",e),b.hideProcessingPopup(function(){var f=new TenderGeneric(d,a,c);f.update(e);var g=f._tenderType;if(f.isValidAccount()){var h=b._theme.getTextAttribute("PAYMENT","nobalance"+g,"No available balance. Select a different method of payment.");if(f.hasBalance()){var i=_nex.assets.theme.getGenericTenderByType(f._tenderType),j=b._getAmountToCharge(f,i);j>0?b._processTender(f,j,e.discountid):(b._debug("There is $0.00 to be charged. Could be from rounding if usefullamount is turned off."),b._showErrorMessage(b.reset,h))}else b._debug("No balance on the account"),b._showErrorMessage(b.reset,h)}else b._debug("Invalid account"),b._genericError(b.reset)})},"GENERICINQUIRYRESPONSE")},b._processTender=function(a,c,d){var e=new _nex.commands.ProcessTender(a,c,d);_nex.communication.send(e,function(a){b.handleTenderResponse(a)},"PROCESSTENDERRESPONSE")},b.handleTenderResponse=function(a){if(b._debug("Handling PROCESSTENDERRESPONSE response: "),b._debug(a),_nex.orderManager.currentOrder.update(a.ORDER),"ENOUGH_COLLECTED"===a.message)b.processOrder();else{var c=a.amount?a.amount:0,d=_nex.orderManager.currentOrder.totals.remainingbalance(),e=b.textBalanceMessage();e=e.replace("{0}",c),e=e.replace("{1}",d),b._showBalanceMessage(b._route,e),b._hideBackButton()}},b.showTenderProcessingMessage=function(){var a=_nex.assets.theme.getTextAttribute("PAYMENT","preauthmessage","Authorizing...");b.showProcessingPopup(a)},b.couponInquiry=function(a){b._debug("couponInquiry");var c="";"string"==typeof b.deviceData?c=b.deviceData:"object"==typeof b.deviceData&&(c=b.deviceData.barcode),b._sendCouponInquiry(c)},b._sendCouponInquiry=function(a){b.showTenderProcessingMessage(),_nex.communication.send(new _nex.commands.CouponInquiry(a),function(c){b._debug("coupon inquiry response",c),b.hideProcessingPopup();var d=new TenderCoupon(a);if(d.update(c),b._debug(c),d.isValidAccount()){var e=d.deductionAmount(_nex.orderManager.currentOrder.totals.subtotal());e>0?b._processTender(d,e,""):(b._debug("There is $0.00 to be deducted. Coupon amount could be invalid."),b._genericError(b.reset))}else b._debug("Invalid account"),b._genericError(b.reset)},"COUPONRESPONSE")},b.registerCallback=function(a,c){b._paymentManager||(b._paymentManager=new PaymentManager),b._paymentManager.registerCallback(a,c)}}function PostOrdering(){var a=this;a.debugEnabled=!0,a.debug=function(){a.debugEnabled&&console.debug("PostOrdering",arguments)},a._isPreviousOrdersEnabled=function(){var a=!1,b=_nex.assets.theme;return b&&b.system&&b.system.PREVIOUSORDERS&&b.system.PREVIOUSORDERS.hasOwnProperty("enabled")&&"true"===b.system.PREVIOUSORDERS.enabled.toLowerCase()&&(a=!0),a},a.start=function(){if(a.debug("start"),_nex.manager.sendStatusUpdate(_nex.manager.statusType.POST_ORDERING),refreshOrderTimer(),a._isPreviousOrdersEnabled())if(_nex.orderManager.currentOrder.smsNumber||_nex.orderManager.currentOrder.lookupData){if(a.debug("Phone number found at previous orders... Trying to apply it here."),_nex.orderManager.currentOrder.lookupData){var b=new _nex.commands.SavePreviousOrder(_nex.orderManager.currentOrder.orderid,_nex.orderManager.currentOrder.smsNumber,_nex.orderManager.currentOrder.lookupData);_nex.communication.send(b)}a.gotoNextPhase(!0)}else a.debug("No phone number at previous orders."),a.showLookupOptions();else a.gotoNextPhase(!1)},a.showLookupOptions=function(){try{_nex.repeatOrderPhase.showLookupOptions(!0)}catch(b){a.gotoNextPhase()}},a.stop=function(){},a.gotoNextPhase=function(b){a.stop();var c=_nex.assets.phaseManager.findPhaseClips(_nex.assets.phaseManager.phaseType.SMS);void 0!==c&&null!==c&&c.length>0?(a.debug("SMS is enabled. Going to SMS."),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.SMS,function(){_nex.sms.start()})):(a.debug("SMS is not enabled. Going to green receipt."),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.GREEN_RECEIPT,function(){_nex.greenReceipt.start()}))},a._trackClick=function(a,b){var c="",d=a,e="",f="control";_nex.utility.buttonTracking.track(c,d,e,b,f)}}function PreviousOrders(a){if(!a)throw"PreviousOrders: Missing parameters.";if(!a.theme)throw"PreviousOrders: Missing parameter theme.";var b=this;b._theme=a.theme,b._previousOrderSelected=null,b.lookupPrevious=!1,b.previousOrdersFound=[],b.deviceData=null,b.phoneData="";var c=!0;b._debug=function(){c&&console.debug("PreviousOrders",arguments)},b.reset=function(){b._previousOrderSelected=null,b.lookupPrevious=!1,b.previousOrdersFound=[],b.deviceData=null,b.phoneData=""},b.start=function(a){if(b._debug("start","Enter the previous orders phase"),b.reset(),_nex.manager.sendStatusUpdate(_nex.manager.statusType.PREVIOUS_ORDERS),b.hideClip(),b.updateControlButtons(),a&&(b.deviceData=a),b.isPreviousOrdersEnabled())if(b._debug("start","previous orders is enabled... checking card swiped"),b.deviceData)b.fetchOrders(b.deviceData);else try{_nex.repeatOrderPhase=new RepeatOrderPhase,_nex.repeatOrderPhase.start()}catch(c){console.log("ERROR entering repeat order phase."),b.gotoOrdering()}else b._debug("start","going to ordering"),b.gotoOrdering();refreshOrderTimer()},b.stop=function(){b.reset()},b.hideClip=function(){$("#clip-orders").hide(),$("#clip-controlbuttons").hide()},b.showClip=function(){b._debug("showing previous orders to select from"),$("#clip-repeatorders").hide(),$("#clip-orders").show(),$("#clip-controlbuttons").show()},b._trackClick=function(a,b){var c="",d=a.text(),e="",f="control";_nex.utility.buttonTracking.track(c,d,e,b,f)},b._continueButtonClicked=function(a){b._trackClick(a,"New Order"),_nex.previousOrders.gotoOrdering()},b._cancelButtonClicked=function(a){b._trackClick(a,"Cancel"),_nex.previousOrders.gotoSplash()},b.updateControlButtons=function(){b._debug("Updating control buttons");var a="",c=$("#ctrl-continue");c.length>0&&(c.attr("onclick",""),c.unbind("click"),c.click(function(){b._continueButtonClicked(c)}),a=_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","continue","NEW ORDER"),c.html(a));var d=$("#ctrl-cancel");d.length>0&&(d.attr("onclick",""),d.unbind("click"),d.click(function(){b._cancelButtonClicked(d)}),a=_nex.assets.theme.getTextAttribute("ORDER","cancel","CANCEL"),d.html(a))},b.isPreviousOrdersEnabled=function(){var a=!1,c=b._theme;return c.system&&c.system.PREVIOUSORDERS&&c.system.PREVIOUSORDERS.hasOwnProperty("enabled")&&"true"===c.system.PREVIOUSORDERS.enabled.toLowerCase()&&(a=!0),a},b.previousOrdersFound=function(a){var b=!1;return a&&a.length>0&&(b=!0),b},b.clearPreviousOrders=function(){$("div.previous-order:not(:first)").remove()},b.isOrderItemsAvailable=function(a){for(var c=!0,d=0;d<a.length&&c;d++){c=_nex.assets.theme.itemIsAvailable(a[d].posid);try{var e=_nex.assets.theme.itemByPosid(a[d].posid);if(c&&a[d].hasOwnProperty("price")&&null!==e){var f=a[d].price.length>0?Number(a[d].price):0,g=_iorderfast.assets.theme.itemPrice(e,a[d].pricelevel);g=g.length>0?Number(g):0,f>0&&0===g&&(c=!1)}}catch(h){console.log("unable to determine price of item")}if(c){var i=b._convertToArray(a[d].ITEM);c=b.isOrderItemsAvailable(i)}}return c},b._convertToArray=function(a){var b=[];return a&&(a instanceof Array?b=a:b.push(a)),b},b._allItemsExist=function(a){var c=!0,d=[],e=[];return a.ORDER&&(d=a.ORDER.ITEM,e=b._convertToArray(d),c=b.isOrderItemsAvailable(e)),b._debug("previousOrders._allItemsExist returning "+c),c},b.displayOrders=function(a,c){b._debug("enter display orders"),b.clearPreviousOrders(),b._debug("Displaying previous orders. Here were the ones that were found:");$("#previousorder");b._debug(b.previousOrdersFound);var d=!1;if(b.previousOrdersFound.length>=1)for(var e=0;e<b.previousOrdersFound.length;e++){var f=b.previousOrdersFound[e];b._allItemsExist(f)&&(b.buildOrder(e,f),d=!0)}d?(a&&a(),b._debug("Showing control buttons"),b.updateControlButtons(),b.showClip()):c?c():b._popupNoPreviousOrdersFound()},b.orderSelected=function(a){b._debug("Previous order selected: ",a),b.loadOrder(a)},b.newOrder=function(){b.gotoOrdering()},b.loadOrder=function(a){
var c=b.previousOrdersFound[a];b._debug("loadOrder",c),console.log(c),b.gotoOrdering(c)},b.gotoSplash=function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.SPLASH,function(){})},b.gotoOrdering=function(a){a?b._gotoOrderingWithOrder(a):b._gotoOrderingWithoutOrder()},b.loadOrder=function(a){var c=b.previousOrdersFound[a];c&&b.gotoOrdering(c)},b.displayNoPreviousOrdersFound=function(){b._popupNoPreviousOrdersFound()},b._popupErrorCardData=function(a,b){var c=$.extend(!0,{},_nex.assets.popupManager.errorPopup);a&&a.length>0&&(c.message=a),_nex.assets.popupManager.showPopup(c,function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){})})},b._lookupPreviousSelected=function(){b.cardSwiped&&_nex.previousOrders.fetchOrders()},b.fetchOrders=function(a,c,d){if(b._debug("fetching orders"),_nex.utility.deviceListener&&(_nex.utility.deviceListener.stop(),_nex.utility.deviceListener=null),"object"==typeof a)switch(a.lookupType){case"2":}c||b._popupProcessing();var e=new _nex.commands.RequestRepeatOrders(a);_nex.communication.send(e,function(a){c||b._popupProcessingHide(),b._responseReceived(a,c,d)},"PREVIOUSORDERS")},b.cancelFetchOrders=function(){_nex.utility.deviceListener&&(_nex.utility.deviceListener.stop(),_nex.utility.deviceListener=null)},b._cardEventListener=function(a){if(_nex.utility.deviceListener&&(_nex.utility.deviceListener.stop(),_nex.utility.deviceListener=null),b._debug(a),a&&"ERROR"!==a){if(a.track1){var c=new CardParser(_nex.assets.theme);c.parse(a.track1,a.track2,function(a){var c=a.cardNumber,d="",e="",f=a.cardType;c&&(c.length>=2&&(d=c.substr(0,2)),c.length>=4&&(e=c.substr(c.length-4,4)));var g=a.fullName(),h=f+g+d+e,i=new LookupData(_nex.types.lookup.CANCEL,h);_nex.orderManager.currentOrder.lookupData=i,b.fetchOrders(i,b.callbackFound,b.callbackNotFound)},function(){b._sendRequestPreviousOrders("")})}}else b._popupErrorCardData(b._theme.getTextAttribute("PAYMENT","swipeerror","Error reading card data"))},b.callbackFound=function(){},b.callbackNotFound=function(){},b._popupNoPreviousOrdersFound=function(){console.log("_popupNoPreviousOrdersFound");var a=$.extend(!0,{},_nex.assets.popupManager.errorPopup);a.message=_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","promptnotfound","Sorry, no previous orders available."),_nex.assets.popupManager.showPopup(a,function(){})},b._popupProcessing=function(a,c){var d=$.extend(!0,{},_nex.assets.popupManager.processingPopup);d.message=a?a:b._theme.getTextAttribute("PREVIOUSORDERS2","processing","Looking Up<br/>Previous Orders..."),_nex.assets.popupManager.showPopup(d,function(){c&&c()})},b._popupProcessingHide=function(a){var b=$.extend(!0,{},_nex.assets.popupManager.processingPopup);_nex.assets.popupManager.hidePopup(b,function(){a&&a()})},b._phonepadPopupHide=function(a,b){var c=$.extend(!0,{},_nex.assets.popupManager.phonepadPopup);_nex.assets.popupManager.hidePopup(c,function(){b&&b()})},b._isValidCard=function(a){var b=!1;return a?!0:b},b._isValidPhone=function(a){var b=!1;return a&&10===a.length&&(b=!0),b},b._sendRequestPreviousOrders=function(a){if(b._debug("Fetching previous orders with data ",a),b._phonepadPopupHide(),a&&(b._isValidPhone(a)||b._isValidCard(a))){b._popupProcessing(),_nex.orderManager.currentOrder||(_nex.orderManager.currentOrder={}),_nex.orderManager.currentOrder.smsNumber=a;var c=new _nex.commands.RequestPreviousOrders(_nex.orderManager.currentOrder);_nex.communication.send(c,function(a){b._popupProcessingHide(),b._responseReceived(a)},"PREVIOUSORDERS")}else console.error("No data or bad data specified for fetching previous orders! Going right to ordering."),b._gotoOrderingWithoutOrder()},b._responseReceived=function(a,c,d){if("true"===a.responseReceived){b._debug(a);var e=a.PREVIOUSORDER;Array.isArray(e)?b.previousOrdersFound=e:"object"==typeof e&&b.previousOrdersFound.push(a.PREVIOUSORDER),_nex.previousOrders.displayOrders(c,d)}else b._debug("error getting previous orders"),b.previousOrdersFound=null,b.displayOrders(c,d)},b._gotoOrderingWithoutOrder=function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){_nex.ordering.start()})},b._gotoOrderingWithOrder=function(a){b._popupProcessing(b._theme.getTextAttribute("PREVIOUSORDERS2","loadorder","Loading Order..."));var c=new _nex.commands.LoadOrder(a);_nex.communication.send(c,function(a){b._popupProcessingHide(),_nex.orderManager.currentOrder.update(a.ORDER),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){_nex.ordering.start(),_nex.ordering.gotoOrderReview()})},"LOADORDERRESPONSE")},b.buildOrder=function(a,c){b._debug("build order - "+a),b._debug(c);var d=$("#previousorder").clone();d.attr("id","previousorder"+String(a));var e=d.find("#orderdate"),f=new Date(c.date),g=dateFormatting.dayOfWeek(f.getDay());e.append(g+", "+dateFormatting.month(f.getMonth())+" "+f.getDate());var h=d.find("#previousOrderItem").clone();if(c.ORDER){var i=c.ORDER,j=null;c.ORDER.previousorderid=c.orderintid,console.log(c);for(var k=b._convertToArray(i.ITEM),l=0;l<k.length;l++){var m=k[l];j=b._getItemHtml(m,h,l),null!==j&&(d.find("#items").append(j),b._debug("1 ORDER HTML NOW: "),b._debug(d.html()))}}else console.log("ORDER is not an array and is expected to be");var n=d.find("#loadOrder");n.attr("onclick","_nex.previousOrders.loadOrder("+a+")"),d.css("visibility",""),d.css("display",""),b._debug("Appending total order HTML now..."),b._debug(d.html()),d.appendTo("#orders"),b._debug("Orders is now: "),b._debug($("#orders").html())},b._getItemHtml=function(a,c,d){var e=c.clone(),f=_nex.assets.theme.itemByPosid(a.posid);if(f){var g=e.attr("id"),h=g+d;e.attr("id",h);var j=e.find("#receipttext");j.empty(),j.append(a.quantity+" - "+itemFormatting.buttonText(_nex.assets.theme.itemTextByType(f,"RECEIPTTEXT")));var k=e.find("#bimage");if(k.length>0){k.empty();var l=order.ITEM[i].posid,m=_nex.assets.theme.itemByPosid(l).DETAIL.image;m.length>0&&themeid.length>0&&(url=_nex.assets.theme.mediaRootUri,-1===url.toLowerCase().indexOf(_nex.assets.theme.id.toLowerCase())&&(url+="/"+_nex.assets.theme.id),url+="/media/images/"+m,$(k).css({"background-image":"url("+url+")"}))}a.ITEM=b._convertToArray(a.ITEM);var n=itemFormatting.buildModReceiptText(a),o=e.find("#modtext");o.empty(),o.append(n),b._debug(e.html()),e.css("visibility",""),e.css("display","")}else b._debug("Could not lookup item in POS"),e.css("visibility",""),e.css("display","");return d++,e}}function RepeatOrderPhase(){var a=this;a.debugEnabled=!1,a.debug=function(){a.debugEnabled&&console.debug("RepeatOrderPhase",arguments)},a.reset=function(){a.hide()},a.start=function(){var b=new RepeatOrderPrompt(a,a.theme,a.soundManager,a.popupManager);b.updateUI(),a.show()},a.stop=function(){a.reset()},a.hide=function(){$("#repeatOrderphase").hide()},a.show=function(){$("#repeatOrderphase").show()},a.getButtonList=function(b){var c=[];c.push({type:"phone"}),c.push({type:"face"}),c.push({type:"credit"}),c.push({type:"cancel"});for(var d=_nex.assets.theme.lastUpdate.THEMES.THEME,e=d.PHASE,f=0;f<e.length;f++){var g="previousorders";b&&(g="postordering");var h=e[f];if(h.id==g)for(var i=h.CLIP,j=0;j<i.length;j++){var k=i[j];if(k.hasOwnProperty("OPTION"))return c=k.OPTION}}return a.debug(".getButtonList",c),c},a.getRepeatOrderElement=function(){var a=null;return a=_nex.assets.theme.kiosk.PAYMENTPROFILE.REPEATORDERS?_nex.assets.theme.kiosk.PAYMENTPROFILE.REPEATORDERS:{phone:"true",face:"false",credit:"true",cancel:"true"}},a.showLookupOptions=function(b){var c=$("#lookupContainer"),d="Cancel",e="Option message",f=a.getButtonList(b),g=new RepeatOrderOptions(b||!1);g.init(c,d,e,f),g.bindButtons(),g.show()},a.gotoOrdering=function(b){b?a._gotoOrderingWithOrder(b):a._gotoOrderingWithoutOrder()},a._gotoOrderingWithoutOrder=function(){_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){_nex.ordering.start()})},a._gotoOrderingWithOrder=function(b){a._popupProcessing();var c=new _nex.commands.LoadOrder(b);_nex.communication.send(c,function(b){a._popupProcessingHide(),_nex.orderManager.currentOrder.update(b.ORDER),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){_nex.ordering.start(),_nex.ordering.gotoOrderReview()})},"LOADORDERRESPONSE")},a._popupProcessing=function(a,b){var c=$.extend(!0,{},_nex.assets.popupManager.processingPopup);c.message=a?a:_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","processing","Processing ..."),_nex.assets.popupManager.showPopup(c,function(){b&&b()})},a._popupProcessingHide=function(a){var b=$.extend(!0,{},_nex.assets.popupManager.processingPopup);_nex.assets.popupManager.hidePopup(b,function(){a&&a()})},a.gotoSplash=function(){}}function sms(a){var b=this;b.timer=null,a||console.log("ERROR: SMS requires parameters"),a.theme||console.log("ERROR: SMS requires parameter: theme"),b._theme=a.theme;var c=!0;b._debug=function(){c&&console.debug("SMS",arguments)},b.startTimer=function(){b._debug("!!!Starting SMS timer");var a=b._getTimeoutSeconds();b.timer&&(b.timer.stop(),b.timer=null),b.timer=new TimeoutTimer(this,b._gotoNextPhase,a),b.timer.start(),b.popupPhone()},b.stopTimer=function(){b.timer&&(console.log("!!!Stopping SMS timer"),b.timer.stop(),b.timer=null)},b.start=function(){console.debug("SMS: Phase started"),_nex.manager.sendStatusUpdate(_nex.manager.statusType.COMPLETING),b._smsenabled()&&!_nex.orderManager.currentOrder.smsNumber?(console.debug("SMS: ENABLED"),b.startTimer()):(console.debug("SMS: DISABLED"),b._gotoNextPhase())},b.stop=function(){b.stopTimer()},b.popupPhone=function(){var a="phonepadPopup",c=$.extend(!0,{},_nex.assets.popupManager[a]);c.message=_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","instructions2","Phone Number"),c.buttons[0].clickEvent="_nex.previousOrders.cancelFetchOrders();",c.buttons[0].text=_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","popupclear","CANCEL"),_nex.assets.popupManager.showPopup(c);var d=function(){var a=new LookupData(_nex.types.lookup.PHONE,_nex.keyboard.phonepad.data);_nex.orderManager.currentOrder.smsNumber=a.lookupValue;var d=new _nex.commands.AddSMSToOrder(_nex.orderManager.currentOrder.orderid,_nex.orderManager.currentOrder.smsNumber);_nex.communication.send(d),_nex.assets.popupManager.hidePopup(c,function(){b._gotoNextPhase()})};_nex.keyboard.phonepad.bindKeys(d)},b._smsenabled=function(){var a=!1;try{var c=b._theme,d=c.system;d&&d.ODS&&d.ODS.smsnotification&&(a=!0),_nex.orderManager.currentOrder.smsNumber&&(a=!1),c.disablesmsprompt&&(a=!1)}catch(e){}return a},b._gotoNextPhase=function(){b.stop(),b._debug("Changing phase to complete."),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.GREEN_RECEIPT,function(){_nex.greenReceipt.start()})},b._getTimeoutSeconds=function(){var a=30;return a}}function SplashPhase(){var a=this;a._startPending=!1,a.actions=null,a.firsttime=!1,a._deviceData=null,a.barcodeData=null,a.userSwipedToStart=!1,a.clickX=window.innerWidth/2,a.clickY=window.innerHeight/2,a.handledSplashClick=!1,a.splashSettings=null,a.redirected=!1,a.barcodescanmenu=null,a._voiceoverDelay=2e3,a._proximityListener=null;var b=!0;a._debug=function(){b&&console.debug("SplashPhase",arguments)},a.start=function(b,c,d){a._reset(),a._proximityListener=_nex.communication.createListener("PROXIMITYTRIGGERED",a._proximityTriggered),_nex.communication.addListener(a._proximityListener),_nex.manager.sendStatusUpdate(_nex.manager.statusType.IDLE),_nex.assets.theme.splashid||console.error("Could not load the splash id from the theme!"),a._checkActions(_nex.assets.theme.splashid),a._debug("start","actions enabled",a.actions),a._checkSplashSettings(_nex.assets.theme.splashid),a._debug("start","splash settings",a.splashSettings),_nex.assets.theme.hasvideo&&(a._debug("start","Adding video feed."),a._addVideoFeed()),a.actions.startorder&&(a._debug("start","Binding buttons for first time and returning guest."),a._bindButtons(b,c,d)),a.actions.barcodescan?(a._debug("start","Barcode action is enabled... Listening for barcode"),a.swipeToStartAction=new SwipeToStartAction(_nex.assets.theme),a.swipeToStartAction.startListening(a.barcodeToStart)):a.actions.cardswipe&&(a._debug("start","Cardswipe action is enabled... Listening for cardswipe"),a.swipeToStartAction=new SwipeToStartAction(_nex.assets.theme),a.swipeToStartAction.startListening(a.deviceToStart));var e="splashvideo";a.showMovie(c,d,e)},a.showMovie=function(b,c,d){if(_nex.assets.theme.hasOwnProperty("kiosk")&&_nex.assets.theme.kiosk.hasOwnProperty("splashbg")){var e=_nex.assets.theme.mediaPath();e+="Other/";var f=_nex.assets.theme.kiosk.splashbg;0===f.length&&(f="splash.webm"),a.setBackground(e,f,b,c,d)}},a.stop=function(){a._stopTicker()},a.clickToStart=function(){a._trackClick(),_nex.assets.theme.languageSelected="english",a._startHelper()},a.firstTimeToStart=function(){a._trackFirstTime(),_nex.assets.theme.languageSelected="english",a._startHelper()},a.returningGuestStart=function(){a._trackReturningGuest(),_nex.assets.theme.languageSelected="english",a._startHelper()},a.cameraFrameClicked=function(){a._trackClickVideo(),_nex.assets.theme.languageSelected="english",a._startHelper()},a.deviceToStart=function(b){a._trackSwipe(),a.userSwipedToStart=!0,_nex.assets.theme.languageSelected="english",a._startHelper(b)},a.barcodeToStart=function(b){a._trackBarcode(),a.userSwipedToStart=!1,_nex.assets.theme.languageSelected="english",a._startHelper(b,!0)},a.alternateLanguageToStart=function(b){a._trackAlternateLanguage(b),_nex.assets.theme.languageSelected=b,$("body").attr("data-language",_nex.assets.theme.languageSelected),a._startHelper()},a._reset=function(){a.firsttime=!1,a._deviceData=null,a.barcodeData=null,a.userSwipedToStart=!1,a.handledSplashClick=!1,a._resetRotateTimer(),_nex.assets.popupManager.hideAllPopups(),_nex.utility.deviceListener&&(_nex.utility.deviceListener.stop(),_nex.utility.deviceListener=null),_nex.orderManager.customData={},$("body").attr("data-language",""),_nex.assets.theme.system.hasOwnProperty("voiceoverdelay")&&_nex.assets.theme.system.voiceoverdelay.length>0&&(a._voiceoverDelay=Number(_nex.assets.theme.system.voiceoverdelay)),_nex.communication.removeListener(a._proximityListener)},a._proximityTriggered=function(){"idle"===_nex.manager.currentStatus.toLowerCase()&&_nex.assets.theme.splashVoiceover.toString().length>0&&window.setTimeout(function(){_nex.assets.soundManager.playVoiceover(_nex.assets.theme.splashVoiceover)},a._voiceoverDelay)},a._resetRotateTimer=function(){_nex.utility.rotateTimer&&_nex.utility.rotateTimer.reset()},a._addVideoFeed=function(){if(_nex.assets.theme.hasvideo){var a="http://127.0.0.1:8088";_nex.assets.theme.frenabled&&(a="http://127.0.0.1:8089");var b="Kiosk1",c="nextep",d='"'+a+'"';d=d.replace("http://","http://"+c+":"+b+"@")}},a._bindFirstStart=function(b){a._debug("Binding first start");var c=null;b?c=$("#"+b):a.actions.startorder.firststartbuttonid&&(c=$("#"+a.actions.startorder.firststartbuttonid)),c&&c.length>0&&(c.button(),c.unbind("click"),c.click(function(b){a.firsttime=!0,a.firstTimeToStart(),a.clickX=b.pageX,a.clickY=b.pageY}),c.css("height",function(){return window.innerHeight}))},a._bindGuestStart=function(b){a._debug("Binding guest start");var c=null;b?c=$("#"+b):a.actions.startorder.buttonid&&(c=$("#"+a.actions.startorder.buttonid)),c&&c.length>0&&(c.button(),c.unbind("click"),c.click(function(b){a.firsttime=!1,a.returningGuestStart(),a.clickX=b.pageX,a.clickY=b.pageY}),c.css("height",function(){return window.innerHeight}))},a._bindLanguageButtons=function(){if(a.actions.selectlanguage){a._debug("Binding language buttons");var b=a.actions.selectlanguage,c="",d=null;a._debug("Found languages ",b),b.length>0&&(d=new SetLanguageAction(_nex.assets.theme));for(var e=0;e<b.length;e++){var f=b[e];f&&f.hasOwnProperty("languageid")&&(c=f.languageid),a._debug("select language is enabled... adding the alernate language button for language id ",c);var g=c+"ToStart",h="_nex.splashPhase.alternateLanguageToStart('"+c+"')",i=$("#"+g);i.length>0?(i.attr("onclick",h),i.attr("class","alternateLanguageToStart")):$("#splash").append('<div class="alternateLanguageToStart" id="'+g+'" onclick="'+h+'"></div>');var j=c;"spanish"===c&&(j="ESPAÑOL"),d.initialize(c,$("#"+g),j)}}},a._bindButtons=function(b,c,d){a._bindFirstStart(c),a._bindGuestStart(d),a._bindLanguageButtons()},a._stopListeningForDevice=function(){a.swipeToStartAction&&a.swipeToStartAction.stopListening()},a._checkSwipeData=function(){var b=new CardParser(_nex.assets.theme);b.parse(a._swipeData.track1,a._swipeData.track2,a.swipeToStartAction.goodSwipe,a.swipeToStartAction.badSwipe)},a._stopTicker=function(){createjs&&createjs.Ticker&&createjs.Ticker.reset()},a._startHelper=function(b,c){a._startPending||(a._startPending=!0,a._stopListeningForDevice(),a._deviceData="",a._stopTicker(),_nex.assets.soundManager.cancelVoiceover(),b&&(a._deviceData=b),_nex.communication.addListener(_nex.communication.createListener("CUSTOMERRESPONSE",function(a){if(void 0!==a.CUSTOMER&&null!==a.CUSTOMER&&Boolean(a.CUSTOMER.facesearch)&&void 0!==a.CUSTOMER.LOCATION&&null!==a.CUSTOMER.LOCATION){var b=!1;if(Array.isArray(a.CUSTOMER.LOCATION)){for(var c=0;c<a.CUSTOMER.LOCATION.length;c++)if(a.CUSTOMER.LOCATION[c].identifier===_nex.assets.theme.system.storeid){b=!0;break}}else a.CUSTOMER.LOCATION.identifier===_nex.assets.theme.system.storeid&&(b=!0);b&&(_nex.hasGuestAccount=!0,_nex.guestAccount=new GuestAccount(a.CUSTOMER.guestaccountid,a.CUSTOMER.firstname,a.CUSTOMER.lastname,a.CUSTOMER.email,a.CUSTOMER.thumbnail64,a.CUSTOMER.ACCOUNT),console.log(_nex.guestAccount))}},!0)),_nex.communication.send(new _nex.commands.CreateOrder(_nex.assets.theme.hasvideo,_nex.assets.theme.frenabled),function(){if(a._startPending=!1,_nex.orderManager.startOrder(),!_nex.initializedFlash&&_nex.assets.theme.hasvideo&&_nex.assets.theme.frenabled){var b=new _nex.commands.VideoFeedQueueFlash;_nex.communication.send(b),_nex.initializedFlash=!0}a._deviceData&&a.barcodescanmenu&&c?_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){a.barcodeData=a._deviceData,_nex.ordering.start(a.barcodescanmenu)}):a._deviceData&&_nex.previousOrders.isPreviousOrdersEnabled()?(console.log("User swiped to start. Going to previous orders"),_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.PREVIOUS_ORDERS,function(){_nex.previousOrders.start(a._deviceData)})):a.firsttime===!1&&_nex.previousOrders.isPreviousOrdersEnabled()?_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.PREVIOUS_ORDERS,function(){_nex.previousOrders.start()}):_nex.assets.phaseManager.changePhase(_nex.assets.phaseManager.phaseType.ORDERING,function(){_nex.ordering.start()})},"CREATEORDERRESPONSE"))},a._checkAction=function(b){"adminswipe"===b.actionid&&"true"===b.enabled?a.actions.adminswipe=b:"cardswipe"===b.actionid&&"true"===b.enabled?a.actions.cardswipe=b:"startorder"===b.actionid&&"true"===b.enabled?a.actions.startorder=b:"futureorder"===b.actionid&&"true"===b.enabled?a.actions.futureorder=b:"playanimation"===b.actionid&&"true"===b.enabled?a.actions.playanimation=b:"selectlanguage"===b.actionid&&"true"===b.enabled?(a.actions.selectlanguage||(a.actions.selectlanguage=[]),a.actions.selectlanguage.push(b)):"barcodescan"===b.actionid&&"true"===b.enabled&&(b.barcodescanmenu||console.log("Error! No barcode scan menu specified!"),a.actions.barcodescan=b,a.barcodescanmenu=b.barcodescanmenu)},a._checkItem=function(b,c){var d=null;if(b.id===c&&b.ACTION)if(Array.isArray(b.ACTION))for(var e=0;e<b.ACTION.length;e++)d=b.ACTION[e],a._checkAction(d);else d=b.ACTION,a._checkAction(d)},a._checkActions=function(b){var c=_nex.assets.theme.system.USERINTERFACE;a.actions={};var d=null;if(c.SPLASH)if(Array.isArray(c.SPLASH))for(var e=0;e<c.SPLASH.length;e++)d=c.SPLASH[e],a._checkItem(d,b);else d=c.SPLASH,a._checkItem(d,b)},a._checkSplashSettings=function(b){a._debug("Checking splash settings for splash id "+b);var c=_nex.assets.theme.system.USERINTERFACE,d=null;if(c.SPLASH)if(Array.isArray(c.SPLASH))for(var e=0;e<c.SPLASH.length;e++)d=c.SPLASH[e],d.id===b&&(a.splashSettings=d);else d=c.SPLASH,d.id===b&&(a.splashSettings=d);if(a.splashSettings)try{if(_nex.authToken.copyright=a.splashSettings.SPLASHTEXT.copyright,a._debug(_nex.authToken.copyright),_nex.splashPhase.splashSettings.SPLASHTEXT.hasOwnProperty("INSTRUCTION")){_nex.splashPhase.splashSettings.SPLASHTEXT.INSTRUCTION=$.isArray(_nex.splashPhase.splashSettings.SPLASHTEXT.INSTRUCTION)?_nex.splashPhase.splashSettings.SPLASHTEXT.INSTRUCTION:new Array(_nex.splashPhase.splashSettings.SPLASHTEXT.INSTRUCTION);for(var f=0;f<_nex.splashPhase.splashSettings.SPLASHTEXT.INSTRUCTION.length;f++){var g=_nex.splashPhase.splashSettings.SPLASHTEXT.INSTRUCTION[f].message;void 0!==g&&(g=g.replace(/~/g,"\n"),g=g.trim()),_nex.splashPhase.splashSettings.SPLASHTEXT.INSTRUCTION[f].message=g}}}catch(h){console.log("ERROR SETTING COPYRIGHT"),console.log(h)}else console.error("UNABLE TO LOAD SPLASH SETTINGS")},a._trackClick=function(){var a="",b="",c="",d="SplashAction",e="control";_nex.utility.buttonTracking.track(a,b,c,d,e)},a._trackClickVideo=function(){var a="",b="Video Feed",c="",d="SplashAction",e="control";_nex.utility.buttonTracking.track(a,b,c,d,e)},a._trackFirstTime=function(){var a="",b="First Time",c="",d="SplashAction",e="control";_nex.utility.buttonTracking.track(a,b,c,d,e)},a._trackReturningGuest=function(){var a="",b="Returning Guest",c="",d="SplashAction",e="control";_nex.utility.buttonTracking.track(a,b,c,d,e)},a._trackSwipe=function(){var a="",b="swipe",c="",d="SplashAction",e="control";_nex.utility.buttonTracking.track(a,b,c,d,e)},a._trackBarcode=function(){var a="",b="barcode",c="",d="SplashAction",e="control";_nex.utility.buttonTracking.track(a,b,c,d,e)},a._trackAlternateLanguage=function(a){var b="",c=a,d="",e="SplashAction",f="control";_nex.utility.buttonTracking.track(b,c,d,e,f)},a._setBackgroundWebm=function(b,c,d,e,f){console.log("Loading splash video onto element");var g=document.getElementById(f);if(!g)return void console.log("Missing element "+f);var h=document.createElement("source");console.log("Videofile: "+b),h.setAttribute("src",b),g.appendChild(h),g.play(),$("#"+f).show();var i="#"+d+", #"+e;$(i).bind("click",function(){$("#"+f).hide(),c()}),a._setCopyright()},a._setCopyright=function(){var b=copyrightNotice(),c='<div id="copyright">'+b+"</div>";a._debug("Appending "+c),$("#splash").append(c)},a.setBackground=function(b,c,d,e,f){var g=b+c;if(g.endsWith("webm")){var h=_nex.splashPhase.clickToStart;a._setBackgroundWebm(g,h,d,e,f)}}}function LookupPopup(a){var b=1500,c=1500,d=1500,e=1500,f=1500,g=this;g.postOrdering=a||!1;g._currentButtonXml=null,g._barCodeListener=null,g._yesButton={},g._noButton={},g.setButtonXml=function(a){g._currentButtonXml=a},g.enableDebugging=!0,g.debug=function(){g.enableDebugging&&console.debug("LookupPopup",arguments)},g.popupFace=function(){g.debug("popup face");var a=!1;if(_nex.assets.theme.frenabled){var c=new _nex.commands.VideoFeedDots(1);_nex.communication.send(c)}_nex.previousOrders.yesClicked=!1,_nex.previousOrders.noClicked=!1;var d=$.extend(!0,{},_nex.assets.popupManager.lookupPopupVideo);d.message=_nex.assets.theme.getTextAttribute("REPEATORDERS","lookuplookmessage","Please look at the camera"),d.buttons[0].clickEvent="_nex.previousOrders.noClicked = true;",d.buttons[0].text=_nex.assets.theme.getTextAttribute("ORDER","cancel","Cancel"),_nex.assets.popupManager.showPopup(d,function(){g.removeLookupEmoticon(),g.changeState("lookuplook"),_nex.previousOrders.noClicked&&(a=!0,g.debug("popupFace no clicked"))}),window.setTimeout(function(){a||(g.changeState("lookupsearching"),g._sendDeviceLookupFr(d))},b)},g._sendDeviceLookupFr=function(a){var b=new _nex.commands.DeviceLookup(_nex.types.lookup.FACE);_nex.communication.send(b,function(b){window.setTimeout(function(){g._handleDeviceLookupResponse(a,b)},c)},"DEVICELOOKUPRESPONSE")},g._handleDeviceLookupResponse=function(a,b){if(b&&"true"===b.success.toLowerCase()){g.debug("success"),g.debug(b);var c=new LookupData(_nex.types.lookup.FACE,b.lookupvalue,b.LOOKUPVALUES);_nex.orderManager.currentOrder.lookupData=c,g.postOrdering?(g.changeState("lookuppostordering"),window.setTimeout(function(){_nex.assets.popupManager.hidePopup(a,function(){g._rememberOrder(c)})},d)):window.setTimeout(function(){g.requestPreviousOrders(c,g.callbackFound,g.callbackNotFound)},d)}else g.changeState("lookupnopicture"),window.setTimeout(function(){_nex.assets.popupManager.hideAllPopups()},f)},g.callbackFound=function(){if(g.changeState("lookupfound"),_nex.assets.theme.frenabled){var a=new _nex.commands.VideoFeedDots(0);_nex.communication.send(a)}window.setTimeout(function(){if(_nex.assets.popupManager.hideAllPopups(),g.removeLookupEmoticon(),_nex.assets.theme.frenabled){var a=new _nex.commands.VideoFeedDots(1);_nex.communication.send(a)}},e)},g.callbackNotFound=function(){g.changeState("lookupnotfound"),window.setTimeout(function(){_nex.assets.popupManager.hideAllPopups(),g.removeLookupEmoticon()},f)},g.requestPreviousOrders=function(a){_nex.previousOrders.fetchOrders(a,g.callbackFound,g.callbackNotFound)},g._rememberOrder=function(a){var b=new _nex.commands.SavePreviousOrder(_nex.orderManager.currentOrder.orderid,_nex.orderManager.currentOrder.smsNumber,a);_nex.communication.send(b),g.gotoComplete()},g.gotoComplete=function(){_nex.postOrdering.gotoNextPhase(!1)},g.popupOther=function(a){g.debug("Showing popupOther");var b=!0;_nex.utility.deviceListener=new DeviceListener("ALL",_nex.previousOrders._cardEventListener,b),_nex.utility.deviceListener.start(),_nex.previousOrders.yesClicked=!1,_nex.previousOrders.noClicked=!1;var c=$.extend(!0,{},_nex.assets.popupManager.lookupPopup);c.message=_nex.assets.theme.getTextAttribute("REPEATORDERS","lookupmessage","Repeat order"),c.buttons[0].clickEvent="_nex.previousOrders.noClicked = true;",_nex.assets.popupManager.showPopup(c,function(){g.removeLookupEmoticon(),_nex.previousOrders.yesClicked?g.debug("popupOther yes clicked"):_nex.previousOrders.noClicked&&g.debug("popupOther no clicked")})},g.popupCredit=function(){g.debug("popupCredit");var a=!0;_nex.previousOrders.callbackFound=g.callbackFound,_nex.previousOrders.callbackNotFound=g.callbackNotFound,_nex.utility.deviceListener=new DeviceListener("CARD",_nex.previousOrders._cardEventListener,a),_nex.utility.deviceListener.start(),_nex.previousOrders.yesClicked=!1,_nex.previousOrders.noClicked=!1;var b=$.extend(!0,{},_nex.assets.popupManager.lookupPopup);b.message=_nex.assets.theme.getTextAttribute("REPEATORDERS","lookupcreditmessage","Please swipe your card"),b.buttons[0].clickEvent="_nex.previousOrders.noClicked = true;",_nex.assets.popupManager.showPopup(b,function(){g.removeLookupEmoticon(),_nex.previousOrders.yesClicked?g.debug("popupCredit yes clicked"):_nex.previousOrders.noClicked&&g.debug("popupCredit no clicked")})},g.popupPhone=function(){var a="phonepadPopup",c=$.extend(!0,{},_nex.assets.popupManager[a]);g.postOrdering?c.message=_nex.assets.theme.getTextAttribute("COMPLETEORDER","savepreviousorder","Remember this order?"):c.message=_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","instructions2","Phone Number"),c.buttons[0].clickEvent="_nex.previousOrders.cancelFetchOrders();",c.buttons[0].text=_nex.assets.theme.getTextAttribute("PREVIOUSORDERS","popupclear","CANCEL"),_nex.assets.popupManager.showPopup(c),g.removeLookupEmoticon(),$("#popup-phonepad #keyboardContainer").show();var e=function(){g.changeState("lookupsearching","phone"),$("div.modal[aria-hidden='false'] #keyboardContainer").hide(),console.debug("Post ordering is ",g.postOrdering);var a=new LookupData(_nex.types.lookup.PHONE,_nex.keyboard.phonepad.data);_nex.orderManager.currentOrder.smsNumber=a.lookupValue,g.postOrdering?(g.changeState("lookuppostordering"),window.setTimeout(function(){_nex.assets.popupManager.hidePopup(c,function(){g._rememberOrder(a)})},d)):window.setTimeout(function(){g.requestPreviousOrders(a)},b)};_nex.keyboard.phonepad.bindKeys(e)},g.show=function(a){g.debug("Showing popup for button type "+a),"face"===a?g.popupFace():"credit"===a?g.popupCredit():"phone"===a?g.popupPhone():g.popupOther(a)},g.updateUI=function(a){g.debug("updateUI"),g._noButton.visible=!0,g._yesButton.visible=!1;var b=a.toLowerCase();switch(b){case"face":g._lookupType=g.LOOKUPTYPE_FACE;break;case"credit":g._lookupType=g.LOOKUPTYPE_CREDIT;break;case"loyalty":g._lookupType=g.LOOKUPTYPE_LOYALTY;break;case"loyalty2":g._lookupType=g.LOOKUPTYPE_LOYALTY2;break;case"generic1":g._lookupType=g.LOOKUPTYPE_GENERIC1;break;case"generic2":g._lookupType=g.LOOKUPTYPE_GENERIC2;break;case"generic3":g._lookupType=g.LOOKUPTYPE_GENERIC3;break;case"generic4":g._lookupType=g.LOOKUPTYPE_GENERIC4;break;case"generic5":g._lookupType=g.LOOKUPTYPE_GENERIC5;break;case"generic6":g._lookupType=g.LOOKUPTYPE_GENERIC6;break;case"generic7":g._lookupType=g.LOOKUPTYPE_GENERIC7;break;case"generic8":g._lookupType=g.LOOKUPTYPE_GENERIC8;break;case"generic9":g._lookupType=g.LOOKUPTYPE_GENERIC9;break;case"generic10":g._lookupType=g.LOOKUPTYPE_GENERIC10}},g.getDefaultText=function(a){var b=g._currentButtonXml.type.toString();switch(b.toLowerCase()){case"face":return a?"Unable to take your picture":"Taking your picture now";case"credit":return"Swipe your card";case"loyalty":case"loyalty2":return"Scan your card";case"generic1":case"generic2":case"generic3":case"generic4":case"generic5":case"generic6":case"generic7":case"generic8":case"generic9":case"generic10":return"Scan your badge";default:return b}},g.changeState=function(a,b){var c=g.getText(a,b);g.changePopupText(c),g.changePopupIcon("lookupicon",a),g.changeFrImage(a)},g.getText=function(a,b,c){var d="";switch(a){case"lookuplook":d="phone"===b?_nex.assets.theme.getTextAttribute("REPEATORDERS",a,"Looking up your previous orders"):_nex.assets.theme.getTextAttribute("REPEATORDERS",a,"Please look at the camera");break;case"lookupsearching":d=g.postOrdering?_nex.assets.theme.getTextAttribute("REPEATORDERS",a,"Saving your order..."):_nex.assets.theme.getTextAttribute("REPEATORDERS",a,"Searching for your orders...");break;case"lookupfound":d=_nex.assets.theme.getTextAttribute("REPEATORDERS",a,"We found you! Loading your previous orders...");break;case"lookupnotfound":d=_nex.assets.theme.getTextAttribute("REPEATORDERS",a,"We didn't find any previous orders.");break;case"lookuppostordering":d=_nex.assets.theme.getTextAttribute("REPEATORDERS",a,"Saved your order!");break;case"lookupnopicture":d=_nex.assets.theme.getTextAttribute("REPEATORDERS",a,"Unable to take your picture!");break;default:d=_nex.assets.theme.getTextAttribute("REPEATORDERS","lookupfacemessage","Repeat order by face recognition")}return d},g.changePopupText=function(a){var b=$("div[aria-hidden='false'] #messageText");b.text(a)},g.changePopupIcon=function(a,b){$(".lookupicon").remove(),$("div.modal[aria-hidden='false'] .modal-content").prepend('<div id="lookupicon" class="animated '+b+' lookupicon"></div>'),"lookupfound"!==b&&"lookupnotfound"!==b||$("#lookupicon").addClass("pulse")},g.removeLookupEmoticon=function(){$(".lookupicon").remove()},g.changeFrImage=function(a){$("#popup-lookupvideo img#cameraFrame").attr("data-state",a)}}function RepeatOrderButton(a,b,c){var d=this;if(!a)throw"RepeatOrderButton: Missing required argument buttonId";if(!b)throw"RepeatOrderButton: Missing required argument buttonSettings";if(!c)throw"RepeatOrderButton: Missing required argument callback";d._buttonId=a,d._buttonSettings=b,d._callback=c,d.getButtonId=function(){return d._buttonId},d.getButtonSettings=function(){return d._buttonSettings},d.getCallback=function(){d._callback(d.getButtonSettings().type)},d.setButtonImage=function(a){$("#"+d._buttonId).css("background-image","url("+a+")")},d.show=function(){$("#"+d._buttonId).show()},d.hide=function(){$("#"+d._buttonId).hide()},d.getButtonText=function(a){
var b=d._buttonSettings.type.toString(),c=d._buttonSettings.buttontextattribute,e="";switch(b.toLowerCase()){case"phone":e="Phone Number";break;case"cancel":e=a?"Go To Full Menu...":"Complete order";break;case"face":e="Facial Recognition";break;case"credit":e="Credit Card";break;case"loyalty":e="Gift Card";break;case"loyalty2":e="Rewards Card";break;case"generic1":case"generic2":case"generic3":case"generic4":case"generic5":case"generic6":case"generic7":case"generic8":case"generic9":case"generic10":e="Badge"}return _nex.assets.theme.getTextAttribute("REPEATORDERS",c,e)}}function RepeatOrderOptions(a){var b=this;b._postOrdering=a||!1,b.OPTION_SELECTED="OPTION_SELECTED",b.BUTTON_PRESSED="BUTTON_PRESSED",b.LOOKUP_MESSAGE_ID="lookupmessage",b.REMEMBER_MESSAGE_ID="remembermessage",b._lookupButtonContainer=null,b._lookupButtons=[],b._lookupHeader={},b._lookupType="",b._lookupValue="",b._lookupValuesXml={},b.debugEnabled=!0,b.debug=function(){b.debugEnabled&&console.debug(arguments)},b.getSelectedValue=function(){return b._lookupValue},b.getSelectedType=function(){return b._lookupType},b.getSelectedValuesXml=function(){return b._lookupValuesXml},b.getText=function(a,b){return _nex.assets.theme.getTextAttribute("REPEATORDERS",a,b)},b.isRepeatOrderEnabled=function(){var a=_nex.assets.theme.system.PREVIOUSORDERS;return a.length>0&&(a=_nex.assets.theme.system.PREVIOUSORDERS[0]),!(!a||!a.userepeatorders||"true"!=a.userepeatorders.toLowerCase())},b.containsAtLeastOneButton=function(){return b.isRepeatOrderEnabled()&&b._lookupButtons.length>0},b.init=function(a,c,d,e){if(!b.containsAtLeastOneButton)return void console.log("No buttons for repeat orders!");b._lookupButtonContainer=a,null!==b._lookupHeader&&(b.postOrdering?b._lookupHeader.text=b.getText(b.REMEMBER_MESSAGE_ID,d):b._lookupHeader.text=b.getText(b.LOOKUP_MESSAGE_ID,d));b._lookupButtons=[];for(var f=0,g=0;g<e.length;g++){var h=e[g];if(b.isTypeEnabled(h)){var i="button"+f;if(buttonUIElement=$("#repeatOrderOptions #"+i),!(buttonUIElement.length>0)){console.log("RepeatOrderOptions: Ran out of button elements in the HTML file!");break}var j=new RepeatOrderButton(i,h,b.onButtonClick);b._lookupButtons.push(j),f++}}},b.bindButtons=function(){for(var a=0;a<b._lookupButtons.length;a++){var c=b._lookupButtons[a],d=c.getButtonId(),e=c.getButtonSettings(),f=e.type;_nex.utility.buttonBinder.bind(d,c.getButtonText(b._postOrdering),c.getCallback,!1,f)}},b.show=function(){for(var a=0;a<b._lookupButtons.length;a++){var c=b._lookupButtons[a];c&&c.show()}var d=$("#repeatOrderPromptHeader");d.length>0&&($("#repeatOrderPromptHeader").html(_nex.assets.theme.getTextAttribute("REPEATORDERS","lookupmessage","")),d.show())},b._isEnabled=function(a,c){b.debug(a),b.debug("Checking if attribute "+c+" is set to true");var d=!1;return a.hasOwnProperty(c)&&"true"===a[c]&&(d=!0),b.debug(d),d},b.isTypeEnabled=function(a){var c=!1,d=a.type.toString(),e=d.toLowerCase(),f=_nex.repeatOrderPhase.getRepeatOrderElement();switch(e){case"cancel":c=!0;break;case"phone":case"face":case"credit":case"loyalty":case"loyalty2":case"generic1":case"generic2":case"generic3":case"generic4":case"generic5":case"generic6":case"generic7":case"generic8":case"generic9":case"generic10":c=b._isEnabled(f,e);break;default:c=b._isEnabled(f,e)}return c},b.onButtonClick=function(a){switch(b.debug("clicked "+a),a.toLowerCase()){case"cancel":b._postOrdering?_nex.postOrdering.gotoNextPhase():_nex.previousOrders.gotoOrdering();break;case"phone":case"face":case"credit":case"loyalty":case"loyalty2":case"generic1":case"generic2":case"generic3":case"generic4":case"generic5":case"generic6":case"generic7":case"generic8":case"generic9":case"generic10":var c=new LookupPopup(b._postOrdering);c.updateUI(a),c.show(a);break;default:console.error("Could not find popup for "+a)}}}function RepeatOrderPrompt(a){var b=this;b.ACTION_NEWORDER=0,b.ACTION_REPEAT=1,b.ACTION_ORDERPIN=2,b.ACTION_CANCEL=3,b._theme=_nex.assets.theme,b._soundManager=_nex.assets.soundManager,b._popupManager=_nex.assets.popupManager,b._phase=a,b._action=0,b._debugEnabled=!0,b._debug=function(){b._debugEnabled&&console.debug(arguments)},b.updateUI=function(){b._action=b.ACTION_NEWORDER,b._newOrderButton||($("#repeatOrderPromptText").html(b._theme.getTextAttribute("REPEATORDERS","prompttitle","")),b.bindOptions(),b.showOptions())},b.showOptions=function(){$("#repeatOrderPrompt").show()},b.hideOptions=function(){$("#repeatOrderPrompt").hide()},b.isPinOrderLookup=function(){var a=!1,c=b._theme;return c.system&&c.system.PREVIOUSORDERS&&c.system.PREVIOUSORDERS.hasOwnProperty("orderlookup")&&"true"===c.system.PREVIOUSORDERS.orderlookup.toLowerCase()&&(a=!0),a},b.bindOptions=function(){var a="repeatorderprompt-newOrderButton",c="repeatorderprompt-repeatButton",d="repeatorderprompt-orderPinButton",e="repeatorderprompt-cancelButton",f=_nex.utility.buttonBinder,g="";if(g=b._theme.getTextAttribute("REPEATORDERS","neworderbutton","Start a New Order"),f.bind(a,g,b.onNewOrder),g=b._theme.getTextAttribute("REPEATORDERS","repeatorderbutton","Repeat a Previous Order"),f.bind(c,g,b.onRepeat),b.isPinOrderLookup())g=b._theme.getTextAttribute("REPEATORDERS","orderpinbutton","I have an Order PIN"),f.bind(d,g,b.onOrderPin);else{var h=$("#"+d);h.hide()}g=b._theme.getTextAttribute("REPEATORDERS","cancelbutton","Cancel"),f.bind(e,g,b.onCancel)},b.onNewOrder=function(){b._action=b.ACTION_NEWORDER,b["continue"]()},b.onRepeat=function(){b._action=b.ACTION_REPEAT,b["continue"]()},b.onOrderPin=function(){b._action=b.ACTION_ORDERPIN,b["continue"]()},b.onCancel=function(){b._action=b.ACTION_CANCEL,b["continue"]()},b["continue"]=function(){switch(b._debug("Continue with action: "+b._action),b._action){case b.ACTION_NEWORDER:b._phase.gotoOrdering();break;case b.ACTION_REPEAT:b.hideOptions(),b._phase.showLookupOptions();break;case b.ACTION_ORDERPIN:_nex.previousOrders.onlineOrder=new OnlineOrder(b._theme),_nex.previousOrders.onlineOrder.getPinFromNumPad();break;default:_nex.manager.cancelCurrentPhase()}},b._trackControlClick=function(a){var b="",c=a.text(),d="",e="control",f="";_nex.utility.buttonTracking.track(b,c,d,f,e)}}function BasePaymentClip(a,b,c){var d=this;d._allowCardSwipes=!1,d._waitingOnUpdate=!1,d._createdTender=!1,d._gratuityEnabled=!1,d._gratuityShown=!1,d._paymentClipXml=a,d._paymentTarget=b,d._paymentText=c,d._paymentMedia=null,d.backButtonVisible=function(){return!0},d.cancelButtonVisible=function(){return!0},d.continueButtonVisible=function(){return!1},d.requestServerButtonVisible=function(){return!0},d.load=function(){}}function CashPaymentClip(a,b,c){var d=this;BasePaymentClip.call(d,a,b,c),d.someNewProperty="test"}function CounterPaymentClip(){var a=this;a._elementId="paymentclip-counter",a.isAvailable=function(){return!0},a.isTracked=function(){return!1},a.backButtonVisible=function(){return!1},a.cancelButtonVisible=function(){return!1},a.continueButtonVisible=function(){return!1},a.load=function(){},a.dispose=function(){},a.show=function(){var a=new TenderCounter;_nex.payment.processOrder(a)},a.hide=function(){}}function CouponPaymentClip(){var a=this;a._elementId=paymentConstants.COUPON_CLIP_ELEMENT_ID,a._paymentDeviceFlow=null,a.tender=null,a.enableDebug=!1,a._debug=function(b){a.enableDebug&&console.debug(b)},a.show=function(){$("#"+paymentConstants.SELECT_CLIP_ELEMENT_ID).hide(),a._showSwipeMessage();var b=_nex.assets.theme.getHardwareType();a._updateSwipeImage(b),$("#"+a._elementId).show(),_nex.utility.deviceListener&&_nex.utility.deviceListener.stop(),_nex.utility.deviceListener=new DeviceListener("BARCODE",a._lastKeyFound,!0),_nex.utility.deviceListener.start()},a._showSwipeMessage=function(){var a=$("#txtScanCoupon");a.length>0&&(a.empty(),a.append(_nex.assets.theme.getTextAttribute("PAYMENT","scanCoupon","Please Scan Your Coupon")))},a._updateSwipeImage=function(a){if(a.length>0){var b=$("#swipeTarget");b.length>0&&b.addClass(a)}},a.hide=function(){$("#"+a._elementId).hide(),_nex.utility.deviceListener&&_nex.utility.deviceListener.stop()},a.reset=function(){a.hide(),a.show()},a._lastKeyFound=function(b){_nex.payment.deviceData=b;var c=_nex.assets.theme.getTenderByType("coupon");c?_nex.assets.theme.isValidationRequired(c)?(a._debug("validation required; prompting for pin"),a._promptForPin()):(a._debug("validation not required"),_nex.payment.couponInquiry("")):(console.log("Configuration Error: No tender for coupon found!"),a._genericError(a.reset))},a._promptForPin=function(){var a=$.extend(!0,{},_nex.assets.popupManager.pinpadPopup);a.buttons[0].clickEvent="_nex.payment.couponInquiry(_nex.keyboard.numpad.data);",a.message=_nex.assets.theme.getTextAttribute("ORDER","couponpin","Please enter your PIN"),_nex.assets.popupManager.showPopup(a),_nex.keyboard.numpad.bindKeys()}}function CreditPaymentClip(){var a=this;a._elementId=paymentConstants.CREDIT_CLIP_ELEMENT_ID,a._cardListener=null,a._paymentDeviceFlow=null,a.MAX_CARD_TYPE=7,a.defaultVoiceover="Swipe Card Now.mp3",a.show=function(){$("#"+paymentConstants.SELECT_CLIP_ELEMENT_ID).hide(),$("#"+a._elementId).show();var b=_nex.assets.theme.getHardwareType();a._updateSwipeImage(b),_nex.payment.usesPaymentDevice()?(a._paymentDeviceFlow=new PaymentDeviceFlow(_nex.payment.numAvailableTenders),a._paymentDeviceFlow.start()):(a._listenForSwipe(),a._showSwipeMessage(),a._showAcceptedCardTypes())},a.hide=function(){var b=document.getElementById(a._elementId);b&&(b.style.display="none"),_nex.payment.usesPaymentDevice()?null!==a._paymentDeviceFlow&&a._paymentDeviceFlow.stop():a._stopListening()},a._showSwipeMessage=function(){var a=$("#swipeCard");a.length>0&&(a.empty(),a.append(_nex.assets.theme.getTextAttribute("PAYMENT","swipe","Please Swipe Your Credit Card")))},a._updateSwipeImage=function(a){if(a.length>0){var b=$("#swipeTarget");b.length>0&&b.addClass(a)}},a._showAcceptedCardTypes=function(){var b=$("#acceptedCards");b.length>0&&(b.empty(),b.append(_nex.assets.theme.getTextAttribute("PAYMENT","accepted","Accepted Credit Cards")));var c=$("#cards");if(c.length>0){for(var d=_nex.assets.theme.system.CREDITCARD,e=0,f=0;f<d.length;f++)if("true"===d[f].accept.toString().toLowerCase()&&-1===d[f].code.toString().toLowerCase().indexOf("loyalty")){var g=c.find("#card"+e);g.length>0&&(g.addClass(d[f].code.toLowerCase()),e++)}for(var h=e;h<a.MAX_CARD_TYPE;h++){var i=c.find("#card"+h);i.length>0&&i.css("display","none")}}},a._listenForSwipe=function(){null!==a._cardListener&&a._cardListener.stopListening(),a._cardListener=new CardListener(a._lastKeyFound),a._cardListener.startListening()},a._lastKeyFound=function(b){a._cardListener.stopListening();var c=new TenderCredit;c.update(b.track1,b.track2),c.cardData?_nex.payment.processOrder(c):_nex.payment.showErrorPopup(_nex.payment.textSwipeError(),_nex.payment.start())},a._stopListening=function(){a._cardListener.stopListening()}}function EmployeePaymentClip(){var a=this;a._elementId=paymentConstants.EMPLOYEE_CLIP_ELEMENT_ID,a._paymentDeviceFlow=null,a.show=function(){$("#"+paymentConstants.SELECT_CLIP_ELEMENT_ID).hide(),a._showSwipeMessage();var b=_nex.assets.theme.getHardwareType();a._updateSwipeImage(b),$("#"+a._elementId).show(),a._listenForSwipe()},a._showSwipeMessage=function(){var a=$("#txtSwipeCard");a.length>0&&(a.empty(),a.append(_nex.assets.theme.getTextAttribute("PAYMENT","employeeswipe","Please Swipe Your Employee Card")))},a._updateSwipeImage=function(a){if(a.length>0){var b=$("#swipeTarget");b.length>0&&b.addClass(a)}},a.showPinPrompt=function(a){var b=$.extend(!0,{},_nex.assets.popupManager.pinpadPopup);b.buttons[0].clickEvent="_nex.payment.processEmployeeCard('"+htmlEscape(a)+"');",b.message=_nex.assets.theme.getTextAttribute("ORDER","employeepin","Please enter your PIN"),_nex.assets.popupManager.showPopup(b),_nex.keyboard.numpad.bindKeys()},a.hide=function(){$("#"+a._elementId).hide(),a._stopListening()},a._listenForSwipe=function(){_nex.utility.deviceListener=new DeviceListener("ALL",a._lastKeyFound),_nex.utility.deviceListener.start()},a._lastKeyFound=function(b){_nex.utility.deviceListener.stop();var c=_nex.assets.theme.getTenderByType("employee"),d="true"===c.validate,e=b.track2?b.track2:b;d?a.showPinPrompt(e):_nex.payment.processEmployeeCard(e)},a._stopListening=function(){null!==_nex.utility.deviceListener&&_nex.utility.deviceListener.stop()}}function GAIncliningBalancePaymentClip(a){var b=this;b._gaIncliningBalanceId=a,b._elementId=paymentConstants.GAINCLININGBALANCE_CLIP_ELEMENT_ID,b._tenderType="gaincliningbalancetender"+a.toString(),b._guestAccountLocal=_nex.guestAccount.getGuestAccountLocalByPaymentClipTenderType(b._tenderType),b._guestAccountLocalTypeId=b._guestAccountLocal.guestAccountLocalTypeId,b._genericTenderId=b._guestAccountLocal.genericTenderId,b._paymentTypeId=Number(b._guestAccountLocal.genericTenderIndex)+50,b._enableDebugging=!0,b._debug=function(a){b._enableDebugging&&console.debug(a)},b.show=function(){$("#"+paymentConstants.SELECT_CLIP_ELEMENT_ID).hide(),$("#paymentclip-"+b._tenderType).show(),$("#"+b._elementId).show();var a=_nex.assets.theme.getGenericTenderByType(b._genericTenderId);_nex.assets.theme.isKioskValidationRequired(a)?(b._debug("generic tender validation required; prompting for pin"),b.promptForPin()):_nex.payment.genericInquiry(b._guestAccountLocal.pin,b._guestAccountLocalTypeId,b._paymentTypeId,b._guestAccountLocal.accountNumber)},b.hide=function(){$("#"+b._elementId).hide(),$("#paymentclip-"+b._tenderType).hide()},b.reset=function(){b.hide(),b.show()},b.promptForPin=function(){var a=$.extend(!0,{},_nex.assets.popupManager.pinpadPopup);a.buttons[0].clickEvent='_nex.payment.genericInquiry(_nex.keyboard.numpad.data, "'+b._guestAccountLocalTypeId.toString()+'",'+b._paymentTypeId.toString()+', "'+b._guestAccountLocal.accountNumber+'");',a.buttons[1].clickEvent="_nex.payment._paymentManager._currentClip.show();",a.message=_nex.assets.theme.getTextAttribute("ORDER","genericpin","Please enter your PIN"),_nex.assets.popupManager.showPopup(a),_nex.keyboard.numpad.bindKeys()}}function GenericPaymentClip(a){var b=this;b._genericTenderId=a,b._elementId=paymentConstants.GENERIC_CLIP_ELEMENT_ID,b._guestAccountLocalTypeId="",b._tenderType="generictender"+a.toString(),b._paymentTypeId=Number(a)+50;var c=_nex.assets.theme.getGenericTenderByType(b._tenderType);c.guestaccountlocaltypeid&&(b._guestAccountLocalTypeId=c.guestaccountlocaltypeid),b.tender=null,b.enableDebug=!0,b._debug=function(a){b.enableDebug&&console.debug(a)},b.show=function(){$("#"+paymentConstants.SELECT_CLIP_ELEMENT_ID).hide(),b._showSwipeMessage();var a=_nex.assets.theme.getHardwareType();b._updateSwipeImage(a),$("#paymentclip-"+b._tenderType).show(),$("#"+b._elementId).show(),_nex.utility.deviceListener&&_nex.utility.deviceListener.stop(),_nex.utility.deviceListener=new DeviceListener("ALL",b._lastKeyFound,!0),_nex.utility.deviceListener.start()},b._showSwipeMessage=function(){var a=$("#txtSwipeCard");a.length>0&&(a.empty(),a.append(_nex.assets.theme.getTextAttribute("PAYMENT","scan"+b._genericTenderId,"Please Scan Your Badge")))},b._updateSwipeImage=function(a){if(a.length>0){var b=$("#swipeTarget");b.length>0&&b.addClass(a)}},b.hide=function(){$("#"+b._elementId).hide(),$("#paymentclip-"+b._tenderType).hide(),_nex.utility.deviceListener&&_nex.utility.deviceListener.stop()},b.reset=function(){b.hide(),b.show()},b._lastKeyFound=function(a){_nex.payment.deviceData=a;var c=_nex.assets.theme.getGenericTenderByType(b._tenderType);c?_nex.assets.theme.isKioskValidationRequired(c)?(b._debug("generic tender validation required; prompting for pin"),b._promptForPin()):(b._debug("generic tender validation not required"),_nex.payment.genericInquiry("",b._guestAccountLocalTypeId,b._paymentTypeId)):(console.log("Configuration Error: No tender for generic found!"),b._genericError(b.reset))},b._promptForPin=function(){var a=$.extend(!0,{},_nex.assets.popupManager.pinpadPopup);a.buttons[0].clickEvent="_nex.payment.genericInquiry(_nex.keyboard.numpad.data, '"+b._guestAccountLocalTypeId.toString()+"',"+b._paymentTypeId.toString()+");",a.buttons[1].clickEvent="_nex.payment._paymentManager._currentClip.show();",a.message=_nex.assets.theme.getTextAttribute("ORDER","genericpin","Please enter your PIN"),_nex.assets.popupManager.showPopup(a),_nex.keyboard.numpad.bindKeys()}}function LoyaltyPaymentClip(){var a=this;a._elementId=paymentConstants.LOYALTY_CLIP_ELEMENT_ID,a._paymentDeviceFlow=null,a.tender=null,a.enableDebug=!1,a._debug=function(b){a.enableDebug&&console.debug(b)},a.show=function(){$("#"+paymentConstants.SELECT_CLIP_ELEMENT_ID).hide(),a._showSwipeMessage();var b=_nex.assets.theme.getHardwareType();a._updateSwipeImage(b),$("#"+a._elementId).show(),_nex.utility.deviceListener&&_nex.utility.deviceListener.stop(),_nex.utility.deviceListener=new DeviceListener("ALL",a._lastKeyFound,!0),_nex.utility.deviceListener.start()},a._showSwipeMessage=function(){var a=$("#txtSwipeCard");a.length>0&&(a.empty(),a.append(_nex.assets.theme.getTextAttribute("PAYMENT","scan","Please Swipe Your Loyalty Card")))},a._updateSwipeImage=function(a){if(a.length>0){var b=$("#swipeTarget");b.length>0&&b.addClass(a)}},a.hide=function(){$("#"+a._elementId).hide(),_nex.utility.deviceListener&&_nex.utility.deviceListener.stop()},a.reset=function(){a.hide(),a.show()},a._lastKeyFound=function(b){_nex.payment.deviceData=b;var c=_nex.assets.theme.getTenderByType("loyalty");c?_nex.assets.theme.isValidationRequired(c)?(a._debug("validation required; prompting for pin"),a._promptForPin()):(a._debug("validation not required"),_nex.payment.loyaltyInquiry("")):(console.log("Configuration Error: No tender for loyalty found!"),a._genericError(a.reset))},a._promptForPin=function(){var a=$.extend(!0,{},_nex.assets.popupManager.pinpadPopup);a.buttons[0].clickEvent="_nex.payment.loyaltyInquiry(_nex.keyboard.numpad.data);",a.buttons[1].clickEvent="_nex.payment._paymentManager._currentClip.show();",a.message=_nex.assets.theme.getTextAttribute("ORDER","loyaltypin","Please enter your PIN"),_nex.assets.popupManager.showPopup(a),_nex.keyboard.numpad.bindKeys()}}function LoyaltyPromptClip(a){var b=this;b._elementId=paymentConstants.LOYALTY_CLIP_ELEMENT_ID,b._cardListener=null,b.cardData=null,b._pinData="";var c=!0;b._debug=function(a){c&&console.debug("LoyaltyPrompt",a)},b._promptIsForLoyalty2=function(){return 2==_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard},b._updateControlButtons=function(){var a=$("#ctrl-cancel");a.length>0&&(_nex.assets.theme.setControlButtonText("ctrl-cancel",_nex.assets.theme.getTextAttribute("ORDER","cancel","CANCEL")),a.removeClass("control-button-hidden"),a.attr("onclick",""),a.unbind("click"),a.click(function(){b._cancelButtonClicked(a)}),a.attr("tabindex","-1"));var c=$("#ctrl-back");c.length>0&&(_nex.assets.theme.setControlButtonText("ctrl-back",_nex.assets.theme.getTextAttribute("ORDER","back","BACK")),c.removeClass("control-button-hidden"),c.attr("onclick",""),c.unbind("click"),c.click(function(){b._backButtonClicked(c)}),c.attr("tabindex","3"));var d=$("#ctrl-skip");d.length>0&&(_nex.assets.theme.setControlButtonText("ctrl-skip",_nex.assets.theme.getTextAttribute("ORDER","skip","SKIP")),d.removeClass("control-button-hidden"),d.attr("onclick",""),d.unbind("click"),d.click(function(){b._skipButtonClicked(d)}),d.attr("tabindex","4"))},b._cancelButtonClicked=function(a){_nex.assets.soundManager.playButtonHit(),_nex.ordering.cancelOrderPrompt()},b._backButtonClicked=function(a){_nex.assets.soundManager.playButtonHit(),_nex.payment.backButton()},b._skipButtonClicked=function(a){_nex.assets.soundManager.playButtonHit(),_nex.payment._route(_nex.splashPhase.userSwipedToStart,!0)},b.show=function(){$("#"+paymentConstants.SELECT_CLIP_ELEMENT_ID).hide(),b._showSwipeMessage();var a=_nex.assets.theme.getHardwareType();b._updateSwipeImage(a),$("#"+b._elementId).show(),_nex.utility.deviceListener&&_nex.utility.deviceListener.stop(),_nex.utility.deviceListener=new DeviceListener("ALL",b._lastKeyFound,!0),_nex.utility.deviceListener.start(),b._listenForSwipe(),b._updateControlButtons()},b._showSwipeMessage=function(){var a=$("#txtSwipeCard");a.length>0&&(a.empty(),a.append(_nex.assets.theme.getTextAttribute("PAYMENT","scan","Please Swipe Your Loyalty Card")))},b._updateSwipeImage=function(a){if(a.length>0){var b=$("#swipeTarget");b.length>0&&b.addClass(a)}},b.hide=function(){var a=document.getElementById(b._elementId);a&&(a.style.display="none")},b._showSwipeMessage=function(){var a=$("#swipeCard");a.length>0&&(a.empty(),a.append(_nex.assets.theme.getTextAttribute("PAYMENT","swipe","Please Swipe Your Credit Card")))},b._listenForSwipe=function(){null!==b._cardListener&&b._cardListener.stopListening(),b._cardListener=new CardListener(b._lastKeyFound),b._cardListener.startListening()},b._promptForPin=function(a,c){b._debug("_promptForPin");var d=$.extend(!0,{},_nex.assets.popupManager.pinpadPopup);d.buttons[0].clickEvent="_nex.payment.loyaltyInquiry(_nex.keyboard.numpad.data, _nex.payment.promptForLoyalty2());",d.buttons[1].clickEvent="_nex.payment._paymentManager._currentClip.show();",d.message=_nex.assets.theme.getTextAttribute("ORDER","loyaltypin","Please enter your PIN"),_nex.assets.popupManager.showPopup(d),_nex.keyboard.numpad.bindKeys()},b._lastKeyFound=function(a){b._cardListener.stopListening(),_nex.payment.deviceData=a;var c=_nex.assets.theme.getTenderByType("loyalty");if(c)if(_nex.assets.theme.isValidationRequired(c))b._debug("validation required; prompting for pin"),b._promptForPin(a.track1,a.track2);else{b._debug("validation not required");var d=2==_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard;_nex.payment.loyaltyInquiry("",d)}}}function SelectPaymentClip(){var a=this;a._elementId=paymentConstants.SELECT_CLIP_ELEMENT_ID,a.defaultVoiceover="Select Payment.mp3",a.enableDebugging=!0,a._debug=function(){a.enableDebugging&&console.debug("SelectPaymentClip",arguments)},a.show=function(){console.debug("SelectPaymentClip.show with element "+a._elementId);var b=document.getElementById(a._elementId);if(!b)throw"Missing element "+a._elementId;$("#"+a._elementId).show()},a._checkForCreditTender=function(){var a=!0,b=-1,c=_nex.assets.theme.tendersAvailable();return $.inArray("credit",c)===b&&(a=!1),a},a._checkForLoyaltyTender=function(){var a=!0,b=-1,c=_nex.assets.theme.tendersAvailable();return $.inArray("loyalty",c)===b&&(a=!1),a},a.hide=function(){$("#"+a._elementId).hide(),_nex.utility.deviceListener&&_nex.utility.deviceListener.stop()},a._lastKeyFound=function(b){_nex.utility.deviceListener&&_nex.utility.deviceListener.stop(),a._debug(b),a._checkSwipeData(b.track1,b.track2)},a._checkSwipeData=function(b,c){var d=new CardParser(_nex.assets.theme);a._debug("_checkSwipeData, parsing card"),d.parse(b,c,a._goodSwipe,a._badSwipe)},a._goodSwipe=function(b){if(a._debug("goodSwipe method"),b.isLoyalty()){a._debug("goodSwipe","User swiped a loyalty card."),a.tenderType="loyalty";var c=new LoyaltyPaymentClip;c._lastKeyFound(b)}else{a._debug("credit"),a._debug("goodSwipe","User swiped a credit card.");var d=new TenderCredit;d.update(b.track1,b.track2),d.cardData?_nex.payment.processOrder(d):a._debug("bad")}},a._badSwipe=function(){a._debug("badSwipe method"),_nex.payment.showErrorPopup(_nex.payment.textSwipeError(),_nex.payment.start())}}function _BaseTender(){var a=this;a._amount=0,a._tenderType="",a._tenderTypeCode=0,a._tenderName="",a._isAuthorized=!1,a._tenderDiscount=0,a._usedAsPayment=!1,a._errorMessage="",a._allowGratuity=!1,a._isValidated=!1,a._saveTender=!0,a._validationData="",a._tenderXml="",a._paymentText="",a._currentValidateSequence=0,a._maxValidates=1,a._validationDataBySequence=null,a._overrideAllreadyUsed=!1,a._isCharged=!1,a._discountXml="",a._showProcessingOnPreAuth=!0,a.isFinalTender=function(){},a.isPreAuthRequired=function(){},a.write=function(){var b={type:a._tenderType,typeCode:a._tenderTypeCode},c=a._write(b);return c}}function TenderCash(){var a=this;a._tenderType=paymentConstants.TENDER_CASH,a._tenderTypeCode="2",a._baseTender=new BaseTender}function TenderCounter(){_BaseTender.call(this);var a=this;a._tenderType=paymentConstants.TENDER_COUNTER,a._tenderTypeCode="0",a._write=function(a){return a.COUNTER={},a}}function TenderCoupon(a,b,c){var d=this;_BaseTender.call(d),d._tenderType=paymentConstants.TENDER_COUPON,d._tenderTypeCode="4",d._responseData=null,d.isValidAccount=function(){return d._responseData?d._responseData.success:!1},d.deductionAmount=function(a){var b=0;return b=2==d._responseData.deductiontype?d._responseData.amount/100*a:d._responseData.amount,d._responseData.amount=b,b},d.update=function(a){var b={};b.success="success"===a.status.toLowerCase(),b.couponnumber=a.number?a.number:"",b.amount=a.value?a.value:"",b.deductiontype=a.type?a.type:"",d._responseData=b},d._write=function(a){return a.COUPON={},a.COUPON.tendercode=d._responseData.couponnumber,a.COUPON.amount=d._responseData.amount,a.COUPON.deductiontype=d._responseData.deductiontype,a.COUPON.paymenttypeid=d._tenderType,a}}function TenderCredit(a){_BaseTender.call(this);var b=this;b._tenderType=paymentConstants.TENDER_CREDIT,b._tenderTypeCode="1",b._amount=0,"number"==typeof a&&a&&a>0&&(b._amount=a),b.cardData={},b.isFinalTender=function(){return!0},b.update=function(a,c){var d=new CardParser(_nex.assets.theme),e=d.parse(a,c);b.cardData=e},b.setCardData=function(a){b.cardData=new CardData,b.cardData.cardNumber=a.CardNumber,b.cardData.expMonth=a.ExpMonth,b.cardData.expYear=a.ExpYear,b.cardData.cardType=a.CardType,b.cardData.firstName=a.FirstName,b.cardData.lastName=a.LastName,b.cardData.track1=a.Track1,b.cardData.track2=a.Track2,b.cardData.userData=a.UserData,b.cardData.userDataLength=b.cardData.userData.length},b._write=function(a){return a.CREDITCARD={},a.CREDITCARD.CardNum=b.cardData.cardNumber,a.CREDITCARD.CardExpMonth=b.cardData.expMonth,a.CREDITCARD.CardExpYear=b.cardData.expYear,a.CREDITCARD.CardType=b.cardData.cardType,a.CREDITCARD.Track1=null!=b.cardData.track1?b.cardData.track1:"",a.CREDITCARD.Track2=null!=b.cardData.track2?b.cardData.track2:"",a.CREDITCARD.UserData=null!=b.cardData.userData?b.cardData.userData:"",a.CREDITCARD.TaxExempt=b.cardData.isTaxExempt,a.CREDITCARD.cardid=b.cardData.cardId,a.CREDITCARD.billingstreet=b.cardData.billingStreet,a.CREDITCARD.billingzip=b.cardData.billingZip,b.cardData.firstName.length>0?a.CREDITCARD.NameOnCard=b.cardData.firstName+" "+b.cardData.lastName:a.CREDITCARD.NameOnCard=b.cardData.lastName,a}}function TenderDebit(){_BaseTender.call(this);var a=this;a._tenderType=paymentConstants.TENDER_DEBIT,a._tenderTypeCode="3"}function TenderDiscount(){var a=this;a._tenderType=paymentConstants.TENDER_DISCOUNT,a._tenderTypeCode="9"}function TenderEmployee(){_BaseTender.call(this);var a=this;a._tenderType=paymentConstants.TENDER_EMPLOYEE,a._tenderTypeCode="7",a._employeeNumber="",a._employeePIN="",a._employeeName="",a._response=null,a.updateNumber=function(b){a._employeeNumber=b},a.updatePin=function(b){a._employeePIN=b},a.getEmployeeNumber=function(){return a._employeeNumber},a.getEmployeePIN=function(){return a._employeePIN},a.updateResponse=function(b){a._response=b},a._write=function(b){return b.EMPLOYEE={},b.EMPLOYEE.number=a._employeeNumber,b.EMPLOYEE.userdata=a._employeePIN,b.EMPLOYEE.name=a._employeeName,null!=a._response&&(b.EMPLOYEE.EMPLOYEERESPONSE=a._response),b}}function TenderGeneric(a,b,c){var d=this;_BaseTender.call(d);var e=Number(a)-50;d._tenderType="generictender"+e.toString(),d._tenderTypeCode=a,d._responseData=null,d._accountNumber=b,d._pin=c,d.isValidAccount=function(){return d._responseData?d._responseData.success:!1},d.remainingBalance=function(){return d._responseData.maxcharge},d.hasBalance=function(){var a=!1;return d._responseData.maxcharge>0&&(a=!0),a},d.update=function(a){var b={};b.success="true"===a.success,b.guestaccountid=a.guestaccountid?a.guestaccountid:"",b.name=a.name?a.name:"",b.email=a.email?a.email:"",b.guestaccountlocalid=a.guestaccountlocalid?a.guestaccountlocalid:"",b.usage=a.usage?a.usage:"",b.usagebalance=a.usagebalance?a.usagebalance:"",b.usagelimit=a.usagelimit?a.usagelimit:"",b.maxcharge=a.maxcharge?Number(a.maxcharge):0,b.totalmax=a.totalmax?Number(a.totalmax):0,b.offline=a.offline?a.offline.toString():"",d._responseData=b},d._write=function(a){return a.GENERIC={},a.GENERIC.accountnumber=d._accountNumber,a.GENERIC.guestaccountid=d._responseData.guestaccountid,a.GENERIC.guestaccountlocalid=d._responseData.guestaccountlocalid,a.GENERIC.name=d._responseData.name,a.GENERIC.paymenttypeid=d._tenderType,a.GENERIC.pin=d._pin,a.GENERIC.usage=d._responseData.usage?d._responseData.usage:"",a.GENERIC.GENERICINQUIRYRESPONSE=d._responseData,a}}function TenderLoyalty(){var a=this;_BaseTender.call(a),a._tenderType=paymentConstants.TENDER_LOYALTY,a._tenderTypeCode="5",a._cardData=null,a._offerPercent="percent",a._offerValue="value",a._hasOffers=!1,a._noOffersReturnedFromInquiry=!1,a._availableOffers=null,a._matchedOffers=[],a._selectedOffers=[],a.LOYALTYRESPONSE={},a.setCardData=function(b){a._cardData=b},a.isValidAccount=function(){var b=!1;return a.LOYALTYRESPONSE&&a.LOYALTYRESPONSE.number&&(b=!0),b},a.remainingBalance=function(){return a.LOYALTYRESPONSE.value},a.hasBalance=function(){var b=!1;return a.LOYALTYRESPONSE.value>0&&(b=!0),b},a.hasMultipleValues=function(){var b=!1;return a.LOYALTYRESPONSE.multiplevalues&&(b=!0),b},a.isCharged=function(){return a.LOYALTYRESPONSE.ischarged},a.getValue=function(){return a.LOYALTYRESPONSE.value},a.setValue=function(b){a.LOYALTYRESPONSE.value=b},a.hideProcessingPopup=function(a){_nex.assets.popupManager.hidePopup(_nex.assets.popupManager.processingPopup,a)},a.update=function(b){var c={};c.ischarged="true"===b.ischarged,c.isoffline="true"===b.isoffline,c.name=b.name?b.name:"",c.number=b.number?b.number:"",c.CardNum=b.number?b.number:"",c.CardType=b.cardType?b.cardType:"LOYALTY",c.responseReceived=b.responseReceived?b.responseReceived:"",c.status=b.status?b.status:"",c.usedphone=b.usedphone?b.usedphone:"",c.value=b.value?b.value:"",c.totalamount=b.value?b.value:"",c.multiplevalues="true"===b.multiplevalues,c.DISCOUNTS={},b.hasOwnProperty("DISCOUNTS")&&b.DISCOUNTS.hasOwnProperty("DISCOUNT")&&(c.DISCOUNTS=b.DISCOUNTS,console.log("UPDATING DISCOUNT ",c.discount)),c.OFFERS={OFFER:[]},a._hasOffers=!1,a._noOffersReturnedFromInquiry=!1,b.hasOwnProperty("OFFERS")&&b.OFFERS.hasOwnProperty("OFFER")?(a._matchedOffers=[],a._availableOffers=b.OFFERS.OFFER,a._populateOffers(b.OFFERS.OFFER),c.OFFERS.OFFER=a._matchedOffers,a._hasOffers=a._matchedOffers.length>0):a._noOffersReturnedFromInquiry=!0,a._hasOffers&&(c.value=a._calculateOfferValue()),a.LOYALTYRESPONSE=c},a._calculateOfferValue=function(){var b=0;return a._matchedOffers.forEach(function(c){c.type===a._offerPercent?b+=a._calculatePercentOff(c.price,c.value):c.type===a._offervalue?b+=a._calculateAmountOff(c.price,c.value):console.log("Unknown Offer Type ",c.type)}),b},a._calculatePercentOff=function(a,b){var c=Number(b);return c>1&&(c=NumericUtilities.CorrectMathError(c/100)),c*a},a._calculateAmountOff=function(a,b){var c=Number(b);return a-c},a._write=function(b){return b.LOYALTY={LOYALTYRESPONSE:a.LOYALTYRESPONSE},b},a._offersPopup=function(b,c){var d=$.extend(!0,{},_nex.assets.popupManager.offersPopup);return d.hasOwnProperty("message")?(a._hasOffers?($("#popup-offers").on("show.bs.modal",function(b){a._showOffers(b,c)}),d.message=_nex.assets.theme.getTextAttribute("OFFERS","hasoffersmessage","Congratulations you have offers!")):($("#popup-offers").on("show.bs.modal",function(b){a._clearOffers(b)}),d.message=_nex.assets.theme.getTextAttribute("OFFERS","hasnooffersmessage","Sorry no offers found!")),d.buttons[0].clickEvent="addSelectedLoyalty();",d.buttons[0].text=_nex.assets.theme.getTextAttribute("ORDER","ok","OK"),void _nex.assets.popupManager.showPopup(d)):void console.log("Offers Popup Not Found","")},a._clearOffers=function(a){var b=$(a.target),c=b.find("#offer1");c.text(""),c.nextAll().remove()},a._showOffers=function(b,c){var d=$(b.target),e=d.find("#offer1"),f=d.find("#noOffer"),g=!1;
f.hide(),e.nextAll().remove(),Array.isArray(c)||(c=[c]),Array.isArray(c)?(c.forEach(function(b){if(g=a._matchedOffers,-1!==a._matchedOffers.indexOf(b)||"all"===b.producttype){var c=d.find("#offer1:last"),f="";"Reward Dollars"===b.name&&(f=" - $"+parseFloat(b.qty).toFixed(2));var h='<input type="checkbox" class="check" id="checked-'+b.id+'" checked><label class="offer-item" onclick="rewardClick('+b.id+');" for="checked-'+b.id+'">'+b.name+f+"</div>";$(c).html(h),a._selectedOffers.push(b.id),e.clone().insertAfter("#offer1:last")}}),e.last().remove()):0===a._matchedOffers.length&&f.show()},a.addNonPaymentTender=function(){var b=$.extend({},a),c=(new _nex.commands.ProcessLoyalty(b,0),"loyalty"),d=new _nex.commands.AddTender("loyalty");_nex.communication.send(d,function(a){if(a.added){b.LOYALTYRESPONSE.value=0,2==_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard&&(c="loyalty2"),b.LOYALTYRESPONSE.CardType=c.toUpperCase();var d=new _nex.commands.ProcessLoyalty(b,0);_nex.communication.send(d,function(a){_nex.payment.handleLoyaltyResponse(a,b)},"PROCESSLOYALTYRESPONSE")}},"TENDERADDED")},addSelectedLoyalty=function(){var b=[];if(0==a._selectedOffers.length)a.addNonPaymentTender(),_nex.payment._route(_nex.splashPhase.userSwipedToStart,!0);else{for(var c=0;c<a._selectedOffers.length;c++){var d,e=a._selectedOffers[c];if(Array.isArray(a._availableOffers)){for(var f=0;f<a._availableOffers.length;f++)if(a._availableOffers[f].id==e){d=a._availableOffers[f];break}}else a._availableOffers.id==e&&(d=a._availableOffers);null!=d&&b.push(d)}var g=$.extend({},a);g._amount=d.price,g._isAuthorized=!0,g._isValidated=!0,g.LOYALTYRESPONSE.OFFERS.OFFER=b;var h="loyalty",i=new _nex.commands.AddTender(h);_nex.communication.send(i,function(b){if(b.added){d.used="1",2==_nex.manager.theme.kiosk.PAYMENTPROFILE.promptforrewardscard&&(h="loyalty2"),g.LOYALTYRESPONSE.CardType=h.toUpperCase();var c=new _nex.commands.ProcessLoyalty(g,d.price);_nex.communication.send(c,function(b){a.handleLoyaltyResponse(b,g)},"PROCESSLOYALTYRESPONSE")}},"TENDERADDED"),_nex.payment._route(_nex.splashPhase.userSwipedToStart,!0)}},a._showBalanceMessage=function(a){var b=$.extend(!0,{},_nex.assets.popupManager.messagePopup);b.message=a,_nex.assets.popupManager.showPopup(b)},a.handleLoyaltyResponse=function(b,c){if(b.ORDER&&_nex.orderManager.currentOrder.update(b.ORDER),"ENOUGH_COLLECTED"===b.message)console.log("Payment: Enough has been collected... Going to process order."),_nex.payment.processOrder();else{var d=b.amount?b.amount:0,e=_nex.orderManager.currentOrder.totals.remainingbalance(),f=_nex.assets.theme.getTextAttribute("PAYMENT","amountauthorized","${0} Applied.  ${1} Remaining");f=f.replace("{0}",d),f=f.replace("{1}",e),a._showBalanceMessage(f),a._hideBackButton()}},a._hideBackButton=function(){var a=$("#ctrl-back");a.length>0&&a.addClass("control-button-hidden")},rewardClick=function(b){var c=a._selectedOffers.indexOf(b.toString());-1==c?a._selectedOffers.push(b.toString()):a._selectedOffers.splice(c,1)},a._populateOffers=function(b){Array.isArray(b)||(b=[b]),Array.isArray(b)&&b.forEach(function(b){a._matchOffersWithCurrentOrder(b)})},a._matchOffersWithCurrentOrder=function(b){var c=_nex.orderManager.currentOrder.ITEM,d=Array.isArray(c),e={};return d&&(e=$.grep(c,function(a){return a.posid===b.posid}),(e.length>0||"all"===b.producttype)&&(e.length>0&&(b.price=e[0].price,b.quantity=e[0].quantity),a._matchedOffers.push(b))),e.length>0}}function TenderRoomCharge(){var a=this;a._tenderType=paymentConstants.TENDER_ROOMCHARGE,a._tenderTypeCode="6"}if("undefined"==typeof jQuery)throw new Error("NEXTEP JavaScript Client requires jQuery");var _nex={assets:{buttons:{},buttonFactory:null,offline:null,popupManager:null,phaseManager:null,soundManager:null,templateManager:null,theme:null},commands:{},commmunication:null,completing:null,complete:null,device:null,keyboard:{keypad:null,numpad:null,phonepad:null,pagerpad:null,namepad:null},manager:null,ordering:null,payment:null,previousOrders:null,sms:null,greenReceipt:null,splashPhase:null,orderManager:null,utility:{cssListener:null,deviceListener:null,exceptionHandler:null,logging:null,orderTimer:null,rotateTimer:null,buttonTracking:null},touchListener:null,hasGuestAccount:!1,guestAccount:null,writetolog:!0,context:"UX",types:{lookup:{CANCEL:"",PHONE:"0",FACE:"1",CREDIT:"2",LOYALTY:"3",LOYALTY2:"4",EMPLOYEE:"5",GENERIC1:"6",GENERIC2:"7",GENERIC3:"8",GENERIC4:"9",GENERIC5:"10",GENERIC6:"11",GENERIC7:"12",GENERIC8:"13",GENERIC9:"14",GENERIC10:"15"}}};!function(){function a(){_nex.manager.init(_nex.device.deviceType(),_nex.assets.theme.id,_device.themeMediaPath(),_nex.parameters),_nex.utility.cssListener.init(),_nex.previousOrders=new PreviousOrders({theme:_nex.assets.theme}),_nex.orderManager=new OrderManager,_nex.ordering=new OrderingUX({theme:_nex.assets.theme,orderManager:_nex.orderManager}),_nex.payment=new Payment({theme:_nex.assets.theme}),_nex.postOrdering=new PostOrdering,_nex.sms=new sms({theme:_nex.assets.theme}),_nex.greenReceipt=new GreenReceipt({theme:_nex.assets.theme}),_nex.splashPhase=new SplashPhase,_nex.complete=new Complete({}),$("#content").empty(),$("#content").append("<div id='targets' ><div id='"+_nex.parameters.offlinephase.id+"' ></div></div>"),c();var a=_nex.assets.theme.mediaPath();_nex.assets.soundManager.initialize(a+"Sounds"),_nex.writetolog&&!inPreviewer()&&(_nex.utility.logging=new Logging(_nex.communication.send)),_nex.utility.rotateTimer=new RotateTimer("wrap"),_nex.keyboard.keypad=new Keypad,_nex.keyboard.numpad=new Numpad,_nex.keyboard.phonepad=new Phonepad(_nex.assets.soundManager),_nex.keyboard.pagerpad=new Pagerpad,_nex.keyboard.namepad=new Namepad,b(),_nex.touchListener=new TouchListener,_nex.touchListener.listenForTouchStart(),_nex.touchListener.listenForTouchEnd()}function b(){function a(){d()}function b(){}_nex.assets.offline=new Offline(window.htmlEscape),_nex.assets.offline.clearReason(),_nex.assets.phaseManager.goOffline(a,b)}function c(){document.ontouchmove=function(a){_nex.assets.phaseManager&&_nex.assets.phaseManager.currentPhase===_nex.assets.phaseManager.phaseType.SPLASH&&a.preventDefault()}}function d(){console.debug("Connecting ..."),_nex.communication.connect()}_nex.parameters={offlinephase:{id:"__offline",CLIP:[{id:"offline-kiosk",filename:"offline-kiosk.html",mediafolder:"html"}]},initialphase:"splash"},_nex.authToken={debug:"false",uri:"",copyright:"",code:""},_nex.loc={get id(){return _nex.assets.theme.system.storeid}},_nex.kvi={active:!1},"UX"===_nex.context&&inPreviewer()&&(window._soundManager={initialize:function(a){},playSound:function(a){},volUp:function(){},volDown:function(){},speak:function(a){var b=new SpeechSynthesisUtterance(a);window.speechSynthesis.speak(b)},cancelSpeak:function(){window.speechSynthesis.cancel()},setSpeaker:function(a){}}),_nex.inAdvancedMode=!1,$(document).ready(function(){document.addEventListener("click",function(){_nex.assets.soundManager&&_nex.assets.soundManager.cancelSpeak()}),_nex.utility.exceptionHandler=new ExceptionHandler,_nex.utility.exceptionHandler.enable(),_nex.device=_device,_nex.communication=new Communication({connection:_connection,commandFactory:new CommandFactory,device:_device}),_nex.utility.cssListener=new CssListener({listener:_cssListener}),_nex.assets.buttonFactory=new _nex.assets.buttons.ButtonFactory,_nex.assets.theme=new ThemeUX(_device.defaultTheme(),_device.themeMediaPath()),_nex.assets.phaseManager=new PhaseManager({theme:_nex.assets.theme,offlinePhase:_nex.parameters.offlinephase}),_nex.assets.phaseManager.loadTheme([]),_nex.assets.soundManager=new SoundManager(_soundManager),_nex.manager=new Manager({communication:_nex.communication,theme:_nex.assets.theme,phaseManager:_nex.assets.phaseManager}),_nex.assets.theme.id&&_nex.assets.theme.id.length>0?a():($("#content").empty(),$("#content").append(_nex.manager.formatError("Initialization Error","No theme is installed"))),_nex.tabManager=new TabManager})}(),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){for(var a,b=function(){},c=["assert","clear","count","debug","dir","dirxml","error","exception","group","groupCollapsed","groupEnd","info","log","markTimeline","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],d=c.length,e=window.console=window.console||{};d--;)a=c[d],e[a]||(e[a]=b)}(),function(a){var b=!1,c=function(c,d){if(!b){var e=a.log;a.log=function(){var f=arguments;e.apply(a,f),d&&"function"==typeof d&&(d.apply(c,f),b=!0)}}};window.defineNewConsoleLog=c}(window.console),$(".navbar-collapse a").click(function(a){$(".navbar-collapse").collapse("toggle")}),uriFormatting={iorderfastUri:"{IORDERFAST_URI}",themeUri:"{THEME_URI}",scriptUri:function(a){return a.indexOf(this.iorderfastUri)>-1&&(a=a.replace(this.iorderfastUri,_nex.authToken.uri)),a.indexOf(this.themeUri)>-1&&(a=a.replace(this.themeUri,_nex.assets.theme.mediaPath())),a}},String.prototype.endsWith||(String.prototype.endsWith=function(a,b){var c=this.toString();("number"!=typeof b||!isFinite(b)||Math.floor(b)!==b||b>c.length)&&(b=c.length),b-=a.length;var d=c.indexOf(a,b);return-1!==d&&d===b}),currency={moneySymbol:"$",thousandSeparator:",",centsSeparator:".",formatAsDollars:function(a,b){if(isNaN(a))return"";null===b&&(b=!1),a=100*a,a=Math.round(a);var c=String(Math.floor(a));if(1===c.length)c="0"+this.centsSeparator+"0"+c;else if(2===c.length)c="0"+this.centsSeparator+c;else{var d=c.slice(-2);c=c.substring(0,c.length-2);var e=[];do e.push(c.slice(-3)),c=c.substring(0,c.length-3);while(c.length>3);c.length&&e.push(c),e.reverse(),c="";for(var f=0;f<e.length;f++)c+=e[f],c+=f!==e.length-1?this.thousandSeparator:"";c=c+this.centsSeparator+d}return b&&(c=this.moneySymbol+" "+c),c}},dateFormatting={days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeek:function(a){return this.days[a]},month:function(a){return this.months[a]}},itemFormatting={buttonText:function(a){return void 0!==a&&(a=a.replace(/~/g,"<br/>"),a=a.trim()),a},buttonImage:function(a){return a.replace(".swf",".png").replace("&amp;","&")},getPrice:function(a){var b=Number(a.amountdue);if(void 0!==a.ITEM)for(var c=0;c<a.ITEM.length;c++)b+=Number(a.ITEM[c].amountdue);return correctMathError(b)},buildModReceiptText:function(a){var b="",c=void 0!==_nex.assets.theme.system.RECEIPT.printmodquantity?"true"===_nex.assets.theme.system.RECEIPT.printmodquantity.toLowerCase():!1,d=void 0!==_nex.assets.theme.system.RECEIPT.printmodpricelevel?"true"===_nex.assets.theme.system.RECEIPT.printmodpricelevel.toLowerCase():!1;if(void 0!==a.ITEM)for(var e=!1,f=0;f<a.ITEM.length;f++){var g=a.ITEM[f];if(f>0&&(b+=e?"<br/>":", "),c&&g.hasOwnProperty("modquantity")&&(b+=g.modquantity.toString()+" "),g.hasOwnProperty("receipttext")||(g=_nex.assets.theme.itemByPosid(g.posid),g.receipttext=_nex.assets.theme.itemTextByType(g,"RECEIPTTEXT")),d){var h=_nex.assets.theme.itemPriceLevelText(g);""!==h&&(b+=_nex.assets.theme.itemPriceLevelText(g)+"-")}b+=g.receipttext,e=g.hasOwnProperty("itemtype")&&"item"==g.itemtype.toLowerCase()}return b.trim()},buildSingleModReceiptText:function(a){var b="",c=void 0!==_nex.assets.theme.system.RECEIPT.printmodquantity?"true"===_nex.assets.theme.system.RECEIPT.printmodquantity.toLowerCase():!1,d=void 0!==_nex.assets.theme.system.RECEIPT.printmodpricelevel?"true"===_nex.assets.theme.system.RECEIPT.printmodpricelevel.toLowerCase():!1;if(void 0!==a){if(c&&a.hasOwnProperty("modquantity")&&(b+=a.modquantity.toString()+" "),a.hasOwnProperty("receipttext")||(a=_nex.assets.theme.itemByPosid(a.posid),a.receipttext=_nex.assets.theme.itemTextByType(a,"RECEIPTTEXT")),d){var e=_nex.assets.theme.itemPriceLevelText(a);""!==e&&(b+=_nex.assets.theme.itemPriceLevelText(a)+"-")}b+=a.receipttext}return b.trim()}};var digitsOnly=/[1234567890]/g,floatOnly=/[0-9\.]/g,alphaOnly=/[A-Za-z]/g,alphaNumOnly=/[A-Za-z1234567890\s]/g;!function(a){function b(){l.setAttribute("content",o),p=!0}function c(){l.setAttribute("content",n),p=!1}function d(d){k=d.accelerationIncludingGravity,h=Math.abs(k.x),i=Math.abs(k.y),j=Math.abs(k.z),a.orientation&&180!==a.orientation||!(h>7||(j>6&&8>i||8>j&&i>6)&&h>5)?p||b():p&&c()}if("-ms-user-select"in document.documentElement.style&&navigator.userAgent.match(/IEMobile\/10\.0/)){var e=document.createElement("style");return e.appendChild(document.createTextNode("@-ms-viewport{width:auto!important}")),void document.getElementsByTagName("head")[0].appendChild(e)}var f=navigator.userAgent;if(/iPhone|iPad|iPod/.test(navigator.platform)&&/OS [1-5]_[0-9_]* like Mac OS X/i.test(f)&&f.indexOf("AppleWebKit")>-1){var g=a.document;if(g.querySelector){var h,i,j,k,l=g.querySelector("meta[name=viewport]"),m=l&&l.getAttribute("content"),n=m+",maximum-scale=1",o=m+",maximum-scale=10",p=!0;l&&(a.addEventListener("orientationchange",b,!1),a.addEventListener("devicemotion",d,!1))}}}(this);var throttle=!1;$("#appSwitcher").click(function(a){throttle||3!==a.originalEvent.detail||(appSwitcherVerify(),throttle=!0,setTimeout(function(){throttle=!1},1e3))});var _alternateui="";!function(a){var b=function(a,b){var c=this;c.id=a,c.clickCallback=b,c.debugEnabled=!0,c.debug=function(){c.debugEnabled&&console.debug("PageElement",arguments)},c.checkElementExists=function(){return $("#"+c.id).length>0},c.html=function(a){c.debug("Setting element html to",c.id,a),$("#"+c.id).html(a)},c.text=function(a){c.debug("Setting element text to",c.id,a),$("#"+c.id).text(a)},c.show=function(){c.debug("Showing element",c.id),$("#"+c.id).show()},c.hide=function(){c.debug("Hiding element",c.id),$("#"+c.id).hide()},c.bindClick=function(){if(c.element=$("#"+a),!c.element.length)throw"Could not bind to the element with the id: "+a;c.debug("Found element and binding to it."),c.clickCallback&&(c.element.unbind("click"),c.element.bind("click",function(){c.playSound(),c.trackHistory(),c.clickCallback()}))},c.trackHistory=function(){c.debug("tracking history")},c.playSound=function(){c.debug("playing sound")}},c=function(a,c,d,e){var f=this;f.id=a,f.pageElements=c||[],f.callbackShow=d||function(){},f.callbackHide=e||function(){},f.debugEnabled=!0,f.debug=function(){f.debugEnabled&&console.debug("CustomPage",arguments)},f.show=function(){f.debug("Showing page"),$("#"+a).show(),f.callbackShow()},f.hide=function(){f.debug("Hiding page"),$("#"+a).hide(),f.callbackHide()},f.addElement=function(a,c){f.debug("Adding an element to the page");var d=new b(a,c);f.pageElements.push(d)}};a.CustomPage=c}(window),function(a){"use strict";var b=1,c=function(c){var d=this;d._keyCallback=c,d.id=b,b++,d._receiveKey=function(a){if(a){a.which||console.error("This browser does not support event.which, which is needed for key listening.");var b=a.which,c=b,e=String.fromCharCode(b);d._keyCallback(c,e)}},d._listener=function(a){d._receiveKey(a)},d.startListening=function(){console.debug("start listening "+d.id),a.addEventListener("keypress",d._listener,!1)},d.stopListening=function(){console.debug("stop listening "+d.id),a.removeEventListener("keypress",d._listener,!1)}};a.SimpleListener=c}(window),SetLanguageAction.prototype=Object.create(_BaseAction.prototype),SwipeToStartAction.prototype=Object.create(_BaseAction.prototype),_nex.commands._BaseRequest=function(){var a=this;a.name="",a.msgHeader=function(){var a={};return"UX"!==_nex.context&&(a.authcode=_iorderfast.authToken.code),a.name=this.name,"UX"!==_nex.context&&(a.locationid=_iorderfast.loc.id),a[this.name]={},a},a.write=function(){}},_nex.commands.AddSMSToOrder=function(a,b){_nex.commands._BaseRequest.call(this);var c=this;c._orderId=a||"",c._smsNumber=b||"",c.name="ADDSMSTOORDER",c.write=function(){var a=c.msgHeader();return a[c.name]={orderid:c._orderId,smsnumber:c._smsNumber},a}},_nex.commands.AddSMSToOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.AddTender=function(a,b){_nex.commands._BaseRequest.call(this);var c=this;c.type=a||"",c.tenderSpecific=b||{},c.name="ADDTENDER",c.write=function(){var a=c.msgHeader();return a[c.name]={type:c.type,tenderSpecific:c.tenderSpecific},a}},_nex.commands.AddTender.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.AddWeight=function(a,b,c){_nex.commands._BaseRequest.call(this);var d=this;d.name="ADDWEIGHT",d.posid=a,d.weight=b,d.weight=c,d.write=function(){var e=d.msgHeader();return e[d.name]={posid:a,weight:b,uom:c},e}},_nex.commands.AddWeight.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.CalculateTotal=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="CALCULATETOTAL",b.subtotal=a.totals.subtotal().replace("$",""),b.togo=a.togo.toString(),b.roundUpCharitySelected=a.roundUpCharitySelected.toString(),b.write=function(){var a=b.msgHeader();return a[b.name]={togo:b.togo,subtotal:b.subtotal,roundupcharityselected:b.roundUpCharitySelected,sendtoserver:"true"},a}},_nex.commands.CalculateTotal.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.CouponInquiry=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="COUPONINQUIRY",b.write=function(){var c=b.msgHeader();return c[b.name]={locationid:_nex.assets.theme.system.storeid,couponnumber:a},console.debug(c),c}},_nex.commands.CouponInquiry.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.CreateOrder=function(a,b){_nex.commands._BaseRequest.call(this);var c=this;c.name="CREATEORDER",c.hasvideo=!1,a&&(c.hasvideo=!0),c.frenabled=!1,b&&(c.frenabled=!0),c.write=function(){var a=c.msgHeader();return a[c.name]={hasvideo:c.hasvideo,frenabled:c.frenabled},a}},_nex.commands.CreateOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.DeviceLookup=function(a){_nex.commands._BaseRequest.call(this);var b=this;b._lookupType="",b.name="DEVICELOOKUP",a&&(b._lookupType=a),b.write=function(){var a=b.msgHeader();return a[b.name]={lookuptype:b._lookupType},a}},_nex.commands.DeviceLookup.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.EmployeeInquiry=function(a,b){_nex.commands._BaseRequest.call(this);var c=this;c.name="EMPLOYEEINQUIRY",c.write=function(){var d=c.msgHeader();return d[c.name]={employeenumber:a,userdata:b},console.debug(d),d}},_nex.commands.EmployeeInquiry.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.EmployeeSecurityCheck=function(a,b){_nex.commands._BaseRequest.call(this);var c=this;c.name="EMPLOYEESECURITYCHECK",c.pin=a,c.capability=b,c.capabilities={SwitchApplication:23},c.write=function(){var a=c.msgHeader();return a[c.name]={pin:c.pin,capability:c.capabilities[c.capability]},a}},_nex.commands.EmployeeSecurityCheck.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.EnableScale=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="ENABLESCALE",b.enabled=a,b.write=function(){var c=b.msgHeader();return c[b.name]={enabled:a},c}},_nex.commands.EnableScale.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.GenericInquiry=function(a,b,c,d){var e=this;_nex.commands._BaseRequest.call(e),e._guestAccountLocalTypeId="",e._accountNumber="",e._pin="",e._paymentTypeId="",d&&(e._guestAccountLocalTypeId=d),a&&(e._accountNumber=a),b&&(e._pin=b),c&&(e._paymentTypeId=c),e.name="GENERICINQUIRY",e.write=function(){var a=e.msgHeader();return a[e.name]={guestaccountlocaltypeid:e._guestAccountLocalTypeId,accountnumber:e._accountNumber,pin:e._pin,paymenttypeid:e._paymentTypeId},a}},_nex.commands.CreateOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.ItemLookup=function(a,b){_nex.commands._BaseRequest.call(this);var c=this;c.name="ITEMLOOKUP",c.lookupField=a,c.lookupValue=b,c.write=function(){var d=c.msgHeader();return d[c.name]={lookupfield:a,lookupvalue:b},d}},_nex.commands.ItemLookup.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.KioskStatus=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="KIOSKSTATUS",b.status=a,b.status||console.log("ERROR! Did not specify a valid status for KioskStatus command."),b.write=function(){var a=b.msgHeader();return a[b.name]={pcstatus:b.status},a}},_nex.commands.KioskStatus.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.MenuStackReset=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="MENUSTACKRESET",a.write=function(){var b=a.msgHeader();return b[a.name]={},b}},_nex.commands.MenuStackReset.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.OrderLookup=function(a,b,c,d){var e=this;_nex.commands._BaseRequest.call(e),e.name="ORDERLOOKUP",e._orderDate="",e._searchType="",e._searchTerm="",e._updateOrderTime=!1,a&&(e._orderDate=new Date(a)),b&&(e._searchType=b),c&&(e._searchTerm=c),d&&(e._updateOrderTime=d),e.write=function(){var a=e.msgHeader();return a[e.name]={orderdate:e._orderDate,searchtype:e._searchType,searchterm:e._searchTerm,updateordertime:e._updateOrderTime},a}},_nex.commands.OrderLookup.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.OrderUsage=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="ORDERUSAGE",a.write=function(){var b=a.msgHeader();return b[a.name]={BUTTONUSAGE:_nex.utility.buttonTracking.writeButtonUsage()},b}},_nex.commands.OrderUsage.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.Preamble=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="PREAMBLE",a.pcstatus="Offline",a.setStatus=function(b){a.pcstatus=b},a.write=function(){var b=a.msgHeader();return b[a.name]={pcstatus:a.pcstatus},b}},_nex.commands.Preamble.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.ProcessLoyalty=function(a,b){_nex.commands._BaseRequest.call(this);var c=this;c.name="PROCESSLOYALTY",c.tender="",a&&(c.tender=a),c.amount="",b&&(c.amount=b),c.write=function(){var a=c.msgHeader();return a[c.name]={amounttocharge:c.amount,TENDER:c.tender.write()},a}},_nex.commands.ProcessLoyalty.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.ProcessOrder=function(a,b){try{if(_nex.keyboard.pagerpad.data&&(_nex.orderManager.currentOrder.customer.pagernumber=_nex.keyboard.pagerpad.data),_nex.keyboard.namepad.data&&(_nex.orderManager.currentOrder.customer.name=_nex.keyboard.namepad.data,_nex.orderManager.currentOrder.customer.name.length>0)){var c=_nex.orderManager.currentOrder.customer.name.split(" ");c.length>0&&(_nex.orderManager.currentOrder.customer.firstname=c[0],c.length>1&&(_nex.orderManager.currentOrder.customer.lastname=c[1]))}}catch(d){console.log("Error in ProcessOrder trying to set the pager number"+d.message)}_nex.commands._BaseRequest.call(this);var e=this;if(e.name="PROCESSORDER",e.customerName=_nex.orderManager.currentOrder.customer.name,e.customerPagerNumber=_nex.orderManager.currentOrder.customer.pagernumber,e.customerFirstName=_nex.orderManager.currentOrder.customer.firstname,e.customerLastName=_nex.orderManager.currentOrder.customer.lastname,a&&a.smsNumber?e.smsNumber=a.smsNumber:e.smsNumber="",b)if(b.write){var f=b.write();f&&(e.tenderSpecific=f)}else console.log("ERROR: Could not find a write method on the final tender object given!");e.tenderSpecific||(e.tenderSpecific=""),e.nutritionData={},_nex.nutritionData&&(e.nutritionData=_nex.nutritionData),e.write=function(){var a=e.msgHeader();return a[e.name]={smsnumber:e.smsNumber,ordertype:_nex.orderManager.currentOrder.ordertype,FINALTENDER:e.tenderSpecific,NUTRITIONINFO:e.nutritionData,CUSTOMER:{email:e.customerEmail,customerName:e.customerName,customerPagerNumber:e.customerPagerNumber,customerFirstName:e.customerFirstName,customerLastName:e.customerLastName}},a}},_nex.commands.ProcessOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.ProcessPrint=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="PROCESSPRINT",b.customerEmail=a.customer.email,b.receiptFormat=a.receiptFormat,b.smsNumber=_nex.orderManager.currentOrder.smsNumber,b.nutritionData={},_nex.nutritionData&&(b.nutritionData=_nex.nutritionData),b.write=function(){var a=b.msgHeader();return a[b.name]={receiptemail:b.customerEmail,receiptformat:b.receiptFormat,CUSTOMER:{email:b.customerEmail,phone:b.smsNumber,smsnumber:b.smsNumber},NUTRITIONINFO:b.nutritionData},a}},_nex.commands.ProcessPrint.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.ProcessTender=function(a,b,c){_nex.commands._BaseRequest.call(this);var d=this;d.name="PROCESSTENDER",d.tender="",a&&(d.tender=a),d.amount="",b&&(d.amount=b),d.discountid="",c&&(d.discountid=c),d.write=function(){var a=d.msgHeader();return a[d.name]={amounttocharge:d.amount,discountid:d.discountid,TENDER:d.tender.write()},a}},_nex.commands.ProcessTender.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.RemoveTender=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="REMOVETENDER",a.write=function(){var b=a.msgHeader();return b[a.name]={},b}},_nex.commands.RemoveTender.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.RequestRepeatOrders=function(a){var b=this;_nex.commands._BaseRequest.call(b),b.name="REQUESTPREVIOUSORDERS",b._lookup=a,b.write=function(){var a=b.msgHeader();return a[b.name]={lookuptype:b._lookup.lookupType,lookupvalue:b._lookup.lookupValue},null!==b._lookup.lookupXML&&(a[b.name].LOOKUPVALUES=b._lookup.lookupXML),console.debug("RequestPreviousOrders2","returning msg",a),a}},_nex.commands.RequestRepeatOrders.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.SavePreviousOrder=function(a,b,c){var d=this;_nex.commands._BaseRequest.call(d),d.name="SAVEPREVIOUSORDER",d._orderId=a||"",d._smsNumber=b||"",d._lookup=c,d.write=function(){var a=d.msgHeader();return a[d.name]={orderid:d._orderId,smsnumber:d._smsNumber,LOOKUP:{type:d._lookup.lookupType,value:d._lookup.lookupValue}},null!==d._lookup.lookupXML&&(a[d.name].LOOKUP.LOOKUPVALUES=d._lookup.lookupXML),a}},_nex.commands.SavePreviousOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.SwitchApplication=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="SWITCHAPPLICATION",b.launch=a,b.write=function(){var c=b.msgHeader();return c[b.name]={launch:a},c}},_nex.commands.SwitchApplication.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.UpdateTender=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.paid=a,b.paid||(b.paid=!1),b.name="UPDATEORDERTENDER",b.write=function(){var a=b.msgHeader();return a[b.name]={paid:b.paid},a}},_nex.commands.UpdateTender.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.VideoFeedDots=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="VIDEOFEEDDOTS",b.write=function(){var c=b.msgHeader();return c[b.name]={dots:a},c}},_nex.commands.VideoFeedDots.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.VideoFeedFlash=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="VIDEOFEEDFLASH",a.write=function(){var b=a.msgHeader();return b[a.name]={test:"test"},b}},_nex.commands.VideoFeedFlash.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.VideoFeedFreeze=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="VIDEOFEEDFREEZE",a.write=function(){var b=a.msgHeader();return b[a.name]={test:"test"},b}},_nex.commands.VideoFeedFreeze.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.VideoFeedLoop=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="VIDEOFEEDLOOP",b.write=function(){var c=b.msgHeader();return c[b.name]={looptime:a},c}},_nex.commands.VideoFeedLoop.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.VideoFeedLoopDefault=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="VIDEOFEEDLOOPDEFAULT",a.write=function(){var b=a.msgHeader();return b[a.name]={looptime:looptime},b}},_nex.commands.VideoFeedLoopDefault.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.VideoFeedQueueFlash=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="VIDEOFEEDQUEUEFLASH",a.write=function(){var b=a.msgHeader();return b[a.name]={},b}},_nex.commands.VideoFeedQueueFlash.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.VideoFeedThaw=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="VIDEOFEEDTHAW",a.write=function(){var b=a.msgHeader();return b[a.name]={test:"test"},b}},_nex.commands.VideoFeedThaw.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.WaitForPayment=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="WAITFORPAYMENT",a.write=function(){var b=a.msgHeader();return b[a.name]={},b}},_nex.commands.WaitForPayment.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.WriteToLog=function(a){_nex.commands._BaseRequest.call(this);var b=2,c=this;c.name="WRITETOLOG",c.logLevel=b,c.message=a,c.setLogLevel=function(a){c.logLevel=a},c.setMessage=function(a){var b="";"string"==typeof a&&(b=a),c.message=b},c.write=function(){var a=c.msgHeader();return a[c.name]={message:c.message,loglevel:c.logLevel},a}},_nex.commands.WriteToLog.prototype=Object.create(_nex.commands._BaseRequest.prototype);var paymentConstants={CASH_BUTTON_ID:"btnTenderCash",COUNTER_BUTTON_ID:"btnTenderCounter",COUPON_BUTTON_ID:"btnTenderCoupon",CREDIT_BUTTON_ID:"btnTenderCredit",DEBIT_BUTTON_ID:"btnTenderDebit",DISCOUNT_BUTTON_ID:"btnTenderDiscount",EMPLOYEE_BUTTON_ID:"btnTenderEmployee",LOYALTY_BUTTON_ID:"btnTenderLoyalty",GENERICTENDER1_BUTTON_ID:"btnTenderGeneric1",GENERICTENDER2_BUTTON_ID:"btnTenderGeneric2",GENERICTENDER3_BUTTON_ID:"btnTenderGeneric3",GENERICTENDER4_BUTTON_ID:"btnTenderGeneric4",GENERICTENDER5_BUTTON_ID:"btnTenderGeneric5",GENERICTENDER6_BUTTON_ID:"btnTenderGeneric6",GENERICTENDER7_BUTTON_ID:"btnTenderGeneric7",GENERICTENDER8_BUTTON_ID:"btnTenderGeneric8",GENERICTENDER9_BUTTON_ID:"btnTenderGeneric9",GENERICTENDER10_BUTTON_ID:"btnTenderGeneric10",GAINCLININGBALANCETENDER1_BUTTON_ID:"btnTenderGAIncliningBalance1",GAINCLININGBALANCETENDER2_BUTTON_ID:"btnTenderGAIncliningBalance2",GAINCLININGBALANCETENDER3_BUTTON_ID:"btnTenderGAIncliningBalance3",GAINCLININGBALANCETENDER4_BUTTON_ID:"btnTenderGAIncliningBalance4",GAINCLININGBALANCETENDER5_BUTTON_ID:"btnTenderGAIncliningBalance5",GAINCLININGBALANCETENDER6_BUTTON_ID:"btnTenderGAIncliningBalance6",GAINCLININGBALANCETENDER7_BUTTON_ID:"btnTenderGAIncliningBalance7",GAINCLININGBALANCETENDER8_BUTTON_ID:"btnTenderGAIncliningBalance8",GAINCLININGBALANCETENDER9_BUTTON_ID:"btnTenderGAIncliningBalance9",GAINCLININGBALANCETENDER10_BUTTON_ID:"btnTenderGAIncliningBalance10",CREDIT_CLIP_ELEMENT_ID:"paymentclip-credit",LOYALTY_CLIP_ELEMENT_ID:"paymentclip-loyalty",EMPLOYEE_CLIP_ELEMENT_ID:"paymentclip-employee",SELECT_CLIP_ELEMENT_ID:"paymentclip-select",GENERIC_CLIP_ELEMENT_ID:"paymentclip-generic",GAINCLININGBALANCE_CLIP_ELEMENT_ID:"paymentclip-gaincliningbalance",COUPON_CLIP_ELEMENT_ID:"paymentclip-coupon",CASH_CLIP:"cash",COUNTER_CLIP:"counter",COUPON_CLIP:"coupon",CREDIT_CLIP:"credit",LOYALTY_CLIP:"loyalty",GENERICTENDER1_CLIP:"generictender1",GENERICTENDER2_CLIP:"generictender2",GENERICTENDER3_CLIP:"generictender3",GENERICTENDER4_CLIP:"generictender4",GENERICTENDER5_CLIP:"generictender5",GENERICTENDER6_CLIP:"generictender6",GENERICTENDER7_CLIP:"generictender7",GENERICTENDER8_CLIP:"generictender8",GENERICTENDER9_CLIP:"generictender9",GENERICTENDER10_CLIP:"generictender10",GAINCLININGBALANCETENDER1_CLIP:"gaincliningbalancetender1",GAINCLININGBALANCETENDER2_CLIP:"gaincliningbalancetender2",GAINCLININGBALANCETENDER3_CLIP:"gaincliningbalancetender3",GAINCLININGBALANCETENDER4_CLIP:"gaincliningbalancetender4",
GAINCLININGBALANCETENDER5_CLIP:"gaincliningbalancetender5",GAINCLININGBALANCETENDER6_CLIP:"gaincliningbalancetender6",GAINCLININGBALANCETENDER7_CLIP:"gaincliningbalancetender7",GAINCLININGBALANCETENDER8_CLIP:"gaincliningbalancetender8",GAINCLININGBALANCETENDER9_CLIP:"gaincliningbalancetender9",GAINCLININGBALANCETENDER10_CLIP:"gaincliningbalancetender10",PREPTIME_CLIP:"preptime",PAGER_CLIP:"pager",PROCESSING_CLIP:"processing",SELECTPAYMENT_CLIP:"selectpayment",LOYALTYSELECTBUCKET_CLIP:"loyaltyselectbucket",ROOMCHARGE_CLIP:"roomcharge",SUBMITORDER_CLIP:"submitorder",TAKECASH_CLIP:"takecash",EMPLOYEE_CLIP:"employee",LOYALTYPROMPT_CLIP:"loyaltyprompt",PAYMENT_CLIP_CLASS:"paymentclip",PAYMENTMODE_STANDARD:"standard",PAYMENTMODE_NOPAYMENT:"nopayment",TENDER_CASH:"cash",TENDER_COUNTER:"counter",TENDER_COUPON:"coupon",TENDER_CREDIT:"credit",TENDER_DEBIT:"debit",TENDER_DISCOUNT:"discount",TENDER_EMPLOYEE:"employee",TENDER_LOYALTY:"loyalty",TENDER_ROOMCHARGE:"roomcharge",TENDER_GENERIC1:"generictender1",TENDER_GENERIC2:"generictender2",TENDER_GENERIC3:"generictender3",TENDER_GENERIC4:"generictender4",TENDER_GENERIC5:"generictender5",TENDER_GENERIC6:"generictender6",TENDER_GENERIC7:"generictender7",TENDER_GENERIC8:"generictender8",TENDER_GENERIC9:"generictender9",TENDER_GENERIC10:"generictender10"};CashPaymentClip.prototype=Object.create(BasePaymentClip.prototype),CashPaymentClip.prototype.constructor=BasePaymentClip,CounterPaymentClip.prototype=Object.create(CounterPaymentClip.prototype),CouponPaymentClip.prototype=Object.create(BasePaymentClip.prototype),CreditPaymentClip.prototype=Object.create(BasePaymentClip.prototype),CreditPaymentClip.prototype.constructor=BasePaymentClip;var PaymentDeviceFlow=function(a,b){var c=this;c._numAvailableTenders=a,c.start=function(){c._enablePaymentDevice()},c.stop=function(){};var d=function(a){return $.extend(!0,{},a)};c._showPaymentDevicePopup=function(a,b){var c=d(_nex.assets.popupManager.processingPopup);return c.message=a,_nex.assets.popupManager.showPopup(c,function(){b&&b()}),c},c._hidePaymentDevicePopup=function(a,b){_nex.assets.popupManager.hidePopup(a,function(){b&&b()})},c._enablePaymentDevice=function(){_nex.utility.orderTimer.stop(!0);var a=c._showPaymentDevicePopup(_nex.payment.textPaymentDeviceSwipe()),b=new _nex.commands.WaitForPayment;_nex.kviReader&&_nex.kviReader.startPaymentProcessing(),_nex.communication.send(b,function(b){try{console.log("creditpaymentclip.enablepaymentdevice - paymentresponse received");try{_nex.kviReader&&_nex.kviReader.stopPaymentProcessing()}catch(d){console.log("creditpaymentclip.enablepaymentdevice - error occured stopping kvi")}console.log("creditpaymentclip.enablepaymentdevice - hidding processing popup"),c._hidePaymentDevicePopup(a,function(){console.log("creditpaymentclip.enablepaymentdevice - processing popup hidden"),_nex.payment.handlePaymentResponse(b)})}catch(d){console.log("creditpaymentclip.enablepaymentdevice - unexpeced error occurred")}console.log("creditpaymentclip.enablepaymentdevice - reset timer"),_nex.utility.orderTimer.restart(!0)},"PAYMENTRESPONSE")}};EmployeePaymentClip.prototype=Object.create(BasePaymentClip.prototype),GAIncliningBalancePaymentClip.prototype=Object.create(BasePaymentClip.prototype),GenericPaymentClip.prototype=Object.create(BasePaymentClip.prototype),LoyaltyPaymentClip.prototype=Object.create(BasePaymentClip.prototype),LoyaltyPromptClip.prototype=Object.create(BasePaymentClip.prototype),LoyaltyPromptClip.prototype.constructor=BasePaymentClip,SelectPaymentClip.prototype=Object.create(BasePaymentClip.prototype),TenderCounter.prototype=Object.create(_BaseTender.prototype),TenderCoupon.prototype=Object.create(_BaseTender.prototype),TenderCredit.prototype=Object.create(_BaseTender.prototype),TenderDebit.prototype=Object.create(_BaseTender.prototype),TenderEmployee.prototype=Object.create(_BaseTender.prototype),TenderGeneric.prototype=Object.create(_BaseTender.prototype),TenderLoyalty.prototype=Object.create(_BaseTender.prototype);