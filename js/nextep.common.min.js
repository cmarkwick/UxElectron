function DomFocus(){function a(a,b){return $("[tabindex='"+b+"']").index(a)}function b(b){return b.toArray().sort(function(b,c){var d=parseInt(b.getAttribute("tabindex")),e=parseInt(c.getAttribute("tabindex"));if(d===e){var f=a(b,d),g=a(c,e);return f-g}return d-e})}var c=this;c.looped=!1,c.debugEnabled=!1,c.debug=function(){c.debugEnabled&&console.debug("DomFocus",arguments)},c.error=function(a){console.log("DomFocus Error: ",a)},c.focusIn=function(){_nex.assets.soundManager.cancelSpeak(),c.debug("Focusin event");var a=$(this).find(".caption").text(),b=$(this).hasClass("button-down-state");(!a||a.length<=0)&&(a=$(this).text()),a&&a.length>0&&(b&&(a="selected "+a),c.debug("Speaking text "+a),_nex.assets.soundManager.speak(a))},c.cycleFocus=function(a){c.debug("Cycle focus","enter");var b=c.anythingHasFocus();if(!b)return c.debug("Cycle focus","Nothing has focus... Cycling focus to the first tabable element."),void c.cycleFocusDefault();_nex.kviReader&&_nex.kviReader.rebind();var d,e=c.getCurrentFocus(),f=c.getTabableElements(),g=f.length-1,h=f.index(e);d=a?c.getPrevIndex(h,g):c.getNextIndex(h,g),c.looped&&c.playLoopSound(),c.debug("Cycle focus","Cycling focus from the current focused item "+h+" to "+d),c.looped?window.setTimeout(function(){f.eq(d).focus()},500):f.eq(d).focus(),c.debug("Cycle focus","exit")},c.playLoopSound=function(){_nex.assets.soundManager.playChime()},c.cycleFocusDefault=function(){var a=c.getTabableElements();return a.length<=0?void c.error("No tabable element found to focus to for default"):(a.first().focus(),void(_nex.kviReader&&_nex.kviReader.rebind()))},c.anythingHasFocus=function(){var a=!1,b=c.getCurrentFocus();return b.length>0&&(a=!0),a},c.getTabableElements=function(){var a=$(c.tabableElementString()).not("[tabindex='-1']"),d=b(a);return $(d)},c.tabableElementString=function(){var a="";return $(".modal-open").length>0?a=".modal [tabindex]:visible":(a+="a:visible",a+=", [tabindex]:visible"),a},c.getCurrentFocus=function(){return $(":focus")},c.setFocusById=function(a){$("#"+a).focus()},c.getNextIndex=function(a,b){var d=a+1;return c.looped=!1,d>b&&(d=0,c.looped=!0),d},c.getPrevIndex=function(a,b){var d=a-1;return c.looped=!1,d<0&&(d=b,c.looped=!0),d},c.focusOrderingHeader=function(){window.setTimeout(function(){c.debug("Setting focus on menu header"),$(".menu-header-text").first().focus()},50)},c.loadContent=function(){c.focusDefault()},c.loadMedia=function(){c.focusDefault()},c.focusDefault=function(){$(".page-header").length>0?window.setTimeout(function(){0===$("#pageHeaderCopy").length&&(text=$(".page-header").first().text(),$("#clip-header").append('<div aria-hidden="false" tabindex="1" id="pageHeaderCopy" style="opacity: 0;">'+text+"</div>")),$("#pageHeaderCopy").is(":focus")||$("#pageHeaderCopy").focus()},100):$("a#btnStart").length>0&&($("a#btnStart").attr("tabindex",1),window.setTimeout(function(){console.debug("Setting focus on start button"),$("a#btnStart").first().focus()},100))}}function FilterCriteria(){var a=this;a.itemFilter=null,a.hideUpsellMenus=!1,a.hideAlcoholMenus=!1,a.tenderFilter=null,a.itemIncludePriceLevel="",a.clear=function(){a.itemFilter=null,a.tenderFilter=null,a.hideUpsellMenus=!1,a.hideAlcoholMenus=!1,a.itemIncludePriceLevel=""},a.applyItemFilter=function(b){a.clear(),a.itemFilter=$.extend(!0,{},b.ITEMFILTER),a.itemFilter.INCLUDEATTRIBUTES=a._convertToArray(a.itemFilter.INCLUDEATTRIBUTES),a.itemFilter.EXCLUDEATTRIBUTES=a._convertToArray(a.itemFilter.EXCLUDEATTRIBUTES),a.itemFilter.INCLUDETEXTS=a._convertToArray(a.itemFilter.INCLUDETEXTS),a.itemFilter.hasOwnProperty("pricelevel")?a.itemIncludePriceLevel=a.itemFilter.pricelevel:a.itemIncludePriceLevel="",a.tenderFilter=a._convertToArray(b.TENDERFILTER).slice(),a.hideUpsellMenus="true"===b.MENUFILTER.hideupsell.toLowerCase(),a.hideAlcoholMenus="true"===b.MENUFILTER.hidealcohol.toLowerCase()},a._convertToArray=function(a){return Array.isArray(a)||(a=a.hasOwnProperty("value")?new Array(a):[]),a},a.doesTenderPassFilter=function(b){var c=!1;if(null!==a.tenderFilter&&a.tenderFilter.length>0)for(var d=0;d<a.tenderFilter.length&&!c;d++)a.tenderFilter[d].name===b&&(c=!0);else c=!0;return c},a.doesItemPassFilter=function(b){var c=!0,d=0,e=null;if(null!==a.itemFilter){for(d=0;d<a.itemFilter.EXCLUDEATTRIBUTES.length&&c;d++)e=_nex.assets.theme.findItemAttribute(b,a.itemFilter.EXCLUDEATTRIBUTES[d].name),null!==e&&e.value===a.itemFilter.EXCLUDEATTRIBUTES[d].value&&(c=!1);if(c)for(d=0;d<a.itemFilter.INCLUDEATTRIBUTES.length&&c;d++)e=_nex.assets.theme.findItemAttribute(b,a.itemFilter.INCLUDEATTRIBUTES[d].name),(null===e||null!==e&&e.value===a.itemFilter.INCLUDEATTRIBUTES[d].value)&&(c=!1);if(c)for(d=0;d<a.itemFilter.INCLUDETEXTS.length&&c;d++){var f=_nex.assets.theme.itemTextByType(b,a.itemFilter.INCLUDETEXTS[d].textType);f.indexOf(a.itemFilter.INCLUDETEXTS[d].value)<0&&(c=!1)}"UX"===_nex.context&&c&&null!==a.itemIncludePriceLevel&&a.itemIncludePriceLevel.length>0&&(priceLevelObj=_nex.assets.theme.findPriceLevel(b,a.itemIncludePriceLevel),c=null!==priceLevelObj)}return c}}function LabelManager(){var a=this,b=!0;a.debug=function(){b&&console.debug("LabelManager",arguments)},a.addMissingLabels=function(){$('input[type="text"], textarea, select').each(function(b,c){a.debug("Checking index "+b+" of inputs.");var d=$(c);a.addMissingIdToInput(d),a.addMissingLabelToInput(d)})},a.addMissingIdToInput=function(b){var c=b.attr("id"),d=b.attr("name");d&&!c&&(a.debug("Giving id of "+d),b.attr("id",d))},a.addMissingLabelToInput=function(b){var c=b.attr("id");a.hasLabel(c)?a.debug("Input with id of "+c+" already has a label."):a.prependLabel(c,c)},a.hasLabel=function(b){var c=!1,d=$("#"+b);if(d.length>0){var e='label[for="'+b+'"]';a.debug("Checking if anything has label with criteria "+e);var f=$(e);f.length>0&&(c=!0)}return c},a.prependLabel=function(b,c){var d=$("#"+b);if(d.length>0){a.debug("Adding label to id "+b);var c='<label class="specialHidden" for="'+b+'">'+c+"</label>";d.before(c)}}}function MenuInfo(a){var b=this;b.menuId=a,b.skipped=!1,b.scrollIndex=0,b.posids=[],b.removePosid=function(a){for(var c=0;c<b.posids.length;c++)if(b.posids[c]===a){b.posids.splice(c,1);break}}}function NutritionSummary(a,b){function c(){var a=this;a.CALORIES="Calories Per Serving",a.TOTALFAT="Total Fat",a.SATFAT="Saturated Fat",a.TRANSFAT="Trans Fat",a.CHOLESTEROL="Cholesterol",a.SODIUM="Sodium",a.TOTALCARBS="Total Carbohydrates",a.SUGARS="Sugar",a.PROTEIN="Protein",a.FIBER="Fiber"}function d(a,b){var c=null;if(a){var d=_nex.assets.theme.itemByPosid(a.posid);c=_nex.assets.theme.findItemAttribute(d,b)}else e.debug("Could not find attribute "+b),e.debug("Item: "),e.debug(a);return c}var e=this;e.debugEnabled=!1,e.debug=function(){e.debugEnabled&&console.debug(arguments)};var f=new c;e._clip=a,e._orderManager=b,e.update=function(){if(e._amount=0,e._clip){var a=!1,b=e._orderManager;if(null!==b.currentOrder&&b.currentOrder.ITEM.length>0){for(var c=new NutritionSummaryData(e._nutritionClip,f.CALORIES,"calories","nutritionTextCalories"),d=new NutritionSummaryData(e._nutritionClip,f.TOTALFAT,"totalFat","nutritionTextTotalFat"),g=new NutritionSummaryData(e._nutritionClip,f.SATFAT,"satFat","nutritionTextSatFat"),h=new NutritionSummaryData(e._nutritionClip,f.TRANSFAT,"transFat","nutritionTextTransFat"),i=new NutritionSummaryData(e._nutritionClip,f.CHOLESTEROL,"cholesterol","nutritionTextCholesterol"),j=new NutritionSummaryData(e._nutritionClip,f.SODIUM,"sodium","nutritionTextSodium"),k=new NutritionSummaryData(e._nutritionClip,f.TOTALCARBS,"totalCarbs","nutritionTextTotalCarbs"),l=new NutritionSummaryData(e._nutritionClip,f.SUGARS,"sugars","nutritionTextSugars"),m=new NutritionSummaryData(e._nutritionClip,f.PROTEIN,"protein","nutritionTextProtein"),n=new NutritionSummaryData(e._nutritionClip,f.FIBER,"fiber","nutritionTextFiber"),o=0;o<b.currentOrder.ITEM.length;o++)e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],c),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],d),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],g),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],h),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],i),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],j),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],k),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],l),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],m),e.calcTotalNutritionForItem(b.currentOrder.ITEM[o],n);c.updateUI(e._nutritionClip),d.updateUI(e._nutritionClip),g.updateUI(e._nutritionClip),h.updateUI(e._nutritionClip),i.updateUI(e._nutritionClip),j.updateUI(e._nutritionClip),k.updateUI(e._nutritionClip),l.updateUI(e._nutritionClip),m.updateUI(e._nutritionClip),n.updateUI(e._nutritionClip),a=c.isFoundOnAllItems()&&d.isFoundOnAllItems()&&g.isFoundOnAllItems()&&h.isFoundOnAllItems()&&i.isFoundOnAllItems()&&j.isFoundOnAllItems()&&k.isFoundOnAllItems()&&l.isFoundOnAllItems()&&m.isFoundOnAllItems()&&n.isFoundOnAllItems(),e.debug("Show = "+a),_nex.nutritionData||(_nex.nutritionData={}),_nex.nutritionData={NUTRITIONDATA:[c.write(),d.write(),g.write(),h.write(),i.write(),j.write(),k.write(),n.write(),l.write(),m.write()]}}a?e.show():(e.debug("hiding nutritional summary because at least one item is missing the required nutrition information"),e.hide())}},e.calcTotalNutritionForItem=function(a,b){var c=d(a,b.getName());if(c){var f=1,g=c.value;a.modquantity?f=Number(a.modquantity):a.quantity&&(f=Number(a.quantity));var h=0,i=0;if(g.toString().indexOf("-")!=-1){var j=g.split("-");h=Number(j[0]),i=Number(j[1])}else h=Number(g),i=Number(g);if(b.addAmount(h*f,i*f)){var k=a.ITEM;if(k)for(var l=0;l<k.length;l++)e.calcTotalNutritionForItem(k[l],b)}else b.foundMissingItem()}else b.foundMissingItem()},e.hide=function(){$("#"+e._clip).hide()},e.show=function(){$("#"+e._clip).show()}}function NutritionSummaryData(a,b,c,d){var e=this;a?e._clipId=a:"UX"===_nex.context?e._clipId="clip-nutritionSummary":e._clipId="nutritionSummary",b?e._nutritionName=b:e._nutritionName="Total Calories",c?e._nutritionUiName=c:e._nutritionUiName="calories",d?e._nutritionUiHTML=d:e._nutritionUiHTML="",e._lowRange=0,e._highRange=0,e._isFoundOnAllItems=!0,e._isUiAvailable=!0,e.getName=function(){return e._nutritionName},e.getUiName=function(){return e._nutritionUiName},e.getAmount=function(){return e._amount},e.isFoundOnAllItems=function(){return e._isFoundOnAllItems},e.isUiAvailable=function(){return e._isUiAvailable},e.foundMissingItem=function(){e._isFoundOnAllItems=!1},e.addAmount=function(a,b){var c=!1;return"number"==typeof a&&"number"==typeof b&&(window.isNaN(a)||window.isNaN(b)||window.isFinite(a)&&window.isFinite(b)&&(e._lowRange+=a,e._highRange+=b,c=!0)),c},e.updateUI=function(){var a="-";_nex.kviReader&&_nex.kviReader.jackedIn()&&(a=" to ");var b=document.getElementById(e._nutritionUiHTML);null!==b&&(e._lowRange===e._highRange?e._setNutritionField(e._nutritionUiHTML,e._lowRange.toFixed(0)):e._setNutritionField(e._nutritionUiHTML,e._lowRange.toFixed(0)+a+e._highRange.toFixed(0)))},e._setNutritionField=function(a,b){var c="#"+e._clipId+" #"+a,d=$(c),f=htmlEscape(b);d.length>0&&d.html(f)},e.write=function(){var a={};a.type=e._nutritionUiName,e._lowRange===e._highRange?a.amount=e._lowRange:a.amount=e._lowRange+"-"+e._highRange;var b="";switch(a.type){case"calories":b=" cals";break;case"totalFat":case"satFat":case"transFat":case"totalCarbs":case"fiber":case"sugars":case"protein":b=" g";break;case"cholesterol":case"sodium":b=" mg"}return a.amount+=" "+_nex.assets.theme.getTextAttribute("RECEIPTTEXT",a.type,b),a.isfoundonallitems=e._isFoundOnAllItems,a.name=e._nutritionName,a}}function Ordering(a){var b=this;a&&(b.theme=a.theme,b.orderManager=a.orderManager||null),b.cancelled=!1,b.currentMenuId=-1,b.pages_topindex=0,b.pagination="none",b.buttonfill="partialbot",b.currentMenu={},b.currentTemplateClass="",b.menus=[],b.menustack=[],b.menuScrollIndex=0,b.startMenu=1,b.buttons=[],b.removeIndex=-1,b.removeDelta=0,b.pending=!1,b.orderUpdated=function(){},b.pullDownShown=function(){},b.currentIButton=null,b.pulldownVisible=!1,b.currentMenuBg="",b.orderingModel=null,b.togo=!0,b.dragalongtext="",b.dragalongmedia=null,b.dragalongdesc="",b.nutritionSummary=null,b.processingerrormessage="",b.pfmCallback=null,b.commandListener=null,b.isOrderReview=null,b.loadActions=function(a){var c=a.split("-");if(c.length>=3){var d=Number(c[2]),e=b.buttons[d];null!==e&&e.executeActions()}},b.loadMenuAndButtons=function(a,c,d){var e=c.split("-");if(e.length>=3){var f=Number(e[2]),g=b.buttons[f];b.menus[a-1].MENUITEM=[],b.menus[a-1].MENUITEM=g.getMenuItems(),b.loadMenu(a,d)}},b.addItem=function(){b.loadMenu(b.startMenu)},b.loadMenu=function(a,c){b.isOrderReview=!1,void 0===a?(a=b.startMenu,void 0!==b.order.ITEM&&b.order.ITEM.length>0&&(a=b.findOrderReview())):"string"==typeof a&&(a=isNaN(a)?1:Number(a)),$(window).scrollTop(0),b.orderUpdated=function(){};var d=_nex.assets.templateManager.isOrderReview(b.menus[a-1].template);"UX"===_nex.context&&d?$("#receipt").attr("tabindex",3):$("#receipt").attr("tabindex",-1);var e=b.menus[a-1];(e.hasOwnProperty("startmenu")&&"true"===e.startmenu.toString().toLowerCase()||1===a)&&("UX"===_nex.context&&_nex.assets.theme.filter.clear(),b.startMenu=a,b.menustack=[],"UX"!==_nex.context?_iorderfast.command.send(new _nex.commands.MenuStackReset):_nex.communication.send(new _nex.commands.MenuStackReset)),b.currentMenuId=a,b.menustack.push(new MenuInfo(a)),null!==b.currentIButton&&(b.currentIButton.popover("destroy"),b.currentIButton.removeClass("ibutton-showing"),b.currentIButton=null),b.currentMenu&&_nex.assets.templateManager.templateUnloaded(b.currentMenu),b.currentMenu={},b.currentTemplateClass="",b.menuScrollIndex=0,$.extend(!0,b.currentMenu,e),d?(b.isOrderReview=!0,b.executePFM()):b.loadTemplate(),$("#template").removeClass(),$("#template").attr("class","menu-"+b.currentMenuId.toString()),null!==b.currentMenu.tag&&void 0!==b.currentMenu.tag&&$("#template").addClass(b.currentMenu.tag.toString()),$("#targets").removeClass(),$("#targets").attr("class","menu-id-"+b.currentMenuId.toString()),null!==b.currentMenu.tag&&void 0!==b.currentMenu.tag&&""!==b.currentMenu.tag&&$("#targets").addClass("menu-tag-"+b.currentMenu.tag.toString());var f=_nex.assets.templateManager.findTemplate(b.currentMenu.template);if(f.hasOwnProperty("layout")&&f.layout.length)for(var g=f.layout.split(" "),h=0;h<g.length;h++)g[h].length>0&&$("#targets").addClass(g[h]);if(d&&$("#targets").addClass("order-review"),b.updateControlButtons(),b.updateReceipt(),_nex.tabManager.ordering(),"UX"===_nex.context){var i={menuId:b.currentMenuId,menuName:b.currentMenu.title};window.parent.$("body").trigger("loadMenuEvent",i),_nex.kviReader&&_nex.kviReader.ordering(),refreshOrderTimer&&refreshOrderTimer()}void 0!==c&&c(),_nex.domFocus&&_nex.domFocus.focusOrderingHeader()},b.orderUpdatedEvent=function(){_nex.assets.templateManager.executeBehavior(b.currentMenu),_nex.assets.templateManager.refreshButtons(b.currentMenu,b.buttons),b.updateControlButtons()},b.loadTemplate=function(a){$("#header-text").empty(),$("#menuDescription").empty(),$("#template").empty(),b.orderUpdated=b.orderUpdatedEvent,"UX"===_nex.context?(b.stopNudge(),$("#header-text").append(b.theme.itemTextByType(b.currentMenu,"HEADER")),$("#menuDescription").append(itemFormatting.buttonText(b.theme.itemTextByType(b.currentMenu,"MENUDESCRIPTION"))),b.currentMenu.hasOwnProperty("voiceover")&&b.currentMenu.voiceover.length>0&&_nex.assets.soundManager.playVoiceover(b.currentMenu.voiceover)):($("#header-text").append(b.currentMenu.HEADER[0].headertext),$("#header-text").attr("tabindex",1),0!==b.currentMenu.MENUDESCRIPTION.length&&$("#menuDescription").append(itemFormatting.buttonText(b.currentMenu.MENUDESCRIPTION[0].menudescriptiontext))),$("#header-text").attr("tabindex",1),$("#menuDescription").attr("tabindex",2),b.loadAd&&b.loadAd(b.currentMenu.ad,b.currentMenu.template),b.loadDragALong(b.currentMenu.template);var c=_nex.assets.templateManager.findTemplate(b.currentMenu.template);$("#template").attr("class",""),b.pagination="none","UX"===_nex.context&&c.hasOwnProperty("pagination")&&(b.pagination=c.pagination.toLowerCase(),"true"===b.pagination&&(b.pagination="moreforward"),"false"===b.pagination&&(b.pagination="none")),b.buttonfill="partialbot",c.hasOwnProperty("buttonfill")&&(b.buttonfill=c.buttonfill.toLowerCase()),"none"!==b.pagination&&(b.buttonfill="partialbot"),"carousel"===b.pagination?$("#template").append("<div id='buttonscarousel' class='carousel slide' data-interval='false' data-wrap='true' data-ride='carousel' ><div id='buttons' class='carousel-inner buttons' role='listbox'></div></div>"):$("#template").append("<div id='buttons' class='buttons' ></div>");var d=$("#template").find("#buttons");d.empty(),b.buttons=b.getAvailableButtons(),"UX"!==_nex.context||_nex.assets.templateManager.hasButtons(b.currentMenu)?b.buttons.length>0?b._loadButtons(d,c):b._showNoItemsPopup():c.hasOwnProperty("buttonrendermode")&&"asset"===c.buttonrendermode.toLowerCase()&&b._loadTemplateHtml(c,d)},b._loadTemplateHtml=function(a,c){var d=a.name;a.hasOwnProperty("htmlsrc")&&a.htmlsrc.length>0&&(d=a.htmlsrc),d.indexOf(".html")===-1&&(d+=".html"),b.theme.loadMedia("templates/"+d,b.currentMenu.id,null,function(d,e){null!==e?(c.append(e),b._loadTemplateAssetButtons(a,c,b.buttons)):b._unableToLoadMenu()})},b._loadButtons=function(a,c){var d=0,e=-1,f="",g=0,h=!0;if(1===b.buttons.length&&"true"==b.theme.system.USERINTERFACE.autoselectmenu.toLowerCase()&&("MENUBUTTON"===b.buttons[0].name&&b.buttons[0].nextMenu!==b.currentMenuId?(h=!1,b.menustack[b.menustack.length-1].skipped=!0,b.loadMenu(b.buttons[0].nextMenu())):"SELECTONEMODIFIER"===b.buttons[0].name&&(h=!1,b.menustack[b.menustack.length-1].skipped=!0,b.addToOrder(b.buttons[0].item.posid,b.buttons[0].priceLevel(),b.buttons[0].buttonName,b.buttons[0].nextMenu()))),h&&1===b.currentMenuId&&_nex.hasOwnProperty("parameters")&&_nex.parameters.hasOwnProperty("menubutton")&&_nex.parameters.menubutton.length>0)for(var i=0;i<b.buttons.length&&h;i++)b.buttons[i].buttonText().toLowerCase().indexOf(_nex.parameters.menubutton.toLowerCase())>-1&&(h=!1,b.menustack[b.menustack.length-1].skipped=!0,b.loadMenu(b.buttons[i].nextMenu()));if(h){var j=_nex.assets.templateManager.getColumnCount(b.currentMenu.template,b.buttons.length);if(a.addClass(b.currentMenu.template.replace(/ /g,"-")+"-buttons"),null!==c)if(b.currentTemplateClass=c.classname||"",c.hasOwnProperty("buttonrendermode")&&"asset"===c.buttonrendermode.toLowerCase())b._loadTemplateHtml(c,a);else{var k=c.hasOwnProperty("maxbuttons")?Number(c.maxbuttons):-1,l=!1,m=0;b._paginateButtons(k,c);var n=0;"partialtop"===b.buttonfill&&(n=Math.round(b.buttons.length%j)-1,n<=0&&(n=j)),"carousel"===b.pagination&&0===m&&($("#pagin"+m).length||a.append("<div id='pagin"+m+"' class='active item'></div>"));for(var o=0;o<b.buttons.length;o++){if(e===-1||d>=j||"partialtop"===b.buttonfill&&d>n&&e<=0)if(e++,d=0,f="row"+e,"carousel"!==b.pagination){var p=l?"row-hidden":"";a.append("<div id='"+f+"' class='row row-centered "+p+"' data-pagenumber="+m+" ></div>")}else $("#pagin"+m).append("<div id='"+f+"' class='row row-centered' data-pagenumber="+m+" ></div>");var q="button-"+e+"-"+o.toString();d++;var r=b.buttons[o];r.descriptionType=c.hasOwnProperty("descriptiontype")&&c.descriptiontype.length>0?c.descriptiontype:"i-button",r.loadButton(q),null!==r.html&&(r.html.addClass("col-"+d.toString()),r.html.appendTo("#"+f)),"BLANK"!==r.name&&g++,"MORE"===r.name&&(m++,d=j,l=!0,b.pages_topindex=m,"carousel"===b.pagination&&o<b.buttons.length-1&&($("#pagin"+m).length||a.append("<div id='pagin"+m+"' class='item' data-pagenumber="+m+"></div>")))}"false"!==b.pagination.toLowerCase()&&"none"!==b.pagination.toLowerCase()&&0!==b.pagination.length||$("#template").attr("data-button-count",g.toString()),b._showPage();var s=b.currentItem();if(null!==s&&void 0!==s.ITEM)for(var t=0;t<s.ITEM.length;t++)s.ITEM[t].menuid===b.currentMenu.id&&b.menustack[b.menustack.length-1].posids.push(s.ITEM[t].posid)}else{var u=b.currentMenuId===b.startMenu,v=$.extend(!0,{},_nex.assets.popupManager.errorPopup);v.message=_nex.assets.theme.getTextAttribute("ORDERING","loadmenuerror","Sorry, unable to load menu."),_nex.assets.popupManager.showPopup(v,function(){u?"UX"===_nex.context?_nex.manager.cancelCurrentPhase():_iorderfast.nav.loadContent("splash"):b.goBack()})}if(b.currentMenu.menubg.length>0){if(b.currentMenuBg!==b.currentMenu.menubg)if(b.currentMenuBg=b.currentMenu.menubg,inPreviewer())$("#ordering").attr("style","background-image: url('../Media.aspx?media=other/"+b.currentMenuBg+"');");else if("UX"===_nex.context){var w=_nex.assets.theme.mediaPath()+"other/"+b.currentMenuBg;$("#ordering").attr("style","background-image: url('"+w+"');")}else $("#ordering").attr("style","background-image: url('themes/"+_iorderfast.assets.theme.id+"/media/other/"+b.currentMenuBg+"');")}else $("#ordering").attr("style","background-image: none");b.menustack.length-1;_nex.assets.templateManager.templateLoaded(b.currentMenu)}},b._createMoreButton=function(a){var b=new _nex.assets.buttons.More;return a.hasOwnProperty("morebuttonid")&&a.morebuttonid.length>0&&b.templateButtonName(a.morebuttonid),b},b._paginateButtons=function(a,c){var d=0;if("none"!==b.pagination){for(var e=[],f=0,g=0;g<b.buttons.length;g++)try{e.push(b.buttons[g]),f++,f===a-1?(e.push(b._createMoreButton(c)),d++,f=0):"carousel"===b.pagination&&g===b.buttons.length-1&&f>0&&(e.push(b._createMoreButton(c)),d++)}catch(h){return void console.debug("Error : "+h.message)}b.buttons=e}},b._showNoItemsPopup=function(){var a=$.extend(!0,{},_nex.assets.popupManager.errorPopup),c=!1;b.currentMenu.continuemenu.length>0?(b.menustack[b.menustack.length-1].skipped=!0,b.loadMenu(Number(b.currentMenu.continuemenu))):b.currentMenuId===b.startMenu?(a.message=_nex.assets.theme.getTextAttribute("ORDERING","noitemserrortrylater","Sorry, no items are currently available. Please try again later."),_nex.assets.popupManager.showPopup(a,function(){"UX"===_nex.context?c||(c=!0,_nex.manager.cancelCurrentPhase()):_iorderfast.nav.loadContent("splash")})):(a.message=_nex.assets.theme.getTextAttribute("ORDERING","noitemserror","Sorry, no items are currently available."),_nex.assets.popupManager.showPopup(a,function(){b.goBack()}))},b._loadTemplateAssetButtons=function(a,c,d){for(var e=0;e<b.buttons.length;e++){var f="button-0-"+e.toString(),g=b.buttons[e],h=c.find("#"+f);h.show(),g.descriptionType=a.hasOwnProperty("descriptiontype")&&a.descriptiontype.length>0?a.descriptiontype:"i-button",g.loadButton(f,h)}var i=0;if(a.hasOwnProperty("maxbuttons")){i=Number(a.maxbuttons);var j=i-d.length;if(j>0)for(var e=d.length;e<=d.length+j;e++){var k="button-0-"+e.toString(),l=c.find("#"+k);l.hide()}}_nex.assets.templateManager.templateLoaded(b.currentMenu)},b._unableToLoadMenu=function(){var a=b.currentMenuId===b.startMenu,c=$.extend(!0,{},_nex.assets.popupManager.errorPopup);c.message="Sorry, unable to load menu.",_nex.assets.popupManager.showPopup(c,function(){a?_nex.manager.cancelCurrentPhase():b.goBack()})},b.gotoNextMenu=function(){var a=b.startMenu;void 0!==b.currentMenu.continuemenu&&b.currentMenu.continuemenu.toString().length>0&&(a=b.currentMenu.continuemenu),void 0!==b.currentMenu.upsell&&"true"===b.currentMenu.upsell.toLowerCase()&&0===b.menustack[b.menustack.length-1].posids.length&&void 0!==b.currentMenu.nothanksmenu&&b.currentMenu.nothanksmenu.toString().length>0&&(a=b.currentMenu.nothanksmenu),b.loadMenu(a)},b.scrollMenu=function(){b.menuScrollIndex++,b._showPage()},b._showPage=function(){if(b.menustack[b.menustack.length-1].scrollIndex=b.menuScrollIndex,"carousel"!==b.pagination)for(var a=0,c=$("#row"+a);c.length>0;)c.data("pagenumber")===b.menuScrollIndex?c.removeClass("row-hidden"):c.addClass("row-hidden"),a++,c=$("#row"+a);else b.menuScrollIndex>b.pages_topindex||!$("#pagin"+b.menuScrollIndex).length?($("#template").find("#buttonscarousel").carousel(0),b.menuScrollIndex=0):$("#template").find("#buttonscarousel").carousel(b.menuScrollIndex);b.updateControlButtons()},b.goBack=function(){if("carousel"===b.pagination&&(b.menuScrollIndex=0),!b.pending)if(b.menuScrollIndex>0)b.menuScrollIndex--,b.menuScrollIndex<0&&(b.menuScrollIndex=0),b._showPage();else{var a=!1;if(b.menustack.length>0){var c=b.menustack.pop(),d=-1,e=!1,f=b.menus[c.menuId-1],g=_nex.assets.templateManager.findTemplate(f.template);null!==g?("UX"===_nex.context&&(g.itemtype&&0!==g.itemtype.length||(g.hasOwnProperty("classname")&&"selectmanyofnintegratedflavor"===g.classname.toLowerCase()?g.itemtype="modifier":g.itemtype="item")),"SELECTMANYMODIFIER"===g.defaultbuttontype||"SELECTNE"===g.defaultbuttontype||"LESSMORE"===g.defaultbuttontype||"SELECTONEQUANTITY"===g.defaultbuttontype&&g.hasOwnProperty("itemtype")&&"item"!==g.itemtype.toLowerCase()?void 0!==b.order.ITEM&&(d=b.order.ITEM.length-1,e=!0,b.removeMods(f.id,d,function(){b.removePreviousMenu()})):("SELECTMANYITEM"===g.defaultbuttontype||"SELECTONEQUANTITY"===g.defaultbuttontype&&g.hasOwnProperty("itemtype")&&"item"===g.itemtype.toLowerCase())&&(e=!0,b.removeItemsByMenu(f.id,function(){b.removePreviousMenu()})),e||b.removePreviousMenu()):a=!0}else a=!0;a&&(b.currentMenuId!==b.startMenu?b.loadMenu(b.startMenu):"UX"===_nex.context?_nex.manager.cancelCurrentPhase():_iorderfast.nav.loadContent("splash"))}},b.currentItem=function(){var a=null;return void 0!==b.order.ITEM&&b.order.ITEM.length>0&&(a=b.order.ITEM[b.order.ITEM.length-1]),a},b.currentItemIndex=function(){var a=-1;return void 0!==b.order.ITEM&&b.order.ITEM.length>0&&(a=b.order.ITEM.length-1),a},b.isOnCurrentItem=function(a){for(var c=!1,d=b.currentItem(),e=0;e<d.ITEM.length&&!c;e++)c=d.ITEM[e].posid===a;return c},b.over21=function(a){b.order.ageVerified=a},b.ageVerificationPrompt=function(a){var c=$.extend(!0,{},_nex.assets.popupManager.ageVerificationPopup);c.header=_nex.assets.theme.getTextAttribute("AGEVERIFICATION","title","VERIFY YOUR AGE");var d=_nex.assets.theme.getTextAttribute("DISCLAIMER","alcohol","");d?c.message=itemFormatting.buttonText(d):c.message=itemFormatting.buttonText(_nex.assets.theme.getFileTextAttribute("AlcoholDisclaimer","Are you old enough to purchase alcohol?")),c.buttons[0].clickEvent="_nex.ordering.over21(true)",c.buttons[1].clickEvent="_nex.ordering.over21(false)",_nex.assets.popupManager.showPopup(c,function(){b.order.ageVerified&&b.loadMenu(a)})},b.addAlcoholToOrder=function(a,c,d,e,f){if(!b.pending)if(b.order.ageVerified)b.addToOrder(a,c,d,e,f);else{var g=$.extend(!0,{},_nex.assets.popupManager.ageVerificationPopup);g.header=_nex.assets.theme.getTextAttribute("AGEVERIFICATION","title","VERIFY YOUR AGE");var h=_nex.assets.theme.getTextAttribute("DISCLAIMER","alcohol","");h?g.message=itemFormatting.buttonText(h):g.message=itemFormatting.buttonText(_nex.assets.theme.getFileTextAttribute("AlcoholDisclaimer","Are you old enough to purchase alcohol?")),g.buttons[0].clickEvent="_nex.ordering.over21(true)",g.buttons[1].clickEvent="_nex.ordering.over21(false)",_nex.assets.popupManager.showPopup(g,function(){b.order.ageVerified&&b.addToOrder(a,c,d,e,f)})}},b.loadDragALong=function(a){var c=_nex.assets.templateManager.findTemplate(a);if(null!==c&&c.hasOwnProperty("displaydragalong")&&"true"==c.displaydragalong.toString().toLowerCase()&&b.dragalongtext.length>0){$("#template").append("<div id='dragalong' ></div>");var d=$("#template").find("#dragalong");if(null!==b.dragalongmedia)if("UX"===_nex.context)if(inPreviewer()){var e="../Media.aspx?media=banners/"+b.dragalongmedia;d.attr("style","background-image: url('"+e+"');")}else{var e=b.theme.mediaRootUri;b.theme.mediaRootUri.toLowerCase().indexOf(b.theme.id.toLowerCase())===-1&&(e+="/"+b.theme.id),e+="/media/banners/"+b.dragalongmedia,d.attr("style","background-image: url('"+e+"');")}else d.attr("style","background-image: url('"+b.theme.mediaRootUri+"/"+b.theme.id+"/media/banners/"+b.dragalongmedia+"');");d.append("<div id='dragalongtext'>"+b.dragalongtext+"</div>"),d.append("<div id='dragalongdesc'>"+b.dragalongdesc+"</div>");var f="dragalong";void 0!==a&&(f+=" "+a.replace(/ /g,"-")+"-dragalong"),d.attr("class",f),$("#template").append(d)}},b.setDragALong=function(a,c){var d=_nex.assets.templateManager.findTemplate(b.currentMenu.template);if(null!==d&&d.hasOwnProperty("setdragalong")&&"true"==d.setdragalong.toString().toLowerCase()&&void 0!==a){var e=a.split("-");if(e.length>=3){var f=Number(e[2]),g=b.buttons[f];null!==g&&(b.dragalongtext=g.buttonText(),b.dragalongdesc=g.descriptionText(),b.dragalongmedia=g.image())}}},b.sortButtonTextOrder=function(a,b){if(a.hasOwnProperty("sortvalue")&&b.hasOwnProperty("sortvalue")){var c=a.sortvalue,d=b.sortvalue;return isNaN(c)||isNaN(d)||(c=Number(c),d=Number(d)),c<d?-1:c>d?1:0}return-1},b.getButtonInfo=function(a){var c={};if(void 0!==a){var d=a.split("-");if(d.length>=3){var e=Number(d[2]),f=b.buttons[e];null!==f&&(c=f.buttonInfo())}}return c},b.addManyModifier=function(a,c,d,e){var f=$("#"+d);if(f.length>0){var g=d.split("-"),h=Number(g[2]),i=b.buttons[h],j=f.data("item-type");"modifier"===j?b.addToOrder(a,c,void 0,void 0,e):"up"===f.data("state")?b.addToOrder(a,c,void 0,void 0,e):b.removeFromOrder(a,e);var k=f.find("#check");"up"===f.data("state")?(f.data("state","down"),f.addClass("button-down-state"),k.length>0&&(k.removeClass("button-many-unselected"),k.addClass("button-many-selected"))):(f.data("state","up"),f.removeClass("button-down-state"),k.length>0&&(k.removeClass("button-many-selected"),k.addClass("button-many-unselected"))),i.update()}},b.updateMultiState=function(a,c,d,e,f){refreshOrderTimer(),null!==e&&void 0!==e.stopPropagation&&e.stopPropagation();var g=d.split("-");if(g.length>=3){var h=Number(g[2]),i=$("#"+d),j=b.buttons[h];i.data("active-posid")!==a&&b.substituteModifier(j,h,a,c,void 0,void 0,void 0,f),j.click(a,c,d)}},b.updateComment=function(a,b){_iorderfast.command.send(new _nex.commands.UpdateComment(a,b),function(a){JSON.parse(a)})},b.getAvailableFilteredMenuItems=function(a,c,d,e,f,g){var h=[],i=_nex.assets.theme.items;if(e||(e=""),f||g){var j="";if(j="UX"===_nex.context?_nex.orderManager.currentOrder.currentItem():b.currentItem()){if(i=[],f){var k=_nex.assets.theme.itemByPosid(j.posid),l=[],m=k.RECIPE;if(m){Array.isArray(m)?l=m:l.push(m);for(var n=0;n<l.length;n++){var o=_nex.assets.theme.itemByPosid(l[n].posid);o&&i.push(o)}}}if(g){var p=_nex.assets.theme.itemByPosid(j.posid),q=[],r=p.SUGGESTED;if(r){Array.isArray(r)?q=r:q.push(r);for(var s=0;s<q.length;s++){var t=_nex.assets.theme.itemByPosid(q[s].posid);t&&i.push(t)}}}}else console.log("There is no current item. selectRecipe and selectSuggested menu genie options require a current item to work")}if(a.length>0||c.length>0){var u={},v="",w="",x="",y=0,z=[];c.length>0?z=b.theme.itemsByClassId(i,c):a.length>0&&(v=a[y].name.toString(),w=a[y].value.toString(),x=a[y].operator,void 0===x&&(x="Equals"),z=b.theme.itemsByAttribute(i,v,w,x),y++);for(var A=0;A<z.length;A++){var B=!0;u=z[A],u.DETAIL.itemtype.toString().toLowerCase()!==d.toLowerCase()&&d.length>0&&(B=!1);for(var C=y;C<a.length&&B;C++){v=a[C].name,w=a[C].value,x=a[C].operator,void 0===x&&(x="equals");var D=b.theme.findItemAttribute(u,v);null===D?B=!1:"equals"===x.toLowerCase()?D.value!==w&&(B=!1):"not equal"===x.toLowerCase()&&D.value===w&&(B=!1)}if(B&&""!==e){for(var E=!1,F=0;F<u.PRICELEVEL.length&&!E;F++)E=u.PRICELEVEL[F].name===e;B=E}B&&b.theme.itemIsAvailable(u.posid)&&h.push(u)}return h}if(g||f)return i},b.updateSubButton=function(a,c,d,e,f,g){refreshOrderTimer&&refreshOrderTimer(),null!==f&&void 0!==f.stopPropagation&&f.stopPropagation();var h=d.split("-");if(h.length>=3){var i=Number(h[2]),j=$("#"+d),k=b.buttons[i];j.data("active-posid")!==a&&""!==a?b.substituteModifier(k,i,a,c,j.data("active-posid"),j.data("active-pricelevel"),e,g):k.hasRecipe&&""!==a?b.substituteModifier(k,i,k.noPosid(),k.noPriceLevel(),j.data("active-posid"),j.data("active-pricelevel"),e,g):b.substituteModifier(k,i,void 0,void 0,j.data("active-posid"),j.data("active-pricelevel"),e,g),
k.update(a,e)}else console.log("unable to find button index")},b.substituteModifier=function(a,c,d,e,f,g,h,i){if(!b.pending){b.pending=!0;var j=b.currentMenu,k=_nex.assets.templateManager.findTemplate(b.currentMenu.template),l=null!==k&&k.hasOwnProperty("incquantity")&&"true"===k.incquantity.toLowerCase();l||(j=void 0,k=void 0);var m=_nex.assets.templateManager.templatePricedBy(b.currentMenu.template);if(h=h||1,"UX"===_nex.context){var n=new _nex.commands.SubstituteModifier(d,e,f,g,h,b.currentMenuId,b.menustack.length-1,b.currentMenu.upsell,m,c,a.buttonInfo(),j,k);_nex.communication.send(n,function(a){var c=_nex.orderManager.currentOrder.currentItem();if(c&&c.hasOwnProperty("ITEM")&&c.ITEM){var d=b.menustack.length-1;b.menustack[d].posids=[];for(var e=0;e<c.ITEM.length;e++)d===Number(c.ITEM[e].menustackindex)&&b.menustack[d].posids.push(c.ITEM[e].posid);for(var f=c.ITEM,g=0;g<f.length;g++)if(Number(f[g].menuid)===b.currentMenuId){var h=Number(f[g].buttonindex);h>=0&&b.buttons[h].html.data("active-posid")!==f[g].posid&&b.buttons[h].update(f[g].posid,f[g].modquantity)}b.updateControlButtons(),b.pending=!1,void 0!==i&&(a?i(a):i())}},"ADDTOORDERRESPONSE")}else{var o=new _nex.commands.SubstituteModifier(d,e,f,g,h.toString(),b.currentMenuId,b.menustack.length-1,b.currentMenu.upsell,m,c,a.buttonInfo(),j,k);_iorderfast.command.send(o,function(a){var c=JSON.parse(a);if("true"===c.success){b.order=c.ORDER,b.checkAlcoholLimit();var d=b.currentItem(),e=b.menustack.length-1;b.menustack[e].posids=[];for(var f=0;f<d.ITEM.length;f++)e===Number(d.ITEM[f].menustackindex)&&b.menustack[e].posids.push(d.ITEM[f].posid);void 0!==b.order.subtotal&&(b.totals.subtotal(currency.formatAsDollars(Number(b.order.subtotal),!0)),b.totals.salestax(currency.formatAsDollars(0,!0)),b.totals.salestax2(currency.formatAsDollars(0,!0)),b.totals.deliveryfee(currency.formatAsDollars(0,!0)),b.totals.gratuity(""),b.totals.amountdue(currency.formatAsDollars(0,!0)),b.totals.discount(currency.formatAsDollars(0,!0)));for(var g=b.currentItem().ITEM,h=0;h<g.length;h++)if(Number(g[h].menuid)===b.currentMenuId){var i=Number(g[h].buttonindex);i>=0&&b.buttons[i].html.data("active-posid")!==g[h].posid&&b.buttons[i].update(g[h].posid,g[h].modquantity)}b.updateReceipt(),void 0!==b.orderUpdated&&b.orderUpdated()}}),b.pending=!1,void 0!==i&&(result?i(result):i())}}},b.updateQuantityButton=function(a,c,d,e){refreshOrderTimer&&refreshOrderTimer(),void 0!==e.stopPropagation&&e.stopPropagation(),b.addToOrder(a,c,d);var f=d.split("-");if(f.length>=3){var g=Number(f[2]),h=b.buttons[g];h.click(a)}},b.changeQuantity=function(a,c,d,e){refreshOrderTimer&&refreshOrderTimer(),void 0!==e.stopPropagation&&e.stopPropagation();var f=c.split("-");if(f.length>=3){var g=Number(f[2]),h=b.buttons[g];if(!b.pending){b.pending=h.quantity+d>0;for(var i=-1,j=b.order.ITEM.length-1;j>=0&&i==-1;j--)b.order.ITEM[j].posid==a&&(i=b.order.ITEM[j].index);h.update(d,i)}}},b.updateModifierQuantity=function(a,c,d,e,f){var g=null,h=null;e=e||"";var i=e.split("-"),j=i.length>=3?Number(i[2]):-1;if(j>0&&"SELECTNE"===b.buttons[j].name){g=b.currentMenu,h=_nex.assets.templateManager.findTemplate(b.currentMenu.template);var k=null!==h&&h.hasOwnProperty("incquantity")&&"true"===h.incquantity.toLowerCase();k||(g=null,h=null)}b.sendUpdateQuantity(a,c,!0,d,function(){if(j>0&&b.buttons[j].hasOwnProperty("name")&&"SELECTNE"===b.buttons[j].name){b.buttons[j].update(d,b.buttons[j].modQuantity+Number(c));for(var e=b.currentItem().ITEM,f=0;f<e.length;f++)Number(e[f].menuid)===b.currentMenuId&&(j=Number(e[f].buttonindex),a>=0&&b.buttons[j].html.data("active-posid")!==e[f].posid&&b.buttons[j].update(e[f].posid,e[f].modquantity))}b.pending=!1})},b.showDescription=function(a,c,d){var e=b;if(null!==b.currentIButton)return b.currentIButton.on("hidden.bs.popover",function(){e.currentIButton.removeClass("ibutton-showing");var b=$("#"+e.currentIButton.data("parent-button")).find(".popover");b.length>0&&b.remove();var f=e.currentIButton.attr("id");e.currentIButton=null,"UX"===_nex.context&&(e.currentPopover=null),f!==c&&e.showDescription(a,c,d)}),void b.currentIButton.popover("destroy");var f=a.split("-");if(f.length>=3&&(null===b.currentIButton||null!==b.currentIButton&&b.currentIButton.attr("id")!==c)){var g=Number(f[2]),h=b.buttons[g];if($("#itemDescriptionContent").length>0){var i=$("#itemDescriptionContent").clone();i.css("display","");var j=i.find("#infoText");j.empty(),j.append(h.descriptionText());var k=i.find("#addButton");if(0===k.length){var l=i.find("#nutritionButton");l.length>0&&l.attr("onclick","_nex.ordering.showNutrition('"+a+"');")}else{var m=h.html.find("#nextmenu");k.attr("onclick",m.attr("onclick"))}var n=i.find("#nutritionInfo");n.length>0&&h.loadNutrition(n);var o="top";if(void 0!==i.data("placement")&&""!==i.data("placement")&&(o=i.data("placement")),void 0!==i.data("placement-media")&&""!==i.data("placement-media"))try{for(var p=i.data("placement-media"),q=0;q<p.length;q++)p[q].width>=$(window).width()&&(o=p[q].placement)}catch(r){console.log("Unable to parse placement-media; value: "+i.data("placement-media")),console.log(r.description)}var s={content:i.html(),html:!0,placement:o};b.currentIButton=$("#"+c),"UX"!==_nex.context?(b.currentIButton.data("parent-button",a),b.currentIButton.popover(s),b.currentIButton.popover("toggle"),b.currentIButton.addClass("ibutton-showing")):b.currentIButton.length>0&&(b.currentIButton.on("shown.bs.popover",function(){b.currentPopover=$(".popover-content")}),b.currentIButton.data("parent-button",a),b.currentIButton.popover(s),b.currentIButton.popover("toggle"),b.currentIButton.addClass("ibutton-showing"),$(document).on("mousedown",b._popoverHitTest),b.currentIButton.blur(function(){null!==b.currentPopover&&"true"!==b.currentPopover.data("keepshowing")&&null!==e.currentIButton&&(e.currentIButton.removeClass("ibutton-showing"),e.currentIButton.on("hidden.bs.popover",function(){e.currentIButton.removeClass("ibutton-showing");var a=$("#"+e.currentIButton.data("parent-button")).find(".popover");a.length>0&&a.remove(),e.currentIButton=null,e.currentPopover=null}),$(document).off("mousedown",b._popoverHitTest),b.currentIButton.popover("destroy"))}))}}else b.currentIButton=null},b.executePFM=function(a){var c=!1;_nex.pfmCallback=a,c=b.theme.system.hasOwnProperty("ORDERREVIEW")&&b.theme.system.ORDERREVIEW.hasOwnProperty("executepfm")&&"true"==b.theme.system.ORDERREVIEW.executepfm.toLowerCase(),c?(b.showProcessingPopup(b.theme.getTextAttribute("PAYMENT","processingorder","Calculating Total")),_nex.communication.send(new _nex.commands.CalculateTotal(_nex.orderManager.currentOrder),function(a){b.hideProcessingPopup(),"true"===a.responseReceived&&b.order.update(a,!1),b.updateReceipt(!0),b.loadOrderReview()},"ORDERTOTAL")):b.loadOrderReview()},b.showProcessingPopup=function(a,b){var c=$.extend(!0,{},_nex.assets.popupManager.processingPopup);c.message=a?a:"Processing ...",_nex.assets.popupManager.showPopup(c,b)},b.hideProcessingPopup=function(a){_nex.assets.popupManager.hidePopup(_nex.assets.popupManager.processingPopup,a)},b.consolidateOrder=function(a,c){void 0!==a&&null!==a||(a=!0),"UX"===_nex.context&&b.theme.consolidate&&a?_nex.communication.send(new _nex.commands.ConsolidateOrder,function(a){"true"===a.responseReceived&&b.order.update(a.ORDER),void 0!==c&&c()},"CONSOLIDATEORDERRESPONSE"):"UX"!==_nex.context&&_iorderfast.assets.theme.consolidate&&a?_iorderfast.command.send(new _nex.commands.ConsolidateOrder,function(a){var d=JSON.parse(a);"true"===d.success&&(b.order=d.ORDER),void 0!==c&&c()}):void 0!==c&&c()},b.loadOrderReview=function(a,c){void 0===a&&(a=!0),$("#targets").removeAttr("class"),$("#template").removeAttr("class"),$("#targets").addClass("order-review"),$("#targets").addClass("menu-id-"+b.currentMenuId.toString()),null!==b.currentMenu.tag&&void 0!==b.currentMenu.tag&&""!==b.currentMenu.tag&&$("#targets").addClass("menu-tag-"+b.currentMenu.tag.toString());var d=_nex.assets.templateManager.findTemplate(b.currentMenu.template);if(d.hasOwnProperty("layout")&&d.layout.length)for(var e=d.layout.split(" "),f=0;f<e.length;f++)e[f].length>0&&$("#targets").addClass(e[f]);var g=!1;if(g="UX"===_nex.context?_nex.orderManager.currentOrder.alcoholEnabled:_iorderfast.ordering.alcoholEnabled,void 0===b.order.ITEM||0===b.order.ITEM.length)b.loadMenu(b.startMenu);else{if(b.orderUpdated=function(){b.loadOrderReview(!1)},$("#header-text").empty(),"UX"===_nex.context?($("#header-text").append(b.theme.itemTextByType(b.currentMenu,"HEADER")),$("#menuDescription").empty(),$("#menuDescription").append(itemFormatting.buttonText(b.theme.itemTextByType(b.currentMenu,"MENUDESCRIPTION"))),b.currentMenu.hasOwnProperty("voiceover")&&b.currentMenu.voiceover.length>0&&_nex.assets.soundManager.playVoiceover(b.currentMenu.voiceover)):($("#header-text").append(b.currentMenu.HEADER[0].headertext),$("#menuDescription").empty(),0!==b.currentMenu.MENUDESCRIPTION.length&&$("#menuDescription").append(itemFormatting.buttonText(b.currentMenu.MENUDESCRIPTION[0].menudescriptiontext))),b.currentMenu.menubg.length>0){if(b.currentMenuBg!==b.currentMenu.menubg)if(b.currentMenuBg=b.currentMenu.menubg,inPreviewer())$("#ordering").attr("style","background-image: url('../Media.aspx?media=other/"+b.currentMenuBg+"');");else if("UX"===_nex.context){var h=_nex.assets.theme.mediaPath()+"other/"+b.currentMenuBg;$("#ordering").attr("style","background-image: url('"+h+"');")}else $("#ordering").attr("style","background-image: url('themes/"+_iorderfast.assets.theme.id+"/media/other/"+b.currentMenuBg+"');")}else $("#ordering").attr("style","background-image: none");b.consolidateOrder(a,function(){if("UX"===_nex.context&&$(".order-review-buttons").length&&(b.scrollTop=$(".order-review-buttons").scrollTop()),$("#template").empty(),$("#template").append("<div id='buttons' class='buttons order-review-buttons' ></div>"),"UX"===_nex.context?b.isOrderReview=!0:b.loadAd(b.currentMenu.ad,b.currentMenu.template),b.currentMenu.menubg.length>0){if(b.currentMenuBg!==b.currentMenu.menubg)if(b.currentMenuBg=b.currentMenu.menubg,"UX"===_nex.context&&inPreviewer()){var a="../Media.aspx?media=other/"+b.currentMenuBg;$("#ordering").attr("style","background-image: url('"+a+"');")}else if("UX"===_nex.context){var a=_nex.assets.theme.mediaPath()+"other/"+b.currentMenuBg;$("#ordering").attr("style","background-image: url('"+a+"');")}else $("#ordering").attr("style","background-image: url('themes/"+b.theme.id+"/media/other/"+b.currentMenuBg+"');")}else $("#ordering").attr("style","background-image: none");if(void 0!==b.order.ITEM){for(var c=[],d=null,e=0;e<b.order.ITEM.length;e++)if("false"===b.order.ITEM[e].hidden)if(b.order.ITEM[e].linkid.length>0&&null!==d){if(void 0===d.ITEM&&(d.ITEM=[]),d.ITEM.push($.extend(!0,{},b.order.ITEM[e])),b.order.ITEM[e].hasOwnProperty("ITEM"))for(var f=0;f<b.order.ITEM[e].ITEM.length;f++)d.ITEM.push($.extend(!0,{},b.order.ITEM[e].ITEM[f]))}else d=$.extend(!0,{},b.order.ITEM[e]),c.push(d);for(var h=0;h<c.length;h++){var i=$("#orderreview").clone();i.addClass("col-xs-12"),i.addClass("order-review-item");var j=Number(c[h].quantity),k=i.find("#quantMinus");void 0!==k&&k.attr("onclick","_nex.assets.soundManager.playButtonHit();_nex.ordering.updateItemQuantity("+c[h].index+",-1, false); _nex.utility.buttonTracking.track('', '-', '"+b.currentMenuId+"', 'Review Order', 'control');");var l=i.find("#quantPlus");void 0!==l&&(l.css("visibility","hidden"),"true"===c[h].alcoholflag.toLowerCase()?g&&(l.attr("onclick","_nex.assets.soundManager.playButtonHit();_nex.ordering.updateItemQuantity("+c[h].index+",1, true);_nex.utility.buttonTracking.track('', '+', '"+b.currentMenuId+"', 'Review Order', 'control');"),l.css("visibility","visible")):j<b.theme.quantityLimit&&(l.attr("onclick","_nex.assets.soundManager.playButtonHit();_nex.ordering.updateItemQuantity("+c[h].index+",1, true); _nex.utility.buttonTracking.track('', '+', '"+b.currentMenuId+"', 'Review Order', 'control');"),l.css("visibility","visible"))),b.hasOwnProperty("checkCustomFilter")&&b.checkCustomFilter(c[h].posid)&&void 0!==l&&(l.css("visibility","hidden"),k.css("visibility","hidden"));var m=i.find("#quantity");m.empty(),m.append(c[h].quantity);var n=i.find("#bimage");n.empty();var o=c[h].posid;i.data("posid",o);var p=_nex.assets.theme.itemByPosid(o);if(null!==p){var q=p.DETAIL.image;if(q.length>0)if("UX"===_nex.context&&inPreviewer()){var a="../Media.aspx?media=images/"+q;$(n).css({"background-image":"url("+a+")"})}else $(n).css({"background-image":"url(themes/"+b.theme.id+"/media/images/"+q+")"})}var r=i.find("#receipttext");r.empty(),r.append(itemFormatting.buttonText(c[h].receipttext));var s=itemFormatting.buildModReceiptText(c[h]),t=i.find("#modtext");t.empty(),t.append(s);var u=i.find("#comment");if(u.length>0){var p=b.theme.itemByPosid(c[h].posid),v=b.theme.findItemAttribute(p,"Disable Instructions");null!==v&&"true"===v.value.toLowerCase()?u.css("display","none"):(c[h].hasOwnProperty("comment")&&u.val(c[h].comment),u.css("display",""),u.attr("onblur","_nex.ordering.updateComment("+c[h].index+", this.value)"),u.attr("onkeypress","return restrictCharacters(this, event, alphaNumOnly);"))}var w=i.find("#amountdue");if(w.empty(),w.append(currency.formatAsDollars(itemFormatting.getPrice(c[h]),!0)),_nex.mviReader){var x='<div id="invisibleLabel'+h+'" class="invisible" aria-hidden="false" tabindex="2">'+j+" "+itemFormatting.buttonText(c[h].receipttext)+" "+s+" "+currency.formatAsDollars(itemFormatting.getPrice(c[h]),!0)+" </div>";$("#template").find("#buttons").append(x)}$("#template").find("#buttons").append(i),i=null}_nex.assets.templateManager.templateLoaded(b.currentMenu)}}),b.scrollTop&&$(".order-review-buttons").scrollTop(b.scrollTop)}},b.gotoOrderReview=function(a){var c=b.findOrderReview();b.loadMenu(c)},b.findOrderReview=function(){for(var a=-1,c=0;c<b.menus.length&&a===-1;c++){var d=_nex.assets.templateManager.findTemplate(b.menus[c].template);null!==d&&d.hasOwnProperty("classname")&&("orderreview"===d.classname.toString().toLowerCase()||"UX"===_nex.context&&"checkout"===d.classname.toString().toLowerCase())&&(console.debug("Found menu for order review"),a=b.menus[c].id)}return a===-1&&(a=1),a},b.findMenuByTag=function(a){for(var c=-1,d=0;d<b.menus.length&&c===-1;d++){var e=b.menus[d];e&&e.hasOwnProperty("tag")&&e.tag===a&&(console.debug("Found menu for "+a),c=b.menus[d].id)}return c===-1&&(c=1),c},b.updateReceipt=function(a){null===a&&(a=!1);var c=$("#receipt");if(c.length>0){var d="",e=!1,f=c.data("receipt-behavior");f=f||"pulldown";var g=0;if("UX"===_nex.context){if(a===!0&&void 0!==b.order.totals.amountdue)var h=correctMathError(Number(b.order.totals.amountdue()));else if(void 0!==b.order.totals.subtotal)var h=correctMathError(Number(b.order.totals.subtotal()));void 0!==h&&(d=$("#receiptItemTemplate").length>0?"_nex.ordering.showPulldownReceipt()":"",g=Number(h))}else if(void 0!==b.order.subtotal){correctMathError(Number(b.order.subtotal));d=$("#receiptItemTemplate").length>0?"_iorderfast.ordering.showPulldownReceipt()":"",g=Number(b.order.subtotal)}e=_nex.assets.templateManager.isReceiptVisible(b.currentMenu.template,g);var i=c.find("#txtTotal");i.length>0&&(i.empty(),i.append(currency.formatAsDollars(g,!0)));var j=c.find("#txtPlusTax");if(j.length>0&&(j.empty(),"absolute"===$("#txtPlusTax").css("position").toLowerCase()&&j.append(b.theme.getTextAttribute("ORDER","plustax","Found tax"))),"visible"===f.toLowerCase()){var k=$("#visibleReceipt");if(k.length>0){var l=b._buildReceiptContent();k.empty(),k.append(l)}}else c.attr("onclick",d),c.css("cursor","pointer");c.css("visibility",e?"visible":"hidden"),c.parent().attr("class",""),c.parent().addClass(b.currentMenu.template.replace(/ /g,"-")),b.currentTemplateClass&&b.currentTemplateClass.length>0&&c.parent().addClass(b.currentTemplateClass)}b.pulldownVisible&&b.showPulldownReceipt(),b.updateNutritionSummary()},b.showPulldownReceipt=function(){if("UX"!==_nex.context||!b.isOrderReview)if(console.debug("showpulldownreceipt - "+b.pulldownVisible.toString()),b.pulldownVisible){b.pulldownVisible=!1;var a=$("#receipt").find("receiptContent");a.length>0&&a.remove(),$("#receipt").off("shown.bs.popover",function(){}),$("#receipt").off("hide.bs.popover",function(){}),$("#receipt").off("hidden.bs.popover",function(){}),$("#receipt").popover("destroy")}else{var c=b._buildReceiptContent(),d="bottom";void 0!==c.data("placement-media")&&""!==c.data("placement-media")&&(d=c.data("placement-media"));var e={content:$("<div>").append(c.clone()).html(),html:!0,placement:d,trigger:"focus"};b.pulldownVisible=!0,$("#receipt").popover(e),$("#receipt").on("shown.bs.popover",function(){b.pullDownShown()}),$("#receipt").on("hide.bs.popover",function(){b.pulldownVisible=!1}),$("#receipt").on("hidden.bs.popover",function(){window.setTimeout(function(){$("#receipt").popover("destroy")},0)}),$("#receipt").popover("show")}},b._buildReceiptContent=function(){var a=$('<div id="receiptContent" class="receipt-content" ></div>'),c=$("#pulldownReceipt");if(c.length>0&&void 0!==c.data("placement-media")&&""!==c.data("placement-media")&&a.data("placement-media",c.data("placement-media")),void 0!==b.order.ITEM){for(var d=[],e=null,f=0;f<b.order.ITEM.length;f++)"false"===b.order.ITEM[f].hidden&&(b.order.ITEM[f].linkid.length>0&&null!==e?(void 0===e.ITEM&&(e.ITEM=[]),e.ITEM.push($.extend(!0,{},b.order.ITEM[f]))):(e=$.extend(!0,{},b.order.ITEM[f]),d.push(e)));for(var g=0;g<d.length;g++){var h=$("#receiptItemTemplate").clone();h.attr("id","receiptItem"+g.toString());var i=h.find("#receiptItemText");i.empty(),i.append(d[g].quantity+"-"+itemFormatting.buttonText(d[g].receipttext));var j=h.find("#receiptItemAmount");j.empty();var k=b.isSingleLineModifier();if(k?j.append(currency.formatAsDollars(itemFormatting.getPrice(d[g]),!0)):j.append(currency.formatAsDollars(d[g].amountdue,!0)),void 0!==d[g].ITEM){var l=h.find("#receiptMod").clone();h.find("#receiptMod").remove();for(var m=null,n=null,o=0;o<d[g].ITEM.length;o++){k&&0!=o?k&&o>0&&m.append(", "):(m=l.find("#receiptModText"),m.empty(),m.append("* "),n=l.find("#receiptModAmount"),n.empty());var p="";Number(d[g].ITEM[o].amountdue)>0&&(p=currency.formatAsDollars(itemFormatting.getPrice(d[g].ITEM[o]),!0)),p.length>0&&(k||n.append(p)),m.append(itemFormatting.buildSingleModReceiptText(d[g].ITEM[o])),(!k||o+1>=d[g].ITEM.length)&&h.append(l.clone())}}a.append(h),h=null}}return a},b.isSingleLineModifier=function(){var a=void 0!==_nex.assets.theme.system.RECEIPT.singlelinemodifiers&&"true"===_nex.assets.theme.system.RECEIPT.singlelinemodifiers.toLowerCase();return a},b.cancelOrderPrompt=function(){var a=$.extend(!0,{},_nex.assets.popupManager.yesNoPopup);a.message=_nex.assets.theme.getTextAttribute("ORDER","cancelorder","Cancel your order?"),a.buttons[0].clickEvent="_nex.ordering.cancelOrder(true)",a.buttons[1].clickEvent="_nex.ordering.cancelOrder(false)",a.voiceover="Cancel Order.mp3",_nex.assets.popupManager.showPopup(a,function(){b.cancelled&&b.cancelOrderPromptCallback()})},b.cancelOrder=function(a){b.cancelled=a,a&&b.resetOrder()},b.removeFromOrder=function(a,c){var d=[];d.push(a),b.removeMultipleFromOrder(d,c)},b.confirmRemoveItem=function(a){a||(b.removeIndex=-1,b.removeDelta=0)},b.removeMods=function(a,c,d){var e=$.extend(!0,{},b.order.ITEM[c]);if(void 0!==e.ITEM){for(var f=[],g=0;g<e.ITEM.length;g++)e.ITEM[g].menuid===a&&f.push(e.ITEM[g].posid);b.removeMultipleFromOrder(f,function(){void 0!==d&&d()})}else void 0!==d&&d()},b.removeItemsByMenu=function(a,c){for(var d=$.extend(!0,{},b.order),e=[],f=0;f<d.ITEM.length;f++)d.ITEM[f].menuid===a&&e.push(d.ITEM[f].posid);e.length>0?b.removeMultipleFromOrder(e,function(){void 0!==c&&c()}):void 0!==c&&c()},b.popupRemoveClosed=function(){b.removeIndex!==-1&&b.updateItemQuantity(b.removeIndex,b.removeDelta,!0)},b.updateItemQuantity=function(a,c,d,e){var f=Number(b.order.ITEM[a].quantity);if(f+c<=0&&void 0!==d&&!d){b.removeIndex=a,b.removeDelta=c;var g=$.extend(!0,{},_nex.assets.popupManager.yesNoPopup);g.message=_nex.assets.theme.getTextAttribute("ORDERREVIEW","removemessage","Remove this item?"),g.buttons[0].clickEvent="_nex.ordering.confirmRemoveItem(true);",g.buttons[1].clickEvent="_nex.ordering.confirmRemoveItem(false);",g.voiceover="Remove This Item.mp3",_nex.assets.popupManager.showPopup(g,b.popupRemoveClosed)}else b.sendUpdateQuantity(a,c,!1,"",e)},b.showNutrition=function(a){var c=a.split("-");if(c.length>=3){var d=Number(c[2]),e=b.buttons[d],f=$.extend(!0,{},_nex.assets.popupManager.nutritionPopup);f.item=e.item,_nex.assets.popupManager.showPopup(f)}},b.updateNutritionSummary=function(){if(!b.nutritionSummary){var a="clip-nutritionSummary";b.nutritionSummary=new NutritionSummary(a,_nex.orderManager)}b.nutritionSummary.update()},b.getAvailableButtons=function(a,c){var d=new _nex.assets.buttons.ButtonFactory,e=[];void 0===a&&(a=b.currentMenu),void 0===c&&(c="");for(var f=_nex.assets.templateManager.findTemplate(a.template),g=Array.isArray(a.MENUITEM)?a.MENUITEM:new Array(a.MENUITEM),h=a.hasOwnProperty("sortby")&&"POPULARITY"===a.sortby.toUpperCase(),i="",j=0;j<g.length;j++){var k="zzzzzzzzzz",l=d.createButton(g[j],a.template);if(null!==l&&(l.hasItemRank=!1,l.init(g[j]),l.enabled(c)))if(l.hasFilter()){var m=!0;if(0===l.attributes().length&&0===l.itemClassId().length&&l.selectRecipe()!==!0&&l.selectSuggested()!==!0)m=!1;else{var n=d.getItemTypeForButton(l.name),o=b.getAvailableFilteredMenuItems(l.attributes(),l.itemClassId(),n,l.priceLevel(),l.selectRecipe(),l.selectSuggested());if(0===o.length)m=!1;else for(var p=0;p<o.length;p++){var q=g[j],r=$.extend(!0,{},q),s=d.createButton(r,a.template);r[q.buttontype].posid=o[p].posid,r[q.buttontype]=b.setPriceLevelFromMenuFilter(r[q.buttontype]);var t=q[q.buttontype].sortby.toLowerCase();switch(t){case"attribute":var u=b.theme.findItemAttribute(o[p],q[q.buttontype].sortattribute);s.sortvalue=null!==u?u.value.toLowerCase():"",0===s.sortvalue.toString().length&&(s.sortvalue="zzzzzzzzzz");break;case"popularity":_nex.assets.theme.itemRank&&(i=r[q.buttontype].posid,"undefined"==typeof i&&(i=r[q.buttontype].posid2),k=b.findItemRank(i),"zzzzzzzzzz"!==k&&(s.sortvalue=k,s.hasItemRank=!0),s.sortvalue=b.findItemRank(i));break;default:s.sortvalue=b.theme.itemTextByType(o[p],"BUTTONTEXT")}s.init(r),_nex.assets.templateManager.isButtonAvailable(b.currentMenu,f,s)&&e.push(s),r=null}}}else h&&_nex.assets.theme.hasOwnProperty("itemRank")&&(i=g[j][g[j].buttontype].posid,"undefined"==typeof i&&(i=g[j][g[j].buttontype].posid2),k=b.findItemRank(i),"zzzzzzzzzz"!==k&&(l.sortvalue=k,l.hasItemRank=!0)),_nex.assets.templateManager.isButtonAvailable(b.currentMenu,f,l)&&e.push(l)}for(j=0;j<e.length;j++)e[j].hasOwnProperty("sortvalue")||!e[j].hasItemRank&&a.hasOwnProperty("sortby")&&"popularity"===a.sortby.toLowerCase()&&(e[j].sortvalue=String(j+1e4));return e=e.mergeSort(b.sortButtonTextOrder)},b.setPriceLevelFromMenuFilter=function(a){if(void 0!==a&&null!==b.theme&&void 0!==b.theme&&void 0!==b.theme.filter&&void 0!==b.theme.filter.itemIncludePriceLevel&&null!==b.theme.filter.itemIncludePriceLevel&&b.theme.filter.itemIncludePriceLevel.length>0){var c=b.theme.filter.itemIncludePriceLevel;a.posid.length>0?a.pricelevel=c:(a.pricelevel1=c,a.pricelevel2=c,a.pricelevel3=c)}return a},b._menuRankExists=function(){var a=!0;return _nex.assets.theme.hasOwnProperty("itemRank")?"object"!=typeof _nex.assets.theme.itemRank?a=!1:_nex.assets.theme.itemRank.hasOwnProperty("MENURANK")||(a=!1):a=!1,a},b.findItemRank=function(a){var c="zzzzzzzzzz";return b._menuRankExists()?(Array.isArray(_nex.assets.theme.itemRank.MENURANK)||(_nex.assets.theme.itemRank.MENURANK=b.convertToArray(_nex.assets.theme.itemRank.MENURANK)),_nex.assets.theme.itemRank.MENURANK.forEach(function(b){!Array.isArray(b)&&Array.isArray(b.ITEM)?b.ITEM.forEach(function(b){b.posid===a&&(c=b.rank)}):b.ITEM.posid===a&&(c=b.ITEM.rank)}),c):c},b.selectOtherPressed=function(a){var c=a.split("-"),d=Number(c[2]),e=b.buttons[d];e.click()},b.convertToArray=function(a){var b=[];return a&&(a instanceof Array?b=a:b.push(a)),b}}function PhaseManager(a){var b=this;b.currentPhase="",b.clipsLoaded=0,b.paymentClipsLoaded=0,b.phases=[],b.clips=null,b.paymentClips=null,b.phaseId="",b.phaseLoaded=function(){},b.phaseUnloaded=function(){},$("#targets").empty(),"UX"===_nex.context&&($("#targets").append('<div id="__offline" style="display:none" ></div>'),b.phaseType={SPLASH:"splash",PREVIOUS_ORDERS:"previousorders",ORDERING:"ordering",POST_ORDERING:"postordering",OFFLINE:"__offline",PAYMENT:"payment",SURVEY:"survey",COMPLETE:"complete",ORDER_GOVERNOR:"ordergovernor",MENUBOARD:"menuboard",SMS:"sms",GREEN_RECEIPT:"greenreceipt",DDMD:"ddmd",STATUS:"status"},b.phaseMover=new PhaseMover("wrap"),b.phaseMover.bind("moveUp","moveDown","moveLeft","moveRight"),b.phaseMover.hide(),a||console.log("ERROR: Missing phaseParams to PhaseManager"),b.theme=a.theme,b.offlinePhase=a.offlinePhase||{id:b.phaseType.OFFLINE,CLIP:[{id:"offline",filename:"offline.html",mediafolder:"html"}]}),b.debugEnabled=!1,b.debug=function(){b.debugEnabled&&console.debug(arguments)},b.loadTheme=function(a){if("UX"===_nex.context)for(var c=0;c<b.phases.length;c++)b.phases[c].id!==b.offlinePhase.id&&$("#"+b.phases[c].id).remove();b.currentPhase="",b.phases=a;for(var d=0;d<b.phases.length;d++)$("#targets").append('<div id="'+b.phases[d].id+'" style="display:none" ></div>');"UX"===_nex.context&&b.phases.push(b.offlinePhase)},b.loadPhase=function(a){return""!==b.currentPhase&&(b.phaseUnloaded(),$("#"+b.currentPhase).css("display","none"),$("#"+b.currentPhase).empty()),void 0!==b.phases?(b.phaseId=a,b.clips=b.findPhaseClips(a)):b.clips=[],b.currentPhase=a,b.clips},b.findPhaseClips=function(a){void 0!==a&&""!==a||(a=b.currentPhase);var c=null;try{for(var d=0;d<b.phases.length&&null===c;d++)b.phases[d].id===a&&(c=b.phases[d].CLIP,c=$.isArray(c)?c:new Array(c))}catch(e){console.log("Exception finding phase clips for phase "+a+"!"),console.log(e)}return void 0!==c&&null!==c||(c=[]),c},b.changePhase=function(a,c,d){if("UX"===_nex.context&&(b.phaseLoaded=c||function(){},b.loadPhaseMover(a),b.currentPhase===a))return void b.phaseLoaded();$("#targets").removeAttr("class"),$("#template").removeAttr("class"),b.clipsLoaded=0,b.paymentClipsLoaded=0,b.clips=b.loadPhase(a),b.paymentClips=[];for(var e=0;e<b.clips.length;e++){var f=b.clips[e].id;if(f.length>0){var g="clip-"+b.clips[e].id,h=null;if(b.clips[e].hasOwnProperty("script")&&(h=b.clips[e].script),$("#"+g).length>0?$("#"+g).empty():$("#"+a).append("<div id='"+g+"'></div>"),"UX"!==_nex.context)_iorderfast.nav.loadMedia(b.clips[e].mediafolder+"/"+b.clips[e].filename,g,h,b.clipLoaded);else{var i=b.clips[e];b.theme.loadMedia(i.mediafolder+"/"+i.filename,g,h,b.clipLoaded,d),i.hasOwnProperty("PAYMENTCLIP")&&i.PAYMENTCLIP.length>0&&(b.paymentClips=$.isArray(i.PAYMENTCLIP)?i.PAYMENTCLIP:new Array(i.PAYMENTCLIP),b.loadPaymentClips(a,i))}}else b.clipsLoaded++}},b.clipLoaded=function(a,c,d){$("#"+a).append(c),d?b.paymentClipsLoaded++:b.clipsLoaded++,b.clipsLoaded===b.clips.length&&b.paymentClipsLoaded===b.paymentClips.length&&window.setTimeout(function(){b.phaseLoaded(),$("#"+b.currentPhase).css("display","")},0)},b.paymentClipLoaded=function(a,c){b.clipLoaded(a,c,!0)},b.loadPaymentClips=function(a,c,d){var e=c.PAYMENTCLIP;if(e)for(var f=0;f<e.length;f++){var g=e[f],h=g.id;if(h){var i="paymentclip-"+h,j=null;g.hasOwnProperty("script")&&(j=g.script),$("#"+a).append("<div class='paymentclip' id='"+i+"' style='display: none;'></div>"),b.theme.loadMedia(g.mediafolder+"/"+g.filename,i,j,b.paymentClipLoaded,d)}}},b.goOffline=function(a,c){var d=document.getElementById("wrap");d&&(d.style.left="0%",d.style.transform="translateX(0%)"),b.changePhase(b.phaseType.OFFLINE,a,c)},b.loadPhaseMover=function(a){var c="9";if(a===b.phaseType.OFFLINE||a===b.phaseType.SPLASH)b.phaseMover.reset(),b.phaseMover.hide();else{var d=_nex.assets.theme.system.USERINTERFACE.hasOwnProperty("POSITION")?_nex.assets.theme.system.USERINTERFACE.POSITION.align||9:9,e=_nex.assets.theme.system.USERINTERFACE.hasOwnProperty("POSITION")?_nex.assets.theme.system.USERINTERFACE.POSITION.resolution||8:8;_nex.splashPhase.splashSettings&&(_nex.splashPhase.splashSettings.align&&(d=_nex.splashPhase.splashSettings.align),_nex.splashPhase.splashSettings.resolution&&(e=_nex.splashPhase.splashSettings.resolution)),_nex.splashPhase.handledSplashClick||(d===c?b.phaseMover.show(_nex.splashPhase.clickX,_nex.splashPhase.clickY):(b.phaseMover.positionToSpot(d),b.phaseMover.show()),_nex.splashPhase.handledSplashClick=!0),b.phaseMover.size(e)}}}function PopupManager(a,b){var c=this;if(c.popupInfo=new Array,c.popupstarttime=null,"UX"===_nex.context?(c.popups=a.popups,c.theme=a.theme,c.popups.hasOwnProperty("POPUP")&&(c.popupInfo=$.isArray(c.popups.POPUP)?c.popups.POPUP:new Array(c.popups.POPUP))):(c.popups=a,c.theme=_iorderfast.assets.theme),c.debugEnabled=!1,c.debug=function(){c.debugEnabled&&console.debug("PopupManager",arguments)},c.initCallback=b,c.popupsLoaded=function(a,b){$("#"+a).append(b),null!==c.initCallback&&c.initCallback()},void 0!==c.popups){var d=$("#targets").find("#popups");d.length>0&&d.remove(),$("#targets").append('<div id="'+c.popups.id+'" ></div>');var e=null;c.popups.hasOwnProperty("script")&&(e=c.popups.script),"UX"===_nex.context?c.theme.loadMedia(c.popups.mediafolder+"/"+c.popups.filename,c.popups.id,e,c.popupsLoaded):_iorderfast.nav.loadMedia(c.popups.mediafolder+"/"+c.popups.filename,c.popups.id,e,c.popupsLoaded)}c._getPopup=function(a){for(var b=null,d=0;d<c.popupInfo.length&&null===b;d++)c.popupInfo[d].id.toLowerCase()===a.toLowerCase()&&(b=c.popupInfo[d]);return b},c.showPopup=function(a,b,d){var e=null;if("object"==typeof a)if(e=$("#"+a.name),e.length>0){var f=e.find("#messageText");if(f.length>0&&a.message.length>0&&(f.empty(),f.append(a.message),f.attr("tabindex","1")),a.hasOwnProperty("roundUpYesAmount")){var g=e.find("#roundUpYesAmountText");g.length>0&&a.roundUpYesAmount.length>0&&(g.empty(),g.append(a.roundUpYesAmount))}if(a.hasOwnProperty("roundUpNoAmount")){var h=e.find("#roundUpNoAmountText");h.length>0&&a.roundUpNoAmount.length>0&&(h.empty(),h.append(a.roundUpNoAmount))}if(a.hasOwnProperty("setContent")&&a.setContent(e),c.debug(a.buttons),void 0!==a.buttons)for(var i=0;i<a.buttons.length;i++){var j=e.find("#"+a.buttons[i].id);if(j.length>0){j.button(),j.button("reset"),a.buttons[i].hidden&&j.hide(),void 0!==a.buttons[i].text&&(j.empty(),j.append(a.buttons[i].text));var k=a.buttons[i].clickEvent||"";"UX"===_nex.context&&k.length>0&&(k="_nex.assets.soundManager.playButtonHit();"+k),c.debug("setting click event to "+k),j.attr("onclick",k),j.attr("tabindex")||j.attr("tabindex","1")}}if(a.hasOwnProperty("onShowCallback")&&a.onShowCallback&&"function"==typeof a.onShowCallback?(e.off("shown.bs.modal"),e.on("shown.bs.modal",function(){c._kviReader(f),a.onShowCallback(),a.onShowCallback=function(){}})):(e.off("shown.bs.modal"),e.on("shown.bs.modal",function(){c._kviReader(f)})),e.modal("show"),c._kviReader&&c._kviReader.rebind&&c._kviReader.rebind(),a.usedelay&&(c.popupstarttime=new Date),"UX"===_nex.context&&($(".modal-backdrop").appendTo("#wrap"),a.autotimeout&&setTimeout(function(){e.modal("hide")},d||4e3),a.hasOwnProperty("voiceover")&&a.voiceover.length>0)){var l=a.voiceover,m=c._getPopup(a.name);null!==m&&m.hasOwnProperty("voiceover")&&m.voiceover.length>0&&(l=m.voiceover),_nex.assets.soundManager.playVoiceover(l)}e.off("hidden.bs.modal"),void 0!==b&&e.on("hidden.bs.modal",function(c){try{a.hasOwnProperty("clearContent")&&a.clearContent(e)}catch(c){}_nex.timingOut?window.setTimeout(function(){_nex.timingOut=!1},0):b()})}else console.error("PopupManager: popup "+a.name+" not found"),void 0!==b&&b();else console.error("PopupManager: Could not find popup "+a.name);return e},c._kviReader=function(a){_nex.kviReader&&_nex.kviReader.rebind&&(_nex.kviReader.rebind(),a.length>0&&a.focus())},c.hidePopup=function(a,b){var d=a.name,e=$("#"+d);e.length<=0&&b();
var f=0;if(a.usedelay){var g=0;void 0!=c.theme.system.USERINTERFACE.popupdelaytime&&$.isNumeric(c.theme.system.USERINTERFACE.popupdelaytime)&&(g=Number(c.theme.system.USERINTERFACE.popupdelaytime)),f=g-c.popupElapsedTime(c.popupstarttime),f<0&&(f=0),c.popupstarttime=null}void 0!==b&&(console.log("popupmanager.hidePopup - listen for popup to be hidden"),e.on("hidden.bs.modal",function(a){console.log("popupmanager.hidePopup - popup hidden"),e.off("hidden.bs.modal"),b()})),setTimeout(function(){e.length>0?(e.modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()):inPreviewer()||console.log("popupManager: Missing element "+d+" to hide.")},f)},c.hideAllPopups=function(a){console.log("hide all popups called.");var b=$(".modal:visible").length;if(b<=0)return console.log("No popups. Calling callback."),void(a&&a());$(".modal:visible").each(function(c){c!==b-1?($(this).modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove()):(a&&$(this).on("hidden.bs.modal",function(b){$(this).off("hidden.bs.modal"),a()}),$(this).modal("hide"))})},c.popupElapsedTime=function(a){var b=0,c=new Date;return void 0!=a&&$.isNumeric(a.getTime())&&(b=c.getTime()-a.getTime(),b<0&&(b=0)),b},c.errorPopup={name:"popup-error",message:"",buttons:[],autotimeout:!0},c.messagePopup={name:"popup-message",message:"",buttons:[],autotimeout:!0},c.processingPopup={name:"popup-processing",message:"Processing...",buttons:[],usedelay:!0,onShowCallback:function(){}},c.futurePopup={name:"popup-future",message:"",buttons:[{id:"yes",text:c.theme.getTextAttribute("ORDER","yes","YES"),clickEvent:""},{id:"no",text:c.theme.getTextAttribute("ORDER","no","NO"),clickEvent:""}]},c.yesNoPopup={name:"popup-yes-no",message:"",buttons:[{id:"yes",text:c.theme.getTextAttribute("ORDER","yes","YES"),clickEvent:""},{id:"no",text:c.theme.getTextAttribute("ORDER","no","NO"),clickEvent:""}]},c.charityYesNoPopup={name:"popup-charity-yes-no",message:"",roundUpYesAmount:"",roundUpNoAmount:"",buttons:[{id:"yes",text:c.theme.getTextAttribute("ORDER","yes","YES"),clickEvent:""},{id:"no",text:c.theme.getTextAttribute("ORDER","no","NO"),clickEvent:""}]},c.dicoPopup={name:"popup-dico",message:"",buttons:[{id:"dinein",text:c.theme.getTextAttribute("ORDERREVIEW","dinetext","DINE IN"),clickEvent:""},{id:"takeout",text:c.theme.getTextAttribute("ORDERREVIEW","taketext","TAKE OUT"),clickEvent:""}],voiceover:"Dine In or Take Out.mp3"},c.needMoreTimePopup={name:"popup-need-more-time",message:"",buttons:[{id:"yes",text:c.theme.getTextAttribute("ORDER","yes","YES"),clickEvent:""}],voiceover:"Need More Time.mp3"},c.dismissibleMessagePopup={name:"popup-dismissible-message",message:"",buttons:[{id:"dismissibleok",text:c.theme.getTextAttribute("ORDER","ok","OK"),clickEvent:""}]},c.ageVerificationPopup={name:"popup-age-verification",header:"",message:"",buttons:[{id:"over21",text:c.theme.getTextAttribute("AGEVERIFICATION","over21","I am over 21"),clickEvent:""},{id:"under21",text:c.theme.getTextAttribute("AGEVERIFICATION","under21","I am under 21"),clickEvent:""}]},c.nutritionPopup={name:"popup-nutrition",header:"",message:"",buttons:[],item:null,setContent:function(a){null!==this.item&&c.theme.setNutrition(this.item,a,!1)}},c.keyboardPopup={name:"popup-keyboard",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","save","SAVE"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}]},c.emailPopup={name:"popup-email",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","save","SAVE"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}]},c.numpadPopup={name:"popup-numpad",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","ok","OK"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}],onShowCallback:function(){}},c.upcpadPopup={name:"popup-upcpad",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","save","SAVE"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}]},c.pinpadPopup={name:"popup-pinpad",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","save","SAVE"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}],autotimeout:!0},c.phonepadPopup={name:"popup-phonepad",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","ok","OK"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}]},c.NamePopup={name:"popup-name",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","ok","OK"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}]},c.PagerPopup={name:"popup-pager",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","ok","OK"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}],onShowCallback:function(){}},c.orderOptionsPopup={name:"popup-orderOptions",message:"",buttons:[{id:"lookupPin",text:c.theme.getTextAttribute("ORDER","pin","I HAVE AN ORDER PIN"),clickEvent:""},{id:"previousOrder",text:c.theme.getTextAttribute("ORDER","previous","LOOKUP PREVIOUS ORDERS"),clickEvent:""},{id:"newOrder",text:c.theme.getTextAttribute("ORDER","new","START A NEW ORDER"),clickEvent:""}]},c.lookupPopupVideo={name:"popup-lookupvideo",message:"",buttons:[{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}],setContent:function(a){c.theme.setVideoFeed(a)},clearContent:function(a){c.theme.clearVideoFeed(a)},autotimeout:!1},c.lookupPopup={name:"popup-lookup",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("ORDER","ok","OK"),clickEvent:""},{id:"cancel",text:c.theme.getTextAttribute("ORDER","cancel","CANCEL"),clickEvent:""}]},c.offersPopup={name:"popup-offers",message:"",buttons:[{id:"ok",text:c.theme.getTextAttribute("OFFERS","ok","OK"),clickEvent:""}]}}function TabManager(){var a=this;a.tabNav=function(){$("#navChangeAccount").attr("tabindex","21"),$("#navChangePassword").attr("tabindex","22"),$("#navLogout").attr("tabindex","23")},a.previousOrders=function(){a.addTabIndex("a",2),a.addTabIndex("button#ctrl-continue",3),a.addTabIndex("button",4)},a.ordering=function(){$(".menu-header-text").attr("tabindex","1"),a.tabButtons()},a.tabInputs=function(){$('input[type="text"], select,textarea').attr("tabindex",2)},a.tabCompleteMobile=function(){},a.tabButtons=function(){_nex.kviReader?$("div#orderreview").each(function(a){_nex.kviReader&&$(this).attr("tabindex","2")}):$(".order-review-item","#orderreview").each(function(a){var b=$(this).text(),c=b.trim();c.length>0&&$(this).attr("tabindex","2")}),$(".order-review-item").each(function(a){$(this).attr("tabindex","2")}),$(".order-review-quantity-minus, .order-review-quantity-plus").each(function(a){$(this).attr("tabindex","2")}),$("#ctrl-continue, #ctrl-done, #ctrl-submit, #ctrl-orderreview").each(function(a){$(this).attr("tabindex","3")}),$("#ctrl-add-item").each(function(a){$(this).attr("tabindex","4")}),$("#ctrl-back").each(function(a){$(this).attr("tabindex","5")}),$("#ctrl-cancel").each(function(a){$(this).attr("tabindex","10")})},a.hasTabIndex=function(a){return $(a).is("[tabindex]")},a.addTabIndex=function(b,c,d){if(b&&"string"==typeof b){var e=$(b);e.each(function(e,f){var g=$(f);a.hasTabIndex(g)&&!d||(console.debug("Adding tab index "+c+" to "+b+" index "+e),g.attr("tabindex",c))})}},a.removeTabIndex=function(a){if(a&&"string"==typeof a){var b=$(a+" [tabindex]");b.each(function(a,b){b.removeAttr("tabindex",tabindex)})}}}function TemplateManager(a){var b=this;b._pendingScan=!1,b.templates=a.TEMPLATE,b.buttonRegions=$.isArray(a.BUTTONREGIONS)?a.BUTTONREGIONS:new Array(a.BUTTONREGIONS);try{for(var c=0;c<b.templates.length;c++)if(b.templates[c].hasOwnProperty("scripturl")&&b.templates[c].scripturl.length>0&&_nex.assets.theme.loadScript){var d=_nex.assets.theme.mediaPath()+"html/js/",e=d+b.templates[c].scripturl;_nex.assets.theme.loadScript(e)}}catch(f){}b.findTemplate=function(a){for(var c=null,d=0;d<b.templates.length&&null===c;d++)b.templates[d].name===a&&(c=$.extend(!0,{},b.templates[d]));return c},b.templatePricedBy=function(a){var c="item",d=b.findTemplate(a);return null!==d&&d.hasOwnProperty("pricedby")&&(c=d.pricedby),c},b.isOrderReview=function(a){var c=!1,d=b.findTemplate(a);return c=null!==d&&d.hasOwnProperty("classname")?"order review"===a.toLowerCase()||"orderreview"===d.classname.toLowerCase():"order review"===a.toLowerCase()},b.isReceiptVisible=function(a,c){var d=!0,e=b.findTemplate(a);return null!==e&&e.hasOwnProperty("displayreceipt")&&(d="true"===e.displayreceipt.toLowerCase()),d=c>0||_nex.assets.theme.system.USERINTERFACE.hasOwnProperty("alwaysshowreceipt")&&"true"===_nex.assets.theme.system.USERINTERFACE.alwaysshowreceipt.toLowerCase()},b.findButtonRegions=function(a){var c=null;if(a=a||"",a.length>0)for(var d=0;d<b.buttonRegions.length&&null===c;d++)b.buttonRegions[d].id===a&&(c=b.buttonRegions[d]);else b.buttonRegions.length>0&&(c=b.buttonRegions[0]);return c},b.getButtonId=function(a,c){var d="";if(void 0!==a&&void 0!==c){var e=b.findTemplate(a);if(null!==e&&e.hasOwnProperty("SUPPORTEDBUTTONTYPE"))for(var f=$.isArray(e.SUPPORTEDBUTTONTYPE)?e.SUPPORTEDBUTTONTYPE:new Array(e.SUPPORTEDBUTTONTYPE),g=0;g<f.length&&""===d;g++)f[g].buttontype===c&&void 0!==f[g].buttonid&&(d=f[g].buttonid)}return d},b.getColumnCount=function(a,c){var d=4;try{if(void 0!==a&&null!==a){var e=b.findTemplate(a);if(null!==e)if(e.hasOwnProperty("buttonrendermode")&&"dynamic"===e.buttonrendermode.toLowerCase()){var f=b.findButtonRegions(e.buttonregionsid);if(null!==f)for(var g=$.isArray(f.BUTTONREGION)?f.BUTTONREGION:new Array(f.BUTTONREGION),h=0;h<g.length;h++)if(c<=Number(g[h].buttoncount)||h===g.length-1){d=Number(g[h].columns),c<d&&"center"===g[h].colalign&&(d=c);break}}else e.hasOwnProperty("htmlcolumns")&&e.htmlcolumns.length>0&&(d=Number(e.htmlcolumns))}}catch(i){}return d},b.executeBehavior=function(a){var c=b.findTemplate(a.template);if(null!==c&&b.templateBehaviors.hasOwnProperty(c.classname)&&b.templateBehaviors[c.classname].hasOwnProperty("executeBehavior"))return b.templateBehaviors[c.classname].executeBehavior(a,c)},b.hasButtons=function(a){var c=!0,d=b.findTemplate(a.template);return null!==d&&b.templateBehaviors.hasOwnProperty(d.classname)&&b.templateBehaviors[d.classname].hasOwnProperty("hasButtons")?b.templateBehaviors[d.classname].hasButtons(a,d):c},b.templateLoaded=function(a){var c=b.findTemplate(a.template);if(null!==c&&b.templateBehaviors.hasOwnProperty(c.classname)&&b.templateBehaviors[c.classname].hasOwnProperty("templateLoaded"))return b.templateBehaviors[c.classname].templateLoaded(a,c)},b.templateUnloaded=function(a){try{if(void 0!==b.barListener&&null!==b.barListener&&b.barListener.stop(),a){var c=b.findTemplate(a.template);if(null!==c){var d=b._getClassName(c);if(b.templateBehaviors[d].hasOwnProperty("templateUnloaded"))return b.templateBehaviors[d].templateUnloaded(a,c)}}}catch(e){}},b.refreshButtons=function(a,c){var d=b.findTemplate(a.template);if(null!==d){var e=b._getClassName(d);if(b.templateBehaviors[e].hasOwnProperty("refreshButtons"))return b.templateBehaviors[e].refreshButtons(a,d,c)}},b.isButtonAvailable=function(a,c,d){var e=!0;if(c){var f=b._getClassName(c);b.templateBehaviors.hasOwnProperty(f)&&b.templateBehaviors[f].hasOwnProperty("isButtonAvailable")&&(e=b.templateBehaviors[f].isButtonAvailable(a,c,d))}return e},b.getPriceOverride=function(a,c){var d="";if(a){var e=b.findTemplate(a),f=b._getClassName(e);b.templateBehaviors.hasOwnProperty(f)&&b.templateBehaviors[f].hasOwnProperty("getPriceOverride")&&(d=b.templateBehaviors[f].getPriceOverride(c))}return d},b._getClassName=function(a){var c="_defaultBehavior";return a.classname&&b.templateBehaviors.hasOwnProperty(a.classname)&&(c=a.classname),c},b.isContinueVisible=function(a){var c=!0,d=b.findTemplate(a.template);return null!==d&&b.templateBehaviors.hasOwnProperty(d.classname)&&b.templateBehaviors[d.classname].hasOwnProperty("continueButton")?b.templateBehaviors[d.classname].continueButton(a,d):c},b.templateBehaviors={_defaultBehavior:{refreshButtons:function(a,b,c,d){var e=0,f=null;f="UX"===_nex.context?_nex.orderManager.currentOrder.currentItem():_iorderfast.ordering.currentItem();var g=a.hasOwnProperty("maxquantity")&&a.maxquantity.length>0?Number(a.maxquantity):0;if(g>0&&null!==f){var h=0,i=f.ITEM,j=b.hasOwnProperty("pricedby")&&"menu"===b.pricedby.toLowerCase();if(i)for(var k=0;k<i.length;k++){var l=!0,m=i[k].BUTTONINFO;(m&&m.hasOwnProperty("removeposid")&&m.removeposid===i[k].posid||i[k].posid.toLowerCase().indexOf("-no")!==-1)&&(l=!1),l&&(j?i[k].menuid===_nex.ordering.currentMenuId.toString()&&(h+=Number(i[k].modquantity)):h+=Number(i[k].modquantity))}if(h>=g){for(var k=0;k<c.length;k++){for(var n=!1,o=0;o<i.length&&!n;o++)n=Number(i[o].bindex)===k+e&&i[o].menuid===_nex.ordering.currentMenuId.toString();if(!n){var p=c[k].html.data("state");p&&"up"===p.toLowerCase()&&c[k].html.addClass("gray-out")}}d||"false"===_nex.assets.theme.system.USERINTERFACE.autoadvance.toLowerCase()||_nex.ordering.loadMenu(Number(a.continuemenu))}else for(var o=0;o<c.length;o++)c[o].html.removeClass("gray-out")}}},SelectManyofNIntegratedFlavor:{templateLoaded:function(a,b){if(b.hasOwnProperty("itemtype")&&"item"===b.itemtype.toLowerCase());else{var c=_nex.ordering.currentItem(),d=(this.calcMaxCount(a,b,c),this.getModifierCount(a,b,c));c.flavorcount=d}this.refreshButtons(a,b,_nex.ordering.buttons,!0)},executeBehavior:function(a,b){if(b.hasOwnProperty("itemtype")&&"item"===b.itemtype.toLowerCase());else{var c=_nex.ordering.currentItem(),d=this.calcMaxCount(a,b,c),e=this.getModifierCount(a,b,c);c.flavorcount=e,null!==c&&c.flavorcount>=d&&"false"!==_nex.assets.theme.system.USERINTERFACE.autoadvance.toLowerCase()&&_nex.ordering.loadMenu(a.continuemenu)}},refreshButtons:function(a,b,c,d){if(b.hasOwnProperty("itemtype")&&"item"===b.itemtype.toLowerCase()){var e=_nex.orderManager.currentOrder.alcoholCount(),f=""===a.maxquantity||isNaN(a.maxquantity)?-1:Number(a.maxquantity);if("true"===_nex.ordering.currentMenu.alcohol.toLowerCase()&&(f=_nex.assets.theme.alcoholLimit),f>-1)if(e>=f){for(var g=0;g<c.length;g++){var h=c[g].html.data("state");h&&"up"===h.toLowerCase()?c[g].html.addClass("gray-out"):(c[g].quantityLimitReached=!0,c[g].refreshSubButtons())}d||"false"===_nex.assets.theme.system.USERINTERFACE.autoadvance.toLowerCase()||_nex.ordering.loadMenu(Number(a.continuemenu))}else for(var i=0;i<c.length;i++)c[i].html.removeClass("gray-out"),c[i].quantity<f&&c[i].quantityLimitReached&&(c[i].quantityLimitReached=!1,c[i].refreshSubButtons())}else for(var j=0;j<c.length;j++)c[j].state()},continueButton:function(a,b){var c=!0;if(b.hasOwnProperty("itemtype")&&"item"===b.itemtype.toLowerCase()){var d=""===a.incquantity||isNaN(a.incquantity)?1:Number(a.incquantity),e=this.getItemCount(a);c=e>=d}else{var f=_nex.ordering.currentItem(),g=this.calcMaxCount(a,b,f);c=!!(null!==f&&f.hasOwnProperty("flavorcount")&&f.flavorcount>=g)||b.hasOwnProperty("allownoselection")&&"true"===b.allownoselection.toLowerCase()}return c},getItemCount:function(a){for(var b=0,c=0;c<_nex.ordering.order.ITEM.length;c++){var d=_nex.ordering.order.ITEM[c];d.menuid===a.id&&(b+=Number(d.quantity))}return b},getModifierCount:function(a,b,c){var d=0;if(c.ITEM)for(var e=$.isArray(c.ITEM)?c.ITEM:new Array(c.ITEM),f=0;f<e.length;f++)e[f].menuid===a.id&&(d+=Number(e[f].modquantity));return d},calcMaxCount:function(a,b,c){var d=a.hasOwnProperty("incquantity")?Number(a.incquantity):1,e=0;if(b.hasOwnProperty("currentitemonly")&&"false"===b.currentitemonly.toLowerCase())for(var f=0;f<_nex.ordering.order.ITEM.length;f++){var g=_nex.ordering.order.ITEM[f];g.menuid!==a.id&&(e+=Number(g.quantity))}else e=null!==c?Number(c.quantity):0;return b.hasOwnProperty("productofitem")&&"true"===b.productofitem.toLowerCase()&&(d*=e),d}},SelectManyofNIntegrated:{templateLoaded:function(a,b){this.refreshButtons(a,b,_nex.ordering.buttons,!0)},refreshButtons:function(a,b,c,d){void 0===d&&(d=!1);var e=a.hasOwnProperty("maxquantity")&&a.maxquantity.length>0?Number(a.maxquantity):0;if(e>0&&null!==_nex.ordering.currentItem()){console.log("menu "+a.id+" - maxquanity: "+e);var f=0,g=_nex.ordering.currentItem().ITEM,h=b.hasOwnProperty("pricedby")&&"menu"===b.pricedby.toString().toLowerCase();if(void 0!==g)for(var i=0;i<g.length;i++)h?g[i].menuid===a.id&&(f+=g[i].modquantity.length>0?Number(g[i].modquantity):1):f+=g[i].modquantity.length>0?Number(g[i].modquantity):1;if(f>=e){for(var j=0;j<c.length;j++){var k=c[j].html.data("state");k&&"up"===k.toLowerCase()&&c[j].html.addClass("gray-out")}d||"false"===_nex.assets.theme.system.USERINTERFACE.autoadvance.toLowerCase()||_nex.ordering.loadMenu(Number(a.continuemenu))}else for(var l=0;l<c.length;l++)c[l].html.removeClass("gray-out");for(var m=0;m<c.length;m++)"SELECTOTHER"===c[m].name&&c[m].orderUpdated()}}},Toggle:{_selectedButtons:[],_isProcessing:!1,templateLoaded:function(a,b){var c=_nex.ordering.buttons;if(this._selectedButtons=new Array(c.length),b.hasOwnProperty("RULE"))for(var d=$.isArray(b.RULE)?b.RULE:new Array(b.RULE),e=0;e<d.length;e++)for(var f=0;f<c.length;f++)this._selectedButtons[f]="SELECTMANYMODIFIER"===c[f].name.toUpperCase()&&"down"===c[f].html.data("state");console.log("Toggle.templateLoaded - _selectedButtons count: "+this._selectedButtons.length.toString()),this.refreshButtons(a,b,c,!0)},refreshButtons:function(a,b,c,d){if(b.hasOwnProperty("RULE")&&!this._isProcessing){this._isProcessing=!0;for(var e=$.isArray(b.RULE)?b.RULE:new Array(b.RULE),f=0;f<e.length;f++)try{var g=e[f],h=Number(g.startbutton),i=Number(g.endbutton),j=Number(g.maxselected),k=0,l=0;console.log("Toggle.refreshButtons - executing rule w/ start: "+h.toString()+"; end: "+i.toString()+"; max selected: "+j.toString());for(var m=h;m<=i&&m<c.length;m++)"SELECTMANYMODIFIER"===c[m].name.toUpperCase()&&"down"===c[m].html.data("state")&&k++;if(console.log("Toggle.refreshButtons - selected count: "+k.toString()),1===j)for(l=h;l<=i&&l<c.length;l++)"SELECTMANYMODIFIER"===c[l].name.toUpperCase()&&"down"===c[l].html.data("state")?(console.log("Toggle.refreshButtons -button down: "+l.toString()+"; isselected: "+this._selectedButtons[l].toString()),this._selectedButtons[l]&&k>j?(console.log("Toggle.refreshButtons -autclick button; index: "+l.toString()),this._selectedButtons[l]=!1,c[l].autoClick()):!this._selectedButtons[l]&&k>=j&&(console.log("Toggle.refreshButtons -set isselected: "+l.toString()),this._selectedButtons[l]=!0)):"SELECTMANYMODIFIER"===c[l].name.toLowerCase()&&"up"===c[l].html.data("state")&&this._selectedButtons[l]&&0===k&&(console.log("Toggle.refreshButtons -autclick button; index: "+l.toString()),this._selectedButtons[l]=!1,c[l].autoClick());else if(k>=j)for(l=h;l<=i;l++)"SELECTMANYMODIFIER"===c[l].name.toUpperCase()&&("down"===c[l].html.data("state")?c[l].disableButton(!1):this._selectedButtons[l]||(this._selectedButtons[l]=!0,c[l].disableButton(!0)));else for(l=h;l<=i;l++)c[l].disableButton(!1),"SELECTMANYMODIFIER"===c[l].name.toUpperCase()&&("up"===c[l].html.data("state")?this._selectedButtons[l]&&(this._selectedButtons[l]=!1):this._selectedButtons[l]||(this._selectedButtons[l]=!0))}catch(n){console.log(n.message)}this._isProcessing=!1}}},WeighItem:{hasButtons:function(a,b){return!1},templateLoaded:function(a,c){var d=$.extend(!0,{},_nex.assets.popupManager.errorPopup);_nex.communication.send(new _nex.commands.EnableScale("EnableScale"),function(a){a.responseReceived?_nex.ordering.buttons.length>0?b.AddWeight(_nex.ordering.buttons[0].posid(),a.weight,a.uom):console.error("EnableScale Failed! Weight modifier not found"):"1"===a.result?(d.message=_nex.assets.theme.getTextAttribute("ORDER","weighitemtimeout","Item not weighed, please place the item on the scale"),_nex.assets.popupManager.showPopup(d)):"2"===a.result&&(d.message=_nex.assets.theme.getTextAttribute("ORDER","weighitemerror","Item not weighed, please place the item on the scale"),_nex.assets.popupManager.showPopup(d))},"ITEMWEIGHT")}},ScanItems:{hasButtons:function(a,b){return!1},templateLoaded:function(a,c){_nex.splashPhase.hasOwnProperty("barcodeData")&&_nex.splashPhase.barcodeData&&(b.addItemBarcode(_nex.splashPhase.barcodeData),_nex.splashPhase.barcodeData=null),console.debug("Scan template loaded"),b.upcOverride($("#ctrl-scanoverride")),b.barListener=new DeviceListener("BARCODE",b.addItemBarcode,(!1)),b.barListener.start(),console.debug("Listener started"),ko.applyBindings(new ScanItems,document.getElementById("scanItems"))}}},b.AddWeight=function(a,c,d){_nex.communication.send(new _nex.commands.AddWeight(a,c,d),function(e){if(_nex.kviReader&&_nex.kviReader.jackedIn()){_nex.orderManager.currentOrder.update(e.ORDER),console.log(e.ORDER);var f=_nex.orderManager.currentOrder.currentItem();if(f&&f.hasOwnProperty("amountdue")){var g="$"+currency.formatAsDollars(itemFormatting.getPrice(f),!1);b._accounceWeight(a,c,d,g,function(){_nex.ordering.loadMenu()})}else console.log("error getting at current item")}else _nex.ordering.loadMenu()},"ADDTOORDERRESPONSE")},b._accounceWeight=function(a,b,c,d,e){var f=new Array(1);f[0]="pounds";var g=_nex.assets.theme.getTextAttribute("ORDER","defaultweight","pounds");try{g=f[c]}catch(h){console.log("Unknown unit encountered "+c)}var i=$.extend(!0,{},_nex.assets.popupManager.messagePopup),j=_nex.assets.theme.getTextAttribute("ORDER","kviweight","This item weighs {0} "+g+" and costs {1}"),k=j.replace("{0}",b);k=k.replace("{1}",d),i.message=k,_nex.assets.popupManager.showPopup(i,function(){e()},7e3)},b.upcOverride=function(a){null!==a&&void 0!==a&&a.click(function(){var a=$.extend(!0,{},_nex.assets.popupManager.upcpadPopup);a.buttons[0].clickEvent="_nex.assets.templateManager.addUpcOverrideItem()",a.message=_nex.assets.theme.getTextAttribute("ORDER","scanoverride","Please enter a upc code"),_nex.assets.popupManager.showPopup(a),_nex.keyboard.numpad.bindKeys()})},b.addUpcOverrideItem=function(){var a=_nex.keyboard.numpad.data;b.addItemBarcode(a)},b.addItemBarcode=function(a){if(!b._pendingScan){b._pendingScan=!0;var c=$.extend(!0,{},_nex.assets.popupManager.errorPopup);_nex.communication.send(new _nex.commands.ItemLookup(2,a,"ItemLookup"),function(a){if(a.responseReceived||(c.message=_nex.assets.theme.getTextAttribute("ORDER","scanitems","An error occured during scanning. Please scan again"),_nex.assets.popupManager.showPopup(c),console.log("No response received from server after scan."),b._pendingScan=!1),void 0===a.ITEM)c.message=_nex.assets.theme.getTextAttribute("ORDER","scanitems","Item not recognized. Please scan again"),_nex.assets.popupManager.showPopup(c,function(){b._pendingScan=!1}),console.log("Server response - Item Undefined.");else if(a.responseReceived){b._pendingScan=!1;var d=[];a.ITEM instanceof Array?d=a.ITEM:d.push(a.ITEM);for(var e=!0,f=0;f<d.length;f++){if("Item"!==d[f].DETAIL.itemtype&0===f)return c.message=_nex.assets.theme.getTextAttribute("ORDER","scanitems","Item not recognized. Please scan again"),_nex.assets.popupManager.showPopup(c),void console.log("The first item on the scan is not an ITEM - POSID: "+d[f].posid);if(e=_nex.assets.theme.itemIsAvailableXml(d[f]),e===!1)return c.message=_nex.assets.theme.getTextAttribute("ORDER","scanitems","Item not recognized. Please scan again"),_nex.assets.popupManager.showPopup(c),void console.log("Item unavilable on scanned barcode - POSID: "+d[f].posid)}return d.length>0&&b.processScan(d,0),a}},"ITEMLOOKUPRESPONSE")}},b.processScan=function(a,c){var d=a[c].price,e=_nex.assets.theme.itemTextByType(a[c],"RECEIPTTEXT");_nex.ordering.addToOrder(a[c].posid,void 0,void 0,void 0,function(){if(_nex.scanItems.addItem(e,d),_nex.kviReader&&_nex.kviReader.jackedIn()){var f=$.extend(!0,{},_nex.assets.popupManager.messagePopup),g=_nex.assets.theme.getTextAttribute("ORDER","kvibarcode","Item scanned: {0}  for  {1}"),h=g.replace("{0}",e);h=h.replace("{1}","$"+d),f.message=h,_nex.assets.popupManager.showPopup(f,function(){_nex.kviReader.rebind(),$("#scan-current-item-prompt").focus()},7e3)}c++,c<a.length&&window.setTimeout(function(){b.processScan(a,c)},0)},!0)}}function Theme(a,b){var c=this;c.menus=null,c.items=null,c.times=null,c.system=null,c.id=a||null,c.kioskText=null,c.priceLevels=null,c.paymentProfile=null,c.filter=new FilterCriteria,c.consolidate=!1,c.mediaRootUri=b||"",c.alcoholLimit=2,c.quantityLimit=9,c.itemRank=null,c.loaded=function(){},c.voiceoversEnabled=!1,c.splashVoiceover="",c.load=function(a){_iorderfast.command.send(new loadMenuCmd,function(b){console.log("menu download complete");var d=JSON.parse(b);"true"===d.success&&(c.id=d.SYSTEM.themeid,c.system=d.SYSTEM,c.system.storeid=_iorderfast.loc.id,c.dayparts=d.DAYPARTS.DAYPART,c.menus=d.MENUS.MENU,c.items=d.ITEMS.ITEM,c.times=d.TIME,c.kioskText=d.KIOSKTEXT,c.priceLevels=d.PRICELEVELS,c.paymentProfile=d.PAYMENTPROFILE,d.hasOwnProperty("PAYPALMERCHANTID")&&(_iorderfast.settings.paypal.merchantId=d.PAYPALMERCHANTID),_iorderfast.assets.phaseManager=new PhaseManager,_iorderfast.assets.phaseManager.loadTheme(d.THEME.PHASE),_iorderfast.assets.templateManager=new TemplateManager(d.TEMPLATES),c.system.hasOwnProperty("quantitylimit")&&(c.quantityLimit=Number(c.system.quantitylimit)),c.system.hasOwnProperty("alcohollimit")&&(c.alcoholLimit=Number(c.system.alcohollimit)),c.system.hasOwnProperty("consolidate")&&(c.consolidate="true"===c.system.consolidate.toLowerCase()),d.hasOwnProperty("thememediapath")&&(c.mediaRootUri=d.thememediapath),d.hasOwnProperty("ITEMRANK")&&(c.itemRank=d.ITEMRANK),_iorderfast.assets.popupManager=new PopupManager(d.THEME.POPUPS,function(){c.loaded(),_iorderfast.previousOrders.request(function(b){void 0!==a&&a(d)})}))})},c.isDayPartActive=function(a){var b=!1;if(null!==c.dayparts)for(var d=0;d<c.dayparts.length&&!b;d++)a.toLowerCase()==c.dayparts[d].name.toLowerCase()&&(b=!0);return b},c.itemByPosid=function(a){for(var b=null,d=0;d<c.items.length&&null===b;d++)c.items[d].posid===a&&(b=$.extend(!0,{},c.items[d]));return b},c.itemPrice=function(a,b){var d=a.price;if(void 0!==b&&b.length>0&&a.hasOwnProperty("PRICELEVEL")){var e=c.findPriceLevel(a,b);null!==e&&(d=e.price)}return d},c.findPriceLevel=function(a,b){var c=null;if(a.hasOwnProperty("PRICELEVEL"))for(var d=0;d<a.PRICELEVEL.length&&null!==b;d++)a.PRICELEVEL[d].name===b&&(c=a.PRICELEVEL[d]);return c},c.itemRecipe=function(a){var b=c.itemByPosid(a),d=[];return null!==b&&void 0!==b.RECIPE&&(d=$.isArray(b.RECIPE)?b.RECIPE:new Array(b.RECIPE)),d},c.itemTextByType=function(a,b){var d="",e=b.toLowerCase();switch(b){case"DESCRIPTION":e="descriptiontext";break;case"HEADER":e="headertext";break;case"MENUDESCRIPTION":e="menudescriptiontext"}var f=null;return a.hasOwnProperty("TEXT")?f=a.TEXT[b.toUpperCase()]:a.hasOwnProperty(b.toUpperCase())&&(f=a[b.toUpperCase()]),null!==f&&(d="UX"===_nex.context?c.getActiveLanguageText(f,e):f[e]),d||f&&f[0]&&f[0].buttontext&&(d=f[0].buttontext),d},c.itemIsAvailableXml=function(a){var b=!1;return null!==a&&(b="true"==a.enabled.toString().toLowerCase(),b&&a.DETAIL.daypart.toString().length>0&&(b=c.isDayPartActive(a.DETAIL.daypart)),b&&"true"==a.DETAIL.alcoholflag.toLowerCase()&&"Item"==a.DETAIL.itemtype&&(b="UX"===_nex.context?_nex.orderManager.currentOrder.alcoholEnabled:_iorderfast.ordering.alcoholEnabled),b&&(b=this.filter.doesItemPassFilter(a))),b},c.itemIsAvailable=function(a){var b=!1,d=c.itemByPosid(a);return null!==d&&(b="true"==d.enabled.toString().toLowerCase(),b&&d.DETAIL.daypart.toString().length>0&&(b=c.isDayPartActive(d.DETAIL.daypart)),b&&"true"==d.DETAIL.alcoholflag.toLowerCase()&&"Item"==d.DETAIL.itemtype&&(b="UX"===_nex.context?_nex.orderManager.currentOrder.alcoholEnabled:_iorderfast.ordering.alcoholEnabled),b&&(b=this.filter.doesItemPassFilter(d))),b},c.itemsByClassId=function(a,b){for(var c=[],d=0;d<a.length;d++)(a[d].hasOwnProperty("itemclassid")&&a[d].itemclassid===b||a[d].hasOwnProperty("parentitemclassid")&&a[d].parentitemclassid===b)&&c.push($.extend(!0,{},a[d]));return c},c.itemsByAttribute=function(a,b,d,e){for(var f=[],g=0;g<a.length;g++)if(a[g].hasOwnProperty("ATTRIBUTE")){var h=c.findItemAttribute(a[g],b,d);null!==h&&("equals"===e.toLowerCase()&&h.value.toLowerCase()===d.toLowerCase()?f.push($.extend(!0,{},a[g])):"not equal"===e.toLowerCase()&&h.value.toLowerCase()!==d.toLowerCase()&&f.push($.extend(!0,{},a[g])))}return f},c.findItemAttribute=function(a,b){var c=null;if(a&&a.hasOwnProperty("ATTRIBUTE")){a.ATTRIBUTE=$.isArray(a.ATTRIBUTE)?a.ATTRIBUTE:new Array(a.ATTRIBUTE);for(var d=0;d<a.ATTRIBUTE.length&&null===c;d++)a.ATTRIBUTE[d].name===b&&(c=a.ATTRIBUTE[d])}return c},c.getText=function(a){var b=null;return null!==c.kioskText&&c.kioskText.hasOwnProperty(a)&&(b=c.kioskText[a]),b},c.itemPriceLevelText=function(a){var b="";if(null!==a&&a.hasOwnProperty("pricelevel")&&(b=a.pricelevel,null!==c.priceLevels))for(var d=!1,e=0;e<c.priceLevels.length&&!d;e++)c.priceLevels[e].name===a.pricelevel&&c.priceLevels[e].hasOwnProperty("display")&&(b=c.priceLevels[e].display,d=!0);return b},c.getTextAttribute=function(a,b,d){void 0===d&&(d="");var e=d,f=c.getText(a);return null!==f&&f.hasOwnProperty(b)&&""!==f[b]&&(e=f[b]),"UX"!==_nex.context?e:("english"!==c.languageSelected&&c.otherLanguages&&(f=c.getLanguageText(c.languageSelected,a),null!==f&&f.hasOwnProperty(b)&&""!==f[b]&&(e=f[b])),itemFormatting.buttonText(e))},c.getFileTextAttribute=function(a,b){void 0===b&&(b="");var d="";if(c.kioskText.hasOwnProperty("FILE"))for(var e=0;e<c.kioskText.FILE.length&&""===d;e++)c.kioskText.FILE[e].id===a&&(d=c.kioskText.FILE[e].contents);return void 0!==d&&""!==d||(d=b),"UX"===_nex.context?itemFormatting.buttonText(d):d},c.menuHasAlcohol=function(a){var b=!1,d=Number(a)-1;if(d<c.menus.length){var e=c.menus[d];b=null!==e&&"true"===e.alcohol.toLowerCase()}return b},c.isTenderTaxExempt=function(a){for(var b=!1,d=0;d<c.system.TENDER.length&&!b;d++)c.system.TENDER[d].type===a&&(b="true"===c.system.TENDER[d].istaxexempt.toLowerCase());return b},c.isPreAuthRequired=function(a){for(var b=!1,d=0;d<c.system.TENDER.length&&!b;d++)c.system.TENDER[d].type===a&&(b="true"===c.system.TENDER[d].preauth.toLowerCase()||c.system.TENDER[d].hasOwnProperty("preauthandpay")&&"true"===c.system.TENDER[d].preauthandpay.toLowerCase());return b},c.isPreAuthAndPay=function(a){for(var b=!1,d=0;d<c.system.TENDER.length&&!b;d++)c.system.TENDER[d].type===a&&(preAuth=c.system.TENDER[d].hasOwnProperty("preauthandpay")&&"true"===c.system.TENDER[d].preauthandpay.toLowerCase());return preAuth},c.isFinal=function(a){for(var b=!0,d=0;d<c.system.TENDER.length;d++)if(c.system.TENDER[d].type===a){b="true"===c.system.TENDER[d]["final"].toLowerCase();break}return b},c.setControlButtonText=function(a,b){var c=$("#"+a);if(c.length>0){var d=c.find("#btext");d.length>0?(d.empty(),d.append(b)):(c.empty(),c.append(b))}},c.setButtonText=function(a,b){var c=$("#"+a);if(c.length>0){var d=c.find(".buttonText");d.length>0?(d.empty(),d.append(b)):(c.empty(),c.append(b))}},c.setNutrition=function(a,b){var c=function(a,b,c,d){var e=_iorderfast.assets.theme.findItemAttribute(d,a),f=null!==e?e.value:"",g=c.find("#"+b);g.length>0&&(g.empty(),g.append(f))};null!==a&&(c("Serving Size","serving",b,a),c("Calories Per Serving","calories",b,a),c("Total Fat","totalFat",b,a),c("Saturated Fat","satFat",b,a),c("Trans Fat","transFat",b,a),c("Cholesterol","cholesterol",b,a),c("Sodium","sodium",b,a),c("Total Carbohydrates","totalCarbs",b,a),c("Sugar","sugars",b,a),c("Protein","protein",b,a),c("Fiber","fiber",b,a))}}function TotalsModel(){var a=this;a.subtotal=ko.observable("0.00"),a.salestax=ko.observable(""),a.salestax2=ko.observable(""),a.deliveryfee=ko.observable(""),a.roundupcharity=ko.observable(""),a.amountdue=ko.observable(""),a.gratuity=ko.observable(""),a.discount=ko.observable("0.00"),a.remainingbalance=ko.observable("0.00");
}!function(){var a=function(a,b){return a<b?-1:a==b?0:1},b=function(a,b,c){for(var d=[];a.length>0||b.length>0;)a.length>0&&b.length>0?c(a[0],b[0])<=0?(d.push(a[0]),a=a.slice(1)):(d.push(b[0]),b=b.slice(1)):a.length>0?(d.push(a[0]),a=a.slice(1)):b.length>0&&(d.push(b[0]),b=b.slice(1));return d},c=function(c){var d=this,e=d.length,f=Math.floor(e/2);return c||(c=a),e<=1?d:b(d.slice(0,f).mergeSort(c),d.slice(f,e).mergeSort(c),c)};Array.prototype.mergeSort=c}(),_nex.assets.buttons._BaseButton=function(){var a=this;a.name="",a.buttonId="",a.menuItem={},a.html=null,a.getProperty=function(b,c){var d=c;return a.menuItem.hasOwnProperty(a.name)&&a.menuItem[a.name].hasOwnProperty(b)&&(d=a.menuItem[a.name][b],!Array.isArray(d)&&Array.isArray(c)&&(d=new Array(d))),d},a.action=function(){},a.attributes=function(){return a.getProperty("ATTRIBUTE",[])},a.autoClick=function(a,b){void 0!==b&&null!==b&&b()},a.buttonText=function(){},a.buttonInfo=function(){return{name:a.buttonName}},a.descriptionText=function(){return""},a.descriptionType="description-text",a._disabled=!1,a.hasItemRank=!1,a.hasFilter=function(){return!1},a.hasPosid=function(){return!1},a.image=function(){},a.overlayimages=function(){var b=[];if(a.item&&a.item.ATTRIBUTE)for(var c=Array.isArray(a.item.ATTRIBUTE)?a.item.ATTRIBUTE:new Array(a.item.ATTRIBUTE),d=0;d<c.length;d++){var e=c[d];0===e.name.toLowerCase().indexOf("imageoverlay")&&b.push(itemFormatting.buttonImage(e.value))}return b},a.itemsEnabled=function(){return!0},a.itemClassId=function(){return a.getProperty("itemclassid","")},a.isIButtonVisible=function(){return a.descriptionText().length>0&&void 0!==a.descriptionType&&"i-button"===a.descriptionType.toLowerCase()},a.isNutritionButtonVisible=function(){return!1},a.isComesWithVisible=function(b){if(null!==a.html){var c=a.html.find("#comeswith");c.addClass("comeswith"),c.removeClass("comeswith-visible"),b&&c.addClass("comeswith-visible")}},a.loadItem=function(){},a.posid=function(){return""},a.nextMenu=function(){return""},a.nutrition=function(){if(null!==a.item&&null!==a.html){var b=a.html.find("#nutritionInfo");b.length>0&&a.loadNutrition(b)}},a.loadNutrition=function(b){_nex.assets.theme.setNutrition(a.item,b,!0)},a.price=function(){return 0},a.showPriceFlag=function(){return"true"===a.getProperty("showpriceflag","false").toLowerCase()},a.priceLevel=function(){return a.getProperty("pricelevel","")},a.selectRecipe=function(){return"true"===a.getProperty("selectrecipe","false").toLowerCase()},a.selectSuggested=function(){return"true"===a.getProperty("selectsuggested","false").toLowerCase()},a.state=function(){},a.templateButtonName=function(b){return void 0!==b&&null!==b&&""!==b&&(a.buttonId=b),a.buttonId},a.init=function(b){a.menuItem=b,a.loadItem()},a.enabled=function(b){return"true"===a.menuItem.enabled.toLowerCase()&&a.itemsEnabled(b)&&!a._disabled},a.disableButton=function(b){void 0===b&&(disbable=!0),a._disabled=b,a._disabled?a.html.addClass("disabled"):a.html.removeClass("disabled")},a._getMediaPath=function(a,b){var c="";return"UX"===_nex.context?inPreviewer()?c="../Media.aspx?media="+a+"/"+b:(c=_nex.assets.theme.mediaRootUri,c.toLowerCase().indexOf(_nex.assets.theme.id.toLowerCase())===-1&&(c+="/"+_nex.assets.theme.id),c+="/media/"+a+"/"+b):c=_iorderfast.assets.theme.mediaRootUri+"themes/"+_iorderfast.assets.theme.id+"/media/"+a+"/"+b,c},a._setBackgroundImage=function(b,c){var d=a._getMediaPath("images",c);b.attr("style","background-image: url('"+d+"');")},a._setOverlayContainer=function(b,c){var d=a._getMediaPath("images",c);b.append("<div class='overlay' style='background-image: url(\""+d+"\")'></div>")},a.loadButton=function(b,c){if(a.buttonName=b,c?a.html=c:a.html=$("#"+a.templateButtonName().toLowerCase()).clone(),a.html.length>0){a.html.attr("id",a.buttonName),""!==a.buttonId&&a.html.addClass(a.buttonId);var d=a.html.find("#btext");if(d.empty(),d.append(a.buttonText()),_nex.kviReader?a.html.attr("tabindex","2"):_nex.mviReader&&(a.html.find("a").length>0?(a.html.find("a").attr("tabindex","2"),a.html.find("a").attr("aria-label",a.buttonText()),a.html.find("a").removeAttr("href")):(a.html.attr("tabindex","2"),a.html.attr("aria-label",a.buttonText()),a.html.removeAttr("href"))),"description-text"===a.descriptionType.toLowerCase()){var e=a.html.find("#textDesc");e.length>0&&(e.empty(),e.append(a.descriptionText()))}if(""!==a.image()){var f=a.html.find("#bimage");f.length>0&&a._setBackgroundImage(f,a.image())}var g=a.html.find(".overlaycontainer");if(g){var h=a.overlayimages();for(var i in h)h.hasOwnProperty(i)&&a._setOverlayContainer(g,h[i])}a.nutrition();var j=a.html.find("#nextmenu"),k=a.getProperty("ACTION",[]).length>0?"_nex.ordering.loadActions('"+a.buttonName+"');":"";k+=a.clickEvent(),k+="_nex.ordering.trackClick('"+a.buttonName+"','"+htmlEscape(a.buttonText())+"');",j.attr("onclick","_nex.assets.soundManager.playButtonHit();"+k);var l=a.html.find("#price");l.length>0&&(l.empty(),a.price()>0?(_nex.kviReader&&_nex.kviReader.jackedIn()?l.append(currency.formatAsDollars(a.price(),!0)):l.append(currency.formatAsDollars(a.price(),a._showCurrencySymbol())),l.removeClass("button-price-hidden")):(l.css("visibility","hidden"),l.addClass("button-price-hidden")));var m=a.html.find("#iButton");if(m.length>0)if(a.isIButtonVisible()){var n=a.buttonName+"-ibutton";m.attr("id",n),m.attr("onclick","_nex.ordering.showDescription('"+a.buttonName+"','"+n+"', event)")}else m.css("display","none");else m=a.html.find("#nutritionButton"),m.length>0&&(a.isNutritionButtonVisible()?m.attr("onclick","_nex.ordering.showNutrition('"+a.buttonName+"');"):m.css("display","none"));a.state()}else console.log("Unable to load button; id: "+a.templateButtonName()),_nex.authToken.hasOwnProperty("debug")&&"true"===_nex.authToken.debug&&(a.html=$("<div class='has-error' ><span class='help-block' >Unable to load "+a.templateButtonName()+"</span></div>"))},a._showCurrencySymbol=function(){var a=!1;return _nex.assets.theme.system.USERINTERFACE.hasOwnProperty("showcurrencyonitems")&&"true"===_nex.assets.theme.system.USERINTERFACE.showcurrencyonitems.toString().toLowerCase()&&(a=!0),a},a.executeActions=function(){for(var b=a.getProperty("ACTION",[]),c=0;c<b.length;c++)switch(b[c].type.toLowerCase()){case"dico":b[c].hasOwnProperty("value")&&"string"==typeof b[c].value&&b[c].value.length>0&&(_nex.ordering.togo="togo"===b[c].value.toLowerCase());break;case"filter":_nex.assets.theme.filter.applyItemFilter(b[c]);break;case"clearfilter":_nex.assets.theme.filter.clear()}},a.getPriceFromNextMenu=function(a,b){var c=0;try{var d=Number(a)-1,e=_nex.assets.theme.menus[d],f=_nex.ordering.getAvailableButtons(e);if(b<f.length){var g=f[b],h=g.menuItem[g.menuItem.buttontype],i=null,j="";switch(g.menuItem.buttontype.toUpperCase()){case"SELECTONE":case"SELECTONEMODIFIER":case"SELECTMANYMODIFIER":case"SELECTMANYITEM":case"SELECTONEQUANTITY":i=h.posid,j=h.pricelevel;break;case"LESSMORE":case"SELECTNND":case"SELECTNNL":case"SELECTNLN":case"SELECTNE":i=h.posid2,j=h.priceleve2}if(null!==i&&i.length>0){var k=_nex.assets.theme.itemByPosid(i);null!==k&&(c=_nex.assets.theme.itemPrice(k,j))}}}catch(l){}return c},a.getDescriptionFromNextMenu=function(a,b){var c="";try{var d=Number(a)-1,e=_nex.assets.theme.menus[d],f=_nex.ordering.getAvailableButtons(e);if(f.length<=b)return"";var g=f[b],h=g.menuItem[g.menuItem.buttontype],i=null;switch(g.menuItem.buttontype.toUpperCase()){case"SELECTONE":case"SELECTONEMODIFIER":case"SELECTMANYMODIFIER":case"SELECTMANYITEM":case"SELECTONEQUANTITY":i=h.posid;break;case"LESSMORE":case"SELECTNND":case"SELECTNNL":case"SELECTNLN":case"SELECTNE":i=h.posid2}if(null!==i&&i.length>0){var j=_nex.assets.theme.itemByPosid(i);null!==j&&(c=_nex.assets.theme.itemTextByType(j,"DESCRIPTION"))}}catch(k){console.log(k.message)}return c}},_nex.assets.buttons.SelectOne=function(){_nex.assets.buttons._BaseButton.call(this);var a=this;a.item=null,a.name="SELECTONE",a.buttonId="selectone",a.descriptionText=function(){return itemFormatting.buttonText(_nex.assets.theme.itemTextByType(a.item,"DESCRIPTION"))},a.isNutritionButtonVisible=function(){return!0},a.hasFilter=function(){return a.menuItem[a.name].hasOwnProperty("filter")&&"true"===a.menuItem[a.name].filter.toLowerCase()},a.itemsEnabled=function(){var b=!0;return null!==a.item&&(b="UX"===_nex.context?"true"!==a.item.DETAIL.alcoholflag.toLowerCase()||"true"===a.item.DETAIL.alcoholflag.toLowerCase()&&_nex.orderManager.currentOrder.alcoholEnabled:"true"!==a.item.DETAIL.alcoholflag.toLowerCase()||"true"===a.item.DETAIL.alcoholflag.toLowerCase()&&_iorderfast.ordering.alcoholEnabled),b&&(b=a.hasFilter()||_nex.assets.theme.itemIsAvailable(a.menuItem[a.name].posid)),b},a.loadItem=function(){a.item=_nex.assets.theme.itemByPosid(a.menuItem.SELECTONE.posid)},a.buttonText=function(){return itemFormatting.buttonText(_nex.assets.theme.itemTextByType(a.item,"BUTTONTEXT"))},a.image=function(){return itemFormatting.buttonImage(a.item.DETAIL.image)},a.posid=function(){return a.menuItem[a.name].posid},a.nextMenu=function(){return a.menuItem.SELECTONE.nextmenu},a.hasPosid=function(b){return a.menuItem.SELECTONE.posid===b},a.clickEvent=function(){var b="_nex.ordering.setDragALong('"+a.buttonName+"');";return b+="true"===a.item.DETAIL.alcoholflag.toLowerCase()?"_nex.ordering.addAlcoholToOrder('"+a.item.posid+"','"+a.priceLevel()+"','"+a.buttonName+"',"+a.nextMenu()+");":"_nex.ordering.addToOrder('"+a.item.posid+"','"+a.priceLevel()+"','"+a.buttonName+"',"+a.nextMenu()+");"},a.price=function(){var b=_nex.assets.theme.itemPrice(a.item,a.priceLevel());return b.length>0&&a.showPriceFlag()?Number(b):0}},_nex.assets.buttons.SelectOne.prototype=Object.create(_nex.assets.buttons._BaseButton.prototype),_nex.assets.buttons.Blank=function(){_nex.assets.buttons._BaseButton.call(this);var a=this;a.name="BLANK",a.clickEvent=function(){},a.enabled=function(){return"UX"===_nex.context&&"true"===a.menuItem.enabled.toLowerCase()&&!a._disabled},a.loadButton=function(a,b){b&&b.css("visibility","hidden")}},_nex.assets.buttons.Blank.prototype=Object.create(_nex.assets.buttons._BaseButton.prototype),_nex.assets.buttons.ButtonFactory=function(){var a=this;a.ITEM_TYPE_ITEM="Item",a.ITEM_TYPE_MOD="Modifier",a.createButton=function(a,b){var c=null;if(!a||!a.buttontype)return console.log("no button available on this menu. template: "+b),null;var d=_nex.assets.templateManager.getButtonId(b,a.buttontype);switch(a.buttontype){case"MENUBUTTON":c=new _nex.assets.buttons.MenuButton;break;case"SELECTONE":c=new _nex.assets.buttons.SelectOne;break;case"MULTIMENUBUTTON":c=new _nex.assets.buttons.MultiMenuButton;break;case"SELECTONEMODIFIER":c=new _nex.assets.buttons.SelectOneModifier;break;case"SELECTMANYITEM":c=new _nex.assets.buttons.SelectManyItem;break;case"SELECTMANYMODIFIER":c=new _nex.assets.buttons.SelectManyModifier;break;case"SELECTONEQUANTITY":c=new _nex.assets.buttons.SelectOneQuantity;break;case"SELECTOTHER":c=new _nex.assets.buttons.SelectOther;break;case"LESSMORE":c=new _nex.assets.buttons.LessMore;break;case"SELECTNE":c=new _nex.assets.buttons.SelectNE;break;default:c=new _nex.assets.buttons.Blank}return null!==c&&""!==d&&c.templateButtonName(d),c},a.hasNoItems=function(a){return null===a||"BLANK"===a.toUpperCase()||"MENUBUTTON"===a.toUpperCase()||"MULTIMENUBUTTON"===a.toUpperCase()||"ORDERREVIEWITEM"===a.toUpperCase()||"SELECTALL"===a.toUpperCase()||"SELECTOTHER"===a.toUpperCase()||"SELECTMODIFIERPOPUP"===a.toUpperCase()},a.getItemTypeForButton=function(b){return a.hasNoItems(b)?a.ITEM_TYPE_ITEM:"SELECTONE"==b.toUpperCase()?a.ITEM_TYPE_ITEM:"SELECTONEQUANTITY"==b.toUpperCase()?"":a.ITEM_TYPE_MOD}},_nex.assets.buttons.LessMore=function(){_nex.assets.buttons.SelectOne.call(this);var a=this;a.hasRecipe=!1,a.recipePosidAttr="",a.recipePriceLevelAttr="",a.isDown=!1,a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2",a.name="LESSMORE",a.buttonInfo=function(){return{name:a.buttonName,removeposid:a.menuItem[a.name].posid2+"-NO",removequantity:-1,defaultposid:a.menuItem[a.name].posid2,defaultquantity:1,chargeableposid:a.menuItem[a.name].posid3,chargeablequantity:2,posid1:a.menuItem[a.name].posid1,posid2:a.menuItem[a.name].posid2,posid3:a.menuItem[a.name].posid3}},a.noPosid=function(){return a.menuItem[a.name].noposid||""},a.noPriceLevel=function(){return a.menuItem[a.name].pricelevelno||""},a.loadItem=function(){a.item=_nex.assets.theme.itemByPosid(a.menuItem[a.name].posid2),a.menuItem[a.name].noposid=a.menuItem[a.name].posid2+"-NO",a.menuItem[a.name].pricelevelno=a.menuItem[a.name].pricelevel2;var b=_nex.ordering.currentItem();if(null!==b){for(var c=_nex.assets.theme.itemRecipe(b.posid),d=0;d<c.length&&!a.hasRecipe;d++)c[d].posid===a.menuItem[a.name].posid1?(a.hasRecipe=!0,a.recipePosidAttr="posid1",a.recipePriceLevelAttr="pricelevel1"):c[d].posid===a.menuItem[a.name].posid2?(a.hasRecipe=!0,a.recipePosidAttr="posid2",a.recipePriceLevelAttr="pricelevel2"):c[d].posid===a.menuItem[a.name].posid3&&(a.hasRecipe=!0,a.recipePosidAttr="posid3",a.recipePriceLevelAttr="pricelevel3");var e=!1;if(void 0!==b.ITEM&&b.ITEM.length>0)for(var f=0;f<b.ITEM.length&&!a.isOnOrder;f++)b.ITEM[f].menuid===String(_nex.ordering.currentMenuId)&&(b.ITEM[f].posid===a.menuItem[a.name].posid1?(e=!0,a.activePosidAttr="posid1",a.activePriceLevelAttr="pricelevel1"):b.ITEM[f].posid===a.menuItem[a.name].posid2?(e=!0,a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2"):b.ITEM[f].posid===a.menuItem[a.name].posid3?(e=!0,a.activePosidAttr="posid3",a.activePriceLevelAttr="pricelevel3"):b.ITEM[f].posid===a.menuItem[a.name].posid2+"-NO"&&(e=!0,a.activePosidAttr="noposid",a.activePriceLevelAttr=""));(e||!e&&a.hasRecipe)&&(a.isDown=!0)}},a.nextMenu=function(){return""},a.buttonId="lessmore",a.itemsEnabled=function(){return _nex.assets.theme.itemIsAvailable(a.menuItem[a.name].posid1)&&_nex.assets.theme.itemIsAvailable(a.menuItem[a.name].posid2)&&_nex.assets.theme.itemIsAvailable(a.menuItem[a.name].posid3)},a.buttonText=function(){var b=a.activePosidAttr,c=a.activePriceLevelAttr;a.hasRecipe&&!a.isDown&&(b="noposid",c="");var d=_nex.assets.theme.itemByPosid(a.menuItem[a.name][b]);return itemFormatting.buttonText(_nex.assets.theme.itemTextByType(d,"BUTTONTEXT",c))},a.image=function(){return itemFormatting.buttonImage(a.item.DETAIL.image)},a.priceLevel=function(){return a.menuItem[a.name][a.activePriceLevelAttr]},a.price=function(){var b=a.activePosidAttr,c=a.activePriceLevelAttr;a.hasRecipe&&!a.isDown&&(b="posid1",c="pricelevel1");var d=_nex.assets.theme.itemByPosid(a.menuItem[a.name][b]),e=_nex.assets.theme.itemPrice(d,a.menuItem[a.name][c]);return e.length>0&&a.showPriceFlag()?Number(e):0},a.hasPosid=function(b){return a.menuItem[a.name].posid1===b||a.menuItem[a.name].posid2===b||a.menuItem[a.name].posid3===b},a.clickEvent=function(){return"void(0);"},a._clickScript=function(){var b="posid2",c="pricelevel2";a.hasRecipe&&!a.isDown&&(b="noposid",c="pricelevelno");var d="_nex.ordering.updateMultiState('"+a.menuItem[a.name][b]+"','"+a.menuItem[a.name][c]+"','"+a.buttonName+"', event);";return a.isDown?d="void(0);":(d+="_nex.ordering.trackClick('"+a.buttonName+"','"+htmlEscape(a.buttonText())+"');",d+="_nex.assets.soundManager.playButtonHit();"),d},a.autoClick=function(b,c){var d=(a.menuItem[a.name].pricelevel2,"");a.menuItem[a.name].posid1==b?d=a.menuItem[a.name].pricelevel1:a.menuItem[a.name].posid3==b&&(d=a.menuItem[a.name].pricelevel3),a._clickScript().indexOf("updateMultiState")!==-1?_nex.ordering.updateMultiState(b,d,a.buttonName,null,function(){void 0!==c&&c()}):_nex.ordering.updateSubButton(b,d,a.buttonName,null,1,function(){void 0!==c&&c()})},a.state=function(){var b="hidden";a.isDown?(a.html.addClass("button-down-state"),b="visible",a.subButtonState("less","posid1","pricelevel1"),a.subButtonState("normal","posid2","pricelevel2"),a.subButtonState("more","posid3","pricelevel3"),a.html.data("state","down")):(a.html.removeClass("button-down-state"),a.subButtonState("less",null,null),a.subButtonState("normal",null,null),a.subButtonState("more",null,null),a.html.data("state","up"));var c=a.html.find("#nextmenu");c.attr("onclick",a._clickScript());var d=a.html.find("#subButtons");void 0!==d&&d.css("visibility",b);var e=a.html.find("#btext");e.empty(),e.append(a.buttonText());var f=a.html.find("#price");if(f.length>0){f.empty();var g=a.price();g>0?(f.append(currency.formatAsDollars(a.price(),!1)),f.css("visibility","visible"),f.addClass("button-price-hidden")):(f.css("visibility","hidden"),f.removeClass("button-price-hidden"))}a.hasRecipe?(a.html.data("active-posid",a.recipePosidAttr===a.activePosidAttr?"":a.menuItem[a.name][a.activePosidAttr]),a.html.data("active-pricelevel",a.recipePriceLevelAttr===a.activePriceLevelAttr?"":a.menuItem[a.name][a.activePriceLevelAttr])):(a.html.data("active-posid",a.isDown?a.menuItem[a.name][a.activePosidAttr]:""),a.html.data("active-pricelevel",a.isDown?a.menuItem[a.name][a.activePriceLevelAttr]:"")),a.html.data("item-type","modifier")},a.subButtonState=function(b,c,d){var e=a.html.find("#"+b);if(void 0!==e){var f=e.find("#check"),g=a.activePosidAttr===c;f.css("visibility",g?"visible":"hidden"),g?e.addClass("sub-button-down-state"):e.removeClass("sub-button-down-state");var h="void(0)";if(null!==c&&void 0!==c){a.hasRecipe&&(a.recipePosidAttr===c&&"posid3"!==a.activePosidAttr?(c="noposid",d="pricelevelno"):a.recipePosidAttr===c&&(c="",d=""));var i=e.find("#btext"+b);i.length>0&&(i.empty(),i.append(_nex.assets.theme.getTextAttribute("ORDER",b,b.toUpperCase())));var j=""!==c?a.menuItem[a.name][c]:"",k=""!==d?a.menuItem[a.name][d]:"";if(j.length>0){var l="price1text";"posid1"===c?l="price0text":"posid3"===c&&(l="price2text");var m=e.find("#"+l);if(m.length>0&&(m.empty(),g)){var n=_nex.assets.theme.itemByPosid(j),o=_nex.assets.theme.itemPrice(n,k);o.length>0&&Number(o)>0&&a.showPriceFlag()&&m.append(currency.formatAsDollars(o,!1))}}h="_nex.ordering.updateSubButton('"+j+"','"+k+"','"+a.buttonName+"',1, event);",h+="_nex.ordering.trackClick('"+a.buttonName+"','"+htmlEscape(a.buttonText())+"');",h+="_nex.assets.soundManager.playButtonHit();"}e.attr("onclick",h)}},a.click=function(b){a.isDown=!0,a.hasRecipe?(a.activePosidAttr=a.recipePosidAttr,a.activePriceLevelAttr=a.recipePriceLevelAttr):a.menuItem[a.name].posid1===b?(a.activePosidAttr="posid1",a.activePriceLevelAttr="pricelevel1"):a.menuItem[a.name].posid2===b?(a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2"):a.menuItem[a.name].posid3===b?(a.activePosidAttr="posid3",a.activePriceLevelAttr="pricelevel3"):a.menuItem[a.name].noposid===b&&(a.activePosidAttr="noposid",a.activePriceLevelAttr="pricelevelno"),a.state()},a.update=function(b){""===b&&(b=a.menuItem[a.name][a.recipePosidAttr]),a.menuItem[a.name][a.activePosidAttr]===b?a.isDown=!a.isDown:a.hasRecipe&&b===a.menuItem[a.name].noposid&&(a.isDown=!1),a.isDown?a.menuItem[a.name].posid1===b?(a.activePosidAttr="posid1",a.activePriceLevelAttr="pricelevel1"):a.menuItem[a.name].posid2===b?(a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2"):a.menuItem[a.name].posid3===b&&(a.activePosidAttr="posid3",a.activePriceLevelAttr="pricelevel3"):(a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2"),a.state()}},_nex.assets.buttons.LessMore.prototype=Object.create(_nex.assets.buttons.SelectOne.prototype),_nex.assets.buttons.MenuButton=function(){_nex.assets.buttons._BaseButton.call(this);var a=this;a.name="MENUBUTTON",a.buttonId="menubutton",a.itemsEnabled=function(b){var c="true"===a.menuItem.enabled.toLowerCase();if(c&&(c=_nex.assets.theme.isDayPartActive(a.menuItem[a.name].daypart))){if(c){var d=_nex.ordering.menus[Number(a.nextMenu())-1];if(d){var e=_nex.assets.templateManager.findTemplate(d.template);if(null!==e&&void 0!==e.classname&&"orderreview"!==e.classname.toLowerCase()&&"buffet"!==e.classname.toLowerCase()&&"buffetreservation"!==e.classname.toLowerCase()&&"checkout"!==e.classname.toLowerCase()&&"merchandising"!==e.classname.toLowerCase()&&"pager"!==e.classname.toLowerCase()&&"scanitems"!==e.classname.toLowerCase()&&"smsprompt"!==e.classname.toLowerCase()&&"weighitem"!==e.classname.toLowerCase()){var f=d.id.toString()+",";if(void 0===b&&(b=""),b.indexOf(f)>=0)return console.log("Found a loop in processing the menu enabled logic. Existing that loop. Menu: "+d.id.toString()),c;if(b+=f,e.hasOwnProperty("htmlsrc")&&e.htmlsrc.length>0)c=!0;else if(!_nex.assets.theme.system.USERINTERFACE.hasOwnProperty("searchmenubuttons")||"true"===_nex.assets.theme.system.USERINTERFACE.searchmenubuttons.toString().toLowerCase()){var g=_nex.ordering.getAvailableButtons(d,b);0===g.length&&(console.log("hiding menu button because no items are available"),c=!1)}}}}if(!c&&"MULTIMENUBUTTON"===a.name)for(var h=0;h<a.menuItem.MULTIMENUBUTTON.MENUITEM.length;h++){var i=a.menuItem.MULTIMENUBUTTON.MENUITEM[h];if(i.SELECTONE&&_nex.assets.theme.itemIsAvailable(i.SELECTONE.posid)){c=!0;break}}}if(c){var j=!1;j="UX"===_nex.context?_nex.orderManager.currentOrder.alcoholEnabled:_iorderfast.ordering.alcoholEnabled,!j&&_nex.assets.theme.menuHasAlcohol(a.nextMenu())&&(c=!1)}if(c&&a.menuItem[a.name].hasOwnProperty("VISIBILITY"))if("UX"!==_nex.context)c="true"===a.menuItem[a.name].VISIBILITY.online.toLowerCase()||"true"===a.menuItem[a.name].VISIBILITY.mobile.toLowerCase();else if(a.menuItem[a.name].VISIBILITY.hasOwnProperty("kiosk")&&(c="true"===a.menuItem[a.name].VISIBILITY.kiosk.toLowerCase(),c&&a.menuItem[a.name].VISIBILITY.hasOwnProperty("devicenamefilter")&&a.menuItem[a.name].VISIBILITY.devicenamefilter.length>0)){var k=a.menuItem[a.name].VISIBILITY.devicenamefilter,l="";k.indexOf(",")>0&&(l=","),c=k.toLowerCase().indexOf(_nex.device.computerName().toLowerCase()+l,0)!=-1}return c},a.descriptionText=function(){var b="";return"true"===a.menuItem[a.name].showdescription.toLowerCase()&&(b=a.getDescriptionFromNextMenu(a.nextMenu(),0)),itemFormatting.buttonText(b)},a.buttonText=function(){return itemFormatting.buttonText(_nex.assets.theme.itemTextByType(a.menuItem[a.name],"BUTTONTEXT"))},a.image=function(){return itemFormatting.buttonImage(a.menuItem[a.name].image)},a.clickEvent=function(){var b="";return!_nex.ordering.order.ageVerified&&_nex.assets.theme.menuHasAlcohol(a.nextMenu())?b="_nex.ordering.ageVerificationPrompt("+a.nextMenu()+");":(b="_nex.ordering.setDragALong('"+a.buttonName+"');",b+="_nex.ordering.loadMenu("+a.nextMenu()+");"),b},a.showPriceFlag=function(){return!1},a.nextMenu=function(){return a.menuItem[a.name].nextmenu}},_nex.assets.buttons.MenuButton.prototype=Object.create(_nex.assets.buttons._BaseButton.prototype),_nex.assets.buttons.More=function(){_nex.assets.buttons._BaseButton.call(this);var a=this;a.name="MORE",a.buttonId="moreforward",a.buttonText=function(){return _nex.assets.theme.getTextAttribute("ORDER","scroll","MORE")},a.clickEvent=function(){return"_nex.ordering.scrollMenu();"},a.enabled=function(){return"UX"===_nex.context}},_nex.assets.buttons.More.prototype=Object.create(_nex.assets.buttons._BaseButton.prototype),_nex.assets.buttons.MultiMenuButton=function(){_nex.assets.buttons.MenuButton.call(this);var a=this;a.name="MULTIMENUBUTTON",a.clickEvent=function(){var b="_nex.ordering.setDragALong('"+a.buttonName+"');";return b+="_nex.ordering.loadMenuAndButtons("+a.nextMenu()+",'"+a.buttonName+"');"},a.getMenuItems=function(){return a.menuItem.MULTIMENUBUTTON.MENUITEM}},_nex.assets.buttons.MultiMenuButton.prototype=Object.create(_nex.assets.buttons.MenuButton.prototype),_nex.assets.buttons.SelectManyItem=function(){_nex.assets.buttons.SelectOne.call(this);var a=this;a.hasRecipe=!1,a.isSelected=!1,a.name="SELECTMANYITEM",a.buttonId="selectmanyitem",a.itemType="item",a.loadItem=function(){a.item=_nex.assets.theme.itemByPosid(a.menuItem[this.name].posid);var b=_nex.ordering.currentItem();if(null!==b&&null!==a.item){var c=_nex.assets.theme.itemByPosid(b.posid);if(void 0!==c.RECIPE){c.RECIPE=$.isArray(c.RECIPE)?c.RECIPE:new Array(c.RECIPE);for(var d=0;d<c.RECIPE.length&&!a.hasRecipe;d++)a.hasRecipe=c.RECIPE[d].posid===a.item.posid}if(void 0!==b.ITEM&&b.ITEM.length>0)for(var e=0;e<b.ITEM.length&&!a.isSelected;e++)a.hasRecipe?a.isSelected=b.ITEM[e].posid===a.item.posid+"-NO":a.isSelected=b.ITEM[e].posid===a.item.posid}},a.nextMenu=function(){return""},a.clickEvent=function(){var b=a.hasRecipe?a.item.posid+"-NO":a.item.posid,c="_nex.ordering.addManyModifier('"+b+"','"+a.priceLevel()+"','"+a.buttonName+"');";return c},a.autoClick=function(b){var c=a.hasRecipe?a.item.posid+"-NO":a.item.posid;_nex.ordering.addManyModifier(c,a.priceLevel(),a.buttonName,function(){void 0!==b&&b()})},a.state=function(){var b=a.html.find("#check"),c=!1;a.hasRecipe?(a.html.addClass("button-down-state"),a.html.data("state","down"),c=!0,a.isComesWithVisible(!0)):(a.isSelected?(a.html.addClass("button-down-state"),a.html.data("state","down"),c=!0):(a.html.removeClass("button-down-state"),a.html.data("state","up")),a.isComesWithVisible(!1)),c&&(b=a.html.find("#check"),void 0!==b&&(b.removeClass("button-many-unselected"),b.addClass("button-many-selected"))),a.html.data("item-type",a.itemType)},a.update=function(){if(a.hasRecipe){var b=a.buttonText();if("up"===a.html.data("state")){var c=_nex.assets.theme.itemByPosid(a.item.posid+"-NO");null!==c&&(b=itemFormatting.buttonText(_nex.assets.theme.itemTextByType(c,"BUTTONTEXT")))}var d=a.html.find("#btext");d.empty(),d.append(b)}}},_nex.assets.buttons.SelectManyItem.prototype=Object.create(_nex.assets.buttons.SelectOne.prototype),_nex.assets.buttons.SelectManyModifier=function(){_nex.assets.buttons.SelectManyItem.call(this);var a=this;a.name="SELECTMANYMODIFIER",a.buttonId="selectmanyof",a.itemType="modifier"},_nex.assets.buttons.SelectManyModifier.prototype=Object.create(_nex.assets.buttons.SelectManyItem.prototype),_nex.assets.buttons.SelectNE=function(){_nex.assets.buttons.SelectOne.call(this);var a=this;a.hasRecipe=!1,a.recipePosidAttr="",a.recipePriceLevelAttr="",a.isDown=!1,a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2",a.modQuantity=0,a.name="SELECTNE",a.buttonInfo=function(){return{name:a.buttonName,removeposid:a.menuItem[a.name].posid1,removequantity:-1,defaultposid:a.menuItem[a.name].posid2,defaultquantity:1,chargeableposid:a.menuItem[a.name].posid3,chargeablequantity:2,activeposidattr:a.activePosidAttr,activepricelevelattr:a.activePriceLevelAttr,posid1:a.menuItem[a.name].posid1,posid2:a.menuItem[a.name].posid2,posid3:a.menuItem[a.name].posid3}},a.noPosid=function(){return a.menuItem[a.name].posid1||""},a.noPriceLevel=function(){return a.menuItem[a.name].pricelevel1||""},a.loadItem=function(){a.item=_nex.assets.theme.itemByPosid(a.menuItem[a.name].posid2);var b=_nex.ordering.currentItem();if(null!==b){for(var c=_nex.assets.theme.itemRecipe(b.posid),d=0;d<c.length&&!a.hasRecipe;d++)c[d].posid===a.menuItem[a.name].posid1?(a.hasRecipe=!0,a.recipePosidAttr="posid1",a.recipePriceLevelAttr="pricelevel1"):c[d].posid===a.menuItem[a.name].posid2?(a.hasRecipe=!0,a.recipePosidAttr="posid2",a.recipePriceLevelAttr="pricelevel2"):c[d].posid===a.menuItem[a.name].posid3&&(a.hasRecipe=!0,a.recipePosidAttr="posid3",a.recipePriceLevelAttr="pricelevel3");var e=!1;if(void 0!==b.ITEM&&b.ITEM.length>0)for(var f=0;f<b.ITEM.length&&!a.isOnOrder;f++)b.ITEM[f].posid===a.menuItem[a.name].posid1&&b.ITEM[f].menuid===_nex.ordering.currentMenu.id?(e=!0,a.activePosidAttr="posid1",a.activePriceLevelAttr="pricelevel1"):b.ITEM[f].posid===a.menuItem[a.name].posid2&&b.ITEM[f].menuid===_nex.ordering.currentMenu.id?(e=!0,a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2"):b.ITEM[f].posid===a.menuItem[a.name].posid3&&b.ITEM[f].menuid===_nex.ordering.currentMenu.id&&(e=!0,a.activePosidAttr="posid3",a.activePriceLevelAttr="pricelevel3");(e||!e&&a.hasRecipe)&&(a.isDown=!0,a.hasRecipe&&(a.activePosidAttr=a.recipePosidAttr,a.activePriceLevelAttr=a.recipePriceLevelAttr))}},a.nextMenu=function(){return""},a.buttonId="selectne",a.itemsEnabled=function(){return _nex.assets.theme.itemIsAvailable(a.menuItem[a.name].posid1)&&_nex.assets.theme.itemIsAvailable(a.menuItem[a.name].posid2)&&_nex.assets.theme.itemIsAvailable(a.menuItem[a.name].posid3)},a.buttonText=function(){var b=a.activePosidAttr,c=a.activePriceLevelAttr;a.hasRecipe&&!a.isDown&&(b="posid1",c="pricelevel1");var d=_nex.assets.theme.itemByPosid(a.menuItem[a.name][b]);return itemFormatting.buttonText(_nex.assets.theme.itemTextByType(d,"BUTTONTEXT",a.menuItem[a.name][c]))},a.image=function(){return itemFormatting.buttonImage(a.item.DETAIL.image)},a.hasPosid=function(b){return a.menuItem[a.name].posid1===b||a.menuItem[a.name].posid2===b||a.menuItem[a.name].posid3===b},a._getQuantity=function(b){var c=a.buttonInfo(),d=c.defaultquantity;return a.isDown&&b===a.menuItem[a.name][a.activePosidAttr]?d=a.modQuantity:b===c.removeposid?d=c.removequantity:b===c.chargeableposid&&(d=c.chargeablequantity),d},a.clickEvent=function(){return"void(0);"},a._clickScript=function(){var b="posid2",c="pricelevel2";a.hasRecipe&&!a.isDown&&(b="posid1",c="pricelevel1");var d="_nex.ordering.updateMultiState('"+a.menuItem[a.name][b]+"','"+a.menuItem[a.name][c]+"','"+a.buttonName+"', event);",e=!0;if(a.isDown){var f=a.html.find("#subButtons");if(0===f.length){a.hasRecipe?(b="posid1",c="pricelevel1"):(b=a.activePosidAttr,c=a.activePriceLevelAttr);var g=""!==b?a.menuItem[a.name][b]:"",h=""!==c?a.menuItem[a.name][c]:"";d="_nex.ordering.updateSubButton('"+g+"','"+h+"','"+a.buttonName+"',"+a._getQuantity(g).toString()+", event);"}else d="void(0)",e=!1}return e&&(d+="_nex.ordering.trackClick('"+a.buttonName+"','"+htmlEscape(a.buttonText())+"');",d+="_nex.assets.soundManager.playButtonHit();"),d},a.autoClick=function(b,c){var d=a.menuItem[a.name].pricelevel2;a.menuItem[a.name].posid1==b?d=a.menuItem[a.name].pricelevel1:a.menuItem[a.name].posid3==b&&(d=a.menuItem[a.name].pricelevel3),a._clickScript().indexOf("updateMultiState")!==-1?_nex.ordering.updateMultiState(b,d,a.buttonName,null,function(){void 0!==c&&c()}):_nex.ordering.updateSubButton(b,d,a.buttonName,null,a._getQuantity(b).toString(),function(){void 0!==c&&c()})},a.state=function(){var b="hidden";a.isDown?(a.html.addClass("button-down-state"),b="visible",a.subButtonState("none","posid1","pricelevel1"),a.subButtonState("normal","posid2","pricelevel2"),a.subButtonState("extra","posid3","pricelevel3"),a.html.data("state","down")):(a.html.removeClass("button-down-state"),a.subButtonState("none",null,null),a.subButtonState("normal",null,null),a.subButtonState("extra",null,null),a.html.data("state","up"));var c=a.html.find("#nextmenu");c.attr("onclick",a._clickScript());var d=a.html.find("#subButtons");void 0!==d&&d.css("visibility",b);var e=a.html.find("#btext");e.empty(),e.append(a.buttonText());var f=a.html.find("#price");if(f.length>0){f.empty();var g=a.price();g>0?(f.append(currency.formatAsDollars(a.price(),!1)),f.css("visibility","visible"),f.addClass("button-price-hidden")):(f.css("visibility","hidden"),f.removeClass("button-price-hidden"))}a.hasRecipe?(a.html.data("active-posid",a.recipePosidAttr===a.activePosidAttr?"":a.menuItem[a.name][a.activePosidAttr]),a.html.data("active-pricelevel",a.recipePriceLevelAttr===a.activePriceLevelAttr?"":a.menuItem[a.name][a.activePriceLevelAttr])):(a.html.data("active-posid",a.isDown?a.menuItem[a.name][a.activePosidAttr]:""),a.html.data("active-pricelevel",a.isDown?a.menuItem[a.name][a.activePriceLevelAttr]:"")),a.html.data("item-type","modifier"),a.isDown&&0===a.modQuantity?a.modQuantity=a.menuItem[a.name][a.activePosidAttr]===a.buttonInfo().removeposid?a.buttonInfo().removequantity:1:a.isDown||(a.modQuantity=0)},a.price=function(){var b=a.activePosidAttr,c=a.activePriceLevelAttr;a.hasRecipe&&!a.isDown&&(b="posid1",c="pricelevel1");var d=_nex.assets.theme.itemByPosid(a.menuItem[a.name][b]),e=_nex.assets.theme.itemPrice(d,a.menuItem[a.name][c]);return e.length>0&&a.showPriceFlag()?Number(e):0},a._isOnCurrentItem=function(a){var b=!1,c=_nex.ordering.currentItem();if(c&&c.hasOwnProperty("ITEM"))for(var d=0;d<c.ITEM.length&&!b;d++)b=c.ITEM[d].posid===a;
return b},a.subButtonState=function(b,c,d){var e=a.html.find("#"+b);if(void 0!==e){var f=e.find("#check"),g=a.activePosidAttr===c;f.css("visibility",g?"visible":"hidden"),g?e.addClass("sub-button-down-state"):e.removeClass("sub-button-down-state");var h="void(0)";if(null!==c&&void 0!==c){a.hasRecipe&&(a.recipePosidAttr===c&&"posid3"!==a.activePosidAttr?(c="posid1",d="pricelevel1"):a.recipePosidAttr===c&&"posid3"===a.activePosidAttr&&(c="",d=""));var i=e.find("#btext"+b);i.length>0&&(i.empty(),i.append(_nex.assets.theme.getTextAttribute("ORDER",b,b.toUpperCase())));var j=""!==c?a.menuItem[a.name][c]:"",k=""!==d?a.menuItem[a.name][d]:"",l=a._isOnCurrentItem(a.buttonInfo().defaultposid)&&a._isOnCurrentItem(a.buttonInfo().chargeableposid);if(j.length>0){var m="price1text";"posid1"===c?(m="price0text",a.hasRecipe||(j="posid3"===a.activePosidAttr?a.menuItem[a.name].posid3:a.menuItem[a.name].posid2)):"posid2"===c?(m="price1text",l?(j=a.menuItem[a.name][a.activePosidAttr],k=a.menuItem[a.name][a.activePriceLevelAttr],g=!1,f.css("visibility","hidden")):"posid3"===a.activePosidAttr?(j=a.menuItem[a.name][a.activePosidAttr],k=a.menuItem[a.name][a.activePriceLevelAttr],1===a.modQuantity&&(g=!0,f.css("visibility","visible"))):"posid2"===a.activePosidAttr&&a.modQuantity>1&&(g=!1,f.css("visibility","hidden"))):"posid3"===c&&(m="price2text",l?(g=!0,f.css("visibility","visible")):"posid2"===a.activePosidAttr?(j=a.menuItem[a.name][a.activePosidAttr],k=a.menuItem[a.name][a.activePriceLevelAttr],g=!1,a.modQuantity>1&&f.css("visibility","visible")):a.modQuantity>1?g=!0:(g=!1,f.css("visibility","hidden")));var n=e.find("#"+m);if(n.length>0&&(n.empty(),g)){var o=_nex.assets.theme.itemByPosid(j),p=_nex.assets.theme.itemPrice(o,k);p.length>0&&Number(p)>0&&a.showPriceFlag()&&(a.modQuantity>1&&(p=(Number(p)*a.modQuantity).toString()),n.append(currency.formatAsDollars(p,!1)))}}h="posid2"!==c&&"posid3"!==c||!l?"posid2"===c&&"posid3"===a.activePosidAttr&&2===a.modQuantity?"_nex.ordering.updateModifierQuantity('"+_nex.ordering.currentItemIndex()+"','-1','"+j+"','"+a.buttonName+"');":"posid3"===c&&("posid2"===a.activePosidAttr||"posid3"===a.activePosidAttr)&&a.modQuantity<=1?"_nex.ordering.updateModifierQuantity('"+_nex.ordering.currentItemIndex()+"','1','"+j+"','"+a.buttonName+"');":"_nex.ordering.updateSubButton('"+j+"','"+k+"','"+a.buttonName+"',"+a._getQuantity(j).toString()+", event);":"_nex.ordering.updateSubButton('"+j+"','"+k+"','"+a.buttonName+"', 1, event);",h+="_nex.ordering.trackClick('"+a.buttonName+"','"+htmlEscape(a.buttonText())+"');",h+="_nex.assets.soundManager.playButtonHit();"}e.attr("onclick",h)}},a.click=function(b){a.isDown=!0,a.hasRecipe?a.activePosidAttr=a.recipePosidAttr:a.menuItem[a.name].posid1===b?(a.activePosidAttr="posid1",a.activePriceLevelAttr="pricelevel1"):a.menuItem[a.name].posid2===b?(a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2"):a.menuItem[a.name].posid3===b&&(a.activePosidAttr="posid3",a.activePriceLevelAttr="pricelevel3"),a.state()},a.update=function(b,c){c=c||"1",c=Number(c),""===b&&(b=a.menuItem[a.name][a.recipePosidAttr]);var d=a._isOnCurrentItem(a.buttonInfo().defaultposid)&&a._isOnCurrentItem(a.buttonInfo().chargeableposid);a.menuItem[a.name].posid1===b?a.isDown=!1:d?a.menuItem[a.name][a.activePosidAttr]===b&&a.buttonInfo().chargeableposid===b&&(a.isDown=!1):a.menuItem[a.name][a.activePosidAttr]===b&&a.modQuantity===c&&(a.isDown=!a.isDown),a.modQuantity=c,a.isDown?a.menuItem[a.name].posid1===b?(a.activePosidAttr="posid1",a.activePriceLevelAttr="pricelevel1"):a.menuItem[a.name].posid2===b?(a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2"):a.menuItem[a.name].posid3===b&&(a.activePosidAttr="posid3",a.activePriceLevelAttr="pricelevel3"):(a.activePosidAttr="posid2",a.activePriceLevelAttr="pricelevel2"),a.state()}},_nex.assets.buttons.SelectNE.prototype=Object.create(_nex.assets.buttons.SelectOne.prototype),_nex.assets.buttons.SelectOneModifier=function(){_nex.assets.buttons.SelectOne.call(this);var a=this;a.hasRecipe=!1,a.name="SELECTONEMODIFIER",a.loadItem=function(){a.item=_nex.assets.theme.itemByPosid(a.menuItem.SELECTONEMODIFIER.posid);var b=_nex.ordering.currentItem();if(null!==b&&null!==a.item){var c=_nex.assets.theme.itemByPosid(b.posid);if(void 0!==c.RECIPE){c.RECIPE=$.isArray(c.RECIPE)?c.RECIPE:new Array(c.RECIPE);for(var d=0;d<c.RECIPE.length&&!a.hasRecipe;d++)a.hasRecipe=c.RECIPE[d].posid===a.item.posid}}},a.nextMenu=function(){return a.menuItem.SELECTONEMODIFIER.nextmenu},a.price=function(){var b=0,c=_nex.assets.theme.itemPrice(a.item,a.priceLevel());if(c.length>0&&a.showPriceFlag()&&(b=Number(c)),0===b&&a.priceLevel().length>0&&a.showPriceFlag()){var d=_nex.ordering.currentItem();if(null!==d){var e=_nex.assets.theme.itemByPosid(d.posid);c=_nex.assets.theme.itemPrice(e,a.priceLevel()),c.length>0&&!isNaN(c)&&(b=Number(c))}}return b},a.state=function(){a.isComesWithVisible(a.hasRecipe)}},_nex.assets.buttons.SelectOneModifier.prototype=Object.create(_nex.assets.buttons.SelectOne.prototype),_nex.assets.buttons.SelectOneQuantity=function(){_nex.assets.buttons.SelectOne.call(this);var a=this;a.item=null,a.name="SELECTONEQUANTITY",a.buttonId="selectonequantity",a.isDown=!1,a.quantity=0,a.quantityLimitReached=!1,a.loadItem=function(){a.item=_nex.assets.theme.itemByPosid(a.menuItem.SELECTONEQUANTITY.posid);var b=!1;if(null!==a.item)if("modifier"==a.item.DETAIL.itemtype.toLowerCase()){var c=_nex.ordering.currentItem();if(c&&c.ITEM)for(var d=0;d<c.ITEM.length;d++)c.ITEM[d].posid===a.item.posid&&(b=!0,a.quantity=c.ITEM[d].hasOwnProperty("modquantity")?Number(c.ITEM[d].modquantity):Number(c.ITEM[d].quantity),a.isDown=!0)}else for(var e=_nex.ordering.order.ITEM.length-1;e>=0&&!b&&_nex.ordering.order.ITEM.length>0;e--)_nex.ordering.order.ITEM[e].posid===a.item.posid&&_nex.ordering.order.ITEM[e].menuid===String(_nex.ordering.currentMenuId)&&(b=!0,a.quantity=Number(_nex.ordering.order.ITEM[e].quantity),a.isDown=!0)},a.nextMenu=function(){return""},a.clickEvent=function(){var b="_nex.ordering.updateQuantityButton('"+a.menuItem[a.name].posid+"','"+a.priceLevel()+"','"+a.buttonName+"', event);";return a.isDown||!a.isDown&&a.quantityLimitReached?b="void(0);":b+="_nex.assets.soundManager.playButtonHit();_nex.ordering.trackClick('"+a.buttonName+"','"+htmlEscape(a.buttonText())+"');",b},a.click=function(b){a.isDown=!0,a.quantity=1,a.state()},a.subButtonState=function(b,c){var d=a.html.find("#"+b);if(void 0!==d){var e="visible",f="void(0);";("plusButton"==b&&a.quantityLimitReached||!a.isDown)&&(e="hidden"),a.isDown&&"visible"===e&&(f="_nex.ordering.changeQuantity('"+a.item.posid+"','"+a.buttonName+"',"+c+", event);"),f+="_nex.assets.soundManager.playButtonHit();_nex.ordering.trackClick('"+a.buttonName+"','"+htmlEscape(a.buttonText())+"');",d.attr("onclick",f),d.css("visibility",e)}},a.state=function(){a.quantityLimitReached=!1;var b=_nex.assets.theme.quantityLimit;if(_nex.ordering.currentMenu.hasOwnProperty("incquantity")&&_nex.ordering.currentMenu.incquantity.length>0&&!isNaN(_nex.ordering.currentMenu.incquantity)&&(b=Number(_nex.ordering.currentMenu.incquantity)),"true"===_nex.ordering.currentMenu.alcohol.toLowerCase()&&(b=_nex.assets.theme.alcoholLimit),"modifier"===a.item.DETAIL.itemtype.toLowerCase()){var c=_nex.ordering.currentItem();console.log("selectonequantity - max quant: "+b.toString()),null!==c&&c.hasOwnProperty("flavorcount")&&(a.quantityLimitReached=c.flavorcount>=b)}else a.quantityLimitReached=a.quantity>=b;a.refreshSubButtons()},a.refreshSubButtons=function(){var b="hidden";if(a.isDown){a.html.addClass("button-down-state"),b="visible",a.subButtonState("minusButton",-1),a.subButtonState("plusButton",1);var c=a.html.find("#txtQuantity");c.length>0&&(c.empty(),c.append(a.quantity.toString())),a.html.data("state","down")}else a.html.removeClass("button-down-state"),a.subButtonState("minusButton",0),a.subButtonState("plusButton",0),a.html.data("state","up");var d=a.html.find("#nextmenu");d.attr("onclick",a.clickEvent());var e=a.html.find("#subButtons");void 0!==e&&e.css("visibility",b),console.log("select one quantity - quantity limit reached: "+a.quantityLimitReached.toString()),a.quantityLimitReached&&!a.isDown?a.html.addClass("disabled"):a.html.removeClass("disabled")},a.modifierPressed=function(b){if(a.quantity>0){var c=_nex.ordering.currentItemIndex();c>-1&&_nex.ordering.updateModifierQuantity(c,b,a.menuItem[a.name].posid)}else _nex.ordering.addToOrder(a.menuItem[a.name].posid)},a.itemPressed=function(a,b){_nex.ordering.updateItemQuantity(b,a,!0)},a.update=function(b,c){a.quantity+=b,a.isDown=a.quantity>0,"modifier"==a.item.DETAIL.itemtype.toLowerCase()?a.modifierPressed(b):a.itemPressed(b,c),a.state()}},_nex.assets.buttons.SelectOneQuantity.prototype=Object.create(_nex.assets.buttons.SelectOne.prototype),_nex.assets.buttons.SelectOther=function(){_nex.assets.buttons._BaseButton.call(this);var a=this;a.selected=!1,a.itemIndex=0,a.ignoreOrderUpdates=!1,a.name="SELECTOTHER",a.buttonText=function(){return itemFormatting.buttonText(a.menuItem.SELECTOTHER.BUTTONTEXT[0].buttontext)},a.image=function(){return itemFormatting.buttonImage(a.menuItem.SELECTOTHER.image)},a.itemsEnabled=function(){for(var b=!1,c=0;c<a.menuItem.SELECTOTHER.SELECTITEM.length&&!b;c++){var d=_nex.assets.theme.itemByPosid(a.menuItem.SELECTOTHER.SELECTITEM[c].posid);if(null!==d){var e=d.DETAIL;b="true"===d.enabled.toString().toLowerCase(),b&&"true"===e.alcoholflag.toString().toLowerCase()&&(b="UX"===_nex.context?_nex.orderManager.currentOrder.alcoholEnabled:_iorderfast.ordering.alcoholEnabled)}}return b},a.clickEvent=function(){var b="_nex.ordering.selectOtherPressed('"+a.buttonName+"');";return b},a.state=function(){var b;a.selected?(a.html.addClass("button-down-state"),b=a.html.find("#check"),void 0!==b&&(b.removeClass("button-many-unselected"),b.addClass("button-many-selected")),a.html.data("state","down")):(a.html.removeClass("button-down-state"),b=a.html.find("#check"),void 0!==b&&(b.removeClass("button-many-selected"),b.addClass("button-many-unselected")),a.html.data("state","up"))},a.click=function(){a.selected=!a.selected,a.ignoreOrderUpdates=!0,a.itemIndex=0,a.state(),a.updateButtons(a.itemIndex)},a.updateButtons=function(a){var b=this,c=function(){b.itemIndex++,b.updateButtons(b.itemIndex)};if(void 0!==a&&a<b.menuItem.SELECTOTHER.SELECTITEM.length){for(var d=!1,e=b.menuItem.SELECTOTHER.SELECTITEM[a].posid,f=0;f<_nex.ordering.buttons.length&&!d;f++)if(d=_nex.ordering.buttons[f].hasPosid(e)){var g=_nex.ordering.isOnCurrentItem(e);g&&!b.selected||!g&&b.selected?_nex.ordering.buttons[f].autoClick(e,c):d=!1}d||c()}else b.ignoreOrderUpdates=!1},a.orderUpdated=function(){if(!a.ignoreOrderUpdates){for(var b=!0,c=0;c<a.menuItem.SELECTOTHER.SELECTITEM.length&&b;c++){var d=a.menuItem.SELECTOTHER.SELECTITEM[c].posid;if(b=_nex.ordering.isOnCurrentItem(d),!b)for(var e=0;e<Number(_nex.ordering.buttons.length)&&!b;e++){var f=_nex.ordering.buttons[e];f.hasPosid(d)&&(b=_nex.ordering.isOnCurrentItem(f.getProperty("posid1","")),b||(b=_nex.ordering.isOnCurrentItem(f.getProperty("posid2",""))),b||(b=_nex.ordering.isOnCurrentItem(f.getProperty("posid3",""))))}}!b&&a.selected?a.selected=!1:b&&!a.selected&&(a.selected=!0),a.state()}}},_nex.assets.buttons.SelectOther.prototype=Object.create(_nex.assets.buttons._BaseButton),_nex.commands._BaseRequest=function(){var a=this;a.name="",a.msgHeader=function(){var a={};return"UX"!==_nex.context&&(a.authcode=_iorderfast.authToken.code),a.name=this.name,"UX"!==_nex.context&&(a.locationid=_iorderfast.loc.id),a[this.name]={},a},a.write=function(){}},_nex.commands.AddToOrder=function(a,b,c,d,e,f,g,h,i,j){_nex.commands._BaseRequest.call(this);var k=this;k.posid=a,k.pricelevel=b,k.quantity=c,k.menuid=d,k.menuStackIndex=e,k.upsell=f,k.pricedBy=g,k.buttonInfo=void 0!==h?h:{},k.isscanned=i,k.price=j,k.name="ADDTOORDER",k.write=function(){var a=k.msgHeader();return a[k.name]={posid:k.posid,pricelevel:k.pricelevel,quantity:k.quantity.toString(),menuid:k.menuid.toString(),menustackindex:k.menuStackIndex.toString(),upsell:k.upsell,pricedby:k.pricedBy,isscanned:k.isscanned,price:k.price,BUTTONINFO:k.buttonInfo},console.log(a),a}},_nex.commands.AddToOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.CalculateTotal=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="CALCULATETOTAL",a&&(b.subtotal=a.totals.subtotal().replace("$",""),b.togo=a.togo.toString(),b.roundUpCharitySelected=a.roundUpCharitySelected.toString()),b.write=function(){var a=b.msgHeader();return"UX"===_nex.context?a[b.name]={togo:b.togo,subtotal:b.subtotal,roundupcharityselected:b.roundUpCharitySelected,sendtoserver:"true"}:a[b.name]={roundupcharityselected:_nex.ordering.roundupcharityselected},a}},_nex.commands.CalculateTotal.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.CancelOrder=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="CANCELORDER",a.write=function(){var b=a.msgHeader();return b[a.name]={cancel:"true"},b}},_nex.commands.CancelOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.ConsolidateOrder=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="CONSOLIDATEORDER",a.write=function(){var b=a.msgHeader();return b[a.name]={},b}},_nex.commands.ConsolidateOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.LoadOrder=function(a){_nex.commands._BaseRequest.call(this);var b=this;a&&(b.order=a),b.name="LOADORDER",b.write=function(){var c,d=b.msgHeader();return c="UX"===_nex.context?b.order.ORDER.ITEM:b.order.ITEM,d[b.name]={orderid:a.orderid,date:a.date,orderintid:a.orderintid,ordernumber:a.ordernumber,time:a.time,previousorderid:a.previousorderid,ITEM:c},d}},_nex.commands.LoadOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.LoyaltyInquiry=function(a,b,c,d,e,f){var g=this;_nex.commands._BaseRequest.call(g),g._cardnumber="",g._userdata="",g._cardtype="LOYALTY",g._track1="",g._track2="",g._preauthandpay="false",f&&(g._preauthandpay="true"),a&&(g._cardnumber=a),b&&(g._userdata=b),d&&(g._track1=d),e&&(g._track2=e),c&&(g._cardtype=c),g.name="LOYALTYINQUIRY",g.write=function(){var a=g.msgHeader();return a[g.name]={cardnumber:g._cardnumber,userdata:g._userdata,cardtype:g._cardtype,track1:g._track1,track2:g._track2,preauthandpay:g._preauthandpay},a}},_nex.commands.LoyaltyInquiry.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.MenuStackReset=function(){_nex.commands._BaseRequest.call(this);var a=this;a.name="MENUSTACKRESET",a.write=function(){var a=this.msgHeader();return a[this.name]={},a}},_nex.commands.MenuStackReset.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.RemoveFromOrder=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="REMOVEFROMORDER",b.posids=[];for(var c=0;c<a.length;c++)b.posids.push({id:a[c]});b.write=function(){var a=b.msgHeader();return a[b.name]={POSIDS:b.posids},a}},_nex.commands.RemoveFromOrder.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.RemoveTender=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="REMOVETENDER",b.tenderId="",a&&(b.tenderId=a),b.write=function(){var a=b.msgHeader();return a[b.name]={tenderid:b.tenderId},a}},_nex.commands.RemoveTender.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.RequestPreviousOrders=function(a){_nex.commands._BaseRequest.call(this);var b=this;b.name="REQUESTPREVIOUSORDERS",b.data="",a&&(b.data=a),b.write=function(){var a=b.msgHeader();return a[b.name]={cardnumber:b.data,locationid:_nex.assets.theme.system.storeid},a}},_nex.commands.RequestPreviousOrders.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.SubstituteModifier=function(a,b,c,d,e,f,g,h,i,j,k,l,m){_nex.commands._BaseRequest.call(this);var n=this;n.posid=a||"",n.priceLevel=b||"",n.removePosid=c||"",n.removePriceLevel=d||"",n.quantity=e||1,n.menuid=f||"",n.menuStackIndex=g||"",n.upsell=h||"false",n.pricedBy=i||"",n.buttonIndex=j,n.buttonInfo=k||"",n.menu=l||null,n.template=m||null,n.name="SUBSTITUTEMODIFIER",n.write=function(){var a=n.msgHeader();return a[n.name]={posid:n.posid,pricelevel:n.priceLevel,removeposid:n.removePosid,removepricelevel:n.removePriceLevel,quantity:n.quantity.toString(),menuid:n.menuid.toString(),menustackindex:n.menuStackIndex.toString(),upsell:n.upsell,pricedby:n.pricedBy,buttonindex:n.buttonIndex,BUTTONINFO:n.buttonInfo},null!==n.menu&&(a[n.name].MENU=n.menu,a[n.name].TEMPLATE=n.template),a}},_nex.commands.SubstituteModifier.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.UpdateComment=function(a,b){_nex.commands._BaseRequest.call(this);var c=this;c.itemIndex=a.toString(),c.comment=b,c.name="UPDATECOMMENT",c.write=function(){var a=this.msgHeader();return a[this.name]={index:c.itemIndex,comment:c.comment},a}},_nex.commands.UpdateComment.prototype=Object.create(_nex.commands._BaseRequest.prototype),_nex.commands.UpdateQuantity=function(a,b,c,d,e,f){_nex.commands._BaseRequest.call(this);var g=this;g.itemIndex=a.toString(),g.delta=b.toString(),g.isModifier=void 0!==c&&c,g.modPosid=d,g.menu=e||null,g.template=f||null,g.name="UPDATEQUANTITY",g.write=function(){var a=this.msgHeader();return a[g.name]={index:this.itemIndex,delta:this.delta},this.isModifier&&(a[g.name].ismodifier="true",a[g.name].modposid=g.modPosid),null!==g.menu&&(a[g.name].MENU=g.menu),null!==g.template&&(a[g.name].TEMPLATE=g.template),a}},_nex.commands.UpdateQuantity.prototype=Object.create(_nex.commands._BaseRequest.prototype);